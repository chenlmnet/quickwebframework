/* (c) :torweg free software group */
Ext.namespace('PULSE');Ext.namespace('Pulse');Ext.namespace('DBG');var DBG={type:'DBG',Pulse:{THROW:false,Execute:false,Throw:false,loadPanelCallBack:{In:false,Out:false,IgnoreError:false},loadPanelCallBackDisablePanel:{In:false,Out:false,IgnoreError:false},initTextFieldMonitor:false,initTextAreaMonitor:false,initCheckBoxMonitor:false,initDropDownBoxMonitor:false,insertHasChangesIcon:false,getWestToolbar:{refresh:false,cfg:false},getWestMinimizeTool:{handlerTool:false,handlerBtnInitialConfig:false,handlerPassedConfig:false,handlerPassedConfigExpand:false,handlerPassedConfigExpandDeferred:true},getFlagCls:true,debug:false,getRootCause:false,dbgError:false,isError:false,__errorArgsTests:false,__errorBasicTests:false,__errorDeepTests:false,__errorHandleTests:false,__errorHandleTestsTwo:false},apply:function(superObj,obj,boolCloneSuperObj){if(false===boolCloneSuperObj){if(typeof(obj)=='object'&&typeof(obj.push)=='function'){return this._applyArray(superObj,obj);}
return this._apply(superObj,obj);}else{var o=this.apply({},superObj,false);if(typeof(obj)=='object'&&typeof(obj.push)=='function'){return this._applyArray(o,obj);}
return this._apply(o,obj);}},_apply:function(superObj,obj){for(var i in obj){if(typeof(obj[i])=='boolean'){superObj[i]=obj[i];continue;}
if(typeof(obj[i])=='object'&&typeof(superObj[i])=='object'){superObj[i]=this._apply(superObj[i],obj[i]);continue;}else if(typeof(obj[i])=='object'){superObj[i]=obj[i];continue;}}
return superObj;},applyArray:function(superObj,arr,boolCloneSuperObj){if(false===boolCloneSuperObj){return this._applyArray(superObj,obj);}else{var o=this.apply({},superObj,false);return this._applyArray(o,obj);}},_applyArray:function(superObj,arr){for(var i=0;i<arr.length;i++){if(typeof(arr[i])=='string'&&arr[i]!==''){switch(arr[i].split('.').length){case 1:superObj[arr[i].split('.')[0]]=true;break;case 2:superObj[arr[i].split('.')[0]][arr[i].split('.')[1]]=true;break;case 3:superObj[arr[i].split('.')[0]][arr[i].split('.')[1]][arr[i].split('.')[2]]=true;break;case 4:superObj[arr[i].split('.')[0]][arr[i].split('.')[1]][arr[i].split('.')[2]][arr[i].split('.')[3]]=true;break;case 5:superObj[arr[i].split('.')[0]][arr[i].split('.')[1]][arr[i].split('.')[2]][arr[i].split('.')[3]][arr[i].split('.')[4]]=true;break;default:FATAL(arr[i]+' EXCEEDS MAX-DEPTH: 5',this,'_applyArray');break;}}}
return superObj;},get:function(pObj,obj){var o=DBG[pObj.type];if(typeof(o)=='undefined'){return this.buildDBG({},obj);}
return this.buildDBG(o,obj);},buildDBG:function(pDBG,obj){if(typeof(obj)=='boolean'){return obj;}
if(typeof(obj)=='object'){if(typeof(obj.push)=='function'){return this.applyArray(pObj,obj,false);}else{return this.apply(pObj,obj,false);}}
return false;},getPropertyArray:function(obj,boolFlat,prop){try{if(typeof(prop)!='string'){prop='';}else{prop+='.';}
arr=[];for(var i in obj){if(typeof(obj[i])=='object'&&typeof(obj[i].push)!='function'&&false===boolFlat){arr=arr.concat(this.getPropertyArray(obj[i],boolFlat,''+i));}else{arr.push(prop+i);}}
return arr;}catch(e){FATAL(e,this,'getPropertyArray');}}};var Pulse={props:{id:null},LOC:{},type:'Pulse',DBG:DBG.Pulse,fieldCls:'editorInputField',disabledFieldCls:'editorInputFieldDisabled',Execute:function(config){THROW({args:arguments,p:[{n:'id',o:''+config.id},{n:'editor',o:''+config.editor},{n:'fn',o:''+config.fn},{n:'params',o:''+config.params},{n:'Ext.getCmp(config.id)',o:typeof(Ext.getCmp(config.id))},{n:'Ext.getCmp(config.id)[config.editor]',o:typeof(Ext.getCmp(config.id)[config.editor])},{n:'Ext.getCmp(config.id)[config.editor].type',o:Ext.getCmp(config.id)[config.editor].type},{n:'Ext.getCmp(config.id)[config.editor].id',o:Ext.getCmp(config.id)[config.editor].id},{n:'Ext.getCmp(config.id)[config.editor][config.fn]',o:typeof(Ext.getCmp(config.id)[config.editor][config.fn])}]},this,'Execute');try{Ext.getCmp(config.id)[config.editor][config.fn](config.params);}catch(e){THROW({e:'FATAL',o:e,p:[{n:'id',o:''+config.id},{n:'editor',o:''+config.editor},{n:'fn',o:''+config.fn},{n:'params',o:''+config.params},{n:'Ext.getCmp(config.id)',o:typeof(Ext.getCmp(config.id))},{n:'Ext.getCmp(config.id)[config.editor]',o:typeof(Ext.getCmp(config.id)[config.editor])},{n:'Ext.getCmp(config.id)[config.editor].type',o:Ext.getCmp(config.id)[config.editor].type},{n:'Ext.getCmp(config.id)[config.editor].id',o:Ext.getCmp(config.id)[config.editor].id},{n:'Ext.getCmp(config.id)[config.editor][config.fn]',o:typeof(Ext.getCmp(config.id)[config.editor][config.fn])}]},this,'Execute');}},Throw:function(eO,bHandle){try{if(true===bHandle){alert('bHandle: '+bHandle+'\neO.getHandle(true): '+this.getErrorHandle(eO,true));if(typeof(this.getErrorHandle(eO,true))=='function'){this.getErrorHandle(eO,true)(eO);}else{try{e=(typeof(this.getRootCause(eO).error)=='object')?this.getRootCause(eO).error.e:this.getRootCause(eO).e;Pulse.Error.Handler[e](eO);}catch(e){Pulse.Error.Handler['undefined'](eO);}}}else if(typeof(this.getErrorHandle(eO))=='function'){this.getErrorHandle(eO,bHandle)(eO);}
PulseErrorWindow.Throw(this.dbgError(eO));if(true===this.DBG.Throw){PulseErrorWindow.Throw(['DBG','Throw Pulse.getRootCause(eO): '+this.getRootCause(eO),'Throw Pulse.getRootCause(eO).error: '+this.getRootCause(eO).error,'Throw Pulse.getRootCause(eO).e: '+this.getRootCause(eO).e]);}}catch(e){try{PulseErrorWindow.Throw(['FATAL.Throw'].concat(this.dbgError(eO)));PulseErrorWindow.Throw(['FATAL.Throw'].concat(this.dbgError(e)));}catch(ee){PulseErrorWindow.Throw(['FATAL.Throw',''+e]);}}},ajaxSuccess:function(response,object,fnName,bHandle){try{decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){return true;}else if(typeof(decodedResponse.error)!='undefined'){Pulse.Throw(new Pulse.Error(decodedResponse.error,object,fnName),bHandle);return false;}}catch(decodingError){}
return Pulse.ajaxFailure(response,object,fnName,bHandle);},ajaxFailure:function(response,object,fnName,bHandle){if(typeof(response.responseText)=='undefined'){Pulse.Throw(new Pulse.Error({e:'REQUEST.FAILED',o:response},object,fnName),bHandle);}else{Pulse.Throw(new Pulse.Error({e:'REQUEST.ERROR',o:response.responseText},object,fnName),bHandle);}
return false;},loadPanelCallBack:function(loadedPanel,success,response,options){THROW({args:arguments,propsObj:loadedPanel,props:['id','type','xtype'],o:new Pulse.Error({propsObj:options,props:['url','method','scripts','callback','timeout'],o:new Pulse.Error({propsObj:response,props:['status','responseText']},'response','loadPanelCallBack')},'options','loadPanelCallBack')},Pulse,'loadPanelCallBack.In');if(true===success){try{decodedResponse=Ext.decode(response.responseText);if(response.status>=400&&typeof(decodedResponse)!='undefined'&&typeof(decodedResponse.error)!='undefined'){THROW({e:'SERVER.ERROR',o:decodedResponse.error},Pulse,'loadPanelCallBack');loadedPanel.update('<div>1...load failure:\n'+decodedResponse.error.e+'</div>');return;}}catch(ignoreError){if(response.status>=400){loadedPanel.update('<div>2...load failure:\n'+response.responseText+'</div>');THROW({e:'REQUEST.ERROR.CHECK',o:response.responseText},Pulse,'loadPanelCallBack');}
THROW({args:arguments,o:new Pulse.Error({e:'response does not contain JSONObject error!',o:ignoreError,propsObj:options,props:['url','method']}),propsObj:response,props:['status','responseText']},Pulse,'loadPanelCallBack.IgnoreError');return;}}else{if(typeof(response)=='undefined'){loadedPanel.update('<div>3...load failure</div>');THROW({args:arguments,o:new Pulse.Error({e:'REQUEST.FAILED',propsObj:options,props:['url','method']})},Pulse,'loadPanelCallBack.Out');return;}else{loadedPanel.update('<div>4...load failure:\n'+response.responseText+'</div>');THROW({args:arguments,o:new Pulse.Error({e:'REQUEST.ERROR',propsObj:options,props:['url','method']}),propsObj:response,props:['status','responseText']},Pulse,'loadPanelCallBack.Out');return;}}
if(response.status>=400||false===success){THROW({e:'FATAL',args:arguments,propsObj:loadedPanel,props:['id','type','xtype'],o:new Pulse.Error({propsObj:options,props:['url','method','scripts'],o:new Pulse.Error({propsObj:response,props:['status','responseText']},'response','loadPanelCallBack')},'options','loadPanelCallBack')},Pulse,'loadPanelCallBack');}},loadPanelCallBackDisablePanel:function(loadedPanel,success,response,options){THROW({args:arguments,propsObj:loadedPanel,props:['id','type','xtype'],o:new Pulse.Error({propsObj:options,props:['url','method','scripts','callback','timeout'],o:new Pulse.Error({propsObj:response,props:['status','responseText']},'response','loadPanelCallBackDisablePanel')},'options','loadPanelCallBackDisablePanel')},Pulse,'loadPanelCallBackDisablePanel.In');if(true!==loadedPanel.pulseMask||false===loadedPanel.hasClass('pulseTransparentMask')){Ext.DomHelper.append(loadedPanel.dom,{cls:'pulseTransparentMask'},true);loadedPanel.pulseMask=true;}
if(true===success){try{decodedResponse=Ext.decode(response.responseText);if(response.status>=400&&typeof(decodedResponse)!='undefined'&&typeof(decodedResponse.error)!='undefined'){THROW({e:'SERVER.ERROR',o:decodedResponse.error},Pulse,'loadPanelCallBackDisablePanel');loadedPanel.update('<div>1...load failure:\n'+decodedResponse.error.e+'</div>');return;}}catch(ignoreError){if(response.status>=400){loadedPanel.update('<div>2...load failure:\n'+response.responseText+'</div>');THROW({e:'REQUEST.ERROR.CHECK',o:response.responseText},Pulse,'loadPanelCallBackDisablePanel');}
THROW({args:arguments,o:new Pulse.Error({e:'response does not contain JSONObject error!',o:ignoreError,propsObj:options,props:['url','method']}),propsObj:response,props:['status','responseText']},Pulse,'loadPanelCallBackDisablePanel.IgnoreError');return;}}else{if(typeof(response)=='undefined'){loadedPanel.update('<div>3...load failure</div>');THROW({args:arguments,o:new Pulse.Error({e:'REQUEST.FAILED',propsObj:options,props:['url','method']})},Pulse,'loadPanelCallBackDisablePanel.Out');return;}else{loadedPanel.update('<div>4...load failure:\n'+response.responseText+'</div>');THROW({args:arguments,o:new Pulse.Error({e:'REQUEST.ERROR',propsObj:options,props:['url','method']}),propsObj:response,props:['status','responseText']},Pulse,'loadPanelCallBackDisablePanel.Out');return;}}
if(response.status>=400||false===success){THROW({e:'FATAL',args:arguments,propsObj:loadedPanel,props:['id','type','xtype'],o:new Pulse.Error({propsObj:options,props:['url','method','scripts'],o:new Pulse.Error({propsObj:response,props:['status','responseText']},'response','loadPanelCallBackDisablePanel')},'options','loadPanelCallBackDisablePanel')},Pulse,'loadPanelCallBackDisablePanel');}},initTextFieldMonitor:function(el,monitor,identifier,allowBlank){THROW({args:arguments},this,'initTextFieldMonitor');try{el.type='TextFieldMonitor';el.DBG=false;el.initValue=el.dom.value.trim();el.changed=false;el.monitor=monitor;el.allowBlank=allowBlank;el.on('keyup',function(){if(false===allowBlank&&this[identifier].dom.value===''){this[identifier].replaceClass(Pulse.fieldCls,Pulse.fieldCls+'Red');this[identifier].replaceClass(Pulse.fieldCls+'Yellow',Pulse.fieldCls+'Red');this[identifier].changed=false;if(typeof(this.tab)!='undefined'&&this.tab!==null){PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'changeNotSaveable'}]});}
if(typeof(this.fireEvent)=='function'){this.fireEvent('MSG','changeNotSaveable',this);}}else if(this[identifier].dom.value===this[identifier].initValue){this[identifier].replaceClass(Pulse.fieldCls+'Yellow',Pulse.fieldCls);this[identifier].replaceClass(Pulse.fieldCls+'Red',Pulse.fieldCls);this[identifier].reset();if(typeof(this.hasChanges)=='function'&&typeof(this.reset)=='function'){if(false===this.hasChanges()){this.reset();}}}else{this[identifier].replaceClass(Pulse.fieldCls,Pulse.fieldCls+'Yellow');this[identifier].replaceClass(Pulse.fieldCls+'Red',Pulse.fieldCls+'Yellow');this[identifier].changed=true;if(typeof(this.tab)!='undefined'&&this.tab!==null){if(typeof(this.tab.toggleHasChangesIcon)=='function'){this.tab.toggleHasChangesIcon(true);}
PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'change'}]});}
if(typeof(this.panel)!='undefined'&&this.panel!==null&&typeof(this.panel.toggleHasChangesIcon)=='function'){this.panel.toggleHasChangesIcon(true);}
if(typeof(this.fireEvent)=='function'){this.fireEvent('MSG','change',this);}}},monitor);el.commit=function(){this.initValue=this.dom.value.trim();this.replaceClass(Pulse.fieldCls+'Yellow',Pulse.fieldCls);this.replaceClass(Pulse.fieldCls+'Red',Pulse.fieldCls);this.changed=false;};el.reset=function(){this.dom.value=this.initValue;this.replaceClass(Pulse.fieldCls+'Yellow',Pulse.fieldCls);this.replaceClass(Pulse.fieldCls+'Red',Pulse.fieldCls);this.changed=false;if(typeof(this.monitor.fieldReset)=='function'){this.monitor.fieldReset();}};return el;}catch(e){THROW({e:e},this,'initTextFieldMonitor');}},initTextAreaMonitor:function(el,monitor,identifier){THROW({args:arguments},this,'initTextAreaMonitor');el.initValue=el.getValue().trim();el.changed=false;el.monitor=monitor;el.on('keyup',function(){if(this[identifier].getValue().trim()===this[identifier].initValue){this[identifier].replaceClass(Pulse.fieldCls+'Yellow',Pulse.fieldCls);this[identifier].changed=false;if(typeof(this.hasChanges)=='function'&&typeof(this.reset)=='function'){if(false===this.hasChanges()){this.reset();}}}else{this[identifier].replaceClass(Pulse.fieldCls,Pulse.fieldCls+'Yellow');this[identifier].changed=true;if(typeof(this.tab)!='undefined'&&this.tab!==null){if(typeof(this.tab.toggleHasChangesIcon)=='function'){this.tab.toggleHasChangesIcon(true);}
PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'change'}]});}
if(typeof(this.panel)!='undefined'&&this.panel!==null&&typeof(this.panel.toggleHasChangesIcon)=='function'){this.panel.toggleHasChangesIcon(true);}
if(typeof(this.fireEvent)=='function'){this.fireEvent('MSG','change',this);}}},monitor);el.commit=function(){this.initValue=this.getValue().trim();this.replaceClass(Pulse.fieldCls+'Yellow',Pulse.fieldCls);this.changed=false;};el.reset=function(){this.update(this.initValue);this.replaceClass(Pulse.fieldCls+'Yellow',Pulse.fieldCls);this.changed=false;if(typeof(this.monitor.fieldReset)=='function'){this.monitor.fieldReset();}};},initCheckBoxMonitor:function(el,monitor,identifier){THROW({args:arguments},this,'initCheckBoxMonitor');el.initValue=el.dom.checked;el.changed=false;el.monitor=monitor;el.on('click',function(){if(this[identifier].dom.checked===this[identifier].initValue){this[identifier].replaceClass(Pulse.fieldCls+'Yellow',Pulse.fieldCls);this[identifier].changed=false;if(typeof(this.hasChanges)=='function'&&typeof(this.reset)=='function'){if(false===this.hasChanges()){this.reset();}}}else{this[identifier].replaceClass(Pulse.fieldCls,Pulse.fieldCls+'Yellow');this[identifier].changed=true;if(typeof(this.tab)!='undefined'&&this.tab!==null){if(typeof(this.tab.toggleHasChangesIcon)=='function'){this.tab.toggleHasChangesIcon(true);}
PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'change'}]});}
if(typeof(this.panel)!='undefined'&&this.panel!==null&&typeof(this.panel.toggleHasChangesIcon)=='function'){this.panel.toggleHasChangesIcon(true);}
if(typeof(this.fireEvent)=='function'){this.fireEvent('MSG','change',this);}}},monitor);el.commit=function(){this.initValue=this.dom.checked;this.replaceClass(Pulse.fieldCls+'Yellow',Pulse.fieldCls);this.changed=false;};el.reset=function(){this.dom.checked=this.initValue;this.replaceClass(Pulse.fieldCls+'Yellow',Pulse.fieldCls);this.changed=false;if(typeof(this.monitor.fieldReset)=='function'){this.monitor.fieldReset();}};if(true===el.hasClass('isBoolean')){el.getValue=function(){return this.dom.checked;};}},initDropDownBoxMonitor:function(box,monitor,identifier){THROW({args:arguments},this,'initDropDownBoxMonitor');box.initValue=box.getValue().trim();box.changed=false;box.monitor=monitor;box.on('select',function(){if(this[identifier].getValue().trim()===this[identifier].initValue){this[identifier].getEl().replaceClass(Pulse.fieldCls+'Yellow',Pulse.fieldCls);this[identifier].changed=false;if(typeof(this.hasChanges)=='function'&&typeof(this.reset)=='function'){if(false===this.hasChanges()){this.reset();}}}else{this[identifier].getEl().replaceClass(Pulse.fieldCls,Pulse.fieldCls+'Yellow');this[identifier].changed=true;if(typeof(this.tab)!='undefined'&&this.tab!==null){if(typeof(this.tab.toggleHasChangesIcon)=='function'){this.tab.toggleHasChangesIcon(true);}
PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'change'}]});}
if(typeof(this.panel)!='undefined'&&this.panel!==null&&typeof(this.panel.toggleHasChangesIcon)=='function'){this.panel.toggleHasChangesIcon(true);}
if(typeof(this.fireEvent)=='function'){this.fireEvent('MSG','change',this);}}},monitor);box.commit=function(){this.initValue=this.getValue().trim();this.getEl().replaceClass(Pulse.fieldCls+'Yellow',Pulse.fieldCls);this.changed=false;};box.on('reset',function(){this.changed=false;if(typeof(this.monitor.fieldReset)=='function'){this.monitor.fieldReset();}},box);},initSelectBoxMonitor:function(box,monitor,identifier){THROW({args:arguments},this,'initSelectBoxMonitor');box.initValue=box.getValue().trim();box.changed=false;box.monitor=monitor;box.on('change',function(){if(this[identifier].getValue().trim()===this[identifier].initValue){this[identifier].replaceClass(Pulse.fieldCls+'Yellow',Pulse.fieldCls);this[identifier].changed=false;if(typeof(this.hasChanges)=='function'&&typeof(this.reset)=='function'){if(false===this.hasChanges()){this.reset();}}}else{this[identifier].replaceClass(Pulse.fieldCls,Pulse.fieldCls+'Yellow');this[identifier].changed=true;if(typeof(this.tab)!='undefined'&&this.tab!==null){if(typeof(this.tab.toggleHasChangesIcon)=='function'){this.tab.toggleHasChangesIcon(true);}
PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'change'}]});}
if(typeof(this.panel)!='undefined'&&this.panel!==null&&typeof(this.panel.toggleHasChangesIcon)=='function'){this.panel.toggleHasChangesIcon(true);}
if(typeof(this.fireEvent)=='function'){this.fireEvent('MSG','change',this);}}},monitor);box.commit=function(){this.initValue=this.getValue().trim();this.replaceClass(Pulse.fieldCls+'Yellow',Pulse.fieldCls);this.changed=false;};box.on('reset',function(){this.changed=false;this.replaceClass(Pulse.fieldCls+'Yellow',Pulse.fieldCls);if(typeof(this.monitor.fieldReset)=='function'){this.monitor.fieldReset();}},box);},getBundleBox:function(emptySelect){data=VIEWPORT_PROPERTIES.getKnownBundlesForBox();if(typeof(emptySelect)=='string'){data.push([emptySelect]);}
return new Ext.form.ComboBox({emptySelect:emptySelect,fieldLabel:VIEWPORT_PROPERTIES.BUNDLE,fieldClass:Pulse.fieldCls,store:new Ext.data.SimpleStore({fields:['bundle'],sortInfo:{field:'bundle',direction:"ASC"},data:data}),displayField:'bundle',valueField:'bundle',mode:'local',triggerAction:'all',editable:false,width:200,emptyText:VIEWPORT_PROPERTIES.TEXT_SELECTBUNDLE_BOX,validator:function(value){if(typeof(this.emptySelect)=='string'){if(typeof(value)=='string'&&value==this.emptySelect){this.setValue('');this.setRawValue('');}}
return true;}});},getLocaleBox:function(emptySelect){data=VIEWPORT_PROPERTIES.getKnownLocalesForBox();if(typeof(emptySelect)=='string'){data.push([emptySelect]);}
return new Ext.form.ComboBox({fieldLabel:VIEWPORT_PROPERTIES.LOCALE,fieldClass:Pulse.fieldCls,store:new Ext.data.SimpleStore({fields:['locale'],sortInfo:{field:'locale',direction:"ASC"},data:data}),displayField:'locale',valueField:'locale',mode:'local',triggerAction:'all',editable:false,width:200,emptyText:VIEWPORT_PROPERTIES.TEXT_SELECTLOCALE_BOX,validator:function(value){if(typeof(this.emptySelect)=='string'){if(typeof(value)=='string'&&value==this.emptySelect){this.setValue('');this.setRawValue('');}}
return true;}});},getWestToolbar:function(config){return['->',{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_RELOAD,scope:config,handler:function(){comp=Ext.getCmp(this.id);if(true===comp.getUpdater().isUpdating()){return;}
THROW({args:arguments,propsObj:comp,props:['id','config','initialConfig','initialConfig.autoLoad','autoLoad','autoLoad.url','autoLoad.method','autoLoad.scripts','autoLoad.timeout','autoLoad.nocache','autoLoad.discardUrl','autoLoad.params','autoLoad.callback']},Pulse,'getWestToolbar.refresh');cfg=comp.initialConfig.autoLoad;cfg.callback=LPCB;cfg.timeout=30;THROW({args:arguments,propsObj:cfg,o:comp,props:['url','method','callback','scripts','params','nocache','discardUrl','timeout']},Pulse,'getWestToolbar.cfg');comp.load(cfg);},iconCls:'reloadIconCls'}];},getWestMinimizeTool:function(){tools=[];tools.push({id:'minimize',handler:function(evt,tEl,pnl){THROW({args:arguments,propsObj:pnl,props:['id','tbar','tools','title','iconCls','initialConfig','initialConfig.autoLoad.url','initialConfig.autoLoad.method','initialConfig.autoLoad.scripts','initialConfig.autoLoad.timeout','initialConfig.autoLoad.nocache','initialConfig.autoLoad.discardUrl','initialConfig.autoLoad.params','initialConfig.autoLoad.callback']},Pulse,'getWestMinimizeTool.handlerTool');initialConfig=pnl.initialConfig;title=pnl.title;west=Ext.getCmp('west-region');height=west.getSize().height;west.remove(pnl);pnl.destroy();pnl=null;delete pnl;pBar=west.getBottomToolbar();action=new Ext.Action({id:initialConfig.id+'.btn',tooltip:title,scope:initialConfig,handler:function(passedConfig){west=Ext.getCmp('west-region');height=west.getSize().height;THROW({args:arguments,propsObj:this,props:['id','tbar','tools','title','iconCls','autoLoad.url','autoLoad.method','autoLoad.scripts','autoLoad.timeout','autoLoad.nocache','autoLoad.discardUrl','autoLoad.params','autoLoad.callback']},Pulse,'getWestMinimizeTool.handlerBtnInitialConfig');if(typeof(this.autoLoad)!='undefined'){this.autoLoad.callback=LPCB;this.autoLoad.timeout=30;}
this.collapsed=false;if(typeof(passedConfig)!='undefined'&&typeof(passedConfig.callback)=='function'){this.passedConfig=passedConfig;}
_panel=new Ext.Panel(this);THROW({args:arguments,propsObj:passedConfig,props:['id','decodedResponse','decodedResponse.ids','callback']},Pulse,'getWestMinimizeTool.handlerPassedConfig');west.insert(0,_panel);Ext.getCmp(this.id+'.btn').destroy();PULSE_TOOLBAR.actions[(this.id+'.btn').split('.').join('')]=null;delete PULSE_TOOLBAR.actions[(this.id+'.btn').split('.').join('')];west.doLayout();_panel.expand();Ext.getCmp('west-region').setHeight(height);VIEWPORT.fireEvent('resize',VIEWPORT,0,0,VIEWPORT.getSize().width,VIEWPORT.getSize().height);},iconCls:initialConfig.iconCls});if(typeof(pBar.actions)=='undefined'||pBar.actions===null){pBar.actions={};}
pBar.actions[(initialConfig.id+'.btn').split('.').join('')]=action;pBar.addButton(action);west.setHeight(height);west.doLayout();}});return tools;},debug:function(eDef,obj,fn){try{if(typeof(eDef)!='undefined'&&typeof(eDef.e)=='undefined'&&typeof(obj)!='undefined'){show=true;if(false===obj.DBG){show=false;}else if(typeof(obj.DBG)=='object'){DBG_UNDEFINED_ERROR=false;switch(fn.split('.').length){case 1:show=obj.DBG[fn.split('.')[0]];break;case 2:try{show=obj.DBG[fn.split('.')[0]][fn.split('.')[1]];}catch(_DBG_UNDEFINED_ERROR){DBG_UNDEFINED_ERROR=_DBG_UNDEFINED_ERROR;}
break;case 3:try{show=obj.DBG[fn.split('.')[0]][fn.split('.')[1]][fn.split('.')[2]];}catch(_DBG_UNDEFINED_ERROR){DBG_UNDEFINED_ERROR=_DBG_UNDEFINED_ERROR;}
break;case 4:try{show=obj.DBG[fn.split('.')[0]][fn.split('.')[1]][fn.split('.')[2]][fn.split('.')[3]];}catch(_DBG_UNDEFINED_ERROR){DBG_UNDEFINED_ERROR=_DBG_UNDEFINED_ERROR;}
break;case 5:try{show=obj.DBG[fn.split('.')[0]][fn.split('.')[1]][fn.split('.')[2]][fn.split('.')[3]][fn.split('.')[4]];}catch(_DBG_UNDEFINED_ERROR){DBG_UNDEFINED_ERROR=_DBG_UNDEFINED_ERROR;}
break;default:FATAL(fn+' EXCEEDS MAX-DEPTH: 5',this,'debug');break;}
if(typeof(show)!='boolean'){if(DBG.Pulse.debug){PulseErrorWindow.Throw(['DBG','ERROR::debug','DBG_UNDEFINED_ERROR: '+DBG_UNDEFINED_ERROR,'typeof(show) != \'boolean\' => '+show]);}
show=false;}
if(DBG.Pulse.debug){PulseErrorWindow.Throw(['DBG','DBG::debug','show => '+show]);}}else if(typeof(obj.type)=='string'&&typeof(DBG[obj.type])=='object'){DBG_UNDEFINED_ERROR=false;switch(fn.split('.').length){case 1:show=DBG[obj.type][fn.split('.')[0]];break;case 2:try{show=DBG[obj.type][fn.split('.')[0]][fn.split('.')[1]];}catch(_DBG_UNDEFINED_ERROR){DBG_UNDEFINED_ERROR=_DBG_UNDEFINED_ERROR;}
break;case 3:try{show=DBG[obj.type][fn.split('.')[0]][fn.split('.')[1]][fn.split('.')[2]];}catch(_DBG_UNDEFINED_ERROR){DBG_UNDEFINED_ERROR=_DBG_UNDEFINED_ERROR;}
break;case 4:try{show=DBG[obj.type][fn.split('.')[0]][fn.split('.')[1]][fn.split('.')[2]][fn.split('.')[3]];}catch(_DBG_UNDEFINED_ERROR){DBG_UNDEFINED_ERROR=_DBG_UNDEFINED_ERROR;}
break;case 5:try{show=DBG[obj.type][fn.split('.')[0]][fn.split('.')[1]][fn.split('.')[2]][fn.split('.')[3]][fn.split('.')[4]];}catch(_DBG_UNDEFINED_ERROR){DBG_UNDEFINED_ERROR=_DBG_UNDEFINED_ERROR;}
break;default:FATAL(fn+' EXCEEDS MAX-DEPTH: 5',this,'debug');break;}
if(typeof(show)!='boolean'){if(DBG.Pulse.debug){PulseErrorWindow.Throw(['DBG','ERROR::debug','DBG_UNDEFINED_ERROR: '+DBG_UNDEFINED_ERROR,'typeof(show) != \'boolean\' => '+show]);}
show=false;}
if(DBG.Pulse.debug){PulseErrorWindow.Throw(['DBG','DBG::debug','show => '+show]);}}
if(false===show&&false!==Pulse.DBG.THROW){args='';if(typeof(eDef)!='undefined'&&typeof(eDef.args)!='undefined'){args+=Pulse.getArgsString(eDef.args);}
try{PulseErrorWindow.Throw(['DBG','THROW DBG.supressed - {'+obj.type+'}.'+fn+'( '+args+' )'],false);}catch(e){PulseErrorWindow.Throw(['DBG','THROW DBG.supressed - {'+e+'}.'+fn+'( '+args+' )'],false);}}
if(false===show){return;}}
if(false!==Pulse.DBG.THROW){args='';if(typeof(eDef)!='undefined'&&typeof(eDef.args)!='undefined'){args+=Pulse.getArgsString(eDef.args);}
try{PulseErrorWindow.Throw(['DBG','THROW DBG - {'+obj.type+'}.'+fn+'( '+args+' )'],false);}catch(e){PulseErrorWindow.Throw(['DBG','THROW DBG - {'+e+'}.'+fn+'( '+args+' )'],false);}}
if(typeof(eDef)=='object'&&eDef.type=='Error'){Pulse.Throw(eDef,obj,fn);}else{Pulse.Throw(new Pulse.Error(eDef,obj,fn));}}catch(ee){args='';try{args=Pulse.getArgsString(arguments);}catch(eee){args=eee;}
alert('FATAL THROW('+args+')\n\n'+ee);}},dbgError:function(error,dbg){_ii=0;if(true===this.DBG.dbgError){PulseErrorWindow.Throw(['DBG','['+_ii+++']Pulse.dbgError( '+this.getArgsString(arguments)+' )\n']);}
try{if(typeof(dbg)=='undefined'||typeof(dbg.length)=='undefined'){dbg=[];rootCause=this.getRootCause(error);if(true===this.DBG.dbgError){PulseErrorWindow.Throw(['DBG','['+_ii+++']Pulse.dbgError.rootCause = { '+typeof(rootCause)+' } '+rootCause+'\n']);}
if(typeof(rootCause)=='undefined'){dbg.push('ERROR');dbg.push('<b>e:</b> { '+this.colorString(typeof(rootCause),'blue')
+' } '+this.colorString(rootCause,'red'));dbg.push('<b>e.id</b> : '+error.id);}else{eString=(typeof(rootCause.error)!='undefined')?rootCause.error.e:rootCause.e;if(true===this.DBG.dbgError){PulseErrorWindow.Throw(['DBG','['+_ii+++']Pulse.dbgError.rootCause.error = { '+typeof(rootCause.error)+' } '+rootCause.error+'\n','['+_ii+++']Pulse.dbgError.eString = { '+typeof(eString)+' } '+eString+'\n','['+_ii+++']Pulse.dbgError.rootCause.e = { '+typeof(rootCause.e)+' } '+rootCause.e+'\n']);}
if(typeof(eString)=='undefined'){oString=(typeof(error.object)!='undefined'&&typeof(error.object.type)=='string')?error.object.type:error.object;eString=oString+'.'+error.fn;}
dbg.push(eString);dbg.push('<b>e.id</b> : '+error.id);if(true===this.isError(rootCause)){dbg.push('<b>e.in:</b> '+this.formatErrorHeader(rootCause));if(typeof(rootCause.error)=='object'){dbg.push('<b>e:</b> { '+this.colorString(typeof(rootCause.error.e),'blue')
+' } '+this.colorString(rootCause.error.e,'red'));}else{dbg.push('<b>e:</b> { '+this.colorString(typeof(rootCause.e),'blue')+' } '+this.colorString(rootCause.e,'red'));}}}}else{dbg.push('<hr class="adminHr"/>');dbg.push('<b>e.id</b> : '+error.id);dbg.push('');dbg.push('<b>in:</b> '+this.formatErrorHeader(error));}
if(true===this.DBG.dbgError){PulseErrorWindow.Throw(['DBG','['+_ii+++']Pulse.dbgError serializing error properties... \n']);}
if(typeof(error)=='undefined'){return dbg;}
if(error.type=='Error'){if(error.get('type')=='Error'){e=error.error;}else{e=error.get('e');}
o=error.get('o');p=error.get('p');args=error.get('args');props=error.get('props');propsObj=error.get('propsObj');}else{e=error.e;o=error.o;p=error.p;args=error.args;props=error.props;propsObj=error.propsObj;}
if(typeof(args)!='undefined'){dbg.push('');dbg.push('<b>ARGS ['+args.length+']</b>');dbg.push(this.getArgsString(args));}
if(true===this.DBG.dbgError){PulseErrorWindow.Throw(['DBG','['+_ii+++']Pulse.dbgError ARGS done... \n']);}
if(typeof(props)!='undefined'){dbg.push('');dbg.push('<b>PROPS ['+props.length+']</b>');try{given=false;if(typeof(propsObj)=='object'){given=true;}else if(typeof(error.object)=='object'){propsObj=error.object;}
if(typeof(propsObj)=='undefined'){throw('no Object to read properties from...');}
if(true===given){dbg.push('propsObj: '+given);_propsObj=(typeof(propsObj.type)!='undefined')?propsObj.type:propsObj;_propsObjId=propsObj.id;dbg.push('propsObj: { '+this.colorString(typeof(propsObj),'blue')+' } '+
_propsObj+' - ( id: '+_propsObjId+' )');}
dbg=this.dbgProperties(dbg,propsObj,props);}catch(getPropFailure){dbg.push('ERROR :: props: '+getPropFailure);}}
if(true===this.DBG.dbgError){PulseErrorWindow.Throw(['DBG','['+_ii+++']Pulse.dbgError PROPS done... \n']);}
if(typeof(p)!='undefined'){dbg.push('');dbg.push('<b>PARAMS ['+p.length+']</b>');try{dbg=this.dbgParams(dbg,p);}catch(getParamFailure){dbg.push('ERROR :: params: '+getParamFailure);}}
if(true===this.DBG.dbgError){PulseErrorWindow.Throw(['DBG','['+_ii+++']Pulse.dbgError PARAMS done... \n']);}
if(true===this.DBG.dbgError){PulseErrorWindow.Throw(['DBG','['+_ii+++']Pulse.dbgError NESTED {e} = { '+typeof(rootCause)+' } '+
rootCause+'.isError = '+this.isError(e)+'\n']);}
if(true===this.DBG.dbgError){PulseErrorWindow.Throw(['DBG','['+_ii+++']Pulse.dbgError NESTED {o} = { '+typeof(rootCause)+' } '+
rootCause+'.isError = '+this.isError(o)+'\n']);}
if(true===this.isError(e)){dbg.push('nested e:');dbg.concat(this.dbgError(e,dbg));}else{dbg.push('');dbg.push('nested e: '+this.formatProperty(e,'e'));}
if(true===this.isError(o)){dbg.push('nested o:');dbg.concat(this.dbgError(o,dbg));}else{dbg.push('');dbg.push('nested o: '+this.formatProperty(o,'o'));}
if(true===this.DBG.dbgError){PulseErrorWindow.Throw(['DBG','['+_ii+++']Pulse.dbgError NESTED {e} done... \n']);}
if(true===this.DBG.dbgError){PulseErrorWindow.Throw(['DBG','['+_ii+++']Pulse.dbgError NESTED {o} done... \n']);}}catch(dbgError){try{dbg.push('ERROR :: dbg: '+dbgError);}catch(ignoreError){dbg=['ERROR :: dbg: '+dbgError];}}
dbg.push('.');return dbg;},errorTests:['e','o','p','args','props','propsObj','handle','handler'],isError:function(obj){_jj=0;if(true===this.DBG.isError){PulseErrorWindow.Throw(['DBG','['+_jj+++']Pulse.isError( '+this.getArgsString(arguments)+' )\n']);}
if(typeof(obj)!='object'||typeof(obj)=='undefined'){return false;}
if(true===this.DBG.isError){PulseErrorWindow.Throw(['DBG','['+_jj+++']Pulse.isError( '+this.getArgsString(arguments)+' )\n']);}
if(obj.type=='Error'){return true;}
if(true===this.DBG.isError){PulseErrorWindow.Throw(['DBG','['+_jj+++']Pulse.isError( '+this.getArgsString(arguments)+' )\n']);}
for(_j=0;_j<this.errorTests.length;_j++){if(obj[this.errorTests[_j]]!='undefined'){return true;}}
if(true===this.DBG.isError){PulseErrorWindow.Throw(['DBG','['+_jj+++']Pulse.isError( '+this.getArgsString(arguments)+' )\n']);}
return false;},dbgParams:function(array,params){if(typeof(array)=='undefined'||typeof(array.push)!='function'){array=[];}
for(i=0;i<params.length;i++){paramString='['+i+'] ';try{param=params[i];if(typeof(param.o)!='undefined'||typeof(param.n)!='undefined'){paramString+=this.formatProperty(param.o,param.n);}else{paramString+=this.formatProperty(param);}}catch(paramFailure){paramString+=this.formatProperty(param,'param')+'  e: '+paramFailure;}
array.push(paramString);}
return array;},dbgProperties:function(array,propsObj,props){if(typeof(array)=='undefined'||typeof(array.push)!='function'){array=[];}
for(i=0;i<props.length;i++){propString='<b>['+i+']</b> ';try{prop=props[i];if(prop.indexOf('.')!=-1){propObj=this.retrieveProperty(prop,propsObj);propString+=this.formatProperty(propObj.o,prop);propString+='    @  '+propObj.addstr;}else{propString+=this.formatProperty(propsObj[prop],prop);}}catch(propFailure){propString+=propFailure;}
array.push(propString);}
return array;},retrieveProperty:function(prop,propsObj){propArr=prop.split('.');ii=0;propObj=propsObj[propArr[ii]];addstr=''+propArr[ii];ii+=1;while(typeof(propArr[ii])!='undefined'&&propArr[ii]!=''){if(typeof(propObj)=='undefined'){break;}
propObj=propObj[propArr[ii]];addstr+='.'+propArr[ii];ii+=1;}
return{o:propObj,addstr:addstr};},formatErrorHeader:function(error){ostring=(typeof(error.object)!='undefined'&&typeof(error.object.type)=='string')?error.object.type:error.object;append='';obj=error.object;if(typeof(error.error)=='object'&&typeof(error.error.args)!='undfined'){if(typeof(obj[error.fn])=='function'){obj=obj[error.fn];append='( '+this.getArgsString(error.error.args)+' )';}}
return'<b>{ '+this.colorString(typeof(obj),'blue')+' }  '+ostring+'.'+error.fn+append+'</b>';},formatProperty:function(prop,identifier){if(typeof(identifier)!='undefined'){return'<b>{ '+this.colorString(typeof(prop),'blue')+' '+identifier+' } '+
this.formatPropertyValue(prop)+'</b>';}
return'<b>{ '+this.colorString(typeof(prop),'blue')+' } '+
this.formatPropertyValue(prop)+'</b>';},formatPropertyValue:function(value){if(typeof(value)=='string'){return'"'+value+'"';}else if(typeof(value)!='undefined'&&typeof(value.length)=='number'&&typeof(value.push)=='function'){string='[ '+value;return string+' ]';}
return''+value;},colorString:function(string,color){return'<span style="color:'+color+';">'+string+'</span>';},getArgsString:function(args){string='';try{if(typeof(args)!='undefined'){for(i=0;i<args.length;i++){arg=args[i];if(arg===null){string+='{ '+this.colorString(typeof(arg),'blue')+' } ['+arg+']';}else if(typeof(arg)=='object'&&typeof(arg.push)=='function'){string+='{ '+this.colorString(typeof(arg),'blue')+' } ['+arg+']';}else if(typeof(arg)=='string'){string+='{ '+this.colorString(typeof(arg),'blue')+' } "'+arg+'"';}else{string+='{ '+this.colorString(typeof(arg),'blue')+' } '+arg;}
if(i<(args.length-1)){string+=' , ';}}}}catch(argsError){return'args: '+args+', e: '+this.colorString(argsError,'red');}
return string;},getRootCause:function(error,_kk){_kk=(typeof(_kk)=='undefined')?0:_kk;if(true===this.DBG.getRootCause){PulseErrorWindow.Throw(['DBG','['+_kk+++'.0]Pulse.getRootCause( '+arguments+' )\n','['+_kk+++'.0]Pulse.getRootCause( '+error.id+' )\n']);}
if(typeof(error.error)=='object'){if(true===this.handleError(error)){if(typeof(error.error.o)=='object'){if(true===this.DBG.getRootCause){PulseErrorWindow.Throw(['DBG','['+_kk+++'.1]Pulse.getRootCause( '+arguments+' )\n','['+_kk+++'.1]Pulse.getRootCause( '+error.id+' )\n']);}
return this.getRootCause(error.error.o,_kk);}}
if(true===this.DBG.getRootCause){PulseErrorWindow.Throw(['DBG','['+_kk+++'.2]Pulse.getRootCause( '+arguments+' )\n','['+_kk+++'.2]Pulse.getRootCause( '+error.id+' )\n']);}
return this.getRootCause(error.error,_kk);}
if(true===this.DBG.getRootCause){PulseErrorWindow.Throw(['DBG','['+_kk+++'.3]Pulse.getRootCause( '+arguments+' )\n','['+_kk+++'.3]Pulse.getRootCause( '+error.id+' )\n']);}
if(typeof(error)!='undefined'&&typeof(error.e)=='object'){return this.getRootCause(error.e,_kk);}
return error;},handleError:function(error){if(typeof(error.error)=='object'){if(error.error.type=='Error'){e=error.get('e');handler=error.get('handler');}else{e=error.error.e;handler=error.error.handler;}
if((typeof(e)=='string'&&e.toUpperCase()=='HANDLE')||typeof(handler)!='undefined'){return true;}}
return false;},getErrorHandle:function(error,bHandle){handle=(true!==bHandle)?this.handleError(error):bHandle;if(true===this.handleError(error)){if(typeof(error.get('o'))=='object'){return this.getErrorHandle(error.get('o'),handle);}}else{if(typeof(error.get('e'))=='object'){return this.getErrorHandle(error.get('e'),handle);}}
if(true===handle){handleError=this.getRootCause(error);try{if(typeof(handleError.handler)=='function'){return handleError.handler;}
if(typeof(handleError.handler)=='object'){return handleError.handler.handle;}}catch(e){}
if(typeof(handleError.object)=='string'){object=handleError.object;}else if(typeof(handleError.object)=='object'&&typeof(handleError.object.type)=='string'){object=handleError.object.type;}
if(typeof(Pulse[object])=='undefined'){return;}
if(typeof(Pulse[object].Handler)=='undefined'){return;}
handler=handleError.handler;if(typeof(handler)!='undefined'){if(true===handler){handler=handleError.e;}}else{handler=handleError.e;}
if(typeof(Pulse[object].Handler[handler])!='undefined'){return Pulse[object].Handler[handler];}else{return Pulse[object].Handler[handleError.functionName];}}},getFlagCls:function(localeString){try{return localeString.split('_')[1].toLowerCase()+'FlagCls';}catch(e){THROW({o:e,args:arguments},Pulse,'getFlagCls');return'errorIconCls';}},insertHasChangesIcon:function(panel){THROW({propsObj:panel,props:['id','header','header.id','header.className']},this,'insertHasChangesIcon');if(typeof(panel)=='undefined'||panel===null){return;}
try{if(typeof(panel.toggleHasChangesIcon)=='function'){return;}
titleSelector="*[@class*='x-panel-header-text']";if(panel.type=='SubEditorWindow'){titleSelector="*[@class*='x-window-header-text']";}
extPanelElTitleDom=Ext.DomQuery.selectNode(titleSelector,Ext.get(panel.header.id).dom);iconSelector="*[@class*='x-panel-inline-icon']";if(panel.type=='SubEditorWindow'){iconSelector="*[@class*='x-panel-icon']";}
extPanelElIconDom=Ext.DomQuery.selectNode(iconSelector,Ext.get(panel.header.id).dom);hasChangesIconImgEl=document.createElement('img');hasChangesIconImgEl.id=panel.id+'.hasChangesIconImgEl';hasChangesIconImgEl.src=Ext.BLANK_IMAGE_URL;hasChangesIconImgEl.className='tabHasChangesIconHidden';if(typeof(extPanelElIconDom)!='undefined'&&extPanelElIconDom!==null){extPanelElIconDom.parentNode.insertBefore(hasChangesIconImgEl,extPanelElIconDom);}else{extPanelElTitleDom.parentNode.insertBefore(hasChangesIconImgEl,extPanelElTitleDom);}
panel.hasChangesIconImgEl=hasChangesIconImgEl;panel.toggleHasChangesIcon=function(bool){if(typeof(bool)!='boolean'){if(this.hasChangesIconImgEl.className=='tabHasChangesIconHidden'){this.hasChangesIconImgEl.className='tabHasChangesIcon';}else{this.hasChangesIconImgEl.className='tabHasChangesIconHidden';}}else{if(true===bool){this.hasChangesIconImgEl.className='tabHasChangesIcon';}else{this.hasChangesIconImgEl.className='tabHasChangesIconHidden';}}};}catch(e){FATAL(e,this,'insertHasChangesIcon');}
return;},id:function(){if(this.props.id===null){this.props.id=0;}else{this.props.id+=1;}
return'pid_'+this.props.id;}};THROW=Pulse.debug;FATAL=function(e,o,fn,eString){props=['id','e','description'];if(typeof(e)=='object'&&e!==null){eString=(typeof(eString)=='string'&&eString!=='')?eString+': '+e.e:'FATAL'+': '+e.e;for(var _EPROP in e){props.push(''+_EPROP);}}else{eString=(typeof(eString)=='string'&&eString!=='')?eString:'FATAL';}
THROW({e:eString,o:e,propsObj:e,props:props},o,fn);};LPCB=Pulse.loadPanelCallBack;LPCB_DISABLE=Pulse.loadPanelCallBackDisablePanel;GETFLAG=Pulse.getFlagCls;Pulse.Configuration=function(configuration){this.configuration=configuration;};Pulse.Configuration.prototype={type:'Configuration',getConfiguration:function(){return this.configuration;},get:function(name){if(typeof(this.configuration[name])=='undefined'||this.configuration[name]===null){return null;}
return this.configuration[name];},has:function(name){if(typeof(this.configuration[name])=='undefined'){return false;}
return true;}};DBG.Editor={initComponent:{Editor:false},addSubEditor:{Editor:false},removeSubEditor:{Editor:false},removeSubEditors:false,isPulseEditor:false,hasChanges:{Editor:false},getChanges:{Editor:false},reset:{Editor:false},commit:{Editor:false},closeCreateFormWindow:false,createForm:{create:false,close:false},closeCreateFormWindow:false,registerEditorMSG:{Editor:false},editorMSG:{Editor:false},getContent:{Editor:false},MSG:false,initialize:false};Editor={forbiddenInitialConfigValues:['component','type','subEditors','isPulseEditor','configuration'],component:null,type:'Editor',DBG:false,implementsComparable:true,implementsConfigurable:false,isPulseEditor:true,addSubEditor:function(editor){if(this.DBG){THROW({args:arguments,o:editor,props:['id','subEditors.length','subEditors']},this,'addSubEditor.Editor');}
try{if(true===editor.isPulseEditor){if(typeof(this.getSubEditor(editor.id))!='undefined'){this.removeSubEditor(editor.id);}
if(typeof(editor.masterEditor)=='undefined'||editor.masterEditor===null){editor.masterEditor=this;}
this.registerEditorMSG(editor);this.subEditors.push(editor);if(this.DBG){THROW({args:arguments,o:editor,props:['id','subEditors.length','subEditors']},this,'addSubEditor.Editor');}
if(typeof(editor.init)=='function'){editor.init(this);}
return true;}
throw({e:'PULSE_EDITOR_CHECK: '+editor.isPulseEditor,editor:editor,editorId:editor.id,editorType:editor.type});}catch(e){if(this.DBG){FATAL(e,this,'addSubEditor.Editor');}}
return false;},getSubEditor:function(id){if(this.subEditors.length<1){return;}
for(var i=0;i<this.subEditors.length;i++){e=this.subEditors[i];if(e.id==id){return e;}}},getSubEditors:function(){return this.subEditors;},removeSubEditor:function(object,boolDestroy){if(this.DBG){THROW({args:arguments,propsObj:object,props:['id','type']},this,'removeSubEditor');}
if(this.subEditors.length<1){return false;}
id=object;if(typeof(object)=='object'){try{id=object.getId();}catch(e){if(this.DBG){FATAL(e,this,'removeSubEditor');}
return false;}}
for(var i=0;i<this.subEditors.length;i++){e=this.subEditors[i];if(e.id==id){this.subEditors.splice(i,1);if(true===boolDestroy){e.destroy(e);}
delete e;return true;}}
return false;},removeSubEditors:function(){if(typeof(this.subEditors)!='undefined'&&this.subEditors.length<1){return false;}
try{eO={};for(var i=0;i<this.subEditors.length;i++){try{this.subEditors[i].destroy(this.subEditors[i]);}catch(de){eO[i+'.o']=de;eO[i+'.toString']=''+de;eO[i+'.editor']=this.subEditors[i];}}
if(this.DBG){THROW({propsObj:eO,props:DBG.getPropertyArray(eO)},this,'removeSubEditors');}
delete this.subEditors;this.subEditors=[];return true;}catch(e){if(this.DBG){FATAL(e,this,'removeSubEditors');}
return false;}},hasChanges:function(){try{if(typeof(this.subEditors)=='undefined'||this.subEditors.length<1){THROW({args:arguments,props:['id','subEditors','subEditors.length'],o:'NO EDITORS'},this,'hasChanges.Editor');return false;}
if(this.DBG&&this.DBG.hasChanges){this.DBG.DBG_ARRAY=[];this.DBG.DBG_hasChanges=false;}
for(var i=0;i<this.subEditors.length;i++){try{if(typeof(this.subEditors[i])=='object'&&typeof(this.subEditors[i].hasChanges)=='function'){if(this.DBG&&this.DBG.hasChanges){this.DBG.DBG_ARRAY.push({n:this.subEditors[i].id+'.HASCHANGES',o:this.subEditors[i].hasChanges()});}
if(true===this.subEditors[i].hasChanges()){if(this.DBG&&this.DBG.hasChanges){this.DBG.DBG_hasChanges=(this.DBG.DBG_hasChanges||this.subEditors[i].hasChanges());}else{return true;}}}else{if(this.DBG&&this.DBG.hasChanges){this.DBG.DBG_ARRAY.push({n:'NO-EDITOR',o:false});}}}catch(e){if(this.DBG&&this.DBG.hasChanges){this.DBG.DBG_ARRAY.push({n:'ERROR',o:''+e});}
continue;}}
if(this.DBG&&this.DBG.hasChanges){THROW({args:arguments,props:['id','type','subEditors','subEditors.length'],p:this.DBG.DBG_ARRAY,o:this.id+'.hasChanges: '+this.DBG.DBG_hasChanges},this,'hasChanges.Editor');return this.DBG.DBG_hasChanges;}else{return false;}}catch(ee){FATAL(ee,this,'hasChanges','HASCHANGES FAILED');}},getChanges:function(v){if(this.DBG){THROW({args:arguments,props:['subEditors','subEditors.length']},this,'getChanges.Editor');}
if(this.subEditors.length<1){return v;}
initialV=v;if(typeof(v)!='object'||v===null){v={};}
try{if(true===this.hasChanges()||true===this.getChangesAlways){for(var i=0;i<this.subEditors.length;i++){v=this.subEditors[i].getChanges(v);}}else{return initialV;}
return v;}catch(e){if(this.DBG){FATAL(e,this,'getChanges.Editor','GETCHANGES FAILED');}}},reset:function(){if(this.DBG){THROW({args:arguments,props:['subEditors','subEditors.length']},this,'reset.Editor');}
if(this.subEditors.length<1){return;}
try{for(var i=0;i<this.subEditors.length;i++){this.subEditors[i].reset();}}catch(e){if(this.DBG){FATAL(e,this,'reset.Editor','RESET FAILED');}}},commit:function(){if(this.DBG){THROW({args:arguments,props:['subEditors','subEditors.length']},this,'commit.Editor');}
if(this.subEditors.length<1){return;}
try{for(var i=0;i<this.subEditors.length;i++){this.subEditors[i].commit();}}catch(e){if(this.DBG){FATAL(e,this,'commit.Editor','COMMIT FAILED');}}},showCreateFormWindow:function(config){if(this.DBG){THROW({args:arguments,propsObj:config,props:['scope','handler','params','fields','fields.length']},this,'showCreateFormWindow');}
try{pel=VIEWPORT.getEl();if(typeof(pel)=='undefined'){throw('VIEWPORT.getEl() = '+typeof(pel));}
this.createFormFields=[];for(i=0;i<config.fields.length;i++){fieldCFG={pEditor:config.fields[i].pEditor,id:this.id+'.createFormField.'+config.fields[i].name,fieldLabel:config.fields[i].fieldLabel,name:config.fields[i].name,width:400,emptyText:config.fields[i].emptyText,allowBlank:false,validator:config.fields[i].validator,validates:(typeof(config.fields[i].validator)!='undefined')?false:true};this.createFormFields.push(new Ext.form.TextField(fieldCFG));}
if(this.DBG){THROW({args:arguments,props:['createFormFields','createFormFields.length']},this,'showCreateFormWindow');}
createFormPanel=new Ext.form.FormPanel({id:this.id+'.createForm',name:'createForm',region:'center',margins:'3 3 3 3',bodyStyle:'padding: 5px',defaultType:'textfield',autoHeight:true,items:this.createFormFields});createCFG={text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CREATE,scope:this,handler:function(){check=true;for(i=0;i<this.createFormFields.length;i++){check=check&&(this.createFormFields[i].getValue().trim()!=='')&&(true===this.createFormFields[i].validates);}
if(false===check){return check;}
if(this.DBG){THROW({o:'CREATE',props:['el','win','createFormWindow']},this,'createForm.create');}
try{if(typeof(config.handler)=='function'){config.handler(this,config);}else{if(this.DBG){THROW({o:'CREATE',propsObj:config,props:['scope','handler']},this,'createForm.create');}
if(typeof(config.scope)=='object'&&config.scope!==null){config.scope[config.handler](this,config);}else{this[config.handler](this,config);}}}catch(e){if(this.DBG){FATAL(e,this,'createForm.create','CREATE FAILED');}}}};createFormPanel.addButton(createCFG);closeWinCFG={text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CANCEL,scope:this,handler:function(){this.createFormWindow.close();}};createFormPanel.addButton(closeWinCFG);if(typeof(this.el)==='undefined'||this.el===null){this.el=pel.createChild({tag:'div',id:this.id+'.createForm.window.el'});}
this.createFormWindow=new Ext.Window({id:this.id+'.createForm.window',title:VIEWPORT_PROPERTIES.BUTTON_TEXT_CREATE,iconCls:'addIconCls',modal:true,plain:true,renderTo:this.el,height:130,layout:'border',items:[createFormPanel],width:600});this.createFormWindow.on({'close':{scope:this,fn:function(){if(this.DBG){THROW({o:'BEFORE CLEANUP',props:['el','createFormWindow','createFormFields']},this,'createForm.close');}
delete this.el;delete this.createFormWindow;delete this.createFormFields;if(this.DBG){THROW({o:'AFTER CLEANUP',props:['el','createFormWindow','createFormFields']},this,'createForm.close');}}}});this.createFormWindow.setPagePosition((VIEWPORT.getSize().width/2)-300,100);this.createFormWindow.show(this);for(i=0;i<this.createFormFields.length;i++){this.createFormFields[i].validate();}}catch(windowInitError){alert('windowInitError: \n'+windowInitError);}},closeCreateFormWindow:function(){try{this.createFormWindow.close();}catch(e){if(this.DBG){FATAL(e,this,'closeCreateFormWindow');}}},getCreateFormParams:function(v){try{if(typeof(v)!='object'){v={};}
for(i=0;i<this.createFormFields.length;i++){v[this.createFormFields[i].getName()]=this.createFormFields[i].getValue().trim();}
return v;}catch(e){if(this.DBG){FATAL(e,this,'getCreateFormParams');}}},registerEditorMSG:function(editor){if(this.DBG){THROW({args:arguments,propsObj:editor,props:['id','type']},this,'registerEditorMSG.Editor');}
try{if(true===editor.isPulseEditor){editor.on('MSG',function(msgString,_editor){if(this.DBG){THROW({args:arguments},this,'MSG');}
this.editorMSG(msgString,_editor,this);},this);}else{throw({e:'PULSE_EDITOR_CHECK: '+this.isPulseEditor(editor),editor:editor});}}catch(e){if(this.DBG){FATAL(e,this,'registerEditorMSG.Editor');}}},editorMSG:function(msgString,editor,masterEditor){if(this.DBG){var p=[{n:'editor',o:editor},{n:'editor.id',o:editor.id},{n:'editor.type',o:editor.type},{n:'editor.subEditors',o:editor.subEditors},{n:'masterEditor',o:masterEditor},{n:'masterEditor.id',o:masterEditor.id},{n:'masterEditor.type',o:masterEditor.type},{n:'masterEditor.subEditors',o:masterEditor.subEditors}];p.push({n:'editor.subEditors',o:'#####################'});if(Ext.isArray(editor.subEditors)){for(var i=0;i<editor.subEditors.length;i++){p.push({n:'editor.subEditor['+(i+1)+'].id',o:editor.subEditors[i].id+' # '+editor.subEditors[i].hasChanges()});}}
p.push({n:'masterEditor.subEditors',o:'#####################'});if(Ext.isArray(masterEditor.subEditors)){for(var j=0;j<masterEditor.subEditors.length;j++){p.push({n:'masterEditor.subEditor['+(j+1)+'].id',o:masterEditor.subEditors[j].id+' # '+masterEditor.subEditors[j].hasChanges()});}}
THROW({args:arguments,p:p,props:['id','type']},this,'editorMSG.Editor');}
msg=msgString.toUpperCase();if(msg=='RESET'||msg=='COMMIT'||msg=='SAVESUCCESS'||msg=='DELETESUCCESS'){if(true===this.hasChanges()){if(this.DBG){THROW({args:arguments,p:p,props:['id','type'],o:'SUPRESSED SUBEDITOR-MSG DUE TO INTERNAL CHANGES'},this,'editorMSG.Editor');}
return;}}
this.fireEvent('MSG',msgString,editor,this);},getContent:function(){if(this.DBG){THROW({props:['content','content.id','content.clazz','masterEditor','masterEditor.id','masterEditor.type']},this,'getContent.Editor');}
o=this.content;if(typeof(o)=='object'&&o!==null){return o;}
if(typeof(this.masterEditor)=='object'&&this.masterEditor!==null&&typeof(this.masterEditor.getContent)=='function'){return this.masterEditor.getContent();}},destroy:function(e){this.removeSubEditors();delete this.subEditors;Pulse.Editor.superclass.destroy.call(this,e);},getId:function(){if(typeof(this.id)=='undefined'&&(typeof(this.initialConfig.id)=='undefined'||this.initialConfig.id===null)){this.id=this.type+'.'+Ext.id();}
return this.id;},getTypeString:function(){return this.type;},equals:function(o){if(typeof(o)=='object'&&o!==null&&o.type==this.type){return(o==this);}
return false;},toString:function(){return'{ ('+this.type+') @ id: '+this.id+' }';},initialize:function(){if(typeof(this.component)=='string'){configuration=Pulse[this.component][this.type]['configuration'];}else{configuration=Pulse[this.type]['configuration'];}
if(typeof(configuration)!='object'||configuration===null||configuration.type!=='Configuration'){throw({e:'CONFIGURATION.EXCEPTION'});}
this.configuration=configuration;},checkInitialConfig:function(){for(i=0;i<this.forbiddenInitialConfigValues;i++){if(typeof(this.initialConfig[this.forbiddenInitialConfigValues[i]])!='undefined'){throw({e:'USAGE OF FORBIDDEN PROPERTY IN CONFIGURATION',o:this});}}}};EditorComp=Editor;EditorComp.initComponent=function(){this.checkInitialConfig();if(this.initialConfig.DBG){this.DBG=DBG.apply(DBG[this.getTypeString()],this.initialConfig.DBG);}
if(this.DBG){props=['id','type'];props=props.concat(DBG.getPropertyArray(this.initialConfig));THROW({args:arguments,props:props},this,'initComponent.Editor');}
if(typeof(this.subEditors)=='undefined'){this.subEditors=[];}
Pulse.Editor.superclass.initComponent.call(this);this.addEvents({'MSG':true});if(true===this.implementsConfigurable){this.initialize();}};Pulse.Editor=Ext.extend(Ext.Component,EditorComp);var AbstractBasicContentEditor={type:'AbstractBasicContentEditor',DBG:false,tab:null,win:null,msgPanel:null,contentPanel:null,loadURL:'',saveURL:'',onSaveSuccess:null,init:function(config){try{THROW({args:arguments,propsObj:config,props:['id','content.id','content.bundle','content.clazz']},this,'init');if(typeof(config.initContentLocalizationMapURL)=='string'&&config.initContentLocalizationMapURL!==''){ContentLocalizationMapEditor.init(config);}
if(typeof(config.loadSitemapNodesURL)=='string'&&config.loadSitemapNodesURL!==''){this.initSitemapNodesDisplayer(config);}
if(typeof(config.loadAttachmentsURL)=='string'&&config.loadAttachmentsURL!==''){this.initAttachmentsPanel(config);}
this.initFieldMonitoring(config);}catch(e){description=(typeof(e)=='object'&&typeof(e.description)!='undefined')?', '+e.description:'';THROW({e:'FATAL',o:{e:e,o:description}},this,'init');}},initFieldMonitoring:function(config){tab=(typeof(config.tab)=='object'&&config.tab!==null)?config.tab:Ext.getCmp(config.id);tab.monitor={tab:tab,headlineEl:Ext.get(config.content.clazz+'.'+config.content.id+'.name'),suffixEl:Ext.get(config.content.clazz+'.'+config.content.id+'.suffix'),keywordsEl:Ext.get(config.content.clazz+'.'+config.content.id+'.keywords')};Pulse.initTextFieldMonitor(tab.monitor.headlineEl,tab.monitor,'headlineEl',false);Pulse.initTextFieldMonitor(tab.monitor.suffixEl,tab.monitor,'suffixEl',false);Pulse.initTextAreaMonitor(tab.monitor.keywordsEl,tab.monitor,'keywordsEl');},getBasicFieldValues:function(clazz,id){tab=Ext.getCmp(clazz+'.'+id+'.editor');vals={};if(true===tab.monitor.headlineEl.changed){vals.name=tab.monitor.headlineEl.getValue().trim();}
if(true===tab.monitor.suffixEl.changed){vals.suffix=tab.monitor.suffixEl.getValue().trim();}
if(true===tab.monitor.keywordsEl.changed){vals.keywords=tab.monitor.keywordsEl.getValue().trim();}
if(typeof(tab.attachmentsEditor)!='undefined'&&tab.attachmentsEditor!==null&&true===tab.attachmentsEditor.hasChanges()){vals=tab.attachmentsEditor.getChanges(vals);}
return vals;},resetFields:function(config){tab=(typeof(config.tab)=='object'&&config.tab!==null)?config.tab:Ext.getCmp(config.id);if(true===tab.monitor.headlineEl.changed){tab.setTitle(tab.monitor.headlineEl.getValue().trim());ContentRegistryEditor.renameNodeByContentId(config.content.id,tab.monitor.headlineEl.getValue().trim());tab.monitor.headlineEl.commit();}
if(true===tab.monitor.suffixEl.changed){tab.monitor.suffixEl.commit();}
if(true===tab.monitor.keywordsEl.changed){tab.monitor.keywordsEl.commit();}
if(typeof(tab.attachmentsEditor)!='undefined'&&tab.attachmentsEditor!==null&&true===tab.attachmentsEditor.hasChanges()){tab.attachmentsEditor.commit();}},getFCKEditorWindow:function(config){THROW({args:arguments,propsObj:config,props:['loadURL','loadParams.id','saveURL','saveParams.id','scope','onSaveSuccess']},this,'getFCKEditorWindow');try{this.loadURL=config.loadURL;this.saveURL=config.saveURL;this.saveParams=config.saveParams;this.scope=config.scope;this.onSaveSuccess=config.onSaveSuccess;pel=VIEWPORT.getEl();if(typeof(pel)=='undefined'){throw('163 :: PULSE.AbstratcBasicContent.Editor.js.getFCKEditorWindow() :: '+'CHECK for element failed...');}
if(this.win===null){el=pel.createChild({tag:'div',id:'FCKEditorWindow.el'});this.msgPanel=new Ext.Panel({id:'FCKEditorWindow.msgPanel',region:'north',html:'msgs go here',border:false,autoHeight:true});this.contentPanel=new Ext.Panel({id:'FCKEditorWindow.contentPanel',region:'center'});items=[this.msgPanel,this.contentPanel];windowCfg={id:'FCKEditorWindow',maximizable:false,title:(typeof(config.title)=='string')?config.title:'',iconCls:(typeof(config.iconCls)=='string')?config.iconCls:'',closable:true,plain:true,modal:true,renderTo:el,height:300,width:400,layout:'border',tbar:[{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_SAVE,handler:function(){saveOpts={url:AbstractBasicContentEditor.saveURL,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){if(typeof(AbstractBasicContentEditor.onSaveSuccess)=='function'){if(typeof(decodedResponse.id)!='undefined'){AbstractBasicContentEditor.saveParams.id=decodedResponse.id;if(typeof(AbstractBasicContentEditor.lastLoadConfig.params)=='undefined'){AbstractBasicContentEditor.lastLoadConfig.params={id:decodedResponse.id};}else{AbstractBasicContentEditor.lastLoadConfig.params.id=decodedResponse.id;}}
AbstractBasicContentEditor.onSaveSuccess(decodedResponse);}
if(typeof(AbstractBasicContentEditor.onSaveSuccess)=='string'&&typeof(AbstractBasicContentEditor.scope)=='object'){if(typeof(decodedResponse.id)!='undefined'){AbstractBasicContentEditor.saveParams.id=decodedResponse.id;if(typeof(AbstractBasicContentEditor.lastLoadConfig.params)=='undefined'){AbstractBasicContentEditor.lastLoadConfig.params={id:decodedResponse.id};}else{AbstractBasicContentEditor.lastLoadConfig.params.id=decodedResponse.id;}}
if(typeof(AbstractBasicContentEditor.scope[AbstractBasicContentEditor.onSaveSuccess])=='function'){AbstractBasicContentEditor.scope[AbstractBasicContentEditor.onSaveSuccess](decodedResponse);}}
PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'win'},{n:'id',o:'FCKEditorWindow'},{n:'msg',o:'SAVESUCCESS'}]});}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'AbstractBasicContentEditor','tbar.save.Action.execute()');}
AbstractBasicContentEditor.win.getTopToolbar().enable();},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'AbstractBasicContentEditor','tbar.save.Action.execute()');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'AbstractBasicContentEditor','tbar.save.Action.execute()');}
AbstractBasicContentEditor.win.getTopToolbar().enable();}};if(typeof(AbstractBasicContentEditor.saveParams)!='undefined'){saveOpts.params=AbstractBasicContentEditor.saveParams;saveOpts.params.value=FCKeditorAPI.GetInstance('FCKEditor').GetData();}
AbstractBasicContentEditor.win.getTopToolbar().disable();Ext.Ajax.request(saveOpts);},iconCls:'saveIconCls'},'-',{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CANCEL,handler:function(){AbstractBasicContentEditor.win.close();},iconCls:'cancelIconCls'},'-','->',{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_RELOAD,handler:function(){if(true===AbstractBasicContentEditor.win.isDirty){Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE,VIEWPORT_PROPERTIES.TEXT_UNSAVEDCHANGES+'<br />'+
VIEWPORT_PROPERTIES.TEXT_REALLYCONTINUE,function(response){if('yes'===response){AbstractBasicContentEditor.win.isDirty=false;AbstractBasicContentEditor.lastLoadConfig.callback=LPCB;AbstractBasicContentEditor.lastLoadConfig.timeout=30;AbstractBasicContentEditor.contentPanel.load(AbstractBasicContentEditor.lastLoadConfig);AbstractBasicContentEditor.msgPanel.hide();AbstractBasicContentEditor.msgPanel.collapse();}},this);}else{AbstractBasicContentEditor.lastLoadConfig.callback=LPCB;AbstractBasicContentEditor.lastLoadConfig.timeout=30;AbstractBasicContentEditor.contentPanel.load(AbstractBasicContentEditor.lastLoadConfig);AbstractBasicContentEditor.msgPanel.hide();AbstractBasicContentEditor.msgPanel.collapse();}},iconCls:'reloadIconCls'}],items:items};this.win=new Ext.Window(windowCfg);}
this.msgPanel.hide();this.msgPanel.collapse();this.msgPanel.on('hide',function(){AbstractBasicContentEditor.win.doLayout(true);});this.lastLoadConfig={url:config.loadURL,method:'POST',timeout:30,scripts:true,callback:LPCB};if(typeof(config.loadParams)!='undefined'){this.lastLoadConfig.params=config.loadParams;}
this.contentPanel.load(this.lastLoadConfig);this.win.on({'beforeclose':{scope:this,fn:function(win){if(true===win.isDirty){Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE,VIEWPORT_PROPERTIES.TEXT_UNSAVEDCHANGES+'<br />'+
VIEWPORT_PROPERTIES.TEXT_REALLYCONTINUE,function(response){if('yes'===response){win.isDirty=false;win.hide();delete this.loadURL;delete this.saveURL;delete this.saveParams;delete this.scope;delete this.onSaveSuccess;}},this);}else{win.hide();delete this.loadURL;delete this.saveURL;delete this.saveParams;delete this.scope;delete this.onSaveSuccess;}
return false;}},'close':{scope:this,fn:function(){delete this.loadURL;delete this.saveURL;delete this.saveParams;delete this.scope;delete this.onSaveSuccess;}}});this.win.setSize({width:VIEWPORT.getSize().width*0.8,height:VIEWPORT.getSize().height*0.8});this.win.show();this.win.setPosition(VIEWPORT.getSize().width*0.1,VIEWPORT.getSize().height*0.1);}catch(windowInitError){alert('windowInitError: \n'+windowInitError);}},buildSummaryPanel:function(config){if(this.DBG){THROW({propsObj:config,props:['content.id','content.clazz','initURL','saveURL','loadURL']},this,'buildSummaryPanel');}
summaryPanel=new Ext.Panel({id:config.content.clazz+'.'+config.content.id+'.summary.panel',title:VIEWPORT_PROPERTIES.SUMMARY+':',collapsible:true,collapsed:true,renderTo:config.content.clazz+'.'+config.content.id+'.summary',contentEl:config.content.clazz+'.'+config.content.id+'.summary.content',tbar:[{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_EDIT,handler:function(){AbstractBasicContentEditor.getFCKEditorWindow({loadURL:config.initURL,loadParams:{id:config.content.id},saveURL:config.saveURL,saveParams:{id:config.content.id},onSaveSuccess:function(){thisPanel=Ext.getCmp(config.content.clazz+'.'+config.content.id+'.summary.panel');thisPanel.reloadContentAction.execute();}});},iconCls:'editIconCls'},'-'],reloadContentAction:new Ext.Action({text:'reloads the content.div',handler:function(){contentEl=Ext.get(config.content.clazz+'.'+config.content.id+'.summary.content');contentEl.getUpdater().update({url:config.loadURL,method:'POST',callback:LPCB,params:{id:config.content.id}});}})});summaryPanel.on('expand',function(p){el=p.getEl().last().child('.x-panel-body');if(true!==el.pulseMask){Ext.DomHelper.append(el.dom,{cls:"pulseTransparentMask"},true);el.pulseMask=true;}});},initSitemapNodesDisplayer:function(config){sitemapNodesStore=new Ext.data.JsonStore({url:config.loadSitemapNodesURL,root:'sitemapNodes',fields:['text','locale',{name:'visible',type:'boolean'},'expandInfo','expandIds','contentName']});sitemapNodePanel=new Ext.Panel({title:VIEWPORT_PROPERTIES.SITEMAP,iconCls:'sitemapIconCls',id:config.content.clazz+'.'+config.content.id+'.sitemapNodes.panel',renderTo:config.content.clazz+'.'+config.content.id+'.sitemapNodes',collapsible:true,collapsed:true,html:'',tbar:['->','-',{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_RELOAD,scope:sitemapNodesStore,handler:function(){this.load({params:{id:config.content.id},scope:panel,callback:function(records,options,success){if(false===success){panel.body.update('<div>...load failure:</div>'+'<div>...records: <b>[ '+records+' ]</b> </div>'+'<div>...options: <b>{ '+options+' }</b> </div>'+'<div>...success: <b>'+success+'</b> </div>');}}});},iconCls:'reloadIconCls'}]});sitemapNodePanel.buildExpandInfo=function(nodes){buf=[];for(ii=0;ii<nodes.length;ii++){buf.unshift(' / ');if(true===nodes[ii].visible||'true'==nodes[ii].visible){buf.unshift('>');buf.unshift('style="vertical-align:middle;" border="0"');buf.unshift('width="14" height="14" class="visibleIconCls_14_no"');buf.unshift('<img src="'+Ext.BLANK_IMAGE_URL+'" ');}else{buf.unshift('>');buf.unshift('style="vertical-align:middle;" border="0"');buf.unshift('width="14" height="14" class="invisibleIconCls_14_no"');buf.unshift('<img src="'+Ext.BLANK_IMAGE_URL+'" ');}
buf.unshift('</a> ');buf.unshift(nodes[ii].text+' (id: '+nodes[ii].id+')');buf.unshift('>');buf.unshift(' ext:qtip="show '+nodes[ii].text+' (id: '+nodes[ii].id+') in sitemap"');buf.unshift('this.blur();return;"');buf.unshift('SitemapTree.expandByIds(null,['+nodes[ii].expandIds+'],null,\''+nodes[ii].locale+'\');');buf.unshift(' onclick="');buf.unshift(' style=" "');buf.unshift(' class=" "');buf.unshift('<a href="#"');}
buf.unshift('> '+nodes[nodes.length-1].locale+' : ');buf.unshift('style="vertical-align:middle;" border="0"');buf.unshift('width="16" height="16" class="'+GETFLAG(nodes[nodes.length-1].locale)+'"');buf.unshift('<img src="'+Ext.BLANK_IMAGE_URL+'" ');return buf;};sitemapNodesStore.on('beforeload',function(store,options){this.getUpdater().showLoading();},sitemapNodePanel);sitemapNodesStore.on('load',function(store,records,options){try{htmlBuf=['<div style="padding:5px;">','<ul ','id="'+config.content.clazz+'.'+config.content.id+'.sitemapNodes"','style="font-weight:bold;list-style:none;"','>'];for(i=0;i<records.length;i++){htmlBuf.push('<li style="padding:1px;">');htmlBuf.push('<img src="'+Ext.BLANK_IMAGE_URL+'" ');htmlBuf.push('width="16" height="16" class="sitemapIconCls"');htmlBuf.push('style="vertical-align:middle;" border="0"');htmlBuf.push('>');htmlBuf.push(' // ');if(records[i].get('expandInfo').length>0){htmlBuf=htmlBuf.concat(this.buildExpandInfo(records[i].get('expandInfo')));}else{htmlBuf.push('<img src="'+Ext.BLANK_IMAGE_URL+'" ');htmlBuf.push('width="16" height="16" class="'+GETFLAG(records[i].get('locale'))+'"');htmlBuf.push('style="vertical-align:middle;" border="0"');htmlBuf.push('> '+records[i].get('locale')+' : ');}
htmlBuf.push('<a href="#"');htmlBuf.push(' class=" "');htmlBuf.push(' style=" "');htmlBuf.push(' ext:qtip="show '+records[i].get('text')+' (id: '+records[i].id+') in sitemap"');htmlBuf.push(' onclick="');htmlBuf.push('SitemapTree.expandByIds(null,['+records[i].get('expandIds')+'],null,\''+records[i].get('locale')+'\');');htmlBuf.push('this.blur();return;">');htmlBuf.push(records[i].get('text')+' (id: '+records[i].id+')');htmlBuf.push('</a> ');if(true===records[i].get('visible')){htmlBuf.push('<img src="'+Ext.BLANK_IMAGE_URL+'" ');htmlBuf.push('width="14" height="14" class="visibleIconCls_14_no"');htmlBuf.push('style="vertical-align:middle;" border="0"');htmlBuf.push('>');}else{htmlBuf.push('<img src="'+Ext.BLANK_IMAGE_URL+'" ');htmlBuf.push('width="14" height="14" class="invisibleIconCls_14_no"');htmlBuf.push('style="vertical-align:middle;" border="0"');htmlBuf.push('>');}
htmlBuf.push(' / ');htmlBuf.push(records[i].get('contentName'));htmlBuf.push('</li>');}
htmlBuf.push('</ul></div>');this.body.update(htmlBuf.join(''));}catch(e){this.body.update('panel.html.build.error:\n'+e);}},sitemapNodePanel);sitemapNodePanel.on('expand',function(panel){this.load({params:{id:config.content.id},scope:panel,callback:function(records,options,success){if(false===success){panel.update('<div>...load failure:</div>'+'<div>...records: <b>[ '+records+' ]</b> </div>'+'<div>...options: <b>{ '+options+' }</b> </div>'+'<div>...success: <b>'+success+'</b> </div>');}}});},sitemapNodesStore);},initAttachmentsPanel:function(config){try{if(this.DBG){THROW({args:arguments,propsObj:config,props:['id','loadAttachmentsURL'],o:{propsObj:Ext.getCmp(config.id),props:['id']}},this,'initAttachmentsPanel');}
attachmentsEditor=new Pulse.AttachmentsEditor({tab:Ext.getCmp(config.id),content:config.content,id:config.content.clazz+'.'+config.content.id+'.attachments.editor',renderTo:config.content.clazz+'.'+config.content.id+'.attachments',loadAttachmentsURL:config.loadAttachmentsURL,initFileBrowserURL:config.initFileBrowserURL,fileBrowserTreeURL:config.fileBrowserTreeURL,addAttachmentURL:config.addAttachmentURL,editAttachmentURL:config.editAttachmentURL,deleteAttachmentURL:config.deleteAttachmentURL,fileBrowserPreviewURL:config.fileBrowserPreviewURL,initAttachmentDescriptionEditorURL:config.initAttachmentDescriptionEditorURL,saveAttachmentDescriptionEditorURL:config.saveAttachmentDescriptionEditorURL});tab=Ext.getCmp(config.id);if(typeof(tab.attachmentsEditor)!='undefined'){delete tab.attachmentsEditor;}
tab.attachmentsEditor=attachmentsEditor;tab.attachmentsEditor.on('MSG',function(msgString,editor){THROW({args:arguments,propsObj:editor,props:['id','type']},editor,'MSG');},tab);}catch(e){description=(typeof(e)=='object'&&typeof(e.description)!='undefined')?', '+e.description:'';THROW({e:'FATAL',o:''+e+description},this,'initAttachmentsPanel');}}};var CommandMatcherEditor={type:'CommandMatcherEditor',DBG:{initComponent:false,initEditor:false,buildParamterGrid:false,removeCommandMatcherParameter:false,removeCommandMatcherParameters:false,hasChanges:false,resize:false,renderer:false},initEditor:function(){THROW({props:['saveCommandMatcherURL','grid','store','parameterEditor']},this,'initEditor');if(false===this.win.isInitialized&&typeof(this.saveCommandMatcherURL)=='string'&&this.saveCommandMatcherURL!==''){this.win.getTopToolbar().insertButton(0,[{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_SAVE,scope:this.win,handler:function(){if(false===this.isDirty){return;}
if(false===this.commandMatcherEditor.hasChanges()){PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'win'},{n:'id',o:this.id},{n:'msg',o:'savesuccess'}]});return;}
Ext.Ajax.request({url:this.commandMatcherEditor.saveCommandMatcherURL,method:'POST',scope:this.commandMatcherEditor,success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){this.commit();this.win.editor.reload();PermissionOverviewEditor.reload();PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'win'},{n:'id',o:this.win.id},{n:'msg',o:'savesuccess'}]});}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this.type,'win.tbar.saveCommandMatcher');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this.type,'win.tbar.saveCommandMatcher');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this.type,'win.tbar.saveCommandMatcher');}},params:this.commandMatcherEditor.getChanges()});},iconCls:'saveIconCls'},new Ext.Toolbar.Separator(),{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CANCEL,scope:this.win,handler:function(){this.close();},iconCls:'deleteIconCls'},new Ext.Toolbar.Separator()]);this.win.isInitialized=true;}
this.tab=this.win;this.msgPanel=Ext.getCmp(this.win.id+'.msgPanel');this.bundleBox=Pulse.getBundleBox('...');this.actionField=this.win.editor.getActionField();this.localeBox=Pulse.getLocaleBox('...');this.sitemapField=this.win.editor.getSitemapField();formPanel=new Ext.form.FormPanel({id:'editCommandMatcherForm.'+this.id,name:'editCommandMatcherForm.'+this.id,renderTo:this.commandMatcher.clazz+'.'+this.commandMatcher.id+'.formpanel',margins:'3 3 3 3',bodyStyle:'padding: 5px',defaultType:'textfield',autoHeight:true,labelWidth:110,items:[this.bundleBox,this.actionField,this.localeBox,this.sitemapField]});this.parameterEditor=this.buildParamterGrid();this.win.commandMatcherEditor=this;this.resize();this.win.on('resize',this.resize,this);if(this.commandMatcher.bundle!==''){this.bundleBox.setValue(this.commandMatcher.bundle);}
if(this.commandMatcher.action!==''){this.actionField.setValue(this.commandMatcher.action);}
if(this.commandMatcher.locale!==''){this.localeBox.setValue(this.commandMatcher.locale);}
if(this.commandMatcher.sitemap!==''){this.sitemapField.setValue(parseInt(this.commandMatcher.sitemap,10));}
this.initFieldMonitoring();THROW({props:['saveCommandMatcherURL','grid','store','parameterEditor'],p:[{n:'parameterEditor.id',o:''+this.parameterEditor.id}]},this,'initEditor');},hasChanges:function(){THROW({p:[{n:'->',o:(this.bundleBox.changed||this.actionEl.changed||this.localeBox.changed||this.sitemapEl.changed||this.parameterEditor.hasChanges())}]},this,'hasChanges');return(this.bundleBox.changed||this.actionEl.changed||this.localeBox.changed||this.sitemapEl.changed||this.parameterEditor.hasChanges());},getChanges:function(){p={id:this.commandMatcher.id};if(true===this.bundleBox.changed){p.bundle=(this.bundleBox.getValue()!='...')?this.bundleBox.getValue().trim():'';}
if(true===this.actionEl.changed){p.action=this.actionField.getValue().trim();}
if(true===this.localeBox.changed){p.locale=(this.localeBox.getValue()!='...')?this.localeBox.getValue().trim():'';}
if(true===this.sitemapEl.changed){p.sitemap=this.sitemapField.getValue().trim();}
if(true===this.parameterEditor.hasChanges()){modparams=this.parameterEditor.getChanges().modparams;if(modparams.length>0){p.modParameter=modparams;}
remparams=this.parameterEditor.getChanges().remparams;if(remparams.length>0){p.remParameter=remparams;}}
return p;},commit:function(){this.bundleBox.commit();this.actionEl.commit();this.localeBox.commit();this.sitemapEl.commit();this.parameterEditor.reload();},initFieldMonitoring:function(){Pulse.initDropDownBoxMonitor(this.bundleBox,this,'bundleBox');this.actionEl=this.actionField.getEl();Pulse.initTextFieldMonitor(this.actionEl,this,'actionEl');Pulse.initDropDownBoxMonitor(this.localeBox,this,'localeBox');this.sitemapEl=this.sitemapField.getEl();Pulse.initTextFieldMonitor(this.sitemapEl,this,'sitemapEl');},resize:function(){THROW({args:arguments,props:['id']},this,'resize');contentEl=Ext.get('contentPanel.content.'+this.commandMatcher.id);if(contentEl!==null){contentElHeight=contentEl.getSize().height;difference=this.win.getSize().height-this.win.getInnerHeight();msgPanelHeight=0;if(typeof(this.msgPanel)!='undefined'&&true===this.msgPanel.isVisible()){msgPanelHeight=this.msgPanel.getSize().height;}
this.win.setHeight(contentElHeight+difference+msgPanelHeight+10);}
this.parameterEditor.setWidth(this.win.getInnerWidth()-15);},removeCommandMatcherParameter:function(id){store=this.parameterEditor.getStore();record=null;store.each(function(r){if(r.get('id')==id){record=r;return false;}});if(record===null){return;}
id=parseInt(id,10);if(typeof(id)=='number'){store.removedRecords.push(record);PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'win'},{n:'id',o:this.win.id},{n:'msg',o:'change'}]});}
store.remove(record);},removeCommandMatcherParameters:function(recs){store=this.parameterEditor.getStore();remove=false;store.each(function(r){for(ii=0;ii<recs.length;ii++){if(r.get('id')==recs[ii].get('id')){id=parseInt(r.get('id'),10);if(typeof(id)=='number'){this.parameterEditor.getStore().removedRecords.push(r);}
this.parameterEditor.getStore().remove(r);remove=true;}}},this);if(true===remove){PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'win'},{n:'id',o:this.win.id},{n:'msg',o:'change'}]});}
return;},buildParamterGrid:function(){record=new Ext.data.Record.create([{name:'id'},{name:'realid'},{name:'name'},{name:'value'},{name:'initvalue'}]);id='store...'+Ext.id();store=new Ext.data.JsonStore({id:id,editor:this,pruneModifiedRecords:true,fields:record,root:'data',remoteSort:false,url:this.loadCommandMatcherParametersURL,baseParams:{id:this.commandMatcher.id},removedRecords:[]});store.on('load',function(store,recs,opts){store.removedRecords=[];});store.on('add',function(store,recs,index){Ext.getCmp(store.gridId).doLayout();});gridSm=new Ext.grid.CheckboxSelectionModel();columns=[gridSm,{header:'id:',dataIndex:'realid',sortable:true,width:30,fixed:true,renderer:function(realid){realid=Number(realid)+'';if(realid=='NaN'){return'';}
return realid;}},{header:VIEWPORT_PROPERTIES.NAME+':',dataIndex:'name',sortable:true,editor:new Ext.form.TextField()},{header:VIEWPORT_PROPERTIES.VALUE+':',dataIndex:'value',sortable:true,editor:new Ext.form.TextField()}];store.gridId=this.commandMatcher.clazz+'.'+this.commandMatcher.id+'.parameters.grid';if(typeof(this.saveCommandMatcherURL)=='string'&&this.saveCommandMatcherURL!==''){columns.push({header:'',dataIndex:'id',width:25,fixed:true,sortable:false,renderer:function(value,meta,rec,rowIndex,colIndex,store){THROW({args:arguments,propsObj:store,props:['id','gridId']},store.editor,'renderer');try{html='<a href="#" onclick="Pulse.Execute({'+'id: \''+store.gridId+'\','+'editor: \'editor\','+'fn: \'removeCommandMatcherParameter\','+'params: \''+value+'\''+'});this.blur();return;" '+'style="display:block;width:14px;height:14px;margin:0px;padding:0px;border:0px;vertical-align:middle;" '+'class="deleteIconCls_14" ';html+='ext:qtip="'+VIEWPORT_PROPERTIES.BUTTON_TEXT_DELETE+'"';html+='/><img src="'+Ext.BLANK_IMAGE_URL+'" width="1" height="1" border="0"/></a>';return html;}catch(renderError){return'<img src="'+Ext.BLANK_IMAGE_URL+'" width="14" height="14" '+'border="0" class="errorIconCls_14" ext:qtip="render-error: '+'try to reload ('+renderError+')"/>';}}});}
gridCm=new Ext.grid.ColumnModel(columns);createButtonCFG={text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CREATE,scope:this,handler:function(){store=this.parameterEditor.getStore();Rec=new Ext.data.Record.create([{name:'id'},{name:'realid'},{name:'name'},{name:'value'},{name:'initvalue'}]);id=Ext.id();store.add(new Rec({id:id,realid:id,name:'',value:''}));},iconCls:'addIconCls',disabled:true};deleteButtonCFG={text:VIEWPORT_PROPERTIES.BUTTON_TEXT_DELETE,scope:this,handler:function(){this.removeCommandMatcherParameters(this.parameterEditor.getSelectionModel().getSelections());},iconCls:'deleteIconCls',disabled:true};reloadButtonCFG={text:VIEWPORT_PROPERTIES.BUTTON_TEXT_RELOAD,scope:this,handler:function(){if(true===this.parameterEditor.hasChanges()){Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE,VIEWPORT_PROPERTIES.TEXT_UNSAVEDCHANGES+'<br />'+
VIEWPORT_PROPERTIES.TEXT_REALLYCONTINUE,function(response){if('yes'===response){this.parameterEditor.reload();}},this);return false;}},iconCls:'reloadIconCls'};if(typeof(this.saveCommandMatcherURL)=='string'&&this.saveCommandMatcherURL!==''){createButtonCFG.disabled=false;deleteButtonCFG.disabled=false;}
tbar=[];tbar.push(createButtonCFG);tbar.push('-');tbar.push(deleteButtonCFG);tbar.push('-');tbar.push('->');tbar.push('-');tbar.push(reloadButtonCFG);grid=new Ext.grid.EditorGridPanel({title:VIEWPORT_PROPERTIES.PARAMETERS+':',renderTo:this.commandMatcher.clazz+'.'+this.commandMatcher.id+'.parameters',id:this.commandMatcher.clazz+'.'+this.commandMatcher.id+'.parameters.grid',store:store,cm:gridCm,sm:gridSm,autoExpandColumn:'id',height:200,loadMask:true,viewConfig:{forceFit:true},frame:false,style:'border: 1px solid #8DB2E3;',clicksToEdit:1,editor:this,tbar:tbar,reload:function(){this.getStore().reload();},hasChanges:function(){store=this.getStore();modLength=store.getModifiedRecords().length;remLength=store.removedRecords.length;return(modLength>0||remLength>0);},getChanges:function(){store=this.getStore();modparams=[];mods=store.getModifiedRecords();for(i=0;i<mods.length;i++){rec=Ext.encode(mods[i].data);modparams.push(rec);}
remparams=[];rems=store.removedRecords;for(i=0;i<rems.length;i++){rec=Ext.encode(rems[i].data);remparams.push(rec);}
return{modparams:modparams,remparams:remparams};}});grid.on('collapse',function(){this.win.fireEvent('resize',this);},this);grid.on('expand',function(){this.win.fireEvent('resize',this);},this);grid.on('afteredit',function(obj){if(obj.value!=obj.originalValue){PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'win'},{n:'id',o:this.win.id},{n:'msg',o:'change'}]});}},this);store.load();THROW({props:['id'],propsObj:store,p:[{n:'gridId',o:''+grid.id}]},this,'buildParamterGrid');return grid;},initComponent:function(){THROW({args:arguments,props:['win','saveCommandMatcherURL','loadCommandMatcherParametersURL'],o:new Pulse.Error({props:['id','bundle','action','locale','sitemap'],propsObj:this.commandMatcher},this,'commandMatcher')},this,'initComponent');try{if(typeof(this.initialConfig.id)=='undefined'){this.id=Ext.id(null,this.type+'.');}
this.initEditor();}catch(e){THROW({e:'FATAL',o:e},this,'initComponent');}}};Pulse.CommandMatcherEditor=Ext.extend(Ext.Component,CommandMatcherEditor);var CommandMatcherOverview={type:'CommandMatcherOverview',DBG:{onRender:false,initComponent:false,createCommandMatcher:false,editCommandMatcher:false,deleteCommandMatcher:false,renderer:false},id:null,baseParams:null,renderTo:null,store:null,grid:null,win:null,el:null,msgPanel:null,contentPanel:null,onRender:function(){THROW({args:arguments,p:[{n:'renderTo',o:this.renderTo}]},this,'onRender');try{record=new Ext.data.Record.create([{name:'id'},{name:'clazz'},{name:'locale'},{name:'bundle'},{name:'action'},{name:'sitemapNodeId'},{name:'noParameters'}]);this.store=new Ext.data.JsonStore({editor:this,pruneModifiedRecords:true,fields:record,root:'data',remoteSort:true,sortInfo:{field:'action',direction:'ASC'},totalProperty:'total',url:this.loadCommandMatchersURL,baseParams:this.baseParams});gridSm=new Ext.grid.CheckboxSelectionModel();columns=[gridSm,{header:'id:',dataIndex:'id',sortable:true,width:30,fixed:true},{header:VIEWPORT_PROPERTIES.BUNDLE+':',dataIndex:'bundle',sortable:true},{header:VIEWPORT_PROPERTIES.ACTION+':',dataIndex:'action',sortable:true},{header:VIEWPORT_PROPERTIES.LOCALE+':',dataIndex:'locale',sortable:true},{header:VIEWPORT_PROPERTIES.SITEMAPNODE+':',dataIndex:'sitemapNodeId',sortable:true},{header:VIEWPORT_PROPERTIES.PARAMETERS+':',dataIndex:'noParameters',sortable:false}];this.store.gridId=this.renderTo+'.grid';if(typeof(this.editCommandMatcherURL)!='undefined'&&this.editCommandMatcherURL!==''){columns.push({header:'',dataIndex:'id',width:25,fixed:true,sortable:false,renderer:function(value,meta,rec,rowIndex,colIndex,store){THROW({args:arguments,propsObj:store,props:['id','gridId']},store.editor,'renderer');try{html='<a href="#" '+'onclick="Pulse.Execute({'+'id: \''+store.gridId+'\','+'editor: \'editor\','+'fn: \'editCommandMatcher\','+'params: '+value+'});this.blur();return;" '+'style="display:block;width:14px;height:14px;margin:0px;padding:0px;border:0px;vertical-align:middle;" '+'class="editIconCls_14" ';html+='ext:qtip="'+VIEWPORT_PROPERTIES.BUTTON_TEXT_EDIT+'"';html+='/><img src="'+Ext.BLANK_IMAGE_URL+'" width="1" height="1" border="0"/></a>';return html;}catch(renderError){return'<img src="'+Ext.BLANK_IMAGE_URL+'" width="14" height="14" '+'border="0" class="errorIconCls_14" ext:qtip="render-error: '+'try to reload ('+renderError+')"/>';}}});}
if(typeof(this.deleteCommandMatcherURL)!='undefined'&&this.deleteCommandMatcherURL!==''){columns.push({header:'',dataIndex:'id',width:25,fixed:true,sortable:false,renderer:function(value,meta,rec,rowIndex,colIndex,store){THROW({args:arguments,propsObj:store,props:['id','gridId']},store.editor,'renderer');try{html='<a href="#" '+'onclick="Pulse.Execute({'+'id: \''+store.gridId+'\','+'editor: \'editor\','+'fn: \'deleteCommandMatcher\','+'params: '+value+'});this.blur();return;" '+'style="display:block;width:14px;height:14px;margin:0px;padding:0px;border:0px;vertical-align:middle;" '+'class="deleteIconCls_14" ';html+='ext:qtip="'+VIEWPORT_PROPERTIES.BUTTON_TEXT_DELETE+'"';html+='/><img src="'+Ext.BLANK_IMAGE_URL+'" width="1" height="1" border="0"/></a>';return html;}catch(renderError){return'<img src="'+Ext.BLANK_IMAGE_URL+'" width="14" height="14" '+'border="0" class="errorIconCls_14" ext:qtip="render-error: '+'try to reload ('+renderError+')"/>';}}});}
gridCm=new Ext.grid.ColumnModel(columns);this.grid=new Ext.grid.GridPanel({title:VIEWPORT_PROPERTIES.COMMANDMATCHERS+':',collapsible:true,collapsed:true,renderTo:this.renderTo,id:this.renderTo+'.grid',store:this.store,cm:gridCm,sm:gridSm,autoExpandColumn:'id',height:250,loadMask:true,viewConfig:{forceFit:true},frame:false,editor:this,tbar:(typeof(this.deleteCommandMatcherURL)!='undefined'&&this.deleteCommandMatcherURL!=='')?[{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CREATE,scope:this,handler:function(){this.createCommandMatcher();},iconCls:'addIconCls'},'-',{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_DELETE,scope:this,handler:function(){this.deleteCommandMatcher();},iconCls:'deleteIconCls'},'-','->','-',{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_RELOAD,scope:this,handler:function(){this.reload();},iconCls:'reloadIconCls'}]:['->','-',{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_RELOAD,scope:this,handler:function(){this.reload();},iconCls:'reloadIconCls'}]});this.store.load({params:{start:0,limit:10}});}catch(e){THROW({e:'FATAL',o:e},this,'onRender');}},deleteCommandMatcher:function(id){THROW({args:arguments,p:[{n:'URL',o:this.deleteCommandMatcherURL}]},this,'deleteCommandMatcher');params=[];if(typeof(id)=='string'||typeof(id)=='number'){params.push(id);}else{selectedRecords=this.grid.getSelectionModel().getSelections();for(i=0;i<selectedRecords.length;i++){record=selectedRecords[i];if(typeof(record)!='undefined'){params.push(record.get('id'));}}}
if(params.length===0){return;}
Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE+':&#160;"'+params.concat()+'"',VIEWPORT_PROPERTIES.MSG_REALLYDELETE,function(response){if('yes'===response){Ext.Ajax.request({url:this.deleteCommandMatcherURL,method:'POST',scope:this,success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){this.reload();PermissionOverviewEditor.reload();this.fireEvent('MSG','DELETESUCCESS',this);}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this.type,'deleteCommandMatcher()');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this.type,'deleteCommandMatcher()');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this.type,'deleteCommandMatcher()');}},params:{ids:params}});}},this);},reload:function(){this.store.reload();},createCommandMatcher:function(){THROW({p:[{n:'URL',o:this.createCommandMatcherURL},{n:'id',o:this.id}]},this,'createCommandMatcher');try{pel=VIEWPORT.getEl();if(typeof(pel)=='undefined'){throw('247 :: '+this.type+'.createCommandMatcher() :: '+'CHECK for element failed...');}
bundleBox=Pulse.getBundleBox('...');actionField=this.getActionField();localeBox=Pulse.getLocaleBox('...');sitemapField=this.getSitemapField();formPanel=new Ext.form.FormPanel({id:'createCommandMatcherForm.'+this.id,name:'createCommandMatcherForm.'+this.id,region:'center',margins:'3 3 3 3',bodyStyle:'padding: 5px',defaultType:'textfield',autoHeight:true,labelWidth:110,items:[bundleBox,actionField,localeBox,sitemapField]});formPanel.addButton({text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CREATE,scope:this,handler:function(){params=this.baseParams;if(bundleBox.getValue()!==null&&bundleBox.getValue().trim()!==''){params.bundle=bundleBox.getValue();}
if(actionField.getValue().trim()!==''){params.action=actionField.getValue().trim();}
if(localeBox.getValue()!==null&&localeBox.getValue().trim()!==''){params.locale=localeBox.getValue();}
if(sitemapField.getValue().trim()!==''){params.sitemap=sitemapField.getValue().trim();}
Ext.Ajax.request({url:this.createCommandMatcherURL,method:'POST',scope:this,success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){this.win.close();this.reload();this.editCommandMatcher(decodedResponse.commandMatcher.id,decodedResponse.commandMatcher.clazz);}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this.type,'createCommandMatcher()');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this.type,'createCommandMatcher()');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this.type,'createCommandMatcher()');}},params:params});}});formPanel.addButton({text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CANCEL,scope:this,handler:function(){this.win.close();}});if(this.el===null){this.el=pel.createChild({tag:'div',id:'commandMatcher.win.el'});}
this.msgPanel=new Ext.Panel({id:'commandMatcher.win.msgPanel',region:'north',html:'msgs go here',border:false,autoHeight:true});this.win=new Ext.Window({id:'commandMatcher.win',iconCls:'commandmatcherIconCls',title:VIEWPORT_PROPERTIES.BUTTON_TEXT_CREATE,modal:true,plain:true,renderTo:this.el,height:200,layout:'border',items:[this.msgPanel,formPanel],width:600});this.win.on('close',function(){delete this.win;delete this.el;delete this.msgPanel;this.win=null;this.el=null;this.msgPanel=null;},this);this.msgPanel.hide();this.msgPanel.collapse();this.msgPanel.on('hide',function(){this.win.doLayout(true);},this);this.win.setPagePosition((VIEWPORT.getSize().width/2)-300,100);this.win.show(this);}catch(windowInitError){alert('windowInitError: \n'+windowInitError);}},editCommandMatcher:function(id,clazz){THROW({args:arguments,p:[{n:'URL',o:this.editCommandMatcherURL}]},this,'editCommandMatcher');if(typeof(clazz)=='undefined'){record=null;this.store.each(function(r){if(r.get('id')==id){record=r;return false;}});clazz=record.get('clazz');}
try{pel=VIEWPORT.getEl();if(typeof(pel)=='undefined'){throw('247 :: '+this.type+'.createCommandMatcher() :: '+'CHECK for element failed...');}
if(this.el===null){this.el=pel.createChild({tag:'div',id:'commandMatcher.win.el'});}
this.msgPanel=new Ext.Panel({id:clazz+'.'+id+'.editor.msgPanel',region:'north',html:'msgs go here',border:false,autoHeight:true});this.contentPanel=new Ext.Panel({id:clazz+'.'+id+'.editor.contentPanel',region:'center',html:'content goes here',border:false,autoHeight:true});this.win=new Ext.Window({id:clazz+'.'+id+'.editor',title:'...loading: '+id,iconCls:'commandmatcherIconCls',modal:true,plain:true,renderTo:this.el,height:400,minHeight:200,layout:'border',width:600,editor:this,tbar:['->','-',{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_RELOAD,scope:this,handler:function(){this.contentPanel.load({method:'Post',scope:this,scripts:true,callback:LPCB,url:this.editCommandMatcherURL,params:{id:id},text:'loading...',discardUrl:true,nocache:true,timeout:30});},iconCls:'reloadIconCls'}],items:[this.msgPanel,this.contentPanel],isDirty:false,isInitialized:false});this.win.on('close',function(){delete this.win;delete this.el;delete this.msgPanel;delete this.contentPanel;this.win=null;this.el=null;this.msgPanel=null;this.contentPanel=null;},this);this.win.on('show',function(){this.contentPanel.load({method:'Post',scope:this,scripts:true,callback:LPCB,url:this.editCommandMatcherURL,params:{id:id},text:'loading...',discardUrl:true,nocache:true,timeout:30});this.contentPanel.getUpdater().on('beforeupdate',function(){if(true===this.win.isDirty){Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE,VIEWPORT_PROPERTIES.TEXT_UNSAVEDCHANGES+'<br />'+
VIEWPORT_PROPERTIES.TEXT_REALLYCONTINUE,function(response){if('yes'===response){this.win.isDirty=false;if(this.msgPanel.isVisible()){PulseMessageHandler.closeMsg(this.msgPanel.id);}
this.contentPanel.load({method:'Post',scope:this,scripts:true,callback:LPCB,url:this.editCommandMatcherURL,params:{id:id},text:'loading...',discardUrl:true,nocache:true,timeout:30});}},this);return false;}else{if(this.msgPanel.isVisible()){PulseMessageHandler.closeMsg(this.msgPanel.id);}}},this);},this);this.win.on('beforeClose',function(){if(true===this.win.isDirty){Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE,VIEWPORT_PROPERTIES.TEXT_UNSAVEDCHANGES+'<br />'+
VIEWPORT_PROPERTIES.TEXT_REALLYCONTINUE,function(response){if('yes'===response){this.win.isDirty=false;this.win.close();CENTER_TAB_PANEL.remove(tab.id,true);}},this);return false;}},this);this.msgPanel.hide();this.msgPanel.collapse();this.msgPanel.on('hide',function(){this.win.doLayout(true);},this);this.win.setPagePosition((VIEWPORT.getSize().width/2)-300,100);this.win.show(this);}catch(windowInitError){alert('windowInitError: \n'+windowInitError);}},getActionField:function(){return new Ext.form.TextField({fieldLabel:VIEWPORT_PROPERTIES.ACTION,fieldClass:Pulse.fieldCls,width:400,enableKeyEvents:true,emptyText:VIEWPORT_PROPERTIES.TEXT_ENTER_ACTION});},getSitemapField:function(){return new Ext.form.TextField({fieldLabel:VIEWPORT_PROPERTIES.SITEMAPNODE+'-id',fieldClass:Pulse.fieldCls,width:400,regex:/\d/,enableKeyEvents:true,emptyText:VIEWPORT_PROPERTIES.TEXT_ENTER_SITEMAPNODEID});},initComponent:function(){THROW({args:arguments,props:['baseParams','loadCommandMatchersURL','createCommandMatcherURL','editCommandMatcherURL','deleteCommandMatcherURL']},this,'initComponent');try{if(typeof(this.initialConfig.id)=='undefined'){this.id=Ext.id(null,this.type+'.');}
this.addEvents('MSG');}catch(e){THROW({e:'FATAL',o:e},this,'initComponent');}}};Pulse.CommandMatcherOverview=Ext.extend(Ext.Component,CommandMatcherOverview);var AccessControlEditor={type:'AccessControlEditor',DBG:false,openUserOverview:function(initOverViewTabURL){if(this.DBG){THROW({args:arguments},this,'openUserOverview');}
PULSE_VIEWPORT_CONTROLLER.openTab({id:'AccessControl.users.overview',title:'...loading',iconCls:'userIconCls',loadParams:{url:initOverViewTabURL}});},openRoleOverview:function(initOverViewTabURL){if(this.DBG){THROW({args:arguments},this,'openRoleOverview');}
PULSE_VIEWPORT_CONTROLLER.openTab({id:'AccessControl.roles.overview',title:'...loading',iconCls:'roleIconCls',loadParams:{url:initOverViewTabURL}});},openGroupOverview:function(initOverViewTabURL){if(this.DBG){THROW({args:arguments},this,'openGroupOverview');}
PULSE_VIEWPORT_CONTROLLER.openTab({id:'AccessControl.usergroups.overview',title:'...loading',iconCls:'usergroupIconCls',loadParams:{url:initOverViewTabURL}});},openPermissionOverview:function(initOverViewTabURL){if(this.DBG){THROW({args:arguments},this,'openPermissionOverview');}
PULSE_VIEWPORT_CONTROLLER.openTab({id:'AccessControl.permissions.overview',title:'...loading',iconCls:'permissionIconCls',loadParams:{url:initOverViewTabURL}});},openVfsPermissionOverview:function(initOverViewTabURL){if(this.DBG){THROW({args:arguments},this,'openVfsPermissionOverview');}
PULSE_VIEWPORT_CONTROLLER.openTab({id:'AccessControl.vfsPermissions.overview',title:'...loading',iconCls:'vfsPermissionIconCls',loadParams:{url:initOverViewTabURL}});}};Pulse.GroupEditor=function(config){this.type='GroupEditor';this.DBG={MSG:false};this.tab=null;this.id=null;this.clazz=null;this.win=null;this.el=null;this.msgPanel=null;this.nameEl=null;this.descriptionEl=null;this.rolesEditor=null;this.usersEditor=null;this.permissionsEditor=null;this.initTab=function(){if(typeof(this.tab)!='undefined'){if(true!==this.tab.isInitialized){saveButtonConfig={text:VIEWPORT_PROPERTIES.BUTTON_TEXT_SAVE,scope:this,handler:function(){if(false===this.tab.isDirty){return;}
if(false===this.hasChanges()){PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'savesuccess'}]});return;}
v=this.getChanges();Ext.Ajax.request({url:this.config.saveURL,method:'POST',scope:this,success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){this.commitChanges();GroupOverviewEditor.reload();PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'savesuccess'}]});}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this.type,'tbar.saveGroup');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this.type,'tbar.saveGroup');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this.type,'tbar.saveGroup');}},params:v});},iconCls:'saveIconCls'};tabTbar=this.tab.getTopToolbar().insertButton(0,[saveButtonConfig,new Ext.Toolbar.Separator()]);this.tab.pEditor=this;this.tab.isInitialized=true;}}};this.initFieldMonitoring=function(){this.nameEl=Ext.get(this.clazz+'.'+this.id+'.name');if(false===this.nameEl.hasClass(Pulse.disabledFieldCls)){Pulse.initTextFieldMonitor(this.nameEl,this,'nameEl',false);}
this.descriptionEl=Ext.get(this.clazz+'.'+this.id+'.description');Pulse.initTextAreaMonitor(this.descriptionEl,this,'descriptionEl');};this.commitChanges=function(){if(this.nameEl.changed===true){this.tab.setTitle(this.nameEl.dom.value.trim());this.nameEl.commit();}
if(this.descriptionEl.changed===true){this.descriptionEl.commit();}
this.rolesEditor.commit();this.usersEditor.commit();this.permissionsEditor.commit();};this.getChanges=function(){try{v={id:this.id};if(true===this.nameEl.changed){v.name=this.nameEl.getValue().trim();}
if(true===this.descriptionEl.changed){v.description=this.descriptionEl.getValue().trim();}
if(typeof(this.rolesEditor)!='undefined'&&this.rolesEditor!==null){if(true===this.rolesEditor.hasChanges()){chgs=this.rolesEditor.getChanges();if(typeof(chgs.asoc)!='undefined'){v.addroles=chgs.asoc;}
if(typeof(chgs.unasoc)!='undefined'){v.remroles=chgs.unasoc;}}}
if(typeof(this.usersEditor)!='undefined'&&this.usersEditor!==null){if(true===this.usersEditor.hasChanges()){chgs=this.usersEditor.getChanges();if(typeof(chgs.asoc)!='undefined'){v.addusers=chgs.asoc;}
if(typeof(chgs.unasoc)!='undefined'){v.remusers=chgs.unasoc;}}}
if(typeof(this.permissionsEditor)!='undefined'&&this.permissionsEditor!==null){if(true===this.permissionsEditor.hasChanges()){chgs=this.permissionsEditor.getChanges();if(typeof(chgs.asoc)!='undefined'){v.addpermissions=chgs.asoc;}
if(typeof(chgs.unasoc)!='undefined'){v.rempermissions=chgs.unasoc;}}}
return v;}catch(e){THROW({e:'FATAL',o:e},this,'getChanges');}};this.hasChanges=function(){return(this.nameEl.changed||this.descriptionEl.changed||this.rolesEditor.hasChanges()||this.usersEditor.hasChanges()||this.permissionsEditor.hasChanges());};try{this.config=config;this.tab=config.tab;this.tab.tabEditor=this;this.id=config.id;this.clazz=config.clazz;this.initTab();this.initFieldMonitoring();this.rolesEditor=new Pulse.AssorterPanel({preLoad:false,title:VIEWPORT_PROPERTIES.ROLES,renderTo:this.clazz+'.'+this.id+'.roles',loadURL:this.config.loadRolesURL+'?id='+this.id,editURL:this.config.editRoleURL,editHandler:function(node){RoleOverviewEditor.editRole(this.editURL,node.attributes.id,node.attributes.clazz);},uiProviders:{'AccessControlTreeNodeUI':PULSE.AccessControlTreeNodeUI}});this.rolesEditor.on('MSG',function(msgString,editor){THROW({args:arguments},this,'MSG');PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:msgString}]});},this);this.usersEditor=new Pulse.AssorterPanel({preLoad:false,title:VIEWPORT_PROPERTIES.USERS,renderTo:this.clazz+'.'+this.id+'.users',loadURL:this.config.loadUsersURL+'?id='+this.id,editURL:this.config.editUserURL,editHandler:function(node){UserOverviewEditor.editUser(this.editURL,node.attributes.id,node.attributes.clazz);},uiProviders:{'AccessControlTreeNodeUI':PULSE.AccessControlTreeNodeUI}});this.usersEditor.on('MSG',function(msgString,editor){THROW({args:arguments},this,'MSG');PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:msgString}]});},this);this.permissionsEditor=new Pulse.AssorterPanel({preLoad:false,title:VIEWPORT_PROPERTIES.PERMISSIONS,renderTo:this.clazz+'.'+this.id+'.permissions',loadURL:this.config.loadPermissionsURL+'?id='+this.id,editURL:this.config.editPermissionURL,editHandler:function(node){PermissionOverviewEditor.editPermission(this.editURL,node.attributes.id,node.attributes.clazz);},uiProviders:{'AccessControlTreeNodeUI':PULSE.AccessControlTreeNodeUI}});this.permissionsEditor.on('MSG',function(msgString,editor){THROW({args:arguments},this,'MSG');PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:msgString}]});},this);}catch(e){THROW({e:'FATAL',o:e},this,'init');}};var GroupOverviewEditor={defaultOverviewPageSize:20,el:null,win:null,msgPanel:null,initEditor:function(config){if(typeof(config.tab)!='undefined'){tab=config.tab;if(true!==tab.isInitialized){if(typeof(config.createGroupURL)!='undefined'&&config.createGroupURL!==''){tabTbar=tab.getTopToolbar().insertButton(0,[{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_NEW,scope:this,handler:function(){this.createGroup(config.createGroupURL,config.editGroupURL);},iconCls:'addUsergroupIconCls'},new Ext.Toolbar.Separator()]);}
tab.isInitialized=true;}}
gridStoreRecord=new Ext.data.Record.create([{name:'id'},{name:'clazz'},{name:'name'},{name:'noUsers'},{name:'noRoles'},{name:'noPermissions'}]);gridStore=new Ext.data.JsonStore({pruneModifiedRecords:true,fields:gridStoreRecord,root:'data',remoteSort:true,sortInfo:{field:'name',direction:'ASC'},totalProperty:'total',url:config.loadGroupsURL});pageSizeBox=new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:['size'],sortInfo:{field:'size',direction:"ASC"},data:[[10],[20],[50],[100]]}),displayField:'size',valueField:'size',selectOnFocus:true,mode:'local',triggerAction:'all',width:60,blankText:''+this.defaultOverviewPageSize,emptyText:''+this.defaultOverviewPageSize});pagingToolBar=new Ext.PagingToolbar({displayInfo:true,pageSize:this.defaultOverviewPageSize,store:gridStore,items:['-',pageSizeBox]});gridStore.on('beforeLoad',function(store,options){this.isLoading=true;if(pageSizeBox.getRawValue()!==''){try{limit=parseInt(pageSizeBox.getRawValue().trim(),10);pagingToolBar.pageSize=limit;options.params.limit=limit;}catch(e){}}else{pagingToolBar.pageSize=GroupOverviewEditor.defaultOverviewPageSize;options.params.limit=GroupOverviewEditor.defaultOverviewPageSize;}
for(i=0;i<config.filterIds.length;i++){filterEl=Ext.get(config.filterIds[i]);if(typeof(filterEl)!='undefined'){try{pname=filterEl.dom.name;pvalue=filterEl.getValue().trim();options.params[pname]=pvalue;}catch(e){}}}},gridStore);gridStore.on('load',function(){(function(){this.isLoading=false;}).defer(500,this);},gridStore);gridStore.on('loadexception',function(){(function(){this.isLoading=false;}).defer(500,this);},gridStore);for(i=0;i<config.filterIds.length;i++){filterEl=Ext.get(config.filterIds[i]);if(typeof(filterEl)!='undefined'){filterEl.on({'keyup':{scope:gridStore,fn:function(evt,el,opts){if(true===this.isLoading){return;}
this.reload();}}},gridStore);}}
gridSm=new Ext.grid.CheckboxSelectionModel();columns=[gridSm,{header:'id:',dataIndex:'id',sortable:true,width:30,fixed:true},{header:VIEWPORT_PROPERTIES.NAME+':',dataIndex:'name',sortable:true},{header:VIEWPORT_PROPERTIES.USERS+':',dataIndex:'noUsers',width:100,fixed:true,sortable:false},{header:VIEWPORT_PROPERTIES.ROLES+':',dataIndex:'noRoles',width:100,fixed:true,sortable:false},{header:VIEWPORT_PROPERTIES.PERMISSIONS+':',dataIndex:'noPermissions',width:100,fixed:true,sortable:false}];if(typeof(config.editGroupURL)!='undefined'&&config.editGroupURL!==''){columns.push({header:'',dataIndex:'id',width:25,fixed:true,sortable:false,renderer:function(id){try{return FilterEditor.getGridImageField({functionString:'GroupOverviewEditor.editGroup(\''+config.editGroupURL+'\','+id+')',iconCls:'editIconCls_14',qtip:VIEWPORT_PROPERTIES.BUTTON_TEXT_EDIT});}catch(renderError){return'<img src="'+Ext.BLANK_IMAGE_URL+'" width="14" height="14" '+'border="0" class="errorIconCls_14" ext:qtip="render-error: '+'try to reload ('+renderError+')"/>';}}});}
if(typeof(config.deleteGroupURL)!='undefined'&&config.deleteGroupURL!==''){columns.push({header:'',dataIndex:'id',width:25,fixed:true,sortable:false,renderer:function(id){try{return FilterEditor.getGridImageField({functionString:'GroupOverviewEditor.deleteGroup(\''+config.deleteGroupURL+'\','+id+')',iconCls:'deleteIconCls_14',qtip:VIEWPORT_PROPERTIES.BUTTON_TEXT_DELETE});}catch(renderError){return'<img src="'+Ext.BLANK_IMAGE_URL+'" width="14" height="14" '+'border="0" class="errorIconCls_14" ext:qtip="render-error: '+'try to reload ('+renderError+')"/>';}}});}
gridCm=new Ext.grid.ColumnModel(columns);grid=new Ext.grid.GridPanel({id:(typeof(config.gridId)=='undefined')?'GroupOverViewGrid.grid':config.gridId,store:gridStore,cm:gridCm,sm:gridSm,renderTo:(typeof(config.gridId)=='undefined')?'GroupOverViewGrid':config.gridId+'.el',autoExpandColumn:'id',loadMask:true,viewConfig:{forceFit:true},frame:false,style:'border: 1px solid #8DB2E3;',tbar:(typeof(config.deleteGroupURL)!='undefined'&&config.deleteGroupURL!=='')?[{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_DELETE,iconCls:'deleteIconCls',handler:function(){id=(typeof(config.gridId)=='undefined')?'GroupOverViewGrid.grid':config.gridId;grid=Ext.getCmp(id);selectedRecords=grid.getSelectionModel().getSelections();GroupOverviewEditor.deleteGroup(config.deleteGroupURL,selectedRecords);}},'-']:[],bbar:pagingToolBar});if(typeof(config.tab)!='undefined'){grid.setWidth(config.tab.getInnerWidth()-10);tabMsgPanel=Ext.getCmp(config.tab.id+'.msgPanel');msgPanelHeight=0;if(tabMsgPanel.isVisible()){msgPanelHeight=tabMsgPanel.getSize().height;}
tabHeader=Ext.get(config.tab.id+'.header');grid.setHeight(config.tab.getInnerHeight()-tabHeader.getBox().height-msgPanelHeight-10);config.tab.on({'resize':{fn:function(tab,adjWidth,adjHeight,rawWidth,rawHeight){grid=Ext.getCmp('GroupOverViewGrid.grid');tabContentPanel=Ext.getCmp(config.tab.id+'.contentPanel');grid.setWidth(config.tab.getInnerWidth()-10);tabMsgPanel=Ext.getCmp(config.tab.id+'.msgPanel');msgPanelHeight=0;if(tabMsgPanel.isVisible()){msgPanelHeight=tabMsgPanel.getSize().height;}
tabHeader=Ext.get(config.tab.id+'.header');grid.setHeight(config.tab.getInnerHeight()-tabHeader.getBox().height-msgPanelHeight-10);}}});}
gridStore.load({params:{start:0,limit:10}});return grid;},editGroup:function(editURL,groupid,clazz){if(typeof(clazz)=='undefined'){record=null;store=Ext.getCmp('GroupOverViewGrid.grid').getStore();if(store!==null&&typeof(store)!='undefined'){store.each(function(r){if(r.get('id')==groupid){record=r;return false;}});}
if(record===null){return;}
clazz=record.get('clazz');}
PULSE_VIEWPORT_CONTROLLER.openTab({id:clazz+'.'+groupid+'.editor',title:'...loading: '+groupid,tabTip:'(id:'+groupid+')',iconCls:'usergroupIconCls',loadParams:{url:editURL,params:{id:groupid}}});},deleteGroup:function(deleteURL,groupid_OR_gridRecords){record=null;if(typeof(groupid_OR_gridRecords)=='string'||typeof(groupid_OR_gridRecords)=='number'){params=[groupid_OR_gridRecords];store=Ext.getCmp('GroupOverViewGrid.grid').getStore();if(store!==null&&typeof(store)!='undefined'){store.each(function(r){if(r.get('id')==groupid_OR_gridRecords){record=r;return false;}});}
if(record===null){return;}}else if(typeof(groupid_OR_gridRecords.length)=='number'&&groupid_OR_gridRecords.length>0){params=[];for(i=0;i<groupid_OR_gridRecords.length;i++){record=groupid_OR_gridRecords[i];if(typeof(record)!='undefined'){params.push(record.get('id'));}}}else{return;}
Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE+':&#160;"'+params.concat()+'"',VIEWPORT_PROPERTIES.MSG_REALLYDELETE,function(response){if('yes'===response){Ext.Ajax.request({url:deleteURL,method:'POST',scope:this,success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){if(typeof(options.groupid_OR_gridRecords)=='string'||typeof(options.groupid_OR_gridRecords)=='number'){PULSE_VIEWPORT_CONTROLLER.closeTab(options.clazz+'.'+options.groupid_OR_gridRecords+'.editor',true);}else{for(i=0;i<options.groupid_OR_gridRecords.length;i++){record=options.groupid_OR_gridRecords[i];if(typeof(record)!='undefined'){PULSE_VIEWPORT_CONTROLLER.closeTab(record.get('clazz')+'.'+record.get('id')+'.editor',true);}}}
this.reload();PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:'AccessControl.usergroups.overview'},{n:'msg',o:'DELETESUCCESS'}]});}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'GroupOverviewEditor','deleteGroup()');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'GroupOverviewEditor','deleteGroup()');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'GroupOverviewEditor','deleteGroup()');}},clazz:(record!==null)?record.get('clazz'):null,groupid_OR_gridRecords:groupid_OR_gridRecords,params:{ids:params}});}},this);},reload:function(){grid=Ext.getCmp('GroupOverViewGrid.grid');if(grid!==null&&typeof(grid)!='undefined'){grid.getStore().reload();}},createGroup:function(createURL,editURL){try{pel=VIEWPORT.getEl();if(typeof(pel)=='undefined'){throw('302 :: GroupOverviewEditor.createGroup() :: '+'CHECK for element failed...');}
nameField=new Ext.form.TextField({fieldLabel:VIEWPORT_PROPERTIES.NAME,name:'name',width:400,emptyText:VIEWPORT_PROPERTIES.TEXT_ENTER_NAME,allowBlank:false});formPanel=new Ext.form.FormPanel({id:'createGroupForm',name:'createGroupForm',region:'center',margins:'3 3 3 3',bodyStyle:'padding: 5px',defaultType:'textfield',autoHeight:true,labelWidth:100,items:[nameField]});formPanel.addButton({text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CREATE,scope:this,handler:function(){if(nameField.getValue().trim()===''){return false;}
Ext.Ajax.request({url:createURL,method:'POST',scope:this,success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){this.win.close();this.reload();group=decodedResponse.group;this.editGroup(editURL,group.id,group.clazz);}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'GroupOverviewEditor','createGroup()');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'GroupOverviewEditor','createGroup()');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'GroupOverviewEditor','createUser()');}},params:{name:nameField.getValue().trim()}});}});formPanel.addButton({text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CANCEL,scope:this,handler:function(){this.win.close();}});if(this.el===null){this.el=pel.createChild({tag:'div',id:'createGroup.win.el'});}
this.msgPanel=new Ext.Panel({id:'createGroup.win.msgPanel',region:'north',html:'msgs go here',border:false,autoHeight:true});this.win=new Ext.Window({id:'createGroup.win',iconCls:'addUsergroupIconCls',title:VIEWPORT_PROPERTIES.NEW,modal:true,plain:true,renderTo:this.el,height:130,layout:'border',items:[this.msgPanel,formPanel],width:600});this.win.on('close',function(){delete this.win;delete this.el;delete this.msgPanel;this.win=null;this.el=null;this.msgPanel=null;},this);this.msgPanel.hide();this.msgPanel.collapse();this.msgPanel.on('hide',function(){this.win.doLayout(true);},this);this.win.setPagePosition((VIEWPORT.getSize().width/2)-300,100);this.win.show(this);nameField.validate();}catch(windowInitError){alert('windowInitError: \n'+windowInitError);}}};Pulse.PermissionEditor=function(config){this.type='PermissionEditor';this.DBG={MSG:false};this.tab=null;this.id=null;this.clazz=null;this.nameEl=null;this.descriptionEl=null;this.rolesEditor=null;this.usersEditor=null;this.groupsEditor=null;this.commmandMatcherEditor=null;this.initTab=function(){if(typeof(this.tab)!='undefined'){if(true!==this.tab.isInitialized){saveButtonConfig={text:VIEWPORT_PROPERTIES.BUTTON_TEXT_SAVE,scope:this,handler:function(){if(false===this.tab.isDirty){return;}
if(false===this.hasChanges()){PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'savesuccess'}]});return;}
v=this.getChanges();Ext.Ajax.request({url:this.config.saveURL,method:'POST',scope:this,success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){this.commitChanges();PermissionOverviewEditor.reload();PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'savesuccess'}]});}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this.type,'tbar.savePermission');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this.type,'tbar.savePermission');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this.type,'tbar.savePermission');}},params:v});},iconCls:'saveIconCls'};tabTbar=this.tab.getTopToolbar().insertButton(0,[saveButtonConfig,new Ext.Toolbar.Separator()]);this.tab.pEditor=this;this.tab.isInitialized=true;}}};this.initFieldMonitoring=function(){this.nameEl=Ext.get(this.clazz+'.'+this.id+'.name');if(false===this.nameEl.hasClass(Pulse.disabledFieldCls)){Pulse.initTextFieldMonitor(this.nameEl,this,'nameEl',false);}
this.descriptionEl=Ext.get(this.clazz+'.'+this.id+'.description');Pulse.initTextAreaMonitor(this.descriptionEl,this,'descriptionEl');};this.commitChanges=function(){if(this.nameEl.changed===true){this.tab.setTitle(this.nameEl.dom.value.trim());this.nameEl.commit();}
if(this.descriptionEl.changed===true){this.descriptionEl.commit();}
this.rolesEditor.commit();this.usersEditor.commit();this.groupsEditor.commit();};this.getChanges=function(){try{v={id:this.id};if(true===this.nameEl.changed){v.name=this.nameEl.getValue().trim();}
if(true===this.descriptionEl.changed){v.description=this.descriptionEl.getValue().trim();}
if(typeof(this.rolesEditor)!='undefined'&&this.rolesEditor!==null){if(true===this.rolesEditor.hasChanges()){chgs=this.rolesEditor.getChanges();if(typeof(chgs.asoc)!='undefined'){v.addroles=chgs.asoc;}
if(typeof(chgs.unasoc)!='undefined'){v.remroles=chgs.unasoc;}}}
if(typeof(this.usersEditor)!='undefined'&&this.usersEditor!==null){if(true===this.usersEditor.hasChanges()){chgs=this.usersEditor.getChanges();if(typeof(chgs.asoc)!='undefined'){v.addusers=chgs.asoc;}
if(typeof(chgs.unasoc)!='undefined'){v.remusers=chgs.unasoc;}}}
if(typeof(this.groupsEditor)!='undefined'&&this.groupsEditor!==null){if(true===this.groupsEditor.hasChanges()){chgs=this.groupsEditor.getChanges();if(typeof(chgs.asoc)!='undefined'){v.addgroups=chgs.asoc;}
if(typeof(chgs.unasoc)!='undefined'){v.remgroups=chgs.unasoc;}}}
return v;}catch(e){THROW({e:'FATAL',o:e},this,'getChanges');}};this.hasChanges=function(){return(this.nameEl.changed||this.descriptionEl.changed||this.rolesEditor.hasChanges()||this.usersEditor.hasChanges()||this.groupsEditor.hasChanges());};try{this.config=config;this.tab=config.tab;this.tab.tabEditor=this;this.id=config.id;this.clazz=config.clazz;this.initTab();this.initFieldMonitoring();this.commmandMatcherEditor=new Pulse.CommandMatcherOverview({renderTo:this.clazz+'.'+this.id+'.commandmatchers',baseParams:{id:this.id},loadCommandMatchersURL:this.config.loadCommandMatchersURL,createCommandMatcherURL:this.config.createCommandMatcherURL,editCommandMatcherURL:this.config.editCommandMatcherURL,deleteCommandMatcherURL:this.config.deleteCommandMatcherURL});this.commmandMatcherEditor.on('MSG',function(msgString,editor){THROW({args:arguments},this,'MSG');PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:msgString}]});},this);this.rolesEditor=new Pulse.AssorterPanel({preLoad:false,title:VIEWPORT_PROPERTIES.ROLES,renderTo:this.clazz+'.'+this.id+'.roles',loadURL:this.config.loadRolesURL+'?id='+this.id,editURL:this.config.editRoleURL,editHandler:function(node){RoleOverviewEditor.editRole(this.editURL,node.attributes.id,node.attributes.clazz);},uiProviders:{'AccessControlTreeNodeUI':PULSE.AccessControlTreeNodeUI}});this.rolesEditor.on('MSG',function(msgString,editor){THROW({args:arguments},this,'MSG');PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:msgString}]});},this);this.usersEditor=new Pulse.AssorterPanel({preLoad:false,title:VIEWPORT_PROPERTIES.USERS,renderTo:this.clazz+'.'+this.id+'.users',loadURL:this.config.loadUsersURL+'?id='+this.id,editURL:this.config.editUserURL,editHandler:function(node){UserOverviewEditor.editUser(this.editURL,node.attributes.id,node.attributes.clazz);},uiProviders:{'AccessControlTreeNodeUI':PULSE.AccessControlTreeNodeUI}});this.usersEditor.on('MSG',function(msgString,editor){THROW({args:arguments},this,'MSG');PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:msgString}]});},this);this.groupsEditor=new Pulse.AssorterPanel({preLoad:false,title:VIEWPORT_PROPERTIES.USERGROUPS,renderTo:this.clazz+'.'+this.id+'.groups',loadURL:this.config.loadGroupsURL+'?id='+this.id,editURL:this.config.editGroupURL,editHandler:function(node){GroupOverviewEditor.editGroup(this.editURL,node.attributes.id,node.attributes.clazz);},uiProviders:{'AccessControlTreeNodeUI':PULSE.AccessControlTreeNodeUI}});this.groupsEditor.on('MSG',function(msgString,editor){THROW({args:arguments},this,'MSG');PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:msgString}]});},this);}catch(e){THROW({e:'FATAL',o:e},this,'init');}};var PermissionOverviewEditor={defaultOverviewPageSize:20,el:null,win:null,msgPanel:null,initEditor:function(config){if(typeof(config.tab)!='undefined'){tab=config.tab;if(true!==tab.isInitialized){if(typeof(config.createPermissionURL)!='undefined'&&config.createPermissionURL!==''){tabTbar=tab.getTopToolbar().insertButton(0,[{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_NEW,scope:this,handler:function(){this.createPermission(config.createPermissionURL,config.editPermissionURL);},iconCls:'addPermissionIconCls'},new Ext.Toolbar.Separator()]);}
tab.isInitialized=true;}}
gridStoreRecord=new Ext.data.Record.create([{name:'id'},{name:'clazz'},{name:'name'},{name:'noUsers'},{name:'noRoles'},{name:'noGroups'},{name:'noCommandMatchers'}]);gridStore=new Ext.data.JsonStore({pruneModifiedRecords:true,fields:gridStoreRecord,root:'data',remoteSort:true,sortInfo:{field:'name',direction:'ASC'},totalProperty:'total',url:config.loadPermissionsURL});pageSizeBox=new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:['size'],sortInfo:{field:'size',direction:"ASC"},data:[[10],[20],[50],[100]]}),displayField:'size',valueField:'size',selectOnFocus:true,mode:'local',triggerAction:'all',width:60,blankText:''+this.defaultOverviewPageSize,emptyText:''+this.defaultOverviewPageSize});pagingToolBar=new Ext.PagingToolbar({displayInfo:true,pageSize:this.defaultOverviewPageSize,store:gridStore,items:['-',pageSizeBox]});gridStore.on('beforeLoad',function(store,options){this.isLoading=true;if(pageSizeBox.getRawValue()!==''){try{limit=parseInt(pageSizeBox.getRawValue().trim(),10);pagingToolBar.pageSize=limit;options.params.limit=limit;}catch(e){}}else{pagingToolBar.pageSize=PermissionOverviewEditor.defaultOverviewPageSize;options.params.limit=PermissionOverviewEditor.defaultOverviewPageSize;}
for(i=0;i<config.filterIds.length;i++){filterEl=Ext.get(config.filterIds[i]);if(typeof(filterEl)!='undefined'){try{pname=filterEl.dom.name;pvalue=filterEl.getValue().trim();options.params[pname]=pvalue;}catch(e){}}}},gridStore);gridStore.on('load',function(){(function(){this.isLoading=false;}).defer(500,this);},gridStore);gridStore.on('loadexception',function(){(function(){this.isLoading=false;}).defer(500,this);},gridStore);for(i=0;i<config.filterIds.length;i++){filterEl=Ext.get(config.filterIds[i]);if(typeof(filterEl)!='undefined'){filterEl.on({'keyup':{scope:gridStore,fn:function(evt,el,opts){if(true===this.isLoading){return;}
this.reload();}}},gridStore);}}
gridSm=new Ext.grid.CheckboxSelectionModel();columns=[gridSm,{header:'id:',dataIndex:'id',sortable:true,width:30,fixed:true},{header:VIEWPORT_PROPERTIES.NAME+':',dataIndex:'name',sortable:true},{header:VIEWPORT_PROPERTIES.USERS+':',dataIndex:'noUsers',width:110,fixed:true,sortable:false},{header:VIEWPORT_PROPERTIES.ROLES+':',dataIndex:'noRoles',width:100,fixed:true,sortable:false},{header:VIEWPORT_PROPERTIES.USERGROUPS+':',dataIndex:'noGroups',width:110,fixed:true,sortable:false},{header:VIEWPORT_PROPERTIES.COMMANDMATCHERS+':',dataIndex:'noCommandMatchers',width:110,fixed:true,sortable:false}];if(typeof(config.editPermissionURL)!='undefined'&&config.editPermissionURL!==''){columns.push({header:'',dataIndex:'id',width:25,fixed:true,sortable:false,renderer:function(id){try{return FilterEditor.getGridImageField({functionString:'PermissionOverviewEditor.editPermission(\''+config.editPermissionURL+'\','+id+')',iconCls:'editIconCls_14',qtip:VIEWPORT_PROPERTIES.BUTTON_TEXT_EDIT});}catch(renderError){return'<img src="'+Ext.BLANK_IMAGE_URL+'" width="14" height="14" '+'border="0" class="errorIconCls_14" ext:qtip="render-error: '+'try to reload ('+renderError+')"/>';}}});}
if(typeof(config.deletePermissionURL)!='undefined'&&config.deletePermissionURL!==''){columns.push({header:'',dataIndex:'id',width:25,fixed:true,sortable:false,renderer:function(id){try{return FilterEditor.getGridImageField({functionString:'PermissionOverviewEditor.deletePermission(\''+config.deletePermissionURL+'\','+id+')',iconCls:'deleteIconCls_14',qtip:VIEWPORT_PROPERTIES.BUTTON_TEXT_DELETE});}catch(renderError){return'<img src="'+Ext.BLANK_IMAGE_URL+'" width="14" height="14" '+'border="0" class="errorIconCls_14" ext:qtip="render-error: '+'try to reload ('+renderError+')"/>';}}});}
gridCm=new Ext.grid.ColumnModel(columns);grid=new Ext.grid.GridPanel({id:(typeof(config.gridId)=='undefined')?'PermissionOverViewGrid.grid':config.gridId,store:gridStore,cm:gridCm,sm:gridSm,renderTo:(typeof(config.gridId)=='undefined')?'PermissionOverViewGrid':config.gridId+'.el',autoExpandColumn:'id',loadMask:true,viewConfig:{forceFit:true},frame:false,style:'border: 1px solid #8DB2E3;',tbar:(typeof(config.deletePermissionURL)!='undefined'&&config.deletePermissionURL!=='')?[{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_DELETE,iconCls:'deleteIconCls',handler:function(){id=(typeof(config.gridId)=='undefined')?'PermissionOverViewGrid.grid':config.gridId;grid=Ext.getCmp(id);selectedRecords=grid.getSelectionModel().getSelections();PermissionOverviewEditor.deletePermission(config.deletePermissionURL,selectedRecords);}},'-']:[],bbar:pagingToolBar});if(typeof(config.tab)!='undefined'){grid.setWidth(config.tab.getInnerWidth()-10);tabMsgPanel=Ext.getCmp(config.tab.id+'.msgPanel');msgPanelHeight=0;if(tabMsgPanel.isVisible()){msgPanelHeight=tabMsgPanel.getSize().height;}
tabHeader=Ext.get(config.tab.id+'.header');grid.setHeight(config.tab.getInnerHeight()-tabHeader.getBox().height-msgPanelHeight-10);config.tab.on({'resize':{fn:function(tab,adjWidth,adjHeight,rawWidth,rawHeight){grid=Ext.getCmp('PermissionOverViewGrid.grid');tabContentPanel=Ext.getCmp(config.tab.id+'.contentPanel');grid.setWidth(config.tab.getInnerWidth()-10);tabMsgPanel=Ext.getCmp(config.tab.id+'.msgPanel');msgPanelHeight=0;if(tabMsgPanel.isVisible()){msgPanelHeight=tabMsgPanel.getSize().height;}
tabHeader=Ext.get(config.tab.id+'.header');grid.setHeight(config.tab.getInnerHeight()-tabHeader.getBox().height-msgPanelHeight-10);}}});}
gridStore.load({params:{start:0,limit:10}});return grid;},editPermission:function(editURL,permissionid,clazz){if(typeof(clazz)=='undefined'){record=null;store=Ext.getCmp('PermissionOverViewGrid.grid').getStore();if(store!==null&&typeof(store)!='undefined'){store.each(function(r){if(r.get('id')==permissionid){record=r;return false;}});}
if(record===null){return;}
clazz=record.get('clazz');}
PULSE_VIEWPORT_CONTROLLER.openTab({id:clazz+'.'+permissionid+'.editor',title:'...loading: '+permissionid,tabTip:'(id:'+permissionid+')',iconCls:'permissionIconCls',loadParams:{url:editURL,params:{id:permissionid}}});},deletePermission:function(deleteURL,permissionid_OR_gridRecords,clazz){record=null;if(typeof(permissionid_OR_gridRecords)=='string'||typeof(permissionid_OR_gridRecords)=='number'){params=[permissionid_OR_gridRecords];store=Ext.getCmp('PermissionOverViewGrid.grid').getStore();if(store!==null&&typeof(store)!='undefined'){store.each(function(r){if(r.get('id')==permissionid_OR_gridRecords){record=r;return false;}});}
if(record===null){return;}}else if(typeof(permissionid_OR_gridRecords.length)=='number'&&permissionid_OR_gridRecords.length>0){params=[];for(i=0;i<permissionid_OR_gridRecords.length;i++){record=permissionid_OR_gridRecords[i];if(typeof(record)!='undefined'){params.push(record.get('id'));}}}else{return;}
Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE+':&#160;"'+params.concat()+'"',VIEWPORT_PROPERTIES.MSG_REALLYDELETE,function(response){if('yes'===response){Ext.Ajax.request({url:deleteURL,method:'POST',scope:this,success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){if(typeof(options.permissionid_OR_gridRecords)=='string'||typeof(options.permissionid_OR_gridRecords)=='number'){PULSE_VIEWPORT_CONTROLLER.closeTab(options.clazz+'.'+options.permissionid_OR_gridRecords+'.editor',true);}else{for(i=0;i<options.permissionid_OR_gridRecords.length;i++){record=options.permissionid_OR_gridRecords[i];if(typeof(record)!='undefined'){PULSE_VIEWPORT_CONTROLLER.closeTab(record.get('clazz')+'.'+record.get('id')+'.editor',true);}}}
this.reload();PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:'AccessControl.permissions.overview'},{n:'msg',o:'DELETESUCCESS'}]});}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'PermissionOverviewEditor','deletePermission()');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'PermissionOverviewEditor','deletePermission()');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'PermissionOverviewEditor','deletePermission()');}},clazz:(record!==null)?record.get('clazz'):null,permissionid_OR_gridRecords:permissionid_OR_gridRecords,params:{ids:params}});}},this);},reload:function(){grid=Ext.getCmp('PermissionOverViewGrid.grid');if(grid!==null&&typeof(grid)!='undefined'){grid.getStore().reload();}},createPermission:function(createURL,editURL){try{pel=VIEWPORT.getEl();if(typeof(pel)=='undefined'){throw('302 :: PermissionOverviewEditor.createPermission() :: '+'CHECK for element failed...');}
nameField=new Ext.form.TextField({fieldLabel:VIEWPORT_PROPERTIES.NAME,name:'name',width:400,emptyText:VIEWPORT_PROPERTIES.TEXT_ENTER_NAME,allowBlank:false});formPanel=new Ext.form.FormPanel({id:'createPermissionForm',name:'createPermissionForm',region:'center',margins:'3 3 3 3',bodyStyle:'padding: 5px',defaultType:'textfield',autoHeight:true,labelWidth:100,items:[nameField]});formPanel.addButton({text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CREATE,scope:this,handler:function(){if(nameField.getValue().trim()===''){return false;}
Ext.Ajax.request({url:createURL,method:'POST',scope:this,success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){this.win.close();this.reload();permission=decodedResponse.permission;this.editPermission(editURL,permission.id,permission.clazz);}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'PermissionOverviewEditor','createPermission()');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'PermissionOverviewEditor','createPermission()');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'PermissionOverviewEditor','createPermission()');}},params:{name:nameField.getValue().trim()}});}});formPanel.addButton({text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CANCEL,scope:this,handler:function(){this.win.close();}});if(this.el===null){this.el=pel.createChild({tag:'div',id:'createPermission.win.el'});}
this.msgPanel=new Ext.Panel({id:'createPermission.win.msgPanel',region:'north',html:'msgs go here',border:false,autoHeight:true});this.win=new Ext.Window({id:'createPermission.win',iconCls:'addPermissionIconCls',title:VIEWPORT_PROPERTIES.NEW,modal:true,plain:true,renderTo:this.el,height:130,layout:'border',items:[this.msgPanel,formPanel],width:600});this.win.on('close',function(){delete this.win;delete this.el;delete this.msgPanel;this.win=null;this.el=null;this.msgPanel=null;},this);this.msgPanel.hide();this.msgPanel.collapse();this.msgPanel.on('hide',function(){this.win.doLayout(true);},this);this.win.setPagePosition((VIEWPORT.getSize().width/2)-300,100);this.win.show(this);nameField.validate();}catch(windowInitError){alert('windowInitError: \n'+windowInitError);}}};Pulse.RoleEditor=function(config){this.type='RoleEditor';this.DBG={MSG:false};this.tab=null;this.id=null;this.clazz=null;this.win=null;this.el=null;this.msgPanel=null;this.nameEl=null;this.descriptionEl=null;this.usersEditor=null;this.groupsEditor=null;this.permissionsEditor=null;this.initTab=function(){if(typeof(this.tab)!='undefined'){if(true!==this.tab.isInitialized){saveButtonConfig={text:VIEWPORT_PROPERTIES.BUTTON_TEXT_SAVE,scope:this,handler:function(){if(false===this.tab.isDirty){return;}
if(false===this.hasChanges()){PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'savesuccess'}]});return;}
v=this.getChanges();Ext.Ajax.request({url:this.config.saveURL,method:'POST',scope:this,success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){this.commitChanges();RoleOverviewEditor.reload();PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'savesuccess'}]});}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this.type,'tbar.saveRole');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this.type,'tbar.saveRole');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this.type,'tbar.saveRole');}},params:v});},iconCls:'saveIconCls'};tabTbar=this.tab.getTopToolbar().insertButton(0,[saveButtonConfig,new Ext.Toolbar.Separator()]);this.tab.pEditor=this;this.tab.isInitialized=true;}}};this.initFieldMonitoring=function(){this.nameEl=Ext.get(this.clazz+'.'+this.id+'.name');if(false===this.nameEl.hasClass(Pulse.disabledFieldCls)){Pulse.initTextFieldMonitor(this.nameEl,this,'nameEl',false);}
this.descriptionEl=Ext.get(this.clazz+'.'+this.id+'.description');Pulse.initTextAreaMonitor(this.descriptionEl,this,'descriptionEl');};this.commitChanges=function(){if(this.nameEl.changed===true){this.tab.setTitle(this.nameEl.dom.value.trim());this.nameEl.commit();}
if(this.descriptionEl.changed===true){this.descriptionEl.commit();}
this.usersEditor.commit();this.groupsEditor.commit();this.permissionsEditor.commit();};this.getChanges=function(){try{v={id:this.id};if(true===this.nameEl.changed){v.name=this.nameEl.getValue().trim();}
if(true===this.descriptionEl.changed){v.description=this.descriptionEl.getValue().trim();}
if(typeof(this.usersEditor)!='undefined'&&this.usersEditor!==null){if(true===this.usersEditor.hasChanges()){chgs=this.usersEditor.getChanges();if(typeof(chgs.asoc)!='undefined'){v.addusers=chgs.asoc;}
if(typeof(chgs.unasoc)!='undefined'){v.remusers=chgs.unasoc;}}}
if(typeof(this.groupsEditor)!='undefined'&&this.groupsEditor!==null){if(true===this.groupsEditor.hasChanges()){chgs=this.groupsEditor.getChanges();if(typeof(chgs.asoc)!='undefined'){v.addgroups=chgs.asoc;}
if(typeof(chgs.unasoc)!='undefined'){v.remgroups=chgs.unasoc;}}}
if(typeof(this.permissionsEditor)!='undefined'&&this.permissionsEditor!==null){if(true===this.permissionsEditor.hasChanges()){chgs=this.permissionsEditor.getChanges();if(typeof(chgs.asoc)!='undefined'){v.addpermissions=chgs.asoc;}
if(typeof(chgs.unasoc)!='undefined'){v.rempermissions=chgs.unasoc;}}}
return v;}catch(e){THROW({e:'FATAL',o:e},this,'getChanges');}};this.hasChanges=function(){return(this.nameEl.changed||this.descriptionEl.changed||this.usersEditor.hasChanges()||this.groupsEditor.hasChanges()||this.permissionsEditor.hasChanges());};try{this.config=config;this.tab=config.tab;this.tab.tabEditor=this;this.id=config.id;this.clazz=config.clazz;this.initTab();this.initFieldMonitoring();this.usersEditor=new Pulse.AssorterPanel({preLoad:false,title:VIEWPORT_PROPERTIES.USERS,renderTo:this.clazz+'.'+this.id+'.users',loadURL:this.config.loadUsersURL+'?id='+this.id,editURL:this.config.editUserURL,editHandler:function(node){UserOverviewEditor.editUser(this.editURL,node.attributes.id,node.attributes.clazz);},uiProviders:{'AccessControlTreeNodeUI':PULSE.AccessControlTreeNodeUI}});this.usersEditor.on('MSG',function(msgString,editor){THROW({args:arguments},this,'MSG');PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:msgString}]});},this);this.groupsEditor=new Pulse.AssorterPanel({preLoad:false,title:VIEWPORT_PROPERTIES.USERGROUPS,renderTo:this.clazz+'.'+this.id+'.groups',loadURL:this.config.loadGroupsURL+'?id='+this.id,editURL:this.config.editGroupURL,editHandler:function(node){GroupOverviewEditor.editGroup(this.editURL,node.attributes.id,node.attributes.clazz);},uiProviders:{'AccessControlTreeNodeUI':PULSE.AccessControlTreeNodeUI}});this.groupsEditor.on('MSG',function(msgString,editor){THROW({args:arguments},this,'MSG');PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:msgString}]});},this);this.permissionsEditor=new Pulse.AssorterPanel({preLoad:false,title:VIEWPORT_PROPERTIES.PERMISSIONS,renderTo:this.clazz+'.'+this.id+'.permissions',loadURL:this.config.loadPermissionsURL+'?id='+this.id,editURL:this.config.editPermissionURL,editHandler:function(node){PermissionOverviewEditor.editPermission(this.editURL,node.attributes.id,node.attributes.clazz);},uiProviders:{'AccessControlTreeNodeUI':PULSE.AccessControlTreeNodeUI}});this.permissionsEditor.on('MSG',function(msgString,editor){THROW({args:arguments},this,'MSG');PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:msgString}]});},this);}catch(e){THROW({e:'FATAL',o:e},this,'init');}};var RoleOverviewEditor={defaultOverviewPageSize:20,el:null,win:null,msgPanel:null,initEditor:function(config){if(typeof(config.tab)!='undefined'){tab=config.tab;if(true!==tab.isInitialized){if(typeof(config.createURL)!='undefined'&&config.createURL!==''){tabTbar=tab.getTopToolbar().insertButton(0,[{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_NEW,scope:this,handler:function(){this.createRole(config.createURL,config.editURL);},iconCls:'addRoleIconCls'},new Ext.Toolbar.Separator()]);}
tab.isInitialized=true;}}
gridStoreRecord=new Ext.data.Record.create([{name:'id'},{name:'clazz'},{name:'name'},{name:'noUsers'},{name:'noGroups'},{name:'noPermissions'}]);gridStore=new Ext.data.JsonStore({pruneModifiedRecords:true,fields:gridStoreRecord,root:'data',remoteSort:true,sortInfo:{field:'name',direction:'ASC'},totalProperty:'total',url:config.loadURL});pageSizeBox=new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:['size'],sortInfo:{field:'size',direction:"ASC"},data:[[10],[20],[50],[100]]}),displayField:'size',valueField:'size',selectOnFocus:true,mode:'local',triggerAction:'all',width:60,blankText:''+this.defaultOverviewPageSize,emptyText:''+this.defaultOverviewPageSize});pagingToolBar=new Ext.PagingToolbar({displayInfo:true,pageSize:this.defaultOverviewPageSize,store:gridStore,items:['-',pageSizeBox]});gridStore.on('beforeLoad',function(store,options){this.isLoading=true;if(pageSizeBox.getRawValue()!==''){try{limit=parseInt(pageSizeBox.getRawValue().trim(),10);pagingToolBar.pageSize=limit;options.params.limit=limit;}catch(e){}}else{pagingToolBar.pageSize=RoleOverviewEditor.defaultOverviewPageSize;options.params.limit=RoleOverviewEditor.defaultOverviewPageSize;}
for(i=0;i<config.filterIds.length;i++){filterEl=Ext.get(config.filterIds[i]);if(typeof(filterEl)!='undefined'){try{pname=filterEl.dom.name;pvalue=filterEl.getValue().trim();options.params[pname]=pvalue;}catch(e){}}}},gridStore);gridStore.on('load',function(){(function(){this.isLoading=false;}).defer(500,this);},gridStore);gridStore.on('loadexception',function(){(function(){this.isLoading=false;}).defer(500,this);},gridStore);for(i=0;i<config.filterIds.length;i++){filterEl=Ext.get(config.filterIds[i]);if(typeof(filterEl)!='undefined'){filterEl.on({'keyup':{scope:gridStore,fn:function(evt,el,opts){if(true===this.isLoading){return;}
this.reload();}}},gridStore);}}
gridSm=new Ext.grid.CheckboxSelectionModel();columns=[gridSm,{header:'id:',dataIndex:'id',sortable:true,width:30,fixed:true},{header:VIEWPORT_PROPERTIES.NAME+':',dataIndex:'name',sortable:true},{header:VIEWPORT_PROPERTIES.USERS+':',dataIndex:'noUsers',width:110,fixed:true,sortable:false},{header:VIEWPORT_PROPERTIES.USERGROUPS+':',dataIndex:'noGroups',width:110,fixed:true,sortable:false},{header:VIEWPORT_PROPERTIES.PERMISSIONS+':',dataIndex:'noPermissions',width:110,fixed:true,sortable:false}];if(typeof(config.editURL)!='undefined'&&config.editURL!==''){columns.push({header:'',dataIndex:'id',width:25,fixed:true,sortable:false,renderer:function(id){try{return FilterEditor.getGridImageField({functionString:'RoleOverviewEditor.editRole(\''+config.editURL+'\','+id+')',iconCls:'editIconCls_14',qtip:VIEWPORT_PROPERTIES.BUTTON_TEXT_EDIT});}catch(renderError){return'<img src="'+Ext.BLANK_IMAGE_URL+'" width="14" height="14" '+'border="0" class="errorIconCls_14" ext:qtip="render-error: '+'try to reload ('+renderError+')"/>';}}});}
if(typeof(config.deleteURL)!='undefined'&&config.deleteURL!==''){columns.push({header:'',dataIndex:'id',width:25,fixed:true,sortable:false,renderer:function(id){try{return FilterEditor.getGridImageField({functionString:'RoleOverviewEditor.deleteRole(\''+config.deleteURL+'\','+id+')',iconCls:'deleteIconCls_14',qtip:VIEWPORT_PROPERTIES.BUTTON_TEXT_DELETE});}catch(renderError){return'<img src="'+Ext.BLANK_IMAGE_URL+'" width="14" height="14" '+'border="0" class="errorIconCls_14" ext:qtip="render-error: '+'try to reload ('+renderError+')"/>';}}});}
gridCm=new Ext.grid.ColumnModel(columns);grid=new Ext.grid.GridPanel({id:(typeof(config.gridId)=='undefined')?'RoleOverViewGrid.grid':config.gridId,store:gridStore,cm:gridCm,sm:gridSm,renderTo:(typeof(config.gridId)=='undefined')?'RoleOverViewGrid':config.gridId+'.el',autoExpandColumn:'id',loadMask:true,viewConfig:{forceFit:true},frame:false,style:'border: 1px solid #8DB2E3;',tbar:(typeof(config.deleteURL)!='undefined'&&config.deleteURL!=='')?[{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_DELETE,iconCls:'deleteIconCls',handler:function(){id=(typeof(config.gridId)=='undefined')?'RoleOverViewGrid.grid':config.gridId;grid=Ext.getCmp(id);selectedRecords=grid.getSelectionModel().getSelections();RoleOverviewEditor.deleteRole(config.deleteURL,selectedRecords);}},'-']:[],bbar:pagingToolBar});if(typeof(config.tab)!='undefined'){grid.setWidth(config.tab.getInnerWidth()-10);tabMsgPanel=Ext.getCmp(config.tab.id+'.msgPanel');msgPanelHeight=0;if(tabMsgPanel.isVisible()){msgPanelHeight=tabMsgPanel.getSize().height;}
tabHeader=Ext.get(config.tab.id+'.header');grid.setHeight(config.tab.getInnerHeight()-tabHeader.getBox().height-msgPanelHeight-10);config.tab.on({'resize':{fn:function(tab,adjWidth,adjHeight,rawWidth,rawHeight){grid=Ext.getCmp('RoleOverViewGrid.grid');tabContentPanel=Ext.getCmp(config.tab.id+'.contentPanel');grid.setWidth(config.tab.getInnerWidth()-10);tabMsgPanel=Ext.getCmp(config.tab.id+'.msgPanel');msgPanelHeight=0;if(tabMsgPanel.isVisible()){msgPanelHeight=tabMsgPanel.getSize().height;}
tabHeader=Ext.get(config.tab.id+'.header');grid.setHeight(config.tab.getInnerHeight()-tabHeader.getBox().height-msgPanelHeight-10);}}});}
gridStore.load({params:{start:0,limit:10}});return grid;},editRole:function(editURL,roleid,clazz){if(typeof(clazz)=='undefined'){record=null;store=Ext.getCmp('RoleOverViewGrid.grid').getStore();if(store!==null&&typeof(store)!='undefined'){store.each(function(r){if(r.get('id')==roleid){record=r;return false;}});}
if(record===null){return;}
clazz=record.get('clazz');}
PULSE_VIEWPORT_CONTROLLER.openTab({id:clazz+'.'+roleid+'.editor',title:'...loading: '+roleid,tabTip:'(id:'+roleid+')',iconCls:'roleIconCls',loadParams:{url:editURL,params:{id:roleid}}});},deleteRole:function(deleteURL,roleid_OR_gridRecords,clazz){record=null;if(typeof(roleid_OR_gridRecords)=='string'||typeof(roleid_OR_gridRecords)=='number'){params=[roleid_OR_gridRecords];store=Ext.getCmp('RoleOverViewGrid.grid').getStore();if(store!==null&&typeof(store)!='undefined'){store.each(function(r){if(r.get('id')==roleid_OR_gridRecords){record=r;return false;}});}
if(record===null){return;}}else if(typeof(roleid_OR_gridRecords.length)=='number'&&roleid_OR_gridRecords.length>0){params=[];for(i=0;i<roleid_OR_gridRecords.length;i++){record=roleid_OR_gridRecords[i];if(typeof(record)!='undefined'){params.push(record.get('id'));}}}else{return;}
Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE+':&#160;"'+params.concat()+'"',VIEWPORT_PROPERTIES.MSG_REALLYDELETE,function(response){if('yes'===response){Ext.Ajax.request({url:deleteURL,method:'POST',scope:this,success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){if(typeof(options.roleid_OR_gridRecords)=='string'||typeof(options.roleid_OR_gridRecords)=='number'){PULSE_VIEWPORT_CONTROLLER.closeTab(options.clazz+'.'+options.roleid_OR_gridRecords+'.editor',true);}else{for(i=0;i<options.roleid_OR_gridRecords.length;i++){record=options.roleid_OR_gridRecords[i];if(typeof(record)!='undefined'){PULSE_VIEWPORT_CONTROLLER.closeTab(record.get('clazz')+'.'+record.get('id')+'.editor',true);}}}
this.reload();PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:'AccessControl.roles.overview'},{n:'msg',o:'DELETESUCCESS'}]});}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'RoleOverviewEditor','deleteRole()');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'RoleOverviewEditor','deleteRole()');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'RoleOverviewEditor','deleteRole()');}},clazz:(record!==null)?record.get('clazz'):null,roleid_OR_gridRecords:roleid_OR_gridRecords,params:{ids:params}});}},this);},reload:function(){grid=Ext.getCmp('RoleOverViewGrid.grid');if(grid!==null&&typeof(grid)!='undefined'){grid.getStore().reload();}},createRole:function(createURL,editURL){try{pel=VIEWPORT.getEl();if(typeof(pel)=='undefined'){throw('302 :: RoleOverviewEditor.createRole() :: '+'CHECK for element failed...');}
nameField=new Ext.form.TextField({fieldLabel:VIEWPORT_PROPERTIES.NAME,name:'name',width:400,emptyText:VIEWPORT_PROPERTIES.TEXT_ENTER_NAME,allowBlank:false});formPanel=new Ext.form.FormPanel({id:'createRoleForm',name:'createRoleForm',region:'center',margins:'3 3 3 3',bodyStyle:'padding: 5px',defaultType:'textfield',autoHeight:true,labelWidth:100,items:[nameField]});formPanel.addButton({text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CREATE,scope:this,handler:function(){if(nameField.getValue().trim()===''){return false;}
Ext.Ajax.request({url:createURL,method:'POST',scope:this,success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){this.win.close();this.reload();role=decodedResponse.role;this.editRole(editURL,role.id,role.clazz);}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'RoleOverviewEditor','createRole()');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'RoleOverviewEditor','createRole()');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'RoleOverviewEditor','createRole()');}},params:{name:nameField.getValue().trim()}});}});formPanel.addButton({text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CANCEL,scope:this,handler:function(){this.win.close();}});if(this.el===null){this.el=pel.createChild({tag:'div',id:'createRole.win.el'});}
this.msgPanel=new Ext.Panel({id:'createRole.win.msgPanel',region:'north',html:'msgs go here',border:false,autoHeight:true});this.win=new Ext.Window({id:'createRole.win',iconCls:'addRoleIconCls',title:VIEWPORT_PROPERTIES.NEW,modal:true,plain:true,renderTo:this.el,height:130,layout:'border',items:[this.msgPanel,formPanel],width:600});this.win.on('close',function(){delete this.win;delete this.el;delete this.msgPanel;this.win=null;this.el=null;this.msgPanel=null;},this);this.msgPanel.hide();this.msgPanel.collapse();this.msgPanel.on('hide',function(){this.win.doLayout(true);},this);this.win.setPagePosition((VIEWPORT.getSize().width/2)-300,100);this.win.show(this);nameField.validate();}catch(windowInitError){alert('windowInitError: \n'+windowInitError);}}};UserAttributesEditor={type:'UserAttributesEditor',DBG:{initComponent:false,onRender:false,initPanel:false,tree:{click:false,beforeselect:false,selectionchange:false},initEditor:false,MSG:false},treeHeight:300,initEditor:function(config){THROW({props:['id'],o:{propsObj:config,props:['clazz','parameterNames']}},this,'initEditor');if(typeof(this.valuesEditor)!='undefined'){delete this.valuesEditor;}
this.valuesEditor=new Pulse.AttributeCheckOrValueEditor({check:config,pEditor:this});this.valuesEditor.on('MSG',function(msgString,editor){THROW({args:arguments},this,'MSG');if(msgString=='reset'&&false===this.hasChanges()){this.panel.toggleHasChangesIcon(false);this.fireEvent('reset',{editor:this,success:true});return;}
this.fireEvent('MSG',msgString,this);},this);this.valuesEditor.on('reset',function(vEditor){if(false===this.hasChanges()){this.panel.toggleHasChangesIcon(false);this.fireEvent('reset',{editor:this,success:true});return;}},this);},initPanel:function(){THROW({props:['editor.config.browseAttributesURL'],args:arguments},this,'initPanel');this.tree.render();this.tree.getRootNode().expand();},onRender:function(){THROW({props:['renderTo','editor.config.browseAttributesURL'],args:arguments},this,'onRender');try{this.editorPanel=new Ext.Panel({id:this.id+'.editorPanel',region:'center',margins:'5 5 5 0',autoScroll:true,html:'<div style="padding:5px;">please select an attribute...</div>'});this.tree=new Ext.tree.TreePanel({id:this.id+'.treePanel',title:VIEWPORT_PROPERTIES.ATTRIBUTEREGISTRY,iconCls:'attributeRegistryIconCls',split:true,height:this.treeHeight,width:250,minSize:150,maxSize:600,margins:'5 0 5 5',region:'west',animate:true,creatingNewNode:false,enableDD:false,autoScroll:true,containerScroll:true,rootVisible:false,border:true,loader:new Ext.tree.TreeLoader({dataUrl:this.editor.config.browseAttributesURL,uiProviders:{'RegistryTreeNodeUI':PULSE.RegistryTreeNodeUI}}),iconRenderer:function(nodeattributes){clazzArray=nodeattributes.clazz.split('.');iconCls=clazzArray.join('');return iconCls;}});this.tree.getSelectionModel().on('beforeselect',function(selMode,newnode,prevnode){THROW({args:arguments,o:{propsObj:newnode,props:['id','text','attributes.clazz']},props:['id','editor.id','editor.config.loadAttributeURL']},this,'tree.beforeselect');if(false===this.hasChanges()){return true;}
Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE,VIEWPORT_PROPERTIES.TEXT_UNSAVEDCHANGES+'<br />'+
VIEWPORT_PROPERTIES.TEXT_REALLYCONTINUE,function(response){if('yes'===response){this.reset();newnode.select();}},this);return false;},this);this.tree.getSelectionModel().on('selectionchange',function(selMode,node){THROW({args:arguments,o:{propsObj:node,props:['id','text','attributes.clazz']},props:['id','editor.id','editor.config.loadAttributeURL']},this,'tree.selectionchange');this.editorPanel.load({url:this.editor.config.loadAttributeURL,method:'POST',scripts:true,callback:LPCB,params:{id:this.editor.id,attributeid:node.id},text:'loading...',discardUrl:true,nocache:true,timeout:30});},this);this.root=new Ext.tree.AsyncTreeNode({text:'root',type:'dir',draggable:false,id:'source.'+Ext.id()});this.tree.setRootNode(this.root);this.panel=new Ext.Panel({renderTo:this.renderTo,title:''+VIEWPORT_PROPERTIES.ATTRIBUTES,iconCls:'attributesIconCls',collapsible:true,collapsed:true,layout:'border',height:400,items:[this.tree,this.editorPanel]});this.panel.on('expand',function(){this.initPanel();},this);Pulse.insertHasChangesIcon(this.panel);}catch(e){THROW({e:'FATAL',o:e},this,'onRender');}},hasChanges:function(){if(typeof(this.valuesEditor)=='undefined'||this.valuesEditor===null){return false;}
return this.valuesEditor.hasChanges();},getChanges:function(v){if(typeof(this.valuesEditor)!='undefined'&&this.valuesEditor!==null){return this.valuesEditor.getChanges(v);}
return v;},commit:function(){if(false===this.fireEvent('beforecommit',this)){return false;}
this.panel.toggleHasChangesIcon(false);if(typeof(this.valuesEditor)!='undefined'&&this.valuesEditor!==null){return this.valuesEditor.commit();}
this.fireEvent('commit',this);},reset:function(){if(false===this.fireEvent('beforereset',this)){return false;}
this.panel.toggleHasChangesIcon(false);if(typeof(this.valuesEditor)!='undefined'&&this.valuesEditor!==null){return this.valuesEditor.reset();}
this.fireEvent('reset',this);},initComponent:function(){if(typeof(this.id)=='undefined'||this.id===null){this.id=Ext.id();}
THROW({args:arguments,props:['id','renderTo','editor.id','editor.clazz','editor.tab','editor.tab.id','editor.config','editor.config.browseAttributesURL']},this,'initComponent');try{this.addEvents({'MSG':true,'beforereset':true,'reset':true,'beforecommit':true,'commit':true});}catch(e){description=(typeof(e)=='object')?e.description:'undefined';THROW({e:'FATAL',o:''+e+', '+description},this,'initComponent');}}};Pulse.UserAttributesEditor=Ext.extend(Ext.Component,UserAttributesEditor);Pulse.UserEditor=function(config){this.type='UserEditor';this.DBG={MSG:false,initAttributesEditor:false};this.tab=null;this.id=null;this.active=null;this.clazz=null;this.win=null;this.el=null;this.msgPanel=null;this.toggleActiveButton=null;this.nameEl=null;this.emailEl=null;this.webdavEnabledEl=null;this.initTab=function(){if(typeof(this.tab)!='undefined'){if(true!==this.tab.isInitialized){saveButtonConfig={text:VIEWPORT_PROPERTIES.BUTTON_TEXT_SAVE,scope:this,handler:function(){if(false===this.tab.isDirty){return;}
if(false===this.hasChanges()){this.tab.toggleHasChangesIcon(false);PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'savesuccess'}]});return;}
v=this.getChanges();Ext.Ajax.request({url:this.config.saveURL,method:'POST',scope:this,success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){this.commitChanges();UserOverviewEditor.reload();PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'savesuccess'}]});}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this.type,'tbar.saveUser');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this.type,'tbar.saveUser');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this.type,'tbar.saveUser');}},params:v});},iconCls:'saveIconCls'};changePasswordButtonConfig={text:VIEWPORT_PROPERTIES.PASSWORDCHANGE,scope:this,handler:function(){this.changePassword();},iconCls:'editPasswordIconCls'};this.toggleActiveButton=new Ext.Toolbar.Button({text:(true===this.active)?'active':'inactive',scope:this,handler:function(){this.showToggleIsLoading();Ext.Ajax.request({url:this.config.toggleUserStateURL,method:'POST',scope:this,success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){UserOverviewEditor.reload();this.toggleActive();}else{this.setToggleActive(this.active);PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this.type,'tbar.toggleUserState');}},failure:function(response,options){this.setToggleActive(this.active);if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this.type,'tbar.toggleUserState');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this.type,'tbar.toggleUserState');}},params:{ids:[this.id]}});},iconCls:(true===this.active)?'isSelectedIconCls':'isSelectedDisabledIconCls'});deleteButtonConfig={text:VIEWPORT_PROPERTIES.BUTTON_TEXT_DELETE,scope:this,handler:function(){Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE+':&#160;"'+this.id+'"',VIEWPORT_PROPERTIES.MSG_REALLYDELETE,function(response){if('yes'===response){Ext.Ajax.request({url:this.config.deleteURL,method:'POST',scope:this,success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){PULSE_VIEWPORT_CONTROLLER.closeTab(this.tab.id,true);UserOverviewEditor.reload();PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:UserOverviewEditor.tab.id},{n:'msg',o:'deletesuccess'}]});}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this.type,'tbar.deleteUser');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this.type,'tbar.deleteUser');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this.type,'tbar.deleteUser');}},params:{id:this.id}});}},this);},iconCls:'deleteIconCls'};tabTbar=this.tab.getTopToolbar().insertButton(0,[saveButtonConfig,new Ext.Toolbar.Separator(),changePasswordButtonConfig,new Ext.Toolbar.Separator(),this.toggleActiveButton,new Ext.Toolbar.Separator(),deleteButtonConfig,new Ext.Toolbar.Separator()]);this.tab.pEditor=this;PULSE_VIEWPORT_CONTROLLER.insertHasChangesIcon(this.tab);this.tab.isInitialized=true;}}};this.initFieldMonitoring=function(){this.nameEl=Ext.get(this.clazz+'.'+this.id+'.name');Pulse.initTextFieldMonitor(this.nameEl,this,'nameEl',false);this.emailEl=Ext.get(this.clazz+'.'+this.id+'.email');Pulse.initTextFieldMonitor(this.emailEl,this,'emailEl',false);this.webdavEnabledEl=Ext.get(this.clazz+'.'+this.id+'.webdavEnabled');Pulse.initCheckBoxMonitor(this.webdavEnabledEl,this,'webdavEnabledEl');};this.commitChanges=function(){if(typeof(this.nameEl)!='undefined'&&this.nameEl!==null){if(this.nameEl.changed===true){this.tab.setTitle(this.nameEl.dom.value.trim());this.nameEl.commit();}}
if(typeof(this.emailEl)!='undefined'&&this.emailEl!==null){if(this.emailEl.changed===true){this.emailEl.commit();}}
if(typeof(this.webdavEnabledEl)!='undefined'&&this.webdavEnabledEl!==null){if(this.webdavEnabledEl.changed===true){this.webdavEnabledEl.commit();}}
if(typeof(this.rolesEditor)!='undefined'&&this.rolesEditor!==null){this.rolesEditor.commit();}
if(typeof(this.groupsEditor)!='undefined'&&this.groupsEditor!==null){this.groupsEditor.commit();}
if(typeof(this.permissionsEditor)!='undefined'&&this.permissionsEditor!==null){this.permissionsEditor.commit();}
if(typeof(this.attributesEditor)!='undefined'&&this.attributesEditor!==null){this.attributesEditor.commit();}
if(typeof(this.tab.toggleHasChangesIcon)=='function'){this.tab.toggleHasChangesIcon(false);}};this.getChanges=function(){try{v={id:this.id};if(true===this.nameEl.changed){v.name=this.nameEl.getValue().trim();}
if(true===this.emailEl.changed){v.email=this.emailEl.getValue().trim();}
if(true===this.webdavEnabledEl.changed){v.webdavEnabled=this.webdavEnabledEl.dom.checked;}
if(typeof(this.rolesEditor)!='undefined'&&this.rolesEditor!==null){if(true===this.rolesEditor.hasChanges()){chgs=this.rolesEditor.getChanges();if(typeof(chgs.asoc)!='undefined'){v.addroles=chgs.asoc;}
if(typeof(chgs.unasoc)!='undefined'){v.remroles=chgs.unasoc;}}}
if(typeof(this.groupsEditor)!='undefined'&&this.groupsEditor!==null){if(true===this.groupsEditor.hasChanges()){chgs=this.groupsEditor.getChanges();if(typeof(chgs.asoc)!='undefined'){v.addgroups=chgs.asoc;}
if(typeof(chgs.unasoc)!='undefined'){v.remgroups=chgs.unasoc;}}}
if(typeof(this.permissionsEditor)!='undefined'&&this.permissionsEditor!==null){if(true===this.permissionsEditor.hasChanges()){chgs=this.permissionsEditor.getChanges();if(typeof(chgs.asoc)!='undefined'){v.addpermissions=chgs.asoc;}
if(typeof(chgs.unasoc)!='undefined'){v.rempermissions=chgs.unasoc;}}}
if(typeof(this.attributesEditor)!='undefined'&&this.attributesEditor!==null){if(true===this.attributesEditor.hasChanges()){v=this.attributesEditor.getChanges(v);}}
return v;}catch(e){description=(typeof(e)=='object'&&typeof(e.description)!='undefined')?', '+e.description:'';THROW({e:'FATAL',o:''+e+description},this,'getChanges');}};this.hasChanges=function(){if((typeof(this.nameEl)=='undefined'||this.nameEl===null)&&(typeof(this.emailEl)=='undefined'||this.emailEl===null)&&(typeof(this.webdavEnabledEl)=='undefined'||this.webdavEnabledEl===null)&&typeof(this.rolesEditor)=='undefined'&&typeof(this.groupsEditor)=='undefined'&&typeof(this.permissionsEditor)=='undefined'&&typeof(this.attributesEditor)=='undefined'){return false;}
return((typeof(this.nameEl)!='undefined'&&this.nameEl.changed)||(typeof(this.emailEl)!='undefined'&&this.emailEl.changed)||(typeof(this.webdavEnabledEl)!='undefined'&&this.webdavEnabledEl.changed)||(typeof(this.rolesEditor)!='undefined'&&this.rolesEditor.hasChanges())||(typeof(this.groupsEditor)!='undefined'&&this.groupsEditor.hasChanges())||(typeof(this.permissionsEditor)!='undefined'&&this.permissionsEditor.hasChanges())||(typeof(this.attributesEditor)!='undefined'&&this.attributesEditor.hasChanges()));};this.resetEditors=function(){if(typeof(this.nameEl)!='undefined'&&this.nameEl!==null){this.nameEl.reset();}
if(typeof(this.emailEl)!='undefined'&&this.emailEl!==null){this.emailEl.reset();}
if(typeof(this.webdavEnabledEl)!='undefined'&&this.webdavEnabledEl!==null){this.webdavEnabledEl.reset();}
if(typeof(this.rolesEditor)!='undefined'&&this.rolesEditor!==null){this.rolesEditor.reset();}
if(typeof(this.groupsEditor)!='undefined'&&this.groupsEditor!==null){this.groupsEditor.reset();}
if(typeof(this.permissionsEditor)!='undefined'&&this.permissionsEditor!==null){this.permissionsEditor.reset();}
if(typeof(this.attributesEditor)!='undefined'&&this.attributesEditor!==null){this.attributesEditor.reset();}};this.reset=function(){this.resetEditors();this.tab.toggleHasChangesIcon(false);PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'reset'}]});};this.toggleActive=function(){if(false===this.active){this.toggleActiveButton.setText('active');this.toggleActiveButton.setIconClass('isSelectedIconCls');this.active=true;}else{this.toggleActiveButton.setText('inactive');this.toggleActiveButton.setIconClass('isSelectedDisabledIconCls');this.active=false;}};this.setToggleActive=function(active){if(false===active){this.toggleActiveButton.setText('inactive');this.toggleActiveButton.setIconClass('isSelectedDisabledIconCls');this.active=false;}else{this.toggleActiveButton.setText('active');this.toggleActiveButton.setIconClass('isSelectedIconCls');this.active=true;}};this.showToggleIsLoading=function(){this.toggleActiveButton.setIconClass('loadingIconCls');};this.changePassword=function(){try{pel=VIEWPORT.getEl();if(typeof(pel)=='undefined'){throw('339 :: UserEditor.changeUserPassword() :: '+'CHECK for element failed...');}
pwdField=new Ext.form.TextField({fieldLabel:VIEWPORT_PROPERTIES.PASSWORD,name:'name',width:400,allowBlank:false,enableKeyEvents:true,inputType:'password'});pwdConfirmField=new Ext.form.TextField({fieldLabel:VIEWPORT_PROPERTIES.PASSWORDCONFIRM,name:'name',width:400,allowBlank:false,inputType:'password',validator:function(value){if(value.trim()===pwdField.getValue().trim()){return true;}else{return'pwds don\'t match!';}}});pwdField.on('keyup',function(){pwdConfirmField.validate();},this);formPanel=new Ext.form.FormPanel({id:'chgPasswordForm',name:'chgPasswordForm',region:'center',margins:'3 3 3 3',bodyStyle:'padding: 5px',defaultType:'textfield',autoHeight:true,labelWidth:100,items:[pwdField,pwdConfirmField]});formPanel.addButton({text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CHANGE,scope:this,handler:function(){if(pwdField.getValue().trim()!==pwdConfirmField.getValue().trim()){return false;}
Ext.Ajax.request({url:this.config.changePasswordURL,method:'POST',scope:this,success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){this.win.close();PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'savesuccess'}]});}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this.type,'changePassword()');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this.type,'changePassword()');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this.type,'changePassword()');}},params:{id:this.id,pwd:pwdField.getValue().trim(),cnf:pwdConfirmField.getValue().trim()}});}});formPanel.addButton({text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CANCEL,scope:this,handler:function(){this.win.close();}});if(this.el===null){this.el=pel.createChild({tag:'div',id:this.tab.id+'.win.el'});}
this.msgPanel=new Ext.Panel({id:this.tab.id+'.win.msgPanel',region:'north',html:'msgs go here',border:false,autoHeight:true});this.win=new Ext.Window({id:this.tab.id+'.win',iconCls:'editPasswordIconCls',title:VIEWPORT_PROPERTIES.PASSWORDCHANGE,modal:true,plain:true,renderTo:this.el,height:150,layout:'border',items:[this.msgPanel,formPanel],width:600});this.msgPanel.hide();this.msgPanel.collapse();this.msgPanel.on('hide',function(){this.win.doLayout(true);},this);this.win.setPagePosition((VIEWPORT.getSize().width/2)-300,100);this.win.show(this);pwdField.validate();pwdConfirmField.validate();}catch(windowInitError){alert('windowInitError: \n'+windowInitError);}};this.initAttributesEditor=function(){THROW({args:arguments,props:['config.browseAttributesURL','tab','tab.id']},this,'initAttributesEditor');if(typeof(this.config.browseAttributesURL)=='string'&&this.config.browseAttributesURL!==''){this.attributesEditor=new Pulse.UserAttributesEditor({id:this.clazz+'.'+this.id+'.attributes.editor',editor:this,renderTo:this.clazz+'.'+this.id+'.attributes'});this.attributesEditor.on('MSG',function(msgString,editor){THROW({args:arguments},this,'MSG');if(msgString=='change'){if(false===this.hasChanges()){this.tab.toggleHasChangesIcon(false);PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'reset'}]});}else{this.tab.toggleHasChangesIcon(true);PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:msgString}]});}}else{PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:msgString}]});}},this);this.attributesEditor.on('reset',function(eObj){if(true===eObj.success&&false===this.hasChanges()){this.tab.toggleHasChangesIcon(false);PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'reset'}]});}},this);}};try{this.config=config;this.tab=config.tab;this.tab.tabEditor=this;this.id=config.id;this.active=config.active;this.clazz=config.clazz;this.initTab();this.initFieldMonitoring();if(typeof(this.config.loadRolesURL)=='string'&&this.config.loadRolesURL!==''){this.rolesEditor=new Pulse.AssorterPanel({iconCls:'roleIconCls',preLoad:false,title:VIEWPORT_PROPERTIES.ROLES,renderTo:this.clazz+'.'+this.id+'.roles',loadURL:this.config.loadRolesURL+'?id='+this.id,editURL:this.config.editRoleURL,editHandler:function(node){RoleOverviewEditor.editRole(this.editURL,node.attributes.id,node.attributes.clazz);},uiProviders:{'AccessControlTreeNodeUI':PULSE.AccessControlTreeNodeUI}});this.rolesEditor.on('MSG',function(msgString,editor){THROW({args:arguments},this,'MSG');if(msgString=='change'){if(false===this.hasChanges()){this.tab.toggleHasChangesIcon(false);PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'reset'}]});}else{this.tab.toggleHasChangesIcon(true);PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:msgString}]});}}else{PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:msgString}]});}},this);this.rolesEditor.on('reset',function(eObj){if(true===eObj.success&&false===this.hasChanges()){this.tab.toggleHasChangesIcon(false);PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'reset'}]});}},this);}
if(typeof(this.config.loadGroupsURL)=='string'&&this.config.loadGroupsURL!==''){this.groupsEditor=new Pulse.AssorterPanel({iconCls:'usergroupIconCls',preLoad:false,title:VIEWPORT_PROPERTIES.USERGROUPS,renderTo:this.clazz+'.'+this.id+'.groups',loadURL:this.config.loadGroupsURL+'?id='+this.id,editURL:this.config.editGroupURL,editHandler:function(node){GroupOverviewEditor.editGroup(this.editURL,node.attributes.id,node.attributes.clazz);},uiProviders:{'AccessControlTreeNodeUI':PULSE.AccessControlTreeNodeUI}});this.groupsEditor.on('MSG',function(msgString,editor){THROW({args:arguments},this,'MSG');if(msgString=='change'){if(false===this.hasChanges()){this.tab.toggleHasChangesIcon(false);PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'reset'}]});}else{this.tab.toggleHasChangesIcon(true);PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:msgString}]});}}else{PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:msgString}]});}},this);this.groupsEditor.on('reset',function(eObj){if(true===eObj.success&&false===this.hasChanges()){this.tab.toggleHasChangesIcon(false);PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'reset'}]});}},this);}
if(typeof(this.config.loadPermissionsURL)=='string'&&this.config.loadPermissionsURL!==''){this.permissionsEditor=new Pulse.AssorterPanel({iconCls:'permissionIconCls',preLoad:false,title:VIEWPORT_PROPERTIES.PERMISSIONS,renderTo:this.clazz+'.'+this.id+'.permissions',loadURL:this.config.loadPermissionsURL+'?id='+this.id,editURL:this.config.editPermissionURL,editHandler:function(node){PermissionOverviewEditor.editPermission(this.editURL,node.attributes.id,node.attributes.clazz);},uiProviders:{'AccessControlTreeNodeUI':PULSE.AccessControlTreeNodeUI}});this.permissionsEditor.on('MSG',function(msgString,editor){THROW({args:arguments},this,'MSG');if(msgString=='change'){if(false===this.hasChanges()){this.tab.toggleHasChangesIcon(false);PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'reset'}]});}else{this.tab.toggleHasChangesIcon(true);PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:msgString}]});}}else{PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:msgString}]});}},this);this.permissionsEditor.on('reset',function(eObj){if(true===eObj.success&&false===this.hasChanges()){this.tab.toggleHasChangesIcon(false);PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'reset'}]});}},this);}
this.initAttributesEditor();}catch(e){THROW({e:'FATAL',o:''+e},this,'init');}};var UserOverviewEditor={type:'UserOverviewEditor',defaultUserOverviewPageSize:20,el:null,win:null,msgPanel:null,initEditor:function(config){if(typeof(config.tab)!='undefined'){this.tab=config.tab;if(true!==this.tab.isInitialized){if(typeof(config.createUserURL)!='undefined'&&config.createUserURL!==''){tabTbar=this.tab.getTopToolbar().insertButton(0,[{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_NEW,scope:this,handler:function(){this.createUser(config.createUserURL,config.editUserURL);},iconCls:'addUserIconCls'},new Ext.Toolbar.Separator()]);}
this.tab.isInitialized=true;}}
gridStoreRecord=new Ext.data.Record.create([{name:'id'},{name:'clazz'},{name:'name'},{name:'email'},{name:'superuser'},{name:'active'},{name:'creationTime'},{name:'lastModificationTime'},{name:'lastLoginTime'},{name:'webdavEnabled'}]);gridStore=new Ext.data.JsonStore({pruneModifiedRecords:true,fields:gridStoreRecord,root:'data',remoteSort:true,sortInfo:{field:'name',direction:'ASC'},totalProperty:'total',url:config.loadUsersURL});pageSizeBox=new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:['size'],sortInfo:{field:'size',direction:"ASC"},data:[[10],[20],[50],[100]]}),displayField:'size',valueField:'size',selectOnFocus:true,mode:'local',triggerAction:'all',width:60,blankText:''+this.defaultUserOverviewPageSize,emptyText:''+this.defaultUserOverviewPageSize});pagingToolBar=new Ext.PagingToolbar({displayInfo:true,pageSize:this.defaultUserOverviewPageSize,store:gridStore,items:['-',pageSizeBox]});gridStore.on('beforeLoad',function(store,options){store.isLoading=true;if(pageSizeBox.getRawValue()!==''){try{limit=parseInt(pageSizeBox.getRawValue().trim(),10);pagingToolBar.pageSize=limit;options.params.limit=limit;}catch(e){}}else{pagingToolBar.pageSize=UserOverviewEditor.defaultUserOverviewPageSize;options.params.limit=UserOverviewEditor.defaultUserOverviewPageSize;}
for(i=0;i<config.filterIds.length;i++){filterEl=Ext.get(config.filterIds[i]);if(typeof(filterEl)!='undefined'){try{pname=filterEl.dom.name;pvalue=filterEl.getValue().trim();options.params[pname]=pvalue;}catch(e){}}}});gridStore.on('load',function(store,recs,options){(function(){this.isLoading=false;}).defer(500,this);});gridStore.on('loadexception',function(){(function(){this.isLoading=false;}).defer(500,this);},gridStore);for(i=0;i<config.filterIds.length;i++){filterEl=Ext.get(config.filterIds[i]);if(typeof(filterEl)!='undefined'){filterEl.on({'keyup':{scope:gridStore,fn:function(evt,el,opts){(function(){if(true===this.isLoading){return;}
this.reload();}).defer(500,this);}}},gridStore);}}
gridSm=new Ext.grid.CheckboxSelectionModel();columns=[gridSm,{header:'su:',dataIndex:'superuser',tooltip:'superuser',sortable:true,width:30,fixed:true,renderer:function(bSuperuser){return UserOverviewEditor.getSuperuserField(bSuperuser);}},{header:'act:',dataIndex:'active',tooltip:'active/inactive',sortable:true,width:30,fixed:true,renderer:function(bActive){return UserOverviewEditor.getUserActiveField(bActive);}},{header:'id:',dataIndex:'id',sortable:true,width:45,fixed:false},{header:VIEWPORT_PROPERTIES.USERNAME+':',dataIndex:'name',sortable:true},{header:VIEWPORT_PROPERTIES.EMAIL+':',dataIndex:'email',sortable:true},{header:'DAV:',dataIndex:'webdavEnabled',tooltip:'WebDAV',sortable:true,width:35,fixed:true,renderer:function(webdavEnabled){return UserOverviewEditor.getWebDAVField(webdavEnabled);}},{header:'created:',dataIndex:'creationTime',sortable:true,renderer:function(creationTime){return UserOverviewEditor.getQtipField(creationTime);}},{header:'last modified:',dataIndex:'lastModificationTime',sortable:true,renderer:function(lastModificationTime){return UserOverviewEditor.getQtipField(lastModificationTime);}},{header:'last login:',dataIndex:'lastLoginTime',sortable:true,renderer:function(lastLoginTime){return UserOverviewEditor.getQtipField(lastLoginTime);}}];if(typeof(config.editUserURL)!='undefined'&&config.editUserURL!==''){columns.push({header:'',dataIndex:'id',width:25,fixed:true,sortable:false,renderer:function(id){try{return FilterEditor.getGridImageField({functionString:'UserOverviewEditor.editUser(\''+config.editUserURL+'\','+id+')',iconCls:'editIconCls_14',qtip:VIEWPORT_PROPERTIES.BUTTON_TEXT_EDIT});}catch(renderError){return'<img src="'+Ext.BLANK_IMAGE_URL+'" width="14" height="14" '+'border="0" class="errorIconCls_14" ext:qtip="render-error: '+'try to reload ('+renderError+')"/>';}}});}
gridCm=new Ext.grid.ColumnModel(columns);grid=new Ext.grid.GridPanel({id:(typeof(config.gridId)=='undefined')?'UserOverViewGrid.grid':config.gridId,store:gridStore,cm:gridCm,sm:gridSm,renderTo:(typeof(config.gridId)=='undefined')?'UserOverViewGrid':config.gridId+'.el',autoExpandColumn:'id',loadMask:true,viewConfig:{forceFit:true},frame:false,style:'border: 1px solid #8DB2E3;',tbar:(typeof(config.toggleUserStateURL)!='undefined'&&config.toggleUserStateURL!=='')?[{text:'LOC: Toggle User active or inactive',iconCls:'isSelectedIconCls',handler:function(){id=(typeof(config.gridId)=='undefined')?'UserOverViewGrid.grid':config.gridId;grid=Ext.getCmp(id);selectedRecords=grid.getSelectionModel().getSelections();if(selectedRecords.length===0){return;}
ids=[];mapping=[];for(i=0;i<selectedRecords.length;i++){ids.push(selectedRecords[i].get('id'));mapping.push({id:selectedRecords[i].get('id'),clazz:selectedRecords[i].get('clazz')});}
Ext.Ajax.request({url:config.toggleUserStateURL,method:'POST',scope:grid,success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){this.getStore().reload();UserOverviewEditor.toggleActiveForOpenUserEditors(options.mapping);}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'UserOverviewEditor','tbar.toggleUserState');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'UserOverviewEditor','tbar.toggleUserState');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'UserOverviewEditor','tbar.toggleUserState');}},mapping:mapping,params:{ids:ids}});}},new Ext.Toolbar.Separator()]:[],bbar:pagingToolBar});if(typeof(config.tab)!='undefined'){grid.setWidth(config.tab.getInnerWidth()-10);tabMsgPanel=Ext.getCmp(config.tab.id+'.msgPanel');msgPanelHeight=0;if(tabMsgPanel.isVisible()){msgPanelHeight=tabMsgPanel.getSize().height;}
tabHeader=Ext.get(config.tab.id+'.header');grid.setHeight(config.tab.getInnerHeight()-tabHeader.getBox().height-msgPanelHeight-10);config.tab.on({'resize':{fn:function(tab,adjWidth,adjHeight,rawWidth,rawHeight){grid=Ext.getCmp('UserOverViewGrid.grid');tabContentPanel=Ext.getCmp(config.tab.id+'.contentPanel');grid.setWidth(config.tab.getInnerWidth()-10);tabMsgPanel=Ext.getCmp(config.tab.id+'.msgPanel');msgPanelHeight=0;if(tabMsgPanel.isVisible()){msgPanelHeight=tabMsgPanel.getSize().height;}
tabHeader=Ext.get(config.tab.id+'.header');grid.setHeight(config.tab.getInnerHeight()-tabHeader.getBox().height-msgPanelHeight-10);}}});}
gridStore.load({params:{start:0,limit:10}});return grid;},getUserActiveField:function(bActive){iconCls='';if(true===bActive){iconCls='isSelectedIconCls_14_big';}
html='<img src="'+Ext.BLANK_IMAGE_URL+'" width="14" height="14" border="0" ';html+='class="'+iconCls+'" style="vertical-align:middle;text-align:center;" ';if(true===bActive){html+='ext:qtip="'+VIEWPORT_PROPERTIES.ACTIVE+'"';}else{html+='ext:qtip="'+VIEWPORT_PROPERTIES.INACTIVE+'"';}
html+='/>';return html;},getSuperuserField:function(bSuperuser){iconCls='';if(true===bSuperuser){iconCls='isSelectedIconCls_14_big';}
html='<img src="'+Ext.BLANK_IMAGE_URL+'" width="14" height="14" border="0" ';html+='class="'+iconCls+'" style="vertical-align:middle;text-align:center;" ';if(true===bSuperuser){html+='ext:qtip="superuser: '+bSuperuser+'"';}else{html+='ext:qtip="superuser: '+bSuperuser+'"';}
html+='/>';return html;},getWebDAVField:function(webdavEnabled){if(typeof(webdavEnabled)=='undefined'||webdavEnabled==false){return'';}
iconCls='isSelectedIconCls_14_big';html='<img src="'+Ext.BLANK_IMAGE_URL+'" width="14" height="14" border="0" ';html+='class="'+iconCls+'" style="vertical-align:middle;text-align:center;" />';return html;},getQtipField:function(string){if(typeof(string)=='undefined'){return'';}
html='<div ';html+='ext:qtip="'+string+'"';html+='>'+string+'</div>';return html;},editUser:function(editURL,userid,clazz){if(typeof(clazz)=='undefined'){record=null;store=Ext.getCmp('UserOverViewGrid.grid').getStore();if(store!==null&&typeof(store)!='undefined'){store.each(function(r){if(r.get('id')==userid){record=r;return false;}});}
if(record===null){return;}
clazz=record.get('clazz');}
PULSE_VIEWPORT_CONTROLLER.openTab({id:clazz+'.'+userid+'.editor',title:'...loading: '+userid,tabTip:'(id:'+userid+')',iconCls:'userMaleIconCls',loadParams:{url:editURL,params:{id:userid}}});},reload:function(){grid=Ext.getCmp('UserOverViewGrid.grid');if(grid!==null&&typeof(grid)!='undefined'){grid.getStore().reload();}},toggleActiveForOpenUserEditors:function(mapping){for(i=0;i<mapping.length;i++){id=mapping[i].clazz+'.'+mapping[i].id+'.editor';userEditorTab=Ext.getCmp(id);if(typeof(userEditorTab)!='undefined'&&userEditorTab!==null){userEditorTab.tabEditor.toggleActive();}}},createUser:function(createURL,editURL){try{pel=VIEWPORT.getEl();if(typeof(pel)=='undefined'){throw('UserOverviewEditor.changeUserPassword() :: '+'CHECK for element failed...');}
nameField=new Ext.form.TextField({fieldLabel:VIEWPORT_PROPERTIES.USERNAME,name:'name',width:400,emptyText:VIEWPORT_PROPERTIES.TEXT_ENTER_NAME,allowBlank:false});emailField=new Ext.form.TextField({fieldLabel:VIEWPORT_PROPERTIES.EMAIL,name:'email',width:400,emptyText:VIEWPORT_PROPERTIES.TEXT_ENTER_EMAIL,allowBlank:false});pwdField=new Ext.form.TextField({fieldLabel:VIEWPORT_PROPERTIES.PASSWORD,name:'pwd',width:400,allowBlank:false,enableKeyEvents:true,inputType:'password'});pwdConfirmField=new Ext.form.TextField({fieldLabel:VIEWPORT_PROPERTIES.PASSWORDCONFIRM,name:'cnf',width:400,allowBlank:false,inputType:'password',validator:function(value){if(value.trim()===pwdField.getValue().trim()){return true;}else{return'pwds don\'t match!';}}});pwdField.on('keyup',function(){pwdConfirmField.validate();},this);formPanel=new Ext.form.FormPanel({id:'createUserForm',name:'createUserForm',region:'center',margins:'3 3 3 3',bodyStyle:'padding: 5px',defaultType:'textfield',autoHeight:true,labelWidth:100,items:[nameField,emailField,pwdField,pwdConfirmField]});formPanel.addButton({text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CREATE,scope:this,handler:function(){if(nameField.getValue().trim()===''){return false;}
if(emailField.getValue().trim()===''){return false;}
if(pwdField.getValue().trim()!==pwdConfirmField.getValue().trim()){return false;}
Ext.Ajax.request({url:createURL,method:'POST',scope:this,success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){this.win.close();this.reload();user=decodedResponse.user;this.editUser(editURL,user.id,user.clazz);}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'UserOverviewEditor','createUser()');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'UserOverviewEditor','createUser()');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'UserOverviewEditor','createUser()');}},params:{name:nameField.getValue().trim(),email:emailField.getValue().trim(),pwd:pwdField.getValue().trim(),cnf:pwdConfirmField.getValue().trim()}});}});formPanel.addButton({text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CANCEL,scope:this,handler:function(){this.win.close();}});if(this.el===null){this.el=pel.createChild({tag:'div',id:'createUser.win.el'});}
this.msgPanel=new Ext.Panel({id:'createUser.win.msgPanel',region:'north',html:'msgs go here',border:false,autoHeight:true});this.win=new Ext.Window({id:'createUser.win',iconCls:'addUserIconCls',title:VIEWPORT_PROPERTIES.NEW,modal:true,plain:true,renderTo:this.el,height:200,layout:'border',items:[this.msgPanel,formPanel],width:600});this.win.on('close',function(){delete this.win;delete this.el;delete this.msgPanel;this.win=null;this.el=null;this.msgPanel=null;},this);this.msgPanel.hide();this.msgPanel.collapse();this.msgPanel.on('hide',function(){this.win.doLayout(true);},this);this.win.setPagePosition((VIEWPORT.getSize().width/2)-300,100);this.win.show(this);nameField.validate();emailField.validate();pwdField.validate();pwdConfirmField.validate();}catch(windowInitError){FATAL(windowInitError,this,'creaetUser');}}};DBG.VFSPermissionEditor=DBG.apply(DBG.Editor,{initComponent:false,tree:{selectionchange:false},previewPanel:{onLoad:false},settingsPanel:{beforeupdate:false},buildSettingsPanel:false,updateDetailsPanel:false,initFolderPreviewGrid:false,MSG:false});VFSPermissionEditor={type:'VFSPermissionEditor',DBG:false,minWidth:400,minHeight:400,tab:null,grid:null,previewPanelView:'tile',onRender:function(){folderUpButtonCFG={iconCls:'folderUpIconCls',scope:this,handler:function(){if(true===this.hasChanges()){return;}
if(typeof(this.selectedNode)=='undefined'||this.selectedNode===null||this.selectedNode.id==this.tree.getRootNode().id){this.selectedNode=this.tree.getRootNode();return;}
if(true===this.tree.getLoader().baseParams.priv){priv=true;}else{priv=false;}
if(this.selectedNode.parentNode.id==this.tree.getRootNode().id){this.selectedNode.unselect();this.selectedNode=this.tree.getRootNode();this.previewPanel.load({url:this.previewURL,method:'POST',scripts:true,callback:LPCB,params:{previewNode:'',view:this.previewPanelView,priv:priv},text:'loading...',discardUrl:true,nocache:true,timeout:30});this.settingsPanel.body.update('<div style="padding:5px;">please select a file or folder...</div>');this.updateDetailsPanel(this.selectedNode);return;}
this.selectedNode.parentNode.select();}};tileViewButtonCFG={iconCls:'tileViewIconCls',scope:this,handler:function(){if(typeof(this.selectedNode.attributes.type)=='undefined'||this.selectedNode.attributes.type!='dir'){return;}
if(this.previewPanelView=='tile'){return;}else{this.previewPanelView='tile';}
if(true===this.tree.getLoader().baseParams.priv){priv=true;}else{priv=false;}
if(this.selectedNode.id==this.tree.getRootNode().id){this.previewPanel.load({url:this.previewURL,method:'POST',scripts:true,callback:LPCB,params:{previewNode:'',view:this.previewPanelView,priv:priv},text:'loading...',discardUrl:true,nocache:true,timeout:30});return;}else{this.previewPanel.load({url:this.previewURL,method:'POST',scripts:true,callback:LPCB,params:{previewNode:this.selectedNode.id,view:this.previewPanelView,priv:priv},text:'loading...',discardUrl:true,nocache:true,timeout:30});return;}}};listViewButtonCFG={iconCls:'listViewIconCls',scope:this,handler:function(){if(typeof(this.selectedNode.attributes.type)=='undefined'||this.selectedNode.attributes.type!='dir'){return;}
if(this.previewPanelView=='list'){return;}else{this.previewPanelView='list';}
if(true===this.tree.getLoader().baseParams.priv){priv=true;}else{priv=false;}
if(this.selectedNode.id==this.tree.getRootNode().id){this.previewPanel.load({url:this.previewURL,method:'POST',scripts:true,callback:LPCB,params:{previewNode:'',view:this.previewPanelView,priv:priv},text:'loading...',discardUrl:true,nocache:true,timeout:30});return;}else{this.previewPanel.load({url:this.previewURL,method:'POST',scripts:true,callback:LPCB,params:{previewNode:this.selectedNode.id,view:this.previewPanelView,priv:priv},text:'loading...',discardUrl:true,nocache:true,timeout:30});return;}}};previewPanelCFG={iconCls:'foldersIconCls',id:this.id+'.preview.panel',title:VIEWPORT_PROPERTIES.FILEBROWSER_TITLE,autoScroll:true,autoLoad:{url:this.previewURL,method:'POST',scripts:true,callback:LPCB,params:{previewNode:'',view:this.previewPanelView},text:'loading...',discardUrl:true,nocache:true,timeout:30},tbar:[folderUpButtonCFG,'-',tileViewButtonCFG,'-',listViewButtonCFG]};tabPanelCFG={id:this.id+'.center-region',region:'center',enableTabScroll:true,resizeTabs:false,margins:'0 5 5 0',deferredRender:false,defaults:{autoScroll:true},activeTab:0,items:[previewPanelCFG,{id:this.id+'.settings.panel',iconCls:'vfsPermissionIconCls',title:VIEWPORT_PROPERTIES.VFSPERMISSIONS,autoScroll:true,html:'<div style="padding:5px;">please select a file or folder...</div>'}]};this.tabPanel=new Ext.TabPanel(tabPanelCFG);this.tree=new Ext.tree.TreePanel({title:VIEWPORT_PROPERTIES.FILEBROWSER_TITLE,iconCls:'foldersIconCls',split:true,width:250,minSize:150,maxSize:600,margins:'0 0 5 5',region:'west',animate:true,creatingNewNode:false,enableDD:false,autoScroll:true,containerScroll:true,rootVisible:false,border:true,loader:new Ext.tree.TreeLoader({dataUrl:this.treeURL,uiProviders:{'FileTreeNodeUI':PULSE.FileTreeNodeUI}}),tbar:[{text:'pub',scope:this,handler:function(){if(true===this.hasChanges()){return;}
if(typeof(this.tree)=='undefined'||this.tree===null){THROW({args:arguments},this,'tree.tbarReloadHandler');return;}
this.tree.getLoader().on("beforeload",function(treeLoader,node){treeLoader.baseParams.priv=false;},this);this.tree.getRootNode().reload(function(node){if(true===node.isSelected()){node.unselect();}
node.select();});},iconCls:''},'-',{text:'priv',scope:this,handler:function(){if(true===this.hasChanges()){return;}
if(typeof(this.tree)=='undefined'||this.tree===null){THROW({args:arguments},this,'tree.tbarReloadHandler');return;}
this.tree.getLoader().on("beforeload",function(treeLoader,node){treeLoader.baseParams.priv=true;},this);this.tree.getRootNode().reload(function(node){if(true===node.isSelected()){node.unselect();}
node.select();});},iconCls:''},'-','->',{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_RELOAD,scope:this,handler:function(){if(true===this.hasChanges()){return;}
if(typeof(this.tree)=='undefined'||this.tree===null){THROW({args:arguments},this,'tree.tbarReloadHandler');return;}
this.tree.getRootNode().reload(function(node){if(true===node.isSelected()){node.unselect();}
node.select();});},iconCls:'reloadIconCls'}]});this.detailsPanel=new Ext.Panel({id:this.id+'.details.panel',region:'north',split:true,autoScroll:true,minSize:50,height:120,maxSize:600,margins:'5 5 0 5',html:'details here...'});this.root=new Ext.tree.AsyncTreeNode({text:'root',type:'dir',draggable:false,id:'source.'+Ext.id()});this.root.on('load',function(root){if(typeof(root.attributes.rootPath)=='undefined'){if(root.firstChild!==null){root.attributes.rootPath=root.firstChild.attributes.rootPath;}else{root.attributes.rootPath='???///';}
this.updateDetailsPanel(root);}},this);this.tree.setRootNode(this.root);height=this.getAvailableHeight();this.mainPanel=new Ext.Panel({layout:'border',height:height,renderTo:this.renderTo,items:[this.detailsPanel,this.tree,this.tabPanel]});this.tab.on('resize',function(){msgPanelHeight='0';msgPanel=Ext.getCmp(this.tab.id+'.msgPanel');if(msgPanel.isVisible()){msgPanelHeight=msgPanel.getSize().height;}
this.mainPanel.setHeight(this.getAvailableHeight()
-msgPanelHeight);if(this.tab.getInnerWidth()-10<this.minWidth){this.mainPanel.setWidth(this.minWidth);}else{this.mainPanel.setWidth(this.tab.getInnerWidth()-10);}
this.tabPanel.setWidth(this.mainPanel.getSize().width-17
-this.tree.getSize().width);},this);this.tree.getSelectionModel().on('selectionchange',function(selMode,node){if(true===this.tree.disabled){this.tree.enable();}
if(typeof(node)=='undefined'||node===null||false===node.isSelected()){return;}
if(this.previewPanelView!='list'&&typeof(this.grid)!='undefined'&&this.grid!==null){delete this.grid;this.grid=null;}
tb=this.tabPanel.getActiveTab();THROW({args:arguments,propsObj:tb,props:['id','title']},this,'tree.selectionchange');if(true===this.tree.getLoader().baseParams.priv){priv=true;}else{priv=false;}
this.selectedNode=node;this.previewPanel.load({url:this.previewURL,method:'POST',scripts:true,callback:LPCB,params:{previewNode:node.id,view:this.previewPanelView,priv:priv},text:'loading...',discardUrl:true,nocache:true,timeout:30});if(tb.id==this.settingsPanel.id){if(node.id==this.tree.getRootNode().id){this.settingsPanel.body.update('<div style="padding:5px;">please select a file or folder...</div>');}else{this.settingsPanel.load({url:this.permissionsURL,method:'POST',scripts:true,callback:LPCB,params:{previewNode:(typeof(node.attributes.vfsid)!='undefined')?node.attributes.vfsid:node.id,view:this.previewPanelView,priv:priv},text:'loading...',discardUrl:true,nocache:true,timeout:30});}}
if(true===this.tabPanel.disabled){this.tabPanel.enable();}
this.updateDetailsPanel(node);},this);this.tree.getSelectionModel().on('beforeselect',function(selMode,newnode,prevnode){if(false===this.hasChanges()){return true;}
Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE,VIEWPORT_PROPERTIES.TEXT_UNSAVEDCHANGES+'<br />'
+VIEWPORT_PROPERTIES.TEXT_REALLYCONTINUE,function(response){if('yes'===response){this.reset();newnode.select();}else{this.settingsPanel.show();}},this);return false;},this);this.previewPanel=Ext.getCmp(this.id+'.preview.panel');this.settingsPanel=Ext.getCmp(this.id+'.settings.panel');this.selectedNode=this.tree.getRootNode();PULSE_VIEWPORT_CONTROLLER.insertHasChangesIcon(this.settingsPanel,this.tabPanel);this.previewPanel.getUpdater().on('update',function(panelEl,response){pnlTabEl=this.tabPanel.getTabEl(this.previewPanel);THROW({args:arguments,o:{props:['className'],propsObj:pnlTabEl},props:['selectedNode','selectedNode.id','selectedNode.text','selectedNode.iconCls','selectedNode.ui','selectedNode.ui.iconCls']},this,'previewPanel.onLoad');if(typeof(this.selectedNode)=='undefined'||this.selectedNode===null){return;}
extPnlTabElTitleDom=Ext.DomQuery.selectNode("*[@class*='x-tab-strip-text']",pnlTabEl);if(this.selectedNode.id==this.tree.getRootNode().id){this.previewPanel.setTitle(VIEWPORT_PROPERTIES.FILEBROWSER_TITLE);extPnlTabElTitleDom.getAttributeNode('class').nodeValue='x-tab-strip-text foldersIconCls';return;}else{this.previewPanel.setTitle(this.selectedNode.text);}
if(typeof(this.selectedNode.ui.iconCls)=='undefined'){extPnlTabElTitleDom.getAttributeNode('class').nodeValue='x-tab-strip-text folderIconCls';}else{extPnlTabElTitleDom.getAttributeNode('class').nodeValue='x-tab-strip-text '
+this.selectedNode.ui.iconCls;}
return;},this);this.settingsPanel.on('show',function(){if(this.selectedNode.id==this.tree.getRootNode().id){return;}
if(true===this.hasChanges()){return;}
this.settingsPanel.load({url:this.permissionsURL,method:'POST',scripts:true,callback:LPCB,params:{previewNode:(typeof(this.selectedNode.attributes.vfsid)!='undefined')?this.selectedNode.attributes.vfsid:this.selectedNode.id,view:this.previewPanelView},text:'loading...',discardUrl:true,nocache:true,timeout:30});},this);},getAvailableHeight:function(){height=this.minHeight;if(typeof(this.tab)!='undefined'&&typeof(this.tab.getAvailableInnerHeight)=='function'){height=this.tab.getAvailableInnerHeight();}
if(height<this.minHeight){height=this.minHeight;}
return height;},onTileClick:function(name,el,singleClick){if(true===this.hasChanges()){return;}
try{this.tree.disable();this.tabPanel.disable();if(typeof(this.selectedNode)=='undefined'||this.selectedNode===null){node=this.tree.getRootNode();for(i=0;i<node.childNodes.length;i++){if(node.childNodes[i].text==name){node.childNodes[i].select();break;}}
return;}
if(false===this.selectedNode.isExpanded()){this.selectedNode.expand(false,true,function(node){for(i=0;i<node.childNodes.length;i++){if(node.childNodes[i].text==name){node.childNodes[i].select();break;}}});}else{for(i=0;i<this.selectedNode.childNodes.length;i++){node=this.selectedNode.childNodes[i];if(node.text==name){node.select();break;}}}}catch(e){this.tree.enable();this.tabPanel.enable();THROW({e:''+e,args:arguments,props:['id','tab','tree','mainPanel','tabPanel','selectedNode','selectedNode.text']},this,'onTileClick');}},folderDblClick:function(fileName,el){this.onTileClick(fileName,el,false);},folderClick:function(fileName,el){this.onTileClick(fileName,el,true);},fileDblClick:function(fileName,el){this.onTileClick(fileName,el,false);},fileClick:function(fileName,el){this.onTileClick(fileName,el,true);},detailsTemplate:new Ext.Template('<div style="font-weight:bold;padding:5px;font-size:12px;">{path}</div>','<hr class="adminHr" style="margin:0px;"/>','<div style="width:100px;height:100%;float:left;overflow:auto;text-align:center;" class="adminBorder_right">','<div style="height:5px;"> </div>','<b>{type}</b><br/>','<img src="'+Ext.BLANK_IMAGE_URL+'" width="32" heigth="32" '
+'border="0" alt="{type}" class="{icoCls}_32" />','</div>','<div>','<div style="height:5px;"> </div>','<div><span style="margin-left:5px;">id:</span>&#160;<b>{fileId}</b></div>','<div><span style="margin-left:5px;">file-extension:</span>&#160;<b>{extension}</b></div>','<div><span style="margin-left:5px;">file-name:</span>&#160;<b>{fileName}</b></div>','<div><span style="margin-left:5px;">file-http-URI:</span>&#160;<b><a href="{httpURI}?download">{httpURI}</a></b></div>','</div>'),updateDetailsPanel:function(node){THROW({args:arguments,propsObj:node,props:['id','text','ui.iconCls']},this,'updateDetailsPanel');if(typeof(node.parentNode)=='undefined'||node.parentNode===null){path=node.attributes.rootPath;icoCls='folderIconCls';}else if(node.attributes.type=='dir'){path=node.id;icoCls='folderIconCls';}else{path=node.parentNode.id+'/'+node.attributes.fileName;icoCls='file'+node.attributes.extension+'IconCls';}
this.detailsTemplate.overwrite(this.detailsPanel.body,{path:path,name:node.text,type:node.attributes.type,extension:node.attributes.extension,fileId:(typeof(node.attributes.vfsid)!='undefined')?node.attributes.vfsid:node.attributes.fileId,fileName:node.attributes.fileName,httpURI:node.attributes.httpURI,icoCls:icoCls});},buildSettingsPanel:function(config){THROW({propsObj:config,props:['id','clazz','editPermissionURL','loadReadPermissionsURL','loadWritePermissionsURL']},this,'buildSettingsPanel');if(true===config.isDirectory){this.initApplyChildrenMonitor(config);}
this.readRolesEditor=new Pulse.AssorterPanel({preLoad:false,title:VIEWPORT_PROPERTIES.VFSREADROLES,renderTo:config.clazz+'.'+config.id+'.roles.read',loadURL:config.loadReadPermissionsURL+'?id='
+config.id,editURL:config.editPermissionURL,editHandler:function(node){PermissionOverviewEditor.editPermission(this.editURL,node.attributes.id,node.attributes.clazz);},uiProviders:{'AccessControlTreeNodeUI':PULSE.AccessControlTreeNodeUI}});this.readRolesEditor.on('MSG',function(msgString,editor){THROW({args:arguments},this,'MSG');if(msgString=='change'){if(true===this.hasChanges()){this.settingsPanel.toggleHasChangesIcon(true);PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'change'}]});}else{this.settingsPanel.toggleHasChangesIcon(false);PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'reset'}]});}
return;}
PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:msgString}]});},this);this.readRolesEditor.on('reset',function(eObj){if(true===eObj.success&&false===this.hasChanges()){this.settingsPanel.toggleHasChangesIcon(false);PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'reset'}]});}},this);this.writeRolesEditor=new Pulse.AssorterPanel({preLoad:false,title:VIEWPORT_PROPERTIES.VFSWRITEROLES,renderTo:config.clazz+'.'+config.id+'.roles.write',loadURL:config.loadWritePermissionsURL+'?id='
+config.id,editURL:config.editPermissionURL,editHandler:function(node){PermissionOverviewEditor.editPermission(this.editURL,node.attributes.id,node.attributes.clazz);},uiProviders:{'AccessControlTreeNodeUI':PULSE.AccessControlTreeNodeUI}});this.writeRolesEditor.on('MSG',function(msgString,editor){THROW({args:arguments},this,'MSG');if(msgString=='change'){if(true===this.hasChanges()){this.settingsPanel.toggleHasChangesIcon(true);PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'change'}]});}else{this.settingsPanel.toggleHasChangesIcon(false);PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'reset'}]});}
return;}
PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:msgString}]});},this);this.writeRolesEditor.on('reset',function(eObj){if(true===eObj.success&&false===this.hasChanges()){this.settingsPanel.toggleHasChangesIcon(false);PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'reset'}]});}},this);},initApplyChildrenMonitor:function(config){try{this.applyForChildrenEl=Ext.get(config.clazz+'.'+config.id
+'.applyForChildren');if(typeof(this.applyForChildrenEl)=='undefined'&&this.applyForChildrenEl===null){if(this.DBG){FATAL('ELEMENT UNDEFINED',this,'initApplyChildrenMonitor');}
return;}
applyForChildrenMonitorCFG={id:this.id+'.applyForChildrenEditor',el:this.applyForChildrenEl,fieldType:'checkbox'};this.applyForChildrenMonitor=new Pulse.FieldMonitor(applyForChildrenMonitorCFG);this.applyForChildrenMonitor.on('MSG',function(msgString){if(true===this.hasChanges()){this.settingsPanel.toggleHasChangesIcon(true);}else{this.settingsPanel.toggleHasChangesIcon(false);}},this);this.addSubEditor(this.applyForChildrenMonitor);try{Ext.get(config.clazz+'.'+config.id
+'.applyForChildrenMSG').setVisibilityMode(Ext.Element.DISPLAY).hide();}catch(e){}
this.applyForChildrenMonitor.on('MSG',function(msgString){try{if(msgString=='change'){Ext.get(this.clazz+'.'+this.id
+'.applyForChildrenMSG').show(true);}else if(msgString=='reset'){Ext.get(this.clazz+'.'+this.id
+'.applyForChildrenMSG').hide(true);}}catch(e){}},config);}catch(e){if(this.DBG){FATAL(e,this,'initApplyChildrenMonitor');}}},hasChanges:function(){superBool=Pulse.VFSPermissionEditor.superclass.hasChanges.call(this);if(typeof(this.readRolesEditor)=='undefined'&&typeof(this.writeRolesEditor)=='undefined'){return superBool;}
return(superBool||this.tab.isDirty||this.readRolesEditor.hasChanges()||this.writeRolesEditor.hasChanges());},getChanges:function(v){try{v=Pulse.VFSPermissionEditor.superclass.getChanges.call(this,v);if(typeof(v)=='undefined'||v===null){v={};}
if(typeof(this.readRolesEditor)!='undefined'&&this.readRolesEditor!==null){if(true===this.readRolesEditor.hasChanges()){chgs=this.readRolesEditor.getChanges();if(typeof(chgs.asoc)!='undefined'){v.addreadroles=chgs.asoc;}
if(typeof(chgs.unasoc)!='undefined'){v.remreadroles=chgs.unasoc;}}}
if(typeof(this.writeRolesEditor)!='undefined'&&this.writeRolesEditor!==null){if(true===this.writeRolesEditor.hasChanges()){chgs=this.writeRolesEditor.getChanges();if(typeof(chgs.asoc)!='undefined'){v.addwriteroles=chgs.asoc;}
if(typeof(chgs.unasoc)!='undefined'){v.remwriteroles=chgs.unasoc;}}}
return v;}catch(e){THROW({e:'FATAL',o:e},this,'getChanges');}},commit:function(){Pulse.VFSPermissionEditor.superclass.commit.call(this);if(typeof(this.readRolesEditor)!='undefined'&&this.readRolesEditor!==null){if(true===this.readRolesEditor.hasChanges()){this.readRolesEditor.commit();}}
if(typeof(this.writeRolesEditor)!='undefined'&&this.writeRolesEditor!==null){if(true===this.writeRolesEditor.hasChanges()){this.writeRolesEditor.commit();}}
this.settingsPanel.toggleHasChangesIcon(false);},resetPermissions:function(){if(typeof(this.readRolesEditor)!='undefined'&&this.readRolesEditor!==null){this.readRolesEditor.reset();}
if(typeof(this.writeRolesEditor)!='undefined'&&this.writeRolesEditor!==null){this.writeRolesEditor.reset();}},reset:function(){Pulse.VFSPermissionEditor.superclass.reset.call(this);this.settingsPanel.toggleHasChangesIcon(false);PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'reset'}]});this.resetPermissions();},initTab:function(){if(typeof(this.tab)!='undefined'){if(true!==this.tab.isInitialized){saveButtonConfig={text:VIEWPORT_PROPERTIES.BUTTON_TEXT_SAVE,scope:this,handler:function(){if(false===this.hasChanges()){PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'savesuccess'}]});return;}
id=this.selectedNode.id;if(typeof(this.selectedNode.attributes.vfsid)!='undefined'){id=this.selectedNode.attributes.vfsid;}
v=this.getChanges({id:id});if(typeof(this.applyForChildrenMonitor)!='undefined'&&true===this.applyForChildrenMonitor.hasChanges()){this.applyForChildrenMonitor.reset();try{Ext.get(this.sitemapNode.clazz+'.'
+this.sitemapNode.id
+'.applyRolesForChildrenMSG').hide();}catch(e){}}
this.tab.disable();Ext.Ajax.request({url:this.saveURL,method:'POST',scope:this,success:function(response,options){this.tab.enable();decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){this.commit();(function(){this.fireEvent('MSG','savesuccess',this);}).defer(250,this);}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this.type,'tbar.savePermissions');}},failure:function(response,options){this.tab.enable();if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this.type,'tbar.savePermissions');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this.type,'tbar.savePermissions');}},params:v});},iconCls:'saveIconCls'};tabTbar=this.tab.getTopToolbar().insertButton(0,[saveButtonConfig,new Ext.Toolbar.Separator()]);this.tab.pEditor=this;this.tab.isInitialized=true;}}},initFolderPreviewGrid:function(){THROW({props:['treeURL','selectedNode.id']},this,'initFolderPreviewGrid');gridStoreRecord=new Ext.data.Record.create([{name:'id'},{name:'vfsid'},{name:'rootPath'},{name:'text'},{name:'type'},{name:'leaf'},{name:'fileId'},{name:'fileName'},{name:'httpURI'},{name:'httpURIString'},{name:'extension'}]);if(true===this.tree.getLoader().baseParams.priv){priv=true;}else{priv=false;}
storeCFG={fields:gridStoreRecord,root:'data',url:this.treeURL,baseParams:{forGrid:true,priv:priv}};gridStore=new Ext.data.JsonStore(storeCFG);columns=[{header:'',dataIndex:'extension',renderer:function(v){if(typeof(v)!='string'||v===''){iconCls='folderIconCls';}else{iconCls='file'+v+'IconCls';}
return'<img src="'+Ext.BLANK_IMAGE_URL+'" '
+'width="18" height="18" border="0" '+'class="'
+iconCls+'" />';},sortable:true,width:30,fixed:true},{header:VIEWPORT_PROPERTIES.NAME+':',dataIndex:'text',sortable:true},{header:VIEWPORT_PROPERTIES.FILETYPE+':',dataIndex:'type',sortable:true},{header:'vfsid:',dataIndex:'vfsid',sortable:true,width:50,fixed:true}];gridCm=new Ext.grid.ColumnModel(columns);gridCFG={store:gridStore,height:this.previewPanel.getInnerHeight(),height:this.previewPanel.getInnerWidth(),cm:gridCm,renderTo:'vfsPermissionEditor.overview.grid.el',autoExpandColumn:'id',loadMask:true,viewConfig:{forceFit:true},frame:false,border:false};this.grid=new Ext.grid.GridPanel(gridCFG);this.grid.on('rowclick',function(grid,rowIndex,evt){this.folderDblClick(grid.getStore().getAt(rowIndex).get('text'));},this);this.grid.on('rowdblclick',function(grid,rowIndex,evt){this.folderDblClick(grid.getStore().getAt(rowIndex).get('text'));},this);this.previewPanel.on('resize',function(){if(typeof(this.grid)=='undefined'||this.grid===null){return;}
this.grid.setHeight(this.previewPanel.getInnerHeight());this.grid.setWidth(this.previewPanel.getInnerWidth());},this);gridStore.on('beforeLoad',function(store,options){store.baseParams.node=this.selectedNode.id;},this);gridStore.load();return this.grid;},initComponent:function(){Pulse.VFSPermissionEditor.superclass.initComponent.call(this);if(typeof(this.id)=='undefined'||this.id===null){this.id=Ext.id();}
this.initTab();THROW({args:arguments,props:['id','renderTo','treeURL','previewURL','tab','tab.id']},this,'initComponent');}};Pulse.VFSPermissionEditor=Ext.extend(Pulse.Editor,VFSPermissionEditor);PULSE.AccessControlTreeNodeUI=function(){PULSE.AccessControlTreeNodeUI.superclass.constructor.apply(this,arguments);};Ext.extend(PULSE.AccessControlTreeNodeUI,Ext.tree.TreeNodeUI,{type:'AccessControlTreeNodeUI',DBG:false,functionsIconSize:14,renderElements:function(n,a,targetNode,bulkRender){if(typeof(a.total)!='undefined'){n.parentNode.attributes.total=a.total;}
if(typeof(a.clazz)!='undefined'&&(a.clazz!==null)&&(a.clazz!=='')){clazzArray=a.clazz.split('.');a.iconCls=clazzArray.join('');}
this.indentMarkup=n.parentNode?n.parentNode.ui.getChildIndent():'';editBtn='';styleString='margin-bottom: 2px; padding: 0px; border: 0px; vertical-align: middle;';id=Ext.id();edit=false;ownerTreeEditor=n.getOwnerTree().treeEditor;if(typeof(ownerTreeEditor.editHandler)=='function'&&typeof(ownerTreeEditor.editURL)=='string'&&ownerTreeEditor.editURL!==''){edit=true;editBtn='&#160;<a href="#" style="font-weight: bold" id="edtEl_'+n.id+'.'+id+'">'+'<img src="'+Ext.BLANK_IMAGE_URL+'" '+'width="'+this.functionsIconSize+'" '+'height="'+this.functionsIconSize+'" '+'style="'+styleString+'" '+'class="editIconCls_'+this.functionsIconSize+'" '+'ext:qtip="'+VIEWPORT_PROPERTIES.BUTTON_TEXT_EDIT+'" />'+'</a>&#160;';}
href=a.href?a.href:Ext.isGecko?"":"#";buf=['<li class="x-tree-node">','<div ext:tree-node-id="',n.id,'" class="x-tree-node-el x-tree-node-leaf ',a.cls,'">','<span class="tabHasChangesIconHidden">*</span>','<img src="',a.icon||this.emptyIcon,'" class="x-tree-node-icon',(a.icon?" x-tree-node-inline-icon":""),(a.iconCls?" "+a.iconCls:""),'" unselectable="on" style="width:18px"/>','<a hidefocus="on" class="x-tree-node-anchor" href="',href,'" tabIndex="1" ',a.hrefTarget?' target="'+a.hrefTarget+'"':'',' dir="LTR">','<span unselectable="on" ext:qtip="id: '+n.id+'">',n.text,'</span></a>',editBtn,"</div>",'<ul class="x-tree-node-ct" style="display:none;"></ul>',"</li>"].join('');if(bulkRender!==true&&n.nextSibling&&n.nextSibling.ui.getEl()){this.wrap=Ext.DomHelper.insertHtml("beforeBegin",n.nextSibling.ui.getEl(),buf);}else{this.wrap=Ext.DomHelper.insertHtml("beforeEnd",targetNode,buf);}
this.elNode=this.wrap.childNodes[0];this.ctNode=this.wrap.childNodes[1];cs=this.elNode.childNodes;this.hasChangesNode=cs[0];this.iconNode=cs[1];this.anchor=cs[2];this.textNode=cs[2].firstChild;if(true===edit){var editEl=Ext.get('edtEl_'+n.id+'.'+id);if(typeof(editEl)!='undefined'&&editEl!==null){editEl.on('click',this.editNode,this);}}
if(typeof(a.description)!='undefined'&&a.description!==''){this.buildQTip(this,a);}},editNode:function(event){event.handle='edit';},updateExpandIcon:function(){},getChildIndent:function(){},renderIndent:function(){},buildQTip:function(ui,a){if(typeof(ui)=='undefined'||typeof(a)=='undefined'||ui===null){return;}
Ext.QuickTips.register({target:ui.textNode,text:'id: '+a.id+'<br />'+'<hr /><span style="font-weight:bold;font-style:italic;">description:</span><br />'+
a.description});},setChanged:function(bool){THROW({o:bool},this,'setChanged');if(true===bool){Ext.fly(this.hasChangesNode).removeClass("tabHasChangesIconHidden");return;}
Ext.fly(this.hasChangesNode).replaceClass("","tabHasChangesIconHidden");}});PULSE.AccessControlRootTreeNodeUI=function(){PULSE.AccessControlRootTreeNodeUI.superclass.constructor.apply(this,arguments);};Ext.extend(PULSE.AccessControlRootTreeNodeUI,PULSE.AccessControlTreeNodeUI,{render:function(){if(!this.rendered){targetNode=this.node.ownerTree.innerCt.dom;this.node.expanded=true;targetNode.innerHTML='<div class="x-tree-root-node"></div>';this.wrap=this.ctNode=targetNode.firstChild;}},collapse:function(){},expand:function(){}});Ext.grid.AjaxRowExpander=function(config){Ext.apply(this,config);this.addEvents({beforeexpand:true,expand:true,beforecollapse:true,collapse:true});Ext.grid.AjaxRowExpander.superclass.constructor.call(this);this.state={};this.loaded={};this.bodyContent={};};Ext.extend(Ext.grid.AjaxRowExpander,Ext.util.Observable,{spanRows:'',header:'',width:30,sortable:false,fixed:true,lazyRender:true,enableCaching:true,getRowClass:function(record,rowIndex,p,ds){var content=this.bodyContent[record.id];if(!content&&!this.lazyRender){content=this.getBodyContent(record,rowIndex);}
if(content){p.body=content;}
return this.state[record.id]?'x-grid3-row-expanded':'x-grid3-row-collapsed';},init:function(grid){this.grid=grid;var view=grid.getView();view.getRowClass=this.getRowClass.createDelegate(this);view.enableRowBody=true;grid.on('render',function(){view.mainBody.on('mousedown',this.onMouseDown,this);},this);},getBodyContent:function(record,index){if(!this.enableCaching){return'test 123 (no-cache)';}
var content=this.bodyContent[record.id];if(!content){content='test 123 (cache)';this.bodyContent[record.id]=content;}
return content;},onMouseDown:function(e,t){if(t.className=='x-grid3-row-expander'){e.stopEvent();row=e.getTarget('.x-grid3-row');this.toggleRow(row);}},renderer:function(v,p,record){if(this.spanRows!==''){p.cellAttr='rowspan="'+this.spanRows+'"';}else{p.cellAttr='rowspan="2"';}
return'<div class="x-grid3-row-expander">&#160;</div>';},beforeExpand:function(record,body,rowIndex){if(this.fireEvent('beforexpand',this,record,body,rowIndex)!==false){if(this.lazyRender){if(typeof(this.params)!='undefined'){this.params.rid=record.get('id');}else{this.params={rid:record.get('id')};}
if(true===this.enableCaching&&true===this.loaded[record.id]){return true;}
this.loaded[record.id]=true;Ext.get(body).load({url:this.url,method:'POST',scripts:true,callback:LPCB,params:this.params,text:'loading...',discardUrl:true,nocache:true,timeout:30});}
return true;}else{return false;}},toggleRow:function(row){if(typeof row=='number'){row=this.grid.view.getRow(row);}
this[Ext.fly(row).hasClass('x-grid3-row-collapsed')?'expandRow':'collapseRow'](row);},expandRow:function(row){if(typeof row=='number'){row=this.grid.view.getRow(row);}
var record=this.grid.store.getAt(row.rowIndex);var body=Ext.DomQuery.selectNode('tr:nth(2) div.x-grid3-row-body',row);if(this.beforeExpand(record,body,row.rowIndex)){this.state[record.id]=true;Ext.fly(row).replaceClass('x-grid3-row-collapsed','x-grid3-row-expanded');this.fireEvent('expand',this,record,body,row.rowIndex);}},collapseRow:function(row){if(typeof row=='number'){row=this.grid.view.getRow(row);}
var record=this.grid.store.getAt(row.rowIndex);var body=Ext.fly(row).child('tr:nth(1) div.x-grid3-row-body',true);if(this.fireEvent('beforcollapse',this,record,body,row.rowIndex)!==false){this.state[record.id]=false;Ext.fly(row).replaceClass('x-grid3-row-expanded','x-grid3-row-collapsed');this.fireEvent('collapse',this,record,body,row.rowIndex);}}});AssorterPanelStore={type:'AssorterPanelStore',DBG:false,id:null,asoc:null,unasoc:null,push:function(boolAsocUnasoc,node){if(boolAsocUnasoc!==node.attributes.initialAsoc){if(true===boolAsocUnasoc){this.asoc.push(node);}else if(false===boolAsocUnasoc){this.unasoc.push(node);}}
this.updateNodeUi(boolAsocUnasoc,node);this.updateArrays(boolAsocUnasoc,node);this.fireEvent('MSG','change',this);THROW({args:arguments,p:[{n:'node.initialAsoc',o:''+node.attributes.initialAsoc},{n:'this.hasChanges()',o:''+this.hasChanges()}]},this,'push');},updateArrays:function(boolAsocUnasoc,node){if(true===boolAsocUnasoc){for(i=0;i<this.unasoc.length;i++){chkNode=this.unasoc[i];if(typeof(chkNode)!='undefined'&&chkNode.id==node.id){this.unasoc.splice(i,1);break;}}}else if(false===boolAsocUnasoc){for(i=0;i<this.asoc.length;i++){chkNode=this.asoc[i];if(typeof(chkNode)!='undefined'&&chkNode.id==node.id){this.asoc.splice(i,1);break;}}}
THROW({args:arguments,p:[{n:'node.initialAsoc',o:''+node.attributes.initialAsoc},{n:'this.hasChanges()',o:''+this.hasChanges()}]},this,'updateArrays');},getIds:function(boolAsocUnasoc){ids=[];if(true===boolAsocUnasoc){for(i=0;i<this.asoc.length;i++){node=this.asoc[i];if(typeof(node)!='undefined'){ids.push(node.id);}}}else if(false===boolAsocUnasoc){for(i=0;i<this.unasoc.length;i++){node=this.unasoc[i];if(typeof(node)!='undefined'){ids.push(node.id);}}}
return ids;},getChanges:function(){chgs={};ids=this.getIds(true);if(ids.length>0){chgs.asoc=ids;}
ids=this.getIds(false);if(ids.length>0){chgs.unasoc=this.getIds(false);}
return chgs;},hasChanges:function(){return(this.asoc.length!==0||this.unasoc.length!==0);},commit:function(){for(i=0;i<this.asoc.length;i++){node=this.asoc[i];if(typeof(node)!='undefined'){node.attributes.initialAsoc=true;if(typeof(node.ui.setChanged)=='function'){node.ui.setChanged(false);}}}
this.asoc=[];for(i=0;i<this.unasoc.length;i++){node=this.unasoc[i];if(typeof(node)!='undefined'){node.attributes.initialAsoc=false;if(typeof(node.ui.setChanged)=='function'){node.ui.setChanged(false);}}}
this.unasoc=[];return!this.hasChanges();},clear:function(){this.asoc=[];this.unasoc=[];return!this.hasChanges();},updateNodeUi:function(boolAsocUnasoc,node){THROW({args:arguments,propsObj:node,props:['ui','ui.hasChanges']},this,'updateNodeUi');if(typeof(node.ui.setChanged)=='function'){if(boolAsocUnasoc==node.attributes.initialAsoc){node.ui.setChanged(false);}else{node.ui.setChanged(true);}}},initComponent:function(){this.addEvents('MSG');this.asoc=[];this.unasoc=[];if(typeof(this.initialConfig.id)=='undefined'){this.id=Ext.id(null,this.type+'.');}}};Pulse.AssorterPanelStore=Ext.extend(Ext.Component,AssorterPanelStore);AssorterPanel={type:'AssorterPanel',DBG:false,id:null,height:200,renderTo:null,panel:null,leftTree:null,rightTree:null,tab:null,store:null,onRender:function(){this.panel=new Ext.Panel({id:this.renderTo+'.panel',header:(typeof(this.header)=='boolean')?this.header:true,title:(this.title)?this.title+':':'&#160;',iconCls:this.iconCls,collapsible:(typeof(this.collapsible)=='boolean')?this.collapsible:true,collapsed:(typeof(this.collapsed)=='boolean')?this.collapsed:true,border:(typeof(this.border)=='boolean')?this.border:true,renderTo:this.renderTo,contentEl:this.renderTo+'.contentEl'});if(false!==this.header){Pulse.insertHasChangesIcon(this.panel);}
this.leftLoader=new Ext.tree.TreeLoader({dataUrl:this.loadURL,uiProviders:this.uiProviders});this.rightLoader=new Ext.tree.TreeLoader({dataUrl:this.loadURL,baseParams:{unasoc:true},uiProviders:this.uiProviders});leftBbar=new Pulse.TreePagingToolbar({displayInfo:true,treeLoader:this.leftLoader,editor:this,onBeforeRefresh:function(){this.editor.leftFilter.setValue('');this.editor.leftLoader.baseParams.filter=null;delete this.editor.leftLoader.baseParams.filter;}});rightBbar=new Pulse.TreePagingToolbar({displayInfo:true,treeLoader:this.rightLoader,editor:this,onBeforeRefresh:function(){this.editor.rightFilter.setValue('');this.editor.rightLoader.baseParams.filter=null;delete this.editor.rightLoader.baseParams.filter;}});this.leftFilter=new Ext.form.TextField({width:150,enableKeyEvents:true,emptyText:VIEWPORT_PROPERTIES.BUTTON_TEXT_FIND});this.rightFilter=new Ext.form.TextField({width:150,enableKeyEvents:true,emptyText:VIEWPORT_PROPERTIES.BUTTON_TEXT_FIND});this.leftRoot=new Ext.tree.AsyncTreeNode({text:this.renderTo+'.source.left',draggable:false,id:this.renderTo+'.source.left'});this.rightRoot=new Ext.tree.AsyncTreeNode({text:this.renderTo+'.source.right',draggable:false,id:this.renderTo+'.source.right'});this.leftTree=new Ext.tree.TreePanel({title:VIEWPORT_PROPERTIES.ASSIGNED+':',iconCls:'isSelectedIconCls',treeEditor:this,el:this.renderTo+'.asoc',rootVisible:false,height:this.height-33,loader:this.leftLoader,autoScroll:true,containerScroll:true,enableDD:true,ddAppendOnly:false,dropConfig:{allowContainerDrop:true,allowParentInsert:true,ddGroup:this.renderTo+'.dd',onContainerOver:function(ddSrc,evt,data){return this.dropAllowed;},onContainerDrop:function(ddSrc,evt,data){if(data.node.getOwnerTree().id==this.tree.id){return false;}
this.tree.root.appendChild(data.node);this.tree.treeEditor.store.push(true,data.node);return true;}},ddGroup:this.renderTo+'.dd',tbar:[this.leftFilter,'&#160;',{tooltip:VIEWPORT_PROPERTIES.BUTTON_TEXT_FIND,scope:this,handler:function(){if(true===this.hasChanges()){Ext.Msg.alert(VIEWPORT_PROPERTIES.TEXT_FUNCTIONDISABLED,VIEWPORT_PROPERTIES.TEXT_UNSAVEDCHANGES);return;}
this.leftRoot.reload();},iconCls:'findIconCls'}],bbar:leftBbar});this.rightTree=new Ext.tree.TreePanel({title:VIEWPORT_PROPERTIES.NOTASSIGNED+':',iconCls:'isSelectedDisabledIconCls',treeEditor:this,el:this.renderTo+'.unasoc',rootVisible:false,autoScroll:true,containerScroll:true,height:this.height-33,loader:this.rightLoader,enableDD:true,ddAppendOnly:false,dropConfig:{allowContainerDrop:true,allowParentInsert:true,ddGroup:this.renderTo+'.dd',onContainerOver:function(ddSrc,evt,data){return this.dropAllowed;},onContainerDrop:function(ddSrc,evt,data){if(data.node.getOwnerTree().id==this.tree.id){return false;}
this.tree.root.appendChild(data.node);this.tree.treeEditor.store.push(false,data.node);return true;}},ddGroup:this.renderTo+'.dd',tbar:[this.rightFilter,'&#160;',{tooltip:VIEWPORT_PROPERTIES.BUTTON_TEXT_FIND,scope:this,handler:function(){if(true===this.hasChanges()){Ext.Msg.alert(VIEWPORT_PROPERTIES.TEXT_FUNCTIONDISABLED,VIEWPORT_PROPERTIES.TEXT_UNSAVEDCHANGES);return;}
this.rightRoot.reload();},iconCls:'findIconCls'}],bbar:rightBbar});this.leftTree.setRootNode(this.leftRoot);this.rightTree.setRootNode(this.rightRoot);leftBbar.setNode(this.leftRoot);rightBbar.setNode(this.rightRoot);this.addTreeListeners(this.leftTree,true);this.addTreeListeners(this.rightTree,false);this.addNameFilterFieldListeners(this.leftFilter,this.leftTree);this.addNameFilterFieldListeners(this.rightFilter,this.rightTree);if(false!==this.preLoad){this.leftTree.render();this.leftTree.getRootNode().expand();}
if(false!==this.preLoad){this.rightTree.render();this.rightTree.getRootNode().expand();}
this.panel.on('expand',function(){if(false===this.preLoad&&true!==this.initialLoad){this.leftTree.render();this.leftTree.getRootNode().expand();this.rightTree.render();this.rightTree.getRootNode().expand();this.initialLoad=true;}
this.leftTree.dropZone.setPadding(0,0,this.leftTree.getInnerHeight(),0);this.rightTree.dropZone.setPadding(0,0,this.rightTree.getInnerHeight(),0);},this);if(false===this.collapsible){this.leftTree.dropZone.setPadding(0,0,this.leftTree.getInnerHeight(),0);this.rightTree.dropZone.setPadding(0,0,this.rightTree.getInnerHeight(),0);}},addTreeListeners:function(tree,boolAsocUnasoc){tree.on('beforenodedrop',function(evt){if(evt.dropNode.getOwnerTree().id==evt.tree.id){return false;}},this);if(true===boolAsocUnasoc){tree.on('nodedrop',function(evt){this.store.push(true,evt.dropNode);},this);}else{tree.on('nodedrop',function(evt){this.store.push(false,evt.dropNode);},this);}
if(true===boolAsocUnasoc){tree.on('dblclick',function(node,evt){this.rightTree.root.appendChild(node);this.store.push(false,node);return true;},this);}else{tree.on('dblclick',function(node,evt){this.leftTree.root.appendChild(node);this.store.push(true,node);return true;},this);}
tree.on('click',function(node,evt){if(typeof(evt.handle)!='undefined'){if(this.DBG){THROW({args:arguments,propsObj:node,props:['text','id'],p:[{n:'evt.handle',o:evt.handle}]},this,'addTreeListeners');}
switch(evt.handle){case'edit':evt.handle=null;delete evt.handle;if(typeof(this.editHandler)=='function'){this.editHandler(node);}
break;default:THROW({e:'ERROR',args:arguments,p:[{n:'node',o:node.text},{n:'id',o:node.id},{n:'UNKNOWN HANDLE:',o:evt.handle}]},this,'addTreeListeners');evt.handle=null;delete evt.handle;}}},this);},addNameFilterFieldListeners:function(field,tree){field.on('keyup',function(field,evt){if(field.getRawValue().trim()===''){this.baseParams.filter=null;delete this.baseParams.filter;return;}
if(!this.baseParams){this.baseParams={};}
this.baseParams.filter=field.getRawValue().trim();},tree.getLoader());field.on('specialkey',function(field,evt){if(evt.getKey()!=Ext.EventObject.ENTER){return;}
if(true===this.treeEditor.hasChanges()){Ext.Msg.alert(VIEWPORT_PROPERTIES.TEXT_FUNCTIONDISABLED,VIEWPORT_PROPERTIES.TEXT_UNSAVEDCHANGES);return;}
if(field.getRawValue().trim()===''){field.blur();}
this.getRootNode().reload();},tree);},getStore:function(){return this.store;},hasChanges:function(){if(this.DBG){THROW({o:''+this.store.hasChanges()},this,'hasChanges');}
return this.store.hasChanges();},getChanges:function(){return this.store.getChanges();},commit:function(){success=this.store.commit();if(true===success&&false!==this.header){this.panel.toggleHasChangesIcon(false);}
return success;},reload:function(boolReset){if(false===this.fireEvent('beforeload',this)){return false;}else{if(true===boolReset){if(false===this.reset()){return;}}
this.leftTree.getBottomToolbar().onClick('refresh');this.rightTree.getBottomToolbar().onClick('refresh');if(false!==this.header){this.panel.toggleHasChangesIcon(false);}
this.fireEvent('load',this);}},reset:function(){if(this.DBG){THROW({p:[{n:'beforereset',o:''+this.fireEvent('beforereset',{assorter:this})}]},this,'reset');}
if(false===this.fireEvent('beforereset',{assorter:this})){return false;}else{success=this.store.clear();if(true===success&&false!==this.header){this.panel.toggleHasChangesIcon(false);}
this.fireEvent('reset',{assorter:this,success:success});return success;}},refreshPagingBar:function(pagingBarId,boolUseOtherBar){if(true===boolUseOtherBar){if(this.rightTree.getBottomToolbar().id==pagingBarId){this.leftTree.getBottomToolbar().onClick('refresh');}else{this.rightTree.getBottomToolbar().onClick('refresh');}
return;}
Ext.getCmp(pagingBarId).onClick('refresh');if(false!==this.header){this.panel.toggleHasChangesIcon(false);}},initComponent:function(){try{this.addEvents({'MSG':true,'beforereset':true,'reset':true,'beforeload':true,'load':true});if(typeof(this.initialConfig.id)=='undefined'){this.id=Ext.id(null,this.type+'.');}
this.store=new Pulse.AssorterPanelStore();this.store.on('MSG',function(msgString,store){if(msgString=='change'){if(false!==this.header){if(true===this.hasChanges()){this.panel.toggleHasChangesIcon(true);}else{this.panel.toggleHasChangesIcon(false);}}}
this.fireEvent('MSG',msgString,this);},this);}catch(e){THROW({e:'FATAL',o:e},this,'initComponent');}}};Pulse.AssorterPanel=Ext.extend(Ext.Component,AssorterPanel);PULSE.AttachmentTreeNodeUI=function(){PULSE.AttachmentTreeNodeUI.superclass.constructor.apply(this,arguments);};Ext.extend(PULSE.AttachmentTreeNodeUI,Ext.tree.TreeNodeUI,{type:'AttachmentTreeNodeUI',DBG:false,functionsIconSize:14,renderElements:function(n,a,targetNode,bulkRender){if(typeof(a.total)!='undefined'){n.parentNode.attributes.total=a.total;}
if(typeof(a.clazz)!='undefined'&&(a.clazz!==null)&&(a.clazz!=='')){clazzArray=a.clazz.split('.');a.iconCls=clazzArray.join('');}
this.indentMarkup=n.parentNode?n.parentNode.ui.getChildIndent():'';styleString='margin-bottom: 2px; padding: 0px; border: 0px; vertical-align: middle;';id=Ext.id();editBtn='';editHandler=false;if(typeof(n.getOwnerTree().treeEditor)!='undefined'&&typeof(n.getOwnerTree().treeEditor.editHandler)=='function'){editHandler=true;editBtn='&#160;<a href="#" style="font-weight: bold" id="edtEl_'+n.id+'.'+id+'">'+'<img src="'+Ext.BLANK_IMAGE_URL+'" '+'width="'+this.functionsIconSize+'" '+'height="'+this.functionsIconSize+'" '+'style="'+styleString+'" '+'class="editIconCls_'+this.functionsIconSize+'" '+'ext:qtip="'+VIEWPORT_PROPERTIES.BUTTON_TEXT_EDIT+'" />'+'</a>&#160;';}
deleteBtn='';deleteHandler=false;if(typeof(n.getOwnerTree().treeEditor)!='undefined'&&typeof(n.getOwnerTree().treeEditor.deleteHandler)=='function'){deleteHandler=true;deleteBtn='&#160;<a href="#" style="font-weight: bold" id="delEl_'+n.id+'.'+id+'">'+'<img src="'+Ext.BLANK_IMAGE_URL+'" '+'width="'+this.functionsIconSize+'" '+'height="'+this.functionsIconSize+'" '+'style="'+styleString+'" '+'class="deleteIconCls_'+this.functionsIconSize+'" '+'ext:qtip="'+VIEWPORT_PROPERTIES.BUTTON_TEXT_REMOVE+'" />'+'</a>&#160;';}
href=a.href?a.href:Ext.isGecko?"":"#";buf=['<li class="x-tree-node">','<div ext:tree-node-id="',n.id,'" class="x-tree-node-el x-tree-node-leaf ',a.cls,'">','<span class="tabHasChangesIconHidden">*</span>','<img src="',a.icon||this.emptyIcon,'" class="x-tree-node-icon',(a.icon?" x-tree-node-inline-icon":""),(a.iconCls?" "+a.iconCls:""),'" unselectable="on" style="width:18px"/>','<a hidefocus="on" class="x-tree-node-anchor" href="',href,'" tabIndex="1" ',a.hrefTarget?' target="'+a.hrefTarget+'"':'',' dir="LTR">','<span unselectable="on" ext:qtip="id: '+n.id+'">',n.text,'</span></a>',editBtn,deleteBtn,"</div>",'<ul class="x-tree-node-ct" style="display:none;"></ul>',"</li>"].join('');if(bulkRender!==true&&n.nextSibling&&n.nextSibling.ui.getEl()){this.wrap=Ext.DomHelper.insertHtml("beforeBegin",n.nextSibling.ui.getEl(),buf);}else{this.wrap=Ext.DomHelper.insertHtml("beforeEnd",targetNode,buf);}
this.elNode=this.wrap.childNodes[0];this.ctNode=this.wrap.childNodes[1];cs=this.elNode.childNodes;this.hasChangesNode=cs[0];this.iconNode=cs[1];this.anchor=cs[2];this.textNode=cs[2].firstChild;if(true===editHandler){var editEl=Ext.get('edtEl_'+n.id+'.'+id);if(typeof(editEl)!='undefined'&&editEl!==null){editEl.on('click',this.editNode,this);}}
if(true===deleteHandler){var deleteEl=Ext.get('delEl_'+n.id+'.'+id);if(typeof(deleteEl)!='undefined'&&deleteEl!==null){deleteEl.on('click',this.deleteNode,this);}}
if(typeof(a.description)!='undefined'&&a.description!==''){this.buildQTip(this,a);}},editNode:function(event){THROW({args:arguments,props:['id','type','node','node.id','node.text']},this,'editNode');event.handle='edit';},deleteNode:function(event){THROW({args:arguments,props:['id','type','node','node.id','node.text']},this,'deleteNode');event.handle='delete';},updateExpandIcon:function(){},getChildIndent:function(){},renderIndent:function(){},buildQTip:function(ui,a){if(typeof(ui)=='undefined'||typeof(a)=='undefined'||ui===null){return;}
Ext.QuickTips.register({target:ui.textNode,text:'id: '+a.id+'<br />'+'<hr /><span style="font-weight:bold;font-style:italic;">description:</span><br />'+
a.description});},setChanged:function(bool){THROW({o:bool},this,'setChanged');if(true===bool){Ext.fly(this.hasChangesNode).removeClass("tabHasChangesIconHidden");return;}
Ext.fly(this.hasChangesNode).replaceClass("","tabHasChangesIconHidden");}});PULSE.AttachmentRootTreeNodeUI=function(){PULSE.AttachmentRootTreeNodeUI.superclass.constructor.apply(this,arguments);};Ext.extend(PULSE.AttachmentRootTreeNodeUI,PULSE.AttachmentTreeNodeUI,{render:function(){if(!this.rendered){targetNode=this.node.ownerTree.innerCt.dom;this.node.expanded=true;targetNode.innerHTML='<div class="x-tree-root-node"></div>';this.wrap=this.ctNode=targetNode.firstChild;}},collapse:function(){},expand:function(){}});DBG.AttachmentsEditor=DBG.apply(DBG.Editor,{initComponent:false,onRender:false,mainPanelExpand:false,loadFileBrowserPanel:false,initFileBrowserPanel:false,MSG:false,click:{treeReload:false,fileBrowserButton:false,createButton:false},addAttachment:false,addTreeListeners:false,editHandler:false,deleteHandler:false,initAttachmentEditorPanel:false,refreshTree:false,fileBrowserTreeRootReload:false});AttachmentsEditor={type:'AttachmentsEditor',height:400,DBG:false,onRender:function(){if(this.DBG){THROW({props:['renderTo'],args:arguments},this,'onRender');}
try{this.treeLoader=new Ext.tree.TreeLoader({dataUrl:this.loadAttachmentsURL,uiProviders:{'AttachmentTreeNodeUI':PULSE.AttachmentTreeNodeUI},baseParams:{id:this.content.id}});treeCfg={treeEditor:this,id:this.id+'.tree',region:'west',loader:this.treeLoader,split:true,width:250,minSize:150,maxSize:600,margins:'5 0 5 5',animate:true,creatingNewNode:false,enableDD:true,ddAppendOnly:false,dropConfig:{editorId:this.id,allowContainerDrop:true,allowParentInsert:true,ddGroup:this.id+'.tree.dropGroup',onContainerOver:function(ddSrc,evt,data){if(typeof(data.node)!='object'||data.node===null||typeof(data.node.attributes.type)!='string'||typeof(data.node.attributes.type)===null){return this.dropNotAllowed;}
if(data.node.attributes.type=='dir'){return this.dropNotAllowed;}
return this.dropAllowed;},onContainerDrop:function(ddSrc,evt,data){if(typeof(data.node)!='object'||data.node===null||typeof(data.node.attributes.type)!='string'||typeof(data.node.attributes.type)===null){return false;}
if(data.node.getOwnerTree().id==this.tree.id||data.node.attributes.type=='dir'){return false;}
Ext.getCmp(this.editorId).addAttachment(data.node);},onNodeOver:function(nodeData,source,evt,data){if(typeof(data.node)!='object'||data.node===null||typeof(data.node.attributes.type)!='string'||typeof(data.node.attributes.type)===null){return this.dropNotAllowed;}
if(data.node.attributes.type=='dir'){return this.dropNotAllowed;}
return this.dropAllowed;},onNodeDrop:function(nodeData,source,evt,data){if(typeof(data.node)!='object'||data.node===null||typeof(data.node.attributes.type)!='string'||typeof(data.node.attributes.type)===null){return false;}
if(data.node.getOwnerTree().id==this.tree.id||data.node.attributes.type=='dir'){return false;}
Ext.getCmp(this.editorId).addAttachment(data.node);}},ddGroup:this.id+'.tree.dropGroup',autoScroll:true,containerScroll:true,rootVisible:false,border:true,tbar:['->','-',{id:this.id+'.tree.reloadButton',text:''+VIEWPORT_PROPERTIES.BUTTON_TEXT_RELOAD,scope:this,handler:function(){THROW({args:arguments},this,'click.treeReload');if(true===this.hasChanges()){return;}
this.refreshTree(this.tree);},iconCls:'reloadIconCls'}]};this.tree=new Ext.tree.TreePanel(treeCfg);this.tree.on('beforeload',function(node){if(node.isLoading()){return false;}});this.tree.on('click',function(node,evt){if(typeof(evt.handle)!='undefined'){if(this.DBG){THROW({args:arguments,propsObj:node,props:['text','id'],p:[{n:'evt.handle',o:evt.handle}]},this,'addTreeListeners');}
switch(evt.handle){case'edit':evt.handle=null;delete evt.handle;if(typeof(this.editHandler)=='function'){this.editHandler(node);}
break;case'delete':evt.handle=null;delete evt.handle;if(typeof(this.deleteHandler)=='function'){this.deleteHandler(node);}
break;default:THROW({e:'ERROR',args:arguments,p:[{n:'node',o:node.text},{n:'id',o:node.id},{n:'UNKNOWN HANDLE:',o:evt.handle}]},this,'addTreeListeners');evt.handle=null;delete evt.handle;}}},this);this.rootNode=new Ext.tree.AsyncTreeNode({text:'root: assigned attachments',type:'dir',draggable:false,id:'source.'+Ext.id()});this.tree.setRootNode(this.rootNode);this.centerPanel=new Ext.Panel({id:this.id+'.center',region:'center',margins:'5 5 5 0',html:' <b style="color:red;">TODO</b> ',autoScroll:true});panelCfg={title:''+VIEWPORT_PROPERTIES.ATTACHMENTSDOWNLOADS,iconCls:'downloadIconCls',id:this.id+'.panel',renderTo:this.renderTo,collapsible:true,collapsed:true,layout:'border',height:this.height,items:[this.tree,this.centerPanel],tbar:[{id:this.id+'.panel.fileBrowserButton',disabled:true,text:VIEWPORT_PROPERTIES.FILEBROWSER_TITLE,scope:this,iconCls:'foldersIconCls',handler:function(){THROW({args:arguments},this,'click.fileBrowserButton');this.loadFileBrowserPanel();}},'-']};this.panel=new Ext.Panel(panelCfg);Pulse.insertHasChangesIcon(this.panel);this.panel.on('expand',function(){if(this.DBG){THROW({args:arguments,props:['tree']},this,'mainPanelExpand');}
if(true===this.panel.isInitialized){return;}
try{this.tree.render();this.tree.getRootNode().expand();this.tree.dropZone.setPadding(0,0,this.tree.getInnerHeight(),0);if(typeof(this.initFileBrowserURL)=='string'&&this.initFileBrowserURL!==''){Ext.getCmp(this.id+'.panel.fileBrowserButton').enable();this.loadFileBrowserPanel();}}catch(e){description=(typeof(e)=='object'&&typeof(e.description)!='undefined')?', '+e.description:'';THROW({e:'FATAL',o:{e:e,o:description}},this,'onInitialExpand');}
this.panel.isInitialized=true;},this);}catch(e){description=(typeof(e)=='object'&&typeof(e.description)!='undefined')?', '+e.description:'';THROW({e:'FATAL',o:{e:e,o:description}},this,'onRender');}},addAttachment:function(node){if(this.DBG){THROW({args:arguments,o:{propsObj:node,props:['id','text','attributes.vfsid','attributes.type','attributes.extension','attributes.fileId','attributes.fileName','attributes.httpURI']}},this,'addAttachment');}
try{pel=VIEWPORT.getEl();if(typeof(pel)=='undefined'){THROW({e:'CANNOT CREATE WINDOW EL'},this,'addAttachment');return;}
this.attNameField=new Ext.form.TextField({fieldLabel:VIEWPORT_PROPERTIES.NAME,id:this.id+'.newAttachmentName',name:this.id+'.newAttachmentName',width:450,emptyText:VIEWPORT_PROPERTIES.TEXT_ENTER_NAME,allowBlank:false,fieldClass:'editorInputField',invalidClass:'editorInputFieldRed',value:node.attributes.fileName});textPanel=new Ext.Panel({bodyStyle:'text-align: center;padding-bottom:10px;',border:false,html:''+VIEWPORT_PROPERTIES.TEXT_ADD_ATTACHMENT});formPanel=new Ext.form.FormPanel({id:this.id+'.newAttachmentForm',name:this.id+'.newAttachmentForm',region:'center',margins:'3 3 3 3',bodyStyle:'padding: 5px',defaultType:'textfield',autoHeight:true,items:[textPanel,this.attNameField]});buttonCfg={text:VIEWPORT_PROPERTIES.BUTTON_TEXT_ADD,scope:this,handler:function(){THROW({args:arguments,props:['addAttachmentURL']},this,'click.createButton');if(this.attNameField.getValue()===''||!this.attNameField.isValid()){return;}
Ext.Ajax.request({scope:this,url:this.addAttachmentURL,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){this.win.close();this.refreshTree(this.tree);}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'ContentRegistryEditor','editNode()');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'ContentRegistryEditor','editNode()');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'ContentRegistryEditor','editNode()');}},params:{id:this.content.id,vfsid:node.attributes.vfsid,name:this.attNameField.getValue()}});}};if(typeof(this.addAttachmentURL)!='string'||this.addAttachmentURL===''){buttonCfg.disabled=true;buttonCfg.iconCls='editDisabledIconCls';}
formPanel.addButton(buttonCfg);formPanel.addButton({text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CANCEL,scope:this,handler:function(){this.win.close();}});if(this.el===null){this.el=pel.createChild({tag:'div',id:'imageGroupEditorWindow.el'});}
this.win=new Ext.Window({id:this.id+'.newAttachment.win',title:node.attributes.fileName,iconCls:'downloadIconCls',modal:true,plain:true,renderTo:this.el,height:130,layout:'border',items:[formPanel],width:600});this.win.on({'close':{scope:this,fn:function(){delete this.attNameField;delete this.el;delete this.win;}}});this.win.setPagePosition((VIEWPORT.getSize().width/2)-300,100);this.win.show(this);this.attNameField.validate();}catch(e){description=(typeof(e)=='object'&&typeof(e.description)!='undefined')?e.description:'';THROW({e:'WINDOW INIT ERROR',o:{e:e,o:description}},this,'addAttachment');}finally{return;}},hasChangesConfirmHandler:function(handler,object){Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE,VIEWPORT_PROPERTIES.TEXT_REALLYCONTINUE+'<br />'+
VIEWPORT_PROPERTIES.TEXT_UNSAVEDCHANGES,function(response){if('yes'===response){this.reset();this[handler](object);}},this);},editHandler:function(node){if(this.DBG){THROW({args:arguments,o:{propsObj:node,props:['id','text','attributes.file.vfsid','attributes.file.type','attributes.file.extension','attributes.file.fileId','attributes.file.fileName','attributes.file.httpURI']}},this,'editHandler');}
if(true===this.hasChanges()){this.hasChangesConfirmHandler('editHandler',node);return;}
try{if(typeof(this.editAttachmentURL)=='string'&&this.editAttachmentURL!==''){this.centerPanel.load({url:this.editAttachmentURL,method:'POST',scripts:true,callback:LPCB,text:'loading...',discardUrl:true,nocache:true,timeout:30,params:{id:this.content.id,attachmentid:node.id}});}}catch(e){description=(typeof(e)=='object'&&typeof(e.description)!='undefined')?e.description:'';THROW({e:'FATAL',o:{e:e,o:description}},this,'editHandler');}},deleteHandler:function(node){if(this.DBG){THROW({args:arguments,o:{propsObj:node,props:['id','text','attributes.file.vfsid','attributes.file.type','attributes.file.extension','attributes.file.fileId','attributes.file.fileName','attributes.file.httpURI','deleteAttachmentURL']}},this,'deleteHandler');}
if(true===this.hasChanges()){if((typeof(this.content.attachment)!='undefined')&&(node.id==this.content.attachment.id)){this.hasChangesConfirmHandler('deleteHandler',node);return;}}
try{if(typeof(this.deleteAttachmentURL)=='string'&&this.deleteAttachmentURL!==''){Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE,VIEWPORT_PROPERTIES.MSG_REALLYREMOVE+'<br />'+
node.text+' ('+node.id+')',function(response){if('yes'===response){Ext.Ajax.request({scope:this,url:this.deleteAttachmentURL,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){this.refreshTree(this.tree);if((typeof(this.content.attachment)!='undefined')&&(options.params.attachmentid==this.content.attachment.id)){this.cleanUpFileBrowser();this.loadFileBrowserPanel();}}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'ContentRegistryEditor','editNode()');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'ContentRegistryEditor','editNode()');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'ContentRegistryEditor','editNode()');}},params:{id:this.content.id,attachmentid:node.id}});}},this);}}catch(e){description=(typeof(e)=='object'&&typeof(e.description)!='undefined')?e.description:'';THROW({e:'FATAL',o:{e:e,o:description}},this,'deleteHandler');}},initFileBrowserPanel:function(content){if(this.DBG){THROW({args:arguments,props:['content.id','content.clazz','fileBrowserTreeURL'],o:{o:'RECEIVED CONTENT',propsObj:content,props:['id','clazz']}},this,'initFileBrowserPanel');}
try{if(true===this.hasChanges()){return;}
if(false===this.checkContentMatch(content)){return;}else{this.content=content;}
this.cleanUpFileBrowser();treeCfg={id:this.id+'.fileBrowserTree',renderTo:this.content.clazz+'.'+this.content.id+'.fileBrowser',animate:true,creatingNewNode:false,enableDrag:true,enableDrop:false,ddGroup:this.id+'.tree.dropGroup',autoScroll:true,containerScroll:true,rootVisible:true,border:false,loader:new Ext.tree.TreeLoader({dataUrl:this.fileBrowserTreeURL,uiProviders:{'FileTreeNodeUI':PULSE.FileTreeNodeUI}}),tbar:[{text:'pub',scope:this,handler:function(){if(true===this.hasChanges()){return;}
this.refreshTree(this.fileBrowserTree,[{n:'priv',v:false}]);},iconCls:''},'-',{text:'priv',scope:this,handler:function(){if(true===this.hasChanges()){return;}
this.refreshTree(this.fileBrowserTree,[{n:'priv',v:true}]);},iconCls:''},'-','->',{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_RELOAD,scope:this,handler:function(){if(true===this.hasChanges()){return;}
this.refreshTree(this.fileBrowserTree);},iconCls:'reloadIconCls'}],root:new Ext.tree.AsyncTreeNode({text:'FileBrowser for attachments',draggable:false,id:'source.'+Ext.id(),iconCls:'foldersIconCls'})};this.fileBrowserTree=new Ext.tree.TreePanel(treeCfg);this.fileBrowserTree.on('beforeload',function(node){if(node.isLoading()){return false;}});this.fileBrowserTree.on('dblclick',function(node,evt){if(node.attributes.type=='dir'){return;}
if(node.id==this.fileBrowserTree.root.id){return;}
this.addAttachment(node);},this);this.fileBrowserTreeRoot=this.fileBrowserTree.getRootNode();this.fileBrowserTreeRoot.on('load',function(node){loader=node.getOwnerTree().getLoader();if(true===loader.baseParams.priv){node.setText('priv');}else{node.setText('pub');}
if(this.DBG){THROW({propsObj:loader,props:['baseParams','baseParams.priv']},this,'fileBrowserTreeRootReload');}},this);this.fileBrowserTree.getRootNode().expand();}catch(e){description=(typeof(e)=='object'&&typeof(e.description)!='undefined')?', '+e.description:'';THROW({e:'FATAL',o:{e:e,o:description}},this,'initFileBrowserPanel');}finally{return;}},loadFileBrowserPanel:function(){if(this.DBG){THROW({args:arguments,props:['content.id','content.clazz','initFileBrowserURL']},this,'loadFileBrowserPanel');}
try{if(true===this.hasChanges()){this.hasChangesConfirmHandler('loadFileBrowserPanel',null);return;}
this.centerPanel.load({url:this.initFileBrowserURL,method:'POST',scripts:true,callback:LPCB,text:'loading...',discardUrl:true,nocache:true,timeout:30,params:{id:this.content.id}});}catch(e){description=(typeof(e)=='object'&&typeof(e.description)!='undefined')?', '+e.description:'';THROW({e:'FATAL',o:{e:e,o:description}},this,'loadFileBrowserPanel');}finally{return;}},initAttachmentEditorPanel:function(content){if(this.DBG){THROW({args:arguments,props:['content.id','content.clazz','fileBrowserPreviewURL','initAttachmentDescriptionEditorURL','saveAttachmentDescriptionEditorURL'],o:{o:'RECEIVED CONTENT',propsObj:content,props:['id','clazz','attachment.id','attachment.clazz','attachment.file.id','attachment.file.clazz']}},this,'initAttachmentEditorPanel');}
try{if(true===this.hasChanges()){return;}
if(false===this.checkContentMatch(content)){return;}else{this.content=content;}
this.cleanUpFileBrowser();panelCfg={id:content.attachment.clazz+'.'+content.attachment.id+'.description.panel',renderTo:content.attachment.clazz+'.'+content.attachment.id+'.description',contentEl:content.attachment.clazz+'.'+content.attachment.id+'.description.content',title:VIEWPORT_PROPERTIES.DESCRIPTION,collapsible:true,collapsed:true,bodyStyle:'padding:5px;',autoScroll:true};if((typeof(this.initAttachmentDescriptionEditorURL)=='string'&&this.initAttachmentDescriptionEditorURL!=='')&&(typeof(this.saveAttachmentDescriptionEditorURL)=='string'&&this.saveAttachmentDescriptionEditorURL!=='')){panelCfg.tbar=[{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_EDIT,scope:this,handler:function(){AbstractBasicContentEditor.getFCKEditorWindow({loadURL:this.initAttachmentDescriptionEditorURL,loadParams:{id:content.id,attachmentid:content.attachment.id},saveURL:this.saveAttachmentDescriptionEditorURL,saveParams:{id:content.id,attachmentid:content.attachment.id},onSaveSuccess:function(){thisPanel=Ext.getCmp(content.attachment.clazz+'.'+content.attachment.id+'.description.panel');thisPanel.reloadContentAction.execute();}});},iconCls:'editIconCls'},'-'];panelCfg.reloadContentAction=new Ext.Action({text:'reloads the content.div',scope:this,handler:function(){contentEl=Ext.get(content.attachment.clazz+'.'+content.attachment.id+'.description.content');updateCfg={url:this.loadAttachmentDescriptionURL,method:'POST',callback:LPCB,params:{attachmentid:content.attachment.id}};contentEl.getUpdater().update(updateCfg);}});}
this.attachmentDescriptionPanel=new Ext.Panel(panelCfg);this.attachmentDescriptionPanel.on('expand',function(p){el=p.getEl().last().child('.x-panel-body');if(true!==el.pulseMask){Ext.DomHelper.append(el.dom,{cls:"pulseTransparentMask"},true);el.pulseMask=true;}});if(typeof(this.fileBrowserPreviewURL)=='string'&&this.fileBrowserPreviewURL!==''){this.filePreviewPanel=new Ext.Panel({renderTo:content.attachment.clazz+'.'+content.attachment.id+'.previewPanel',border:false,autoLoad:{url:this.fileBrowserPreviewURL,method:'POST',callback:LPCB,scripts:true,text:'loading...',discardUrl:true,nocache:true,timeout:30,params:{previewNode:content.attachment.file.id}}});}
this.attachmentNameFieldEl=Ext.get(content.attachment.clazz+'.'+content.attachment.id+'.name');Pulse.initTextFieldMonitor(this.attachmentNameFieldEl,this,'attachmentNameFieldEl',false);}catch(e){description=(typeof(e)=='object'&&typeof(e.description)!='undefined')?', '+e.description:'';THROW({e:'FATAL',o:{e:e,o:description}},this,'initAttachmentEditorPanel');}finally{return;}},checkContentMatch:function(content){if(content.id!=this.content.id){THROW({e:'CONTENTS DON\'T MATCH',props:['content.id','content.clazz'],o:{o:'RECEIVED CONTENT',propsObj:content,props:['id','clazz']}},this,'checkContentMatch');return false;}
return true;},cleanUpFileBrowser:function(){if(typeof(this.fileBrowserTree)!='undefined'&&this.fileBrowserTree!==null){delete this.fileBrowserTree;delete this.fileBrowserTreeRoot;}
if(typeof(this.filePreviewPanel)!='undefined'&&this.filePreviewPanel!==null){delete this.attachmentNameFieldEl;delete this.filePreviewPanel;}},hasChanges:function(){if(typeof(this.attachmentNameFieldEl)=='undefined'||this.attachmentNameFieldEl===null){return false;}
return this.attachmentNameFieldEl.changed;},getChanges:function(v){initialV=v;if(typeof(v)!='object'||v===null){v={};}
if(true===this.hasChanges()){if(true===this.attachmentNameFieldEl.changed){v['attachment_'+this.content.attachment.id+'_name']=this.attachmentNameFieldEl.getValue().trim();}}else{return initialV;}
return v;},commit:function(){if(false===this.fireEvent('MSG','beforecommit',this)){return false;}
try{this.panel.toggleHasChangesIcon(false);if(typeof(this.attachmentNameFieldEl)!='undefined'&&this.attachmentNameFieldEl!==null&&true===this.attachmentNameFieldEl.changed){this.attachmentNameFieldEl.commit();this.refreshTree(this.tree);}
this.fireEvent('MSG','commit',this);return true;}catch(e){this.fireEvent('MSG','commitFailure',this);THROW({e:'commitFailure',o:''+e},this,'commit');return false;}},refreshTree:function(tree,baseParamArray,scope){if(this.DBG){THROW({args:arguments,propsObj:tree,props:['id']},((typeof(scope)!='object'||scope===null)?this:scope),'refreshTree');}
try{if(typeof(tree)=='string'){tree=this.findTree(tree,scope);}
if(typeof(tree)=='undefined'||tree===null){throw('TREE UNDEFINED');}
if(typeof(baseParamArray)=='object'&&typeof(baseParamArray.length)=='number'){this.fileBrowserTree.getLoader().on('beforeload',function(treeLoader,node){for(i=0;i<this.length;i++){parameter=this[i];if(typeof(parameter)=='object'&&parameter!==null){treeLoader.baseParams[parameter.n]=parameter.v;}}},baseParamArray);}
tree.getRootNode().reload(function(node){if(true===node.isSelected()){node.unselect();}
node.select();});}catch(e){description=(typeof(e)=='object'&&typeof(e.description)!='undefined')?', '+e.description:'';THROW({e:'FATAL',o:{e:e,o:description},args:arguments,propsObj:tree,props:['id']},((typeof(scope)!='object'||scope===null)?this:scope),'refreshTree');}finally{return;}},findTree:function(treeIdentifierString,scope){if(this.DBG){THROW({args:arguments},((typeof(scope)!='object'||scope===null)?this:scope),'findTree');}
try{tree=Ext.getCmp(treeIdentifierString);if(typeof(tree)=='object'&&tree!==null&&typeof(tree.getXType)=='function'&&tree.getXType()=='treepanel'){return tree;}
if(typeof(scope)=='object'&&scope!==null){tree=scope[treeIdentifierString];}else{tree=this[treeIdentifierString];}
if(typeof(tree)=='object'&&tree!==null&&typeof(tree.getXType)=='function'&&tree.getXType()=='treepanel'){return tree;}}catch(e){description=(typeof(e)=='object'&&typeof(e.description)!='undefined')?', '+e.description:'';THROW({e:'FATAL',o:{e:e,o:description},args:arguments},((typeof(scope)!='object'||scope===null)?this:scope),'findTree');}finally{return;}},reset:function(){if(false===this.fireEvent('MSG','beforereset',this)){return false;}
try{this.panel.toggleHasChangesIcon(false);if(typeof(this.attachmentNameFieldEl)!='undefined'&&this.attachmentNameFieldEl!==null){this.attachmentNameFieldEl.reset();}
this.fireEvent('MSG','reset',this);return true;}catch(e){this.fireEvent('MSG','resetFailure',this);THROW({e:'RESETFAILURE',o:''+e},this,'reset');return false;}},initComponent:function(){try{Pulse.AttachmentsEditor.superclass.initComponent.call(this);if(typeof(this.id)=='undefined'||this.id===null){this.id=this.type+'.'+Ext.id();}
this.addEvents({'MSG':true});if((typeof(this.renderTo)=='undefined'||this.renderTo===null)&&(typeof(this.content)!='undefined'&&typeof(this.content.clazz)!='undefined'&&typeof(this.content.id)!='undefined')){this.id=this.content.clazz+'.'+this.content.id+'.attachments.editor';this.renderTo=this.content.clazz+'.'+this.content.id+'.attachments';}}catch(e){description=(typeof(e)=='object'&&typeof(e.description)!='undefined')?', '+e.description:'';THROW({e:'FATAL',o:{e:e,o:description}},this,'initComponent');}
if(this.DBG){THROW({args:arguments,props:['id','renderTo','content.clazz','content.id','loadAttachmentsURL','initFileBrowserURL','fileBrowserTreeURL','addAttachmentURL','editAttachmentURL','fileBrowserPreviewURL','initAttachmentDescriptionEditorURL','saveAttachmentDescriptionEditorURL']},this,'initComponent');}}};Pulse.AttachmentsEditor=Ext.extend(Pulse.Editor,AttachmentsEditor);AttributeCheckOrValueEditor={type:'AttributeCheckOrValueEditor',fieldNamePrefix:'field_',DBG:{initComponent:false,initFieldMonitoring:false,initFieldMonitoringSwitch:true,initFieldMonitoringSwitch_Input:true,hasChanges:false},initFieldMonitoring:function(){THROW({props:['id','check.clazz','check.parameterNames','pEditor']},this,'initFieldMonitoring');for(i=0;i<this.check.parameterNames.length;i++){pName=this.check.parameterNames[i];unifier='';if(typeof(this.check.parameterFieldUnifier)=='string'){unifier=this.check.parameterFieldUnifier;}
el=Ext.get(pName+'.id'+unifier);if(el!==null){fieldName=this.fieldNamePrefix+pName;nodeName=el.dom.nodeName.toUpperCase();switch(nodeName){case'INPUT':switch(el.dom.type.toUpperCase()){case'TEXT':Pulse.initTextFieldMonitor(el,this,fieldName,true);break;case'CHECKBOX':Pulse.initCheckBoxMonitor(el,this,fieldName);break;default:THROW({e:'TODO',o:'create case'},this,'initFieldMonitoringSwitch_Input');return;}
break;case'SELECT':Pulse.initSelectBoxMonitor(el,this,fieldName);break;default:THROW({e:'TODO',o:'create case for: '+nodeName},this,'initFieldMonitoringSwitch');return;}
this[fieldName]=el;}}},hasChanges:function(){try{bool=false;for(i=0;i<this.check.parameterNames.length;i++){pName=this.check.parameterNames[i];fieldName=this.fieldNamePrefix+pName;if(this[fieldName]){bool=bool||this[fieldName].changed;}
if(true===bool){break;}}
if(this.DBG){THROW({o:bool},this,'hasChanges');}
return bool;}catch(e){FATAL(e,this,'hasChanges','FATAL');}},getChanges:function(v){changes=[];for(i=0;i<this.check.parameterNames.length;i++){pName=this.check.parameterNames[i];fieldName=this.fieldNamePrefix+pName;if(this[fieldName]){if(typeof(this[fieldName].getValue)=='function'){changes.push({name:pName,value:this[fieldName].getValue()});}else{THROW({e:'TODO',o:'implement .getValue()'},this,fieldName);}}}
if(typeof(v)=='object'&&v!==null){for(i=0;i<changes.length;i++){v[changes[i].name]=changes[i].value;}
return v;}
return changes;},commit:function(){if(false===this.fireEvent('beforecommit',this)){return;}
for(i=0;i<this.check.parameterNames.length;i++){pName=this.check.parameterNames[i];fieldName=this.fieldNamePrefix+pName;if(this[fieldName]){if(typeof(this[fieldName].commit)=='function'){this[fieldName].commit();}else{THROW({e:'TODO',o:'implement .commit()'},this,fieldName);}}}
this.fireEvent('commit',this);},fieldReset:function(){if(false===this.hasChanges()){this.fireEvent('MSG','reset',this);}},reset:function(){if(false===this.fireEvent('beforereset',this)){return;}
if(false===this.hasChanges()){return;}
for(i=0;i<this.check.parameterNames.length;i++){pName=this.check.parameterNames[i];fieldName=this.fieldNamePrefix+pName;if(this[fieldName]&&true===this[fieldName].changed){if(typeof(this[fieldName].reset)=='function'){this[fieldName].reset();}else{THROW({e:'TODO',o:'implement .reset()'},this,fieldName);}}}
this.fireEvent('reset',this);},initComponent:function(){THROW({props:['id','check.clazz','check.parameterNames','pEditor']},this,'initComponent');try{this.addEvents({'MSG':true,'beforereset':true,'reset':true,'beforecommit':true,'commit':true});if(typeof(this.initialConfig.id)=='undefined'){this.id=Ext.id(null,this.type+'.');}
this.tab=this.pEditor.tab;this.panel=this.pEditor.panel;this.initFieldMonitoring();}catch(e){description=(typeof(e)=='object'&&typeof(e.description)!='undefined')?', '+e.description:'';THROW({e:'FATAL',o:''+e+description},this,'initComponent');}}};Pulse.AttributeCheckOrValueEditor=Ext.extend(Ext.Component,AttributeCheckOrValueEditor);AttributeEditor={type:'AttributeEditor',tab:null,isRequiredEl:null,DBG:false,onRender:function(){THROW({e:'renderTo: unused',args:arguments},this,'onRender');},initTab:function(){THROW({props:['tab','tab.id','tab.pEditor']},this,'initTab');if(typeof(this.tab)!='undefined'){if(true!==this.tab.isInitialized){saveButtonConfig={text:VIEWPORT_PROPERTIES.BUTTON_TEXT_SAVE,scope:this,handler:function(){if(false===this.tab.isDirty){return;}
if(false===this.hasChanges()){PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'savesuccess'}]});return;}
v=this.getChanges();Ext.Ajax.request({url:this.saveURL,method:'POST',scope:this,success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){this.commit();PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'savesuccess'}]});}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this.type,'tbar.savePermissions');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this.type,'tbar.savePermissions');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this.type,'tbar.savePermissions');}},params:v});},iconCls:'saveIconCls'};tabTbar=this.tab.getTopToolbar().insertButton(0,[saveButtonConfig,new Ext.Toolbar.Separator()]);this.tab.setEditor(this);this.tab.isInitialized=true;}}},initFieldMonitoring:function(){this.isRequiredEl=Ext.get(this.clazz+'.'+this.attributeId+'.isRequired');Pulse.initCheckBoxMonitor(this.isRequiredEl,this,'isRequiredEl');},initChecksEditorPanel:function(){if(typeof(this.loadChecksURL)=='string'&&this.loadChecksURL!==''){removeButtonCfg={id:this.id+'.remove.check.button',text:VIEWPORT_PROPERTIES.BUTTON_TEXT_REMOVE,scope:this,disabled:true,handler:function(){Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE,VIEWPORT_PROPERTIES.MSG_REALLYDELETE,function(response){if('yes'===response){this.setAttributeCheck('');}},this);},iconCls:'deleteIconCls'};this.checksEditorPanel=new Ext.Panel({title:VIEWPORT_PROPERTIES.ATTRIBUTECHECKS,iconCls:'attributeCheckIconCls',renderTo:this.clazz+'.'+this.attributeId+'.checks',autoScroll:true,collapsed:true,collapsible:true,html:'...',tbar:[removeButtonCfg,'-']});this.checksEditorPanel.on('expand',function(){if(true!==this.checksEditorPanel.initialLoad){this.checksEditorPanel.initialLoad=true;this.loadChecksEditorPanel();}},this);Pulse.insertHasChangesIcon(this.checksEditorPanel);}},loadChecksEditorPanel:function(){THROW({props:['tab','tab.id','tab.pEditor','loadChecksURL']},this,'loadChecksEditorPanel');this.checksEditorPanel.load({url:this.loadChecksURL,method:'POST',scripts:true,callback:LPCB,params:{id:this.attributeId},text:'loading...',discardUrl:true,nocache:true,timeout:30});},initSubEditor:function(){if(this.DBG){THROW({args:arguments,props:['loadSubEditorURL','clazz','attributeId']},this,'initSubEditor');}
try{if(typeof(this.loadSubEditorURL)!='string'||this.loadSubEditorURL===''){if(this.DBG){FATAL({e:'URL UNDEFINED',props:['loadSubEditorURL']},this,'initSubEditor');}
return;}
subEditorPanel=new Pulse.SubEditorPanel({height:250,id:this.clazz+'.'+this.attributeId+'.subEditor',masterEditor:this,url:this.loadSubEditorURL,params:{id:this.attributeId},renderTo:this.clazz+'.'+this.attributeId+'.subEditorDiv'});subEditorPanel.on('expand',function(){this.initializePanel();});this.addSubEditor(subEditorPanel);}catch(e){FATAL(e,this,'initSubEditor');}},initCheckEditor:function(config){THROW({propsObj:config,props:['clazz','parameterNames']},this,'initCheckEditor');Ext.getCmp(this.id+'.remove.check.button').enable();this.checksEditor=new Pulse.AttributeCheckOrValueEditor({check:config,pEditor:this});this.checksEditor.on('MSG',function(msgString,editor){THROW({args:arguments},this,'MSG');if(msgString=='reset'){this.tab.toggleHasChangesIcon(false);this.checksEditorPanel.toggleHasChangesIcon(false);PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'reset'}]});return;}else if(msgString=='change'){if(true===this.hasChanges()){this.tab.toggleHasChangesIcon(true);this.checksEditorPanel.toggleHasChangesIcon(true);PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:msgString}]});}else{this.tab.toggleHasChangesIcon(false);this.checksEditorPanel.toggleHasChangesIcon(false);PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'reset'}]});}
return;}
PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:msgString}]});},this);},buildAssorters:function(){THROW({props:['id','clazz','editRoleURL','loadAdminEditRolesURL','loadAdminViewRolesURL','loadSelfEditRolesURL','loadSelfViewRolesURL','loadTriggeredRolesURL']},this,'buildAssorters');if(typeof(this.loadAdminEditRolesURL)=='string'&&this.loadAdminEditRolesURL!==''){this.adminEditRolesEditor=new Pulse.AssorterPanel({preLoad:false,title:''+VIEWPORT_PROPERTIES.EDITATTRIBUTE,iconCls:'editAttributeIconCls',renderTo:this.clazz+'.'+this.attributeId+'.admin.edit.roles',loadURL:this.loadAdminEditRolesURL+'?id='+this.attributeId,editURL:this.editRoleURL,editHandler:function(node){RoleOverviewEditor.editRole(this.editURL,node.attributes.id,node.attributes.clazz);},uiProviders:{'AccessControlTreeNodeUI':PULSE.AccessControlTreeNodeUI}});this.adminEditRolesEditor.on('MSG',function(msgString,editor){THROW({args:arguments},this,'MSG');if(msgString=='change'){if(true===this.hasChanges()){this.tab.toggleHasChangesIcon(true);PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'change'}]});}else{this.tab.toggleHasChangesIcon(false);PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'reset'}]});}
return;}
PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:msgString}]});},this);this.adminEditRolesEditor.on('reset',function(obj){if(true===obj.success&&false===this.hasChanges()){this.tab.toggleHasChangesIcon(false);PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'reset'}]});}},this);}
if(typeof(this.loadAdminViewRolesURL)=='string'&&this.loadAdminViewRolesURL!==''){this.adminViewRolesEditor=new Pulse.AssorterPanel({preLoad:false,title:''+VIEWPORT_PROPERTIES.VIEWATTRIBUTE,iconCls:'viewAttributeIconCls',renderTo:this.clazz+'.'+this.attributeId+'.admin.view.roles',loadURL:this.loadAdminViewRolesURL+'?id='+this.attributeId,editURL:this.editRoleURL,editHandler:function(node){RoleOverviewEditor.editRole(this.editURL,node.attributes.id,node.attributes.clazz);},uiProviders:{'AccessControlTreeNodeUI':PULSE.AccessControlTreeNodeUI}});this.adminViewRolesEditor.on('MSG',function(msgString,editor){THROW({args:arguments},this,'MSG');if(msgString=='change'){if(true===this.hasChanges()){this.tab.toggleHasChangesIcon(true);PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'change'}]});}else{this.tab.toggleHasChangesIcon(false);PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'reset'}]});}
return;}
PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:msgString}]});},this);this.adminViewRolesEditor.on('reset',function(obj){if(true===obj.success&&false===this.hasChanges()){this.tab.toggleHasChangesIcon(false);PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'reset'}]});}},this);}
if(typeof(this.loadSelfEditRolesURL)=='string'&&this.loadSelfEditRolesURL!==''){this.selfEditRolesEditor=new Pulse.AssorterPanel({preLoad:false,title:''+VIEWPORT_PROPERTIES.EDITATTRIBUTE,iconCls:'editAttributeIconCls',renderTo:this.clazz+'.'+this.attributeId+'.self.edit.roles',loadURL:this.loadSelfEditRolesURL+'?id='+this.attributeId,editURL:this.editRoleURL,editHandler:function(node){RoleOverviewEditor.editRole(this.editURL,node.attributes.id,node.attributes.clazz);},uiProviders:{'AccessControlTreeNodeUI':PULSE.AccessControlTreeNodeUI}});this.selfEditRolesEditor.on('MSG',function(msgString,editor){THROW({args:arguments},this,'MSG');if(msgString=='change'){if(true===this.hasChanges()){this.tab.toggleHasChangesIcon(true);PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'change'}]});}else{this.tab.toggleHasChangesIcon(false);PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'reset'}]});}
return;}
PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:msgString}]});},this);this.selfEditRolesEditor.on('reset',function(obj){if(true===obj.success&&false===this.hasChanges()){this.tab.toggleHasChangesIcon(false);PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'reset'}]});}},this);}
if(typeof(this.loadSelfViewRolesURL)=='string'&&this.loadSelfViewRolesURL!==''){this.selfViewRolesEditor=new Pulse.AssorterPanel({preLoad:false,title:''+VIEWPORT_PROPERTIES.VIEWATTRIBUTE,iconCls:'viewAttributeIconCls',renderTo:this.clazz+'.'+this.attributeId+'.self.view.roles',loadURL:this.loadSelfViewRolesURL+'?id='+this.attributeId,editURL:this.editRoleURL,editHandler:function(node){RoleOverviewEditor.editRole(this.editURL,node.attributes.id,node.attributes.clazz);},uiProviders:{'AccessControlTreeNodeUI':PULSE.AccessControlTreeNodeUI}});this.selfViewRolesEditor.on('MSG',function(msgString,editor){THROW({args:arguments},this,'MSG');if(msgString=='change'){if(true===this.hasChanges()){this.tab.toggleHasChangesIcon(true);PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'change'}]});}else{this.tab.toggleHasChangesIcon(false);PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'reset'}]});}
return;}
PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:msgString}]});},this);this.selfViewRolesEditor.on('reset',function(obj){if(true===obj.success&&false===this.hasChanges()){this.tab.toggleHasChangesIcon(false);PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'reset'}]});}},this);}
if(typeof(this.loadTriggeredRolesURL)=='string'&&this.loadTriggeredRolesURL!==''){this.triggeredRolesEditor=new Pulse.AssorterPanel({preLoad:false,title:''+VIEWPORT_PROPERTIES.TRIGGEREDROLES,iconCls:'roleIconCls',renderTo:this.clazz+'.'+this.attributeId+'.triggered.roles',loadURL:this.loadTriggeredRolesURL+'?id='+this.attributeId,editURL:this.editRoleURL,editHandler:function(node){RoleOverviewEditor.editRole(this.editURL,node.attributes.id,node.attributes.clazz);},uiProviders:{'AccessControlTreeNodeUI':PULSE.AccessControlTreeNodeUI}});this.triggeredRolesEditor.on('MSG',function(msgString,editor){THROW({args:arguments},this,'MSG');if(msgString=='change'){if(true===this.hasChanges()){this.tab.toggleHasChangesIcon(true);PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'change'}]});}else{this.tab.toggleHasChangesIcon(false);PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'reset'}]});}
return;}
PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:msgString}]});},this);this.triggeredRolesEditor.on('reset',function(obj){if(true===obj.success&&false===this.hasChanges()){this.tab.toggleHasChangesIcon(false);PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'reset'}]});}},this);}},setAttributeCheck:function(clazz){THROW({args:arguments,props:['setCheckURL']},this,'setAttributeCheck');if(typeof(this.setCheckURL)!='string'||this.setCheckURL===''){return;}
Ext.Ajax.request({url:this.setCheckURL,method:'POST',scope:this,success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){if(options.params.clazz===''){this.checksEditorPanel.toggleHasChangesIcon(false);delete this.checksEditor;Ext.getCmp(this.id+'.remove.check.button').disable();if(false===this.hasChanges()){this.tab.toggleHasChangesIcon(false);PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'reset'}]});}}
this.loadChecksEditorPanel();}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this.type,'setAttributeCheck');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this.type,'setAttributeCheck');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this.type,'setAttributeCheck');}},params:{id:this.attributeId,clazz:clazz}});},hasChanges:function(){superBool=Pulse.AttributeEditor.superclass.hasChanges.call(this);return((typeof(this.adminEditRolesEditor)!='undefined'&&this.adminEditRolesEditor.hasChanges())||(typeof(this.adminViewRolesEditor)!='undefined'&&this.adminViewRolesEditor.hasChanges())||(typeof(this.selfEditRolesEditor)!='undefined'&&this.selfEditRolesEditor.hasChanges())||(typeof(this.selfViewRolesEditor)!='undefined'&&this.selfViewRolesEditor.hasChanges())||(typeof(this.triggeredRolesEditor)!='undefined'&&this.triggeredRolesEditor.hasChanges())||(typeof(this.checksEditor)!='undefined'&&this.checksEditor.hasChanges())||superBool||(typeof(this.isRequiredEl)!==null&&this.isRequiredEl.changed));},getChanges:function(){try{v={id:this.attributeId};if(true===this.isRequiredEl.changed){v.isRequired=this.isRequiredEl.dom.checked;}
if(typeof(this.adminEditRolesEditor)!='undefined'&&this.adminEditRolesEditor!==null){if(true===this.adminEditRolesEditor.hasChanges()){chgs=this.adminEditRolesEditor.getChanges();if(typeof(chgs.asoc)!='undefined'){v.addAdminEditRoles=chgs.asoc;}
if(typeof(chgs.unasoc)!='undefined'){v.remAdminEditRoles=chgs.unasoc;}}}
if(typeof(this.adminViewRolesEditor)!='undefined'&&this.adminViewRolesEditor!==null){if(true===this.adminViewRolesEditor.hasChanges()){chgs=this.adminViewRolesEditor.getChanges();if(typeof(chgs.asoc)!='undefined'){v.addAdminViewRoles=chgs.asoc;}
if(typeof(chgs.unasoc)!='undefined'){v.remAdminViewRoles=chgs.unasoc;}}}
if(typeof(this.selfEditRolesEditor)!='undefined'&&this.selfEditRolesEditor!==null){if(true===this.selfEditRolesEditor.hasChanges()){chgs=this.selfEditRolesEditor.getChanges();if(typeof(chgs.asoc)!='undefined'){v.addSelfEditRoles=chgs.asoc;}
if(typeof(chgs.unasoc)!='undefined'){v.remSelfEditRoles=chgs.unasoc;}}}
if(typeof(this.selfViewRolesEditor)!='undefined'&&this.selfViewRolesEditor!==null){if(true===this.selfViewRolesEditor.hasChanges()){chgs=this.selfViewRolesEditor.getChanges();if(typeof(chgs.asoc)!='undefined'){v.addSelfViewRoles=chgs.asoc;}
if(typeof(chgs.unasoc)!='undefined'){v.remSelfViewRoles=chgs.unasoc;}}}
if(typeof(this.triggeredRolesEditor)!='undefined'&&this.triggeredRolesEditor!==null){if(true===this.triggeredRolesEditor.hasChanges()){chgs=this.triggeredRolesEditor.getChanges();if(typeof(chgs.asoc)!='undefined'){v.addTriggeredRoles=chgs.asoc;}
if(typeof(chgs.unasoc)!='undefined'){v.remTriggeredRoles=chgs.unasoc;}}}
if(typeof(this.checksEditor)!='undefined'&&this.checksEditor!==null){if(true===this.checksEditor.hasChanges()){chgs=this.checksEditor.getChanges();for(i=0;i<chgs.length;i++){v[chgs[i].name]=chgs[i].value;}}}
v=Pulse.AttributeEditor.superclass.getChanges.call(this,v);return v;}catch(e){THROW({e:'FATAL',o:e},this,'getChanges');}},commit:function(){this.tab.toggleHasChangesIcon(false);if(typeof(this.isRequiredEl)!='undefined'&&this.isRequiredEl!==null){if(this.isRequiredEl.changed===true){this.isRequiredEl.commit();}}
if(typeof(this.adminEditRolesEditor)!='undefined'&&this.adminEditRolesEditor!==null){this.adminEditRolesEditor.commit();}
if(typeof(this.adminViewRolesEditor)!='undefined'&&this.adminViewRolesEditor!==null){this.adminViewRolesEditor.commit();}
if(typeof(this.selfEditRolesEditor)!='undefined'&&this.selfEditRolesEditor!==null){this.selfEditRolesEditor.commit();}
if(typeof(this.selfViewRolesEditor)!='undefined'&&this.selfViewRolesEditor!==null){this.selfViewRolesEditor.commit();}
if(typeof(this.triggeredRolesEditor)!='undefined'&&this.triggeredRolesEditor!==null){this.triggeredRolesEditor.commit();}
if(typeof(this.checksEditor)!='undefined'&&this.checksEditor!==null){this.checksEditorPanel.toggleHasChangesIcon(false);this.checksEditor.commit();}
Pulse.AttributeEditor.superclass.commit.call(this);},resetEditors:function(){if(typeof(this.isRequiredEl)!='undefined'&&this.isRequiredEl!==null){this.isRequiredEl.reset();}
if(typeof(this.adminEditRolesEditor)!='undefined'&&this.adminEditRolesEditor!==null){this.adminEditRolesEditor.reset();}
if(typeof(this.adminViewRolesEditor)!='undefined'&&this.adminViewRolesEditor!==null){this.adminViewRolesEditor.reset();}
if(typeof(this.selfEditRolesEditor)!='undefined'&&this.selfEditRolesEditor!==null){this.selfEditRolesEditor.reset();}
if(typeof(this.selfViewRolesEditor)!='undefined'&&this.selfViewRolesEditor!==null){this.selfViewRolesEditor.reset();}
if(typeof(this.triggeredRolesEditor)!='undefined'&&this.triggeredRolesEditor!==null){this.triggeredRolesEditor.reset();}
if(typeof(this.checksEditor)!='undefined'&&this.checksEditor!==null){this.checksEditorPanel.toggleHasChangesIcon(false);this.checksEditor.reset();}},reset:function(){Pulse.AttributeEditor.superclass.reset.call(this);this.tab.toggleHasChangesIcon(false);PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'reset'}]});this.resetEditors();},initComponent:function(){Pulse.AttributeEditor.superclass.initComponent.call(this);this.tab=Ext.getCmp(this.clazz+'.'+this.attributeId+'.editor');if(this.DBG){THROW({args:arguments,props:['id','clazz','attributeId','tab','tab.id','saveURL','editRoleURL','loadAdminEditRolesURL','loadAdminViewRolesURL','loadSelfEditRolesURL','loadSelfViewRolesURL','loadTriggeredRolesURL','loadChecksURL','setCheckURL','loadSubEditorURL']},this,'initComponent');}
try{this.initTab();this.initFieldMonitoring();this.initChecksEditorPanel();this.initSubEditor();this.buildAssorters();}catch(e){FATAL(e,this,'initComponent');}}};Pulse.AttributeEditor=Ext.extend(Pulse.Editor,AttributeEditor);var AttributeRegistryEditor={win:null,msgPanel:null,centerPanel:null,contentNameField:null,createNameField:null,selectedNode:null,el:null,tel:null,tree:null,getTree:function(config){loaderConf={dataUrl:config.getChildrenURL,uiProviders:{'RegistryTreeNodeUI':PULSE.RegistryTreeNodeUI}};if(typeof(config.baseParams)!='undefined'){loaderConf.baseParams=config.baseParams;}
loader=new Ext.tree.TreeLoader(loaderConf);id=config.id;if(typeof(id)=='undefined'||id===null){id=Ext.id();}
tree=new Ext.tree.TreePanel({id:id,el:config.renderTo,region:(typeof(config.region)=='undefined')?'':config.region,autoScroll:true,autoHeight:(typeof(config.height)!='undefined')?false:true,animate:true,enableDD:(typeof(config.enableDD)!='boolean')?false:config.enableDD,containerScroll:true,rootVisible:false,border:false,loader:loader,onSelectNodeClick:null,editor:this});if(typeof(config.iconRenderer)=='function'){tree.iconRenderer=config.iconRenderer;}
if(typeof(config.height)!='undefined'){tree.setHeight(config.height);}
if(config.enableDD===true){tree.on({'beforenodedrop':{scope:tree,fn:function(e){Ext.Ajax.request({url:e.dropNode.attributes.moveURL,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);targetNode=options.e.target;movenode=options.e.dropNode;oldParent=movenode.parentNode;if(true===decodedResponse.status){switch(options.e.point){case'append':if(!targetNode.isExpanded()){try{if(true===targetNode.isLoaded()){targetNode.expand(false,null,function(){targetNode.appendChild(movenode);}.createDelegate(this));}else{oldParent.removeChild(movenode);targetNode.expand();}}catch(err){targetNode.expand();targetNode.appendChild(movenode);}}else{targetNode.appendChild(movenode);}
break;case'above':targetNode.parentNode.insertBefore(movenode,targetNode);break;case'below':targetNode.parentNode.insertBefore(movenode,targetNode.nextSibling);break;}}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'AttributeRegistryEditor','onbeforenodedrop('+options.e.dropNode+')');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'AttributeRegistryEditor','onbeforenodedrop('+options.e.dropNode+')');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'AttributeRegistryEditor','onbeforenodedrop('+options.e.dropNode+')');}},e:e,params:{targetnodeid:e.target.id,insertpoint:e.point,movenodeid:e.dropNode.id}});return false;}}});}
if(typeof(config.onSelectNodeClick)=='function'){tree.onSelectNodeClick=config.onSelectNodeClick;}
id=Ext.id();root=new Ext.tree.AsyncTreeNode({text:'',draggable:false,allowDrop:false,id:'source.'+id,iconCls:'attributeRegistryIconCls'});if(typeof(config.westAnimate)=='object'){loader.on('beforeload',function(loader,node,callback){if(node.id===Ext.getCmp(config.id).getRootNode().id){try{Ext.get(config.westAnimate.id).replaceClass(config.westAnimate.replaceCls,'loadingIconCls');}catch(e){}}});loader.on('load',function(loader,node,response){if(node.id===Ext.getCmp(config.id).getRootNode().id){try{Ext.get(config.westAnimate.id).replaceClass('loadingIconCls',config.westAnimate.replaceCls);}catch(e){}}});}
tree.setRootNode(root);return tree;},createNode:function(node){this.selectedNode=node;try{pel=VIEWPORT.getEl();if(typeof(pel)=='undefined'){throw('276 :: AttributeRegistryEditor.createNode() :: '+'CHECK for element failed...');}
if(this.el===null){this.el=pel.createChild({tag:'div',id:'AttributeRegistryEditorWindow.el'});}
this.centerPanel=new Ext.Panel({margins:'3 3 0 3',html:'center'});this.win=new Ext.Window({id:'AttributeRegistryEditorWindow.Win',title:VIEWPORT_PROPERTIES.ATTRIBUTEREGISTRY+':',iconCls:'attributeRegistryIconCls',modal:true,plain:true,renderTo:this.el,autoHeight:true,items:[this.centerPanel],width:400,buttonAlign:'center',buttons:[{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CANCEL,handler:function(){AttributeRegistryEditor.win.close();},iconCls:'cancelIconCls'}]});this.win.on('close',function(){delete this.centerPanel;delete this.createNameField;this.centerPanel=null;this.createNameField=null;},this);this.win.on('show',function(){this.centerPanel.load({url:node.attributes.createURL,method:'POST',scripts:true,callback:LPCB,text:'loading...',discardUrl:true,nocache:true,timeout:30});},this);this.win.setPagePosition((VIEWPORT.getSize().width/2)-200,50);this.win.show(this);}catch(windowInitError){alert('windowInitError: \n'+windowInitError);}},save:function(saveURL){if(this.createNameField===null||this.createNameField.getValue().trim()===''){return;}
Ext.Ajax.request({url:saveURL,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){AttributeRegistryEditor.responseId=parseInt(decodedResponse.id,10);AttributeRegistryEditor.selectedNode.reload(function(node){n=node.findChild('id',AttributeRegistryEditor.responseId);delete AttributeRegistryEditor.responseId;AttributeRegistryEditor.win.close();n.select();if(typeof(n)!='undefined'&&n!==null){AttributeRegistryEditor.editNode(n);}});}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'AttributeRegistryEditor','save');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'AttributeRegistryEditor','save');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'AttributeRegistryEditor','save');}},params:{name:this.createNameField.getValue().trim()}});},editNode:function(node){if(typeof(node)!='undefined'&&node!==null){PULSE_VIEWPORT_CONTROLLER.openTab({id:node.attributes.clazz+'.'+node.attributes.id+'.editor',title:node.text,tabTip:node.text+' (id: '+node.attributes.id+')',iconCls:node.attributes.clazz.split('.').join(''),registeredObject:{node:node},loadParams:{url:node.attributes.editURL}});return;}
THROW({e:'node undefined'},this,'editNode');},deleteNode:function(node){Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE+':&#160;"'+node.text+'"',VIEWPORT_PROPERTIES.MSG_REALLYDELETE,function(response){if('yes'===response){node.ui.setBusy(true);Ext.Ajax.request({url:node.attributes.deleteURL,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);node=options.node;parentNode=node.parentNode;if(true===decodedResponse.status){tabId=node.attributes.clazz+'.'+node.id+'.editor';PULSE_VIEWPORT_CONTROLLER.closeTab(tabId,true);parentNode.removeChild(node);}else{node.ui.setBusy();PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'AttributeRegistryEditor','deleteNode('+options.node+')');}},failure:function(response,options){options.node.ui.setBusy();if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'AttributeRegistryEditor','deleteNode('+options.node+')');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'AttributeRegistryEditor','deleteNode('+options.node+')');}},node:node});}},this);},initCreateInputField:function(elId){this.createNameField=new Ext.form.TextField({name:'AttributeRegistryEditorWindow.nameField.name',renderTo:elId,style:'width:100%;',emptyText:VIEWPORT_PROPERTIES.TEXT_ENTER_NAME,allowBlank:false});this.createNameField.validate();},renameNodeByContentId:function(contentid,newName){n=this.findChildByContentId(AttributeRegistryTree.getRootNode(),contentid);if(typeof(n)!='undefined'){n.setText(newName);n.ui.buildQTip(n.ui,n.attributes);}},findChildByContentId:function(node,contentid){if(node===null){return;}
if(node.attributes===null){return;}
if(node.attributes.contentId==contentid){return node;}
if(node.firstChild!==null){return this.findChildByContentId(node.firstChild,contentid);}else if(node.nextSibling!==null){return this.findChildByContentId(node.nextSibling,contentid);}else{return this.findChildByContentId(node.parentNode.nextSibling,contentid);}},expandByIds:function(node,arrayids,callback,isExpanding){try{if(typeof(node)=='undefined'||node===null){return;}
if(true===Ext.getCmp('AttributeRegistry.WEST').isExpanding&&true!==isExpanding){return;}
if(true!==isExpanding){Ext.getCmp('AttributeRegistry.WEST').disable();}
Ext.getCmp('AttributeRegistry.WEST').isExpanding=true;exp_fn=function(){node.expand(false,true,function(node){c=node.findChild('id',arrayids[0]);if(arrayids.length===1){c.select();Ext.getCmp('AttributeRegistry.WEST').isExpanding=false;Ext.getCmp('AttributeRegistry.WEST').enable();if(typeof(callback)=='function'){callback(c);}
return;}
arrayids.shift();AttributeRegistryEditor.expandByIds(c,arrayids,callback,true);});};if(arrayids.length===2){if(node.isLoaded()){node.reload(exp_fn);}else{exp_fn();}}else{exp_fn();}
return;}catch(e){crPanel=Ext.getCmp('AttributeRegistry.WEST');if(typeof(crPanel)!='undefined'&&crPanel!==null){crPanel.isExpanding=false;crPanel.enable();}}},editContent:function(crExpandIdsURL,contentid){Ext.Ajax.request({url:crExpandIdsURL,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){crPanel=Ext.getCmp('AttributeRegistry.WEST');crPanel.expand();AttributeRegistryEditor.expandByIds(AttributeRegistryTree.getRootNode(),decodedResponse.ids,function(node){AttributeRegistryEditor.editNode(node);});}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'AttributeRegistryEditor','editContent()');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'AttributeRegistryEditor','editContent()');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'AttributeRegistryEditor','editContent()');}},params:{id:contentid}});}};SelectionAttributeOptionEditor={type:'SelectionAttributeOptionEditor',DBG:false,gridHeight:500,onRender:function(){THROW({props:['renderTo'],args:arguments},this,'onRender');try{}catch(e){description=(typeof(e)=='object'&&typeof(e.description)!='undefined')?', '+e.description:'';THROW({e:'FATAL',o:{e:e,o:description}},this,'onRender');}},buildGrid:function(){if(this.DBG){THROW({args:arguments,props:['gridEl']},this,'buildGrid');}
try{this.store=new Ext.data.SimpleStore({pruneModifiedRecords:true,fields:['id','name','value'],data:this.options});nameEditorCfg={allowBlank:false};valueEditorCfg={allowBlank:false,pEditor:this,validator:function(v){THROW({args:arguments,props:['pEditor']},this.pEditor,'validate.click');return this.pEditor.validate(v);}};_id=this.id;deleteFieldCfg={header:'',dataIndex:'id',width:25,fixed:true,sortable:false,renderer:function(id){try{return FilterEditor.getGridImageField({functionString:'Ext.getCmp(\''+_id+'\').removeOption(\''+id+'\')',iconCls:'deleteIconCls_14',qtip:VIEWPORT_PROPERTIES.BUTTON_TEXT_DELETE});}catch(renderError){return'<img src="'+Ext.BLANK_IMAGE_URL+'" width="14" height="14" '+'border="0" class="errorIconCls_14" ext:qtip="render-error: '+'try to reload ('+renderError+')"/>';}}};columnModel=new Ext.grid.ColumnModel([{id:'id',header:'id:',dataIndex:'id',sortable:true,width:50,fixed:true,resizable:true,renderer:function(id){t=parseInt(id,10);if((t+'')=='NaN'){return'*';}
return id;}},{header:VIEWPORT_PROPERTIES.NAME+':',dataIndex:'name',sortable:false,editor:new Ext.form.TextField(nameEditorCfg)},{header:VIEWPORT_PROPERTIES.VALUE+':',dataIndex:'value',sortable:false,editor:new Ext.form.TextField(valueEditorCfg)},deleteFieldCfg]);this.grid=new Ext.grid.EditorGridPanel({store:this.store,renderTo:this.gridEl,height:this.gridHeight,cm:columnModel,autoExpandColumn:'id',loadMask:true,viewConfig:{forceFit:true},header:false,frame:false,border:false,enableHdMenu:false,clicksToEdit:1});this.grid.on('beforeedit',function(e){this.currentGridEditEvent=e;if(this.DBG){THROW({args:arguments,props:['currentGridEditEvent']},this,'grid.beforeedit');}},this);this.grid.on('afteredit',function(e){this.deleteCurrentGridEvent=true;if(this.DBG){THROW({args:arguments,props:['currentGridEditEvent']},this,'grid.afteredit');}},this);this.store.on('datachanged',function(_store){if(this.DBG){THROW({args:arguments},this,'store.datachanged');}
if(false===this.hasChanges()){this.fireEvent('MSG','reset',this);}else{this.fireEvent('MSG','change',this);}},this);this.store.on('remove',function(store,record,index){if(this.DBG){THROW({args:arguments},this,'store.remove');}
if(false===this.hasChanges()){this.fireEvent('MSG','reset',this);}else{this.fireEvent('MSG','change',this);}},this);this.store.on('update',function(store,record,index){if(this.DBG){THROW({args:arguments},this,'store.update');}
if(false===this.hasChanges()){this.fireEvent('MSG','reset',this);}else{this.fireEvent('MSG','change',this);}},this);this.store.on('add',function(store,record,index){if(this.DBG){THROW({args:arguments},this,'store.add');}
if(false===this.hasChanges()){this.fireEvent('MSG','reset',this);}else{this.fireEvent('MSG','change',this);}},this);}catch(e){if(this.DBG){FATAL(e,this,'buildGrid');}}},validate:function(v,field){THROW({args:arguments,props:['currentGridEditEvent','currentGridEditEvent.grid','currentGridEditEvent.record','currentGridEditEvent.field','currentGridEditEvent.value','currentGridEditEvent.row','currentGridEditEvent.column','currentGridEditEvent.cancel']},this,'validate.call');records=this.store.getRange();evt=this.currentGridEditEvent;if(typeof(evt)!='undefined'&&(typeof(field)=='undefined'||field===null)){field=evt.field;}
if(true===this.deleteCurrentGridEvent){delete this.deleteCurrentGridEvent;delete this.currentGridEditEvent;}
for(i=0;i<records.length;i++){if(typeof(evt)!='undefined'&&evt.record.get('id')==records[i].get('id')){continue;}
if(v==records[i].get(field)){return false;}}
return true;},getButtons:function(){addButtonCfg={text:VIEWPORT_PROPERTIES.BUTTON_TEXT_ADD,scope:this,handler:function(){if(this.DBG){THROW({args:arguments},this,'button.add');}
this.showCreateFormWindow({fields:[{fieldLabel:VIEWPORT_PROPERTIES.NAME,name:'name',emptyText:VIEWPORT_PROPERTIES.TEXT_ENTER_NAME},{fieldLabel:VIEWPORT_PROPERTIES.VALUE,name:'value',emptyText:VIEWPORT_PROPERTIES.TEXT_ENTER_VALUE,pEditor:this,validator:function(v){THROW({args:arguments,props:['pEditor']},this.pEditor,'validate.click');this.validates=this.pEditor.validate(v,'value');return this.validates;}}],handler:'createOption'});},iconCls:'addIconCls'};toggleMultiSelectButtonCfg={text:(true===this.multiselect)?'ON':'OFF',scope:this,handler:function(){if(this.DBG){THROW({args:arguments},this,'button.toggleMultiSelect');}
if(true===this.multiselect){this.multiselect=false;this.toggleMultiSelectButton.setIconClass('isSelectedDisabledIconCls');this.toggleMultiSelectButton.setText('OFF');}else{this.multiselect=true;this.toggleMultiSelectButton.setIconClass('isSelectedIconCls');this.toggleMultiSelectButton.setText('ON');}
if(false===this.hasChanges()){this.fireEvent('MSG','reset',this);return;}
this.fireEvent('MSG','change',this);},iconCls:(true===this.multiselect)?'isSelectedIconCls':'isSelectedDisabledIconCls'};this.toggleMultiSelectButton=new Ext.Toolbar.Button(toggleMultiSelectButtonCfg);toggleMultiSelectButtonLabel=new Ext.Toolbar.TextItem('multi-select: ');return[new Ext.Toolbar.Button(addButtonCfg),new Ext.Toolbar.Separator(),toggleMultiSelectButtonLabel,this.toggleMultiSelectButton,new Ext.Toolbar.Separator()];},removeOption:function(id){if(this.DBG){THROW({args:arguments},this,'removeOption');}
Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE,VIEWPORT_PROPERTIES.MSG_REALLYDELETE,function(response){if('yes'===response){this.store.each(function(rec){if(id==rec.get('id')){t=parseInt(id,10);if((t+'')!='NaN'){this.removedIds.push(id);}else{for(i=0;i<this.addRecords.length;i++){if(id==this.addRecords[i].get('id')){this.addRecords.splice(i,1);}}}
this.store.remove(rec);return false;}},this);}},this);},createOption:function(){if(this.DBG){THROW({args:arguments},this,'createOption');}
params=this.getCreateFormParams();THROW({propsObj:params,props:['name','value']},this,'createOption');if(this.store===null){return;}
gridStoreRecord=new Ext.data.Record.create([{name:'id'},{name:'name'},{name:'value'}]);rc=new gridStoreRecord({id:Ext.id(),value:params.value,name:params.name});this.addRecords.push(rc);this.store.add(rc);this.closeCreateFormWindow();},hasChanges:function(){return(this.initialMultiselect!=this.multiselect)||(this.removedIds.length>0)||(this.addRecords.length>0)||(this.store.getModifiedRecords().length>0);},getChanges:function(v){if(typeof(v)!='object'||v===null){v={};}
if(true===this.hasChanges()){v.isMultiSelect=this.multiselect;v.removedOptions=this.removedIds;modRecs=this.store.getModifiedRecords();for(i=0;i<modRecs.length;i++){rc=modRecs[i];_id=rc.get('id');v['mOpt_name_'+_id]=rc.get('name');v['mOpt_value_'+_id]=rc.get('value');}
for(i=0;i<this.addRecords.length;i++){rc=this.addRecords[i];v['aOpt_name_'+i]=rc.get('name');v['aOpt_value_'+i]=rc.get('value');}}
return v;},commit:function(){if(false===this.fireEvent('MSG','beforecommit',this)){return false;}
this.store.commitChanges();this.removedIds=[];this.addRecords=[];this.initialMultiselect=this.multiselect;this.fireEvent('MSG','commit',this);if(typeof(this.masterEditor)!='undefined'&&typeof(this.masterEditor.loadPanel)=='function'){this.masterEditor.loadPanel();}},reset:function(){if(false===this.fireEvent('MSG','beforereset',this)){return false;}
this.removedIds=[];this.addRecords=[];this.store.loadData(this.initialConfig.options);if(this.multiselect!=this.initialConfig.multiselect){this.multiselect=this.initialConfig.multiselect;if(false===this.multiselect){this.toggleMultiSelectButton.setIconClass('isSelectedDisabledIconCls');this.toggleMultiSelectButton.setText('OFF');}else{this.toggleMultiSelectButton.setIconClass('isSelectedIconCls');this.toggleMultiSelectButton.setText('ON');}}
this.fireEvent('MSG','reset',this);},initComponent:function(){THROW({args:arguments,props:['id','renderTo','attribute.id','attribute.clazz','options']},this,'initComponent');try{this.removedIds=[];this.addRecords=[];Pulse.SelectionAttributeOptionEditor.superclass.initComponent.call(this);this.initialMultiselect=this.multiselect;this.gridEl=Ext.get(this.attribute.clazz+'.'+this.attribute.id+'.options');this.buildGrid();}catch(e){FATAL(e,this,'initComponent');}}};Pulse.SelectionAttributeOptionEditor=Ext.extend(Pulse.Editor,SelectionAttributeOptionEditor);DBG.ContentEditor=DBG.apply(DBG.Editor,{addSubEditor:{ContentEditor:false},hasChanges:{ContentEditor:false},getChanges:{ContentEditor:false},reset:{ContentEditor:false},commit:{ContentEditor:false},initSitemapNodesDisplayer:false,initAttachmentsPanel:false,initFieldMonitoring:{ContentEditor:false}});ContentEditor={type:'ContentEditor',DBG:false,onRender:function(){THROW({props:['renderTo'],args:arguments},this,'onRender');try{THROW({e:'TODO',args:arguments},this,'onRender');}catch(e){FATAL(e,this,'onRender');}},hasChanges:function(){keywordsBool=(typeof(this.keywordsEl)!='undefined'&&this.keywordsEl!==null)?this.keywordsEl.changed:false;attachmentsBool=(typeof(this.attachmentsEditor)=='undefined'&&this.attachmentsEditor===null)?this.attachmentsEditor.hasChanges():false;metakeywordsBool=(typeof(this.metakeywordsEl)!='undefined'&&this.metakeywordsEl!==null)?this.metakeywordsEl.changed:false;metadescriptionBool=(typeof(this.metadescriptionEl)!='undefined'&&this.metadescriptionEl!==null)?this.metadescriptionEl.changed:false;superBool=Pulse.ContentEditor.superclass.hasChanges.call(this);if(this.DBG){THROW({args:arguments,props:['id'],o:'(keywordsBool: '
+keywordsBool
+' || attachmentsBool: '
+attachmentsBool
+' || superBool: '
+superBool
+' ) -> '
+(keywordsBool||attachmentsBool||superBool)},this,'hasChanges.ContentEditor');}
return(keywordsBool||attachmentsBool||metakeywordsBool||metadescriptionBool||superBool);},getChanges:function(v){if(this.DBG){THROW({args:arguments,props:['subEditors','subEditors.length']},this,'getChanges.ContentEditor');}
initialV=v;if(typeof(v)=='undefined'||v===null){v={};}
if(true===this.hasChanges()){v=Pulse.ContentEditor.superclass.getChanges.call(this,v);if(typeof(this.keywordsEl)!='undefined'&&this.keywordsEl!==null&&true===this.keywordsEl.changed){v.keywords=this.keywordsEl.getValue().trim();}
if(typeof(this.metakeywordsEl)!='undefined'&&this.metakeywordsEl!==null&&true===this.metakeywordsEl.changed){v.metakeywords=this.metakeywordsEl.getValue().trim();}
if(typeof(this.metadescriptionEl)!='undefined'&&this.metadescriptionEl!==null&&true===this.metadescriptionEl.changed){v.metadescription=this.metadescriptionEl.getValue().trim();}
if(typeof(this.attachmentsEditor)!='undefined'&&this.attachmentsEditor!==null&&true===this.attachmentsEditor.hasChanges()){v=this.attachmentsEditor.getChanges(v);}}else{return initialV;}
return v;},reset:function(){Pulse.ContentEditor.superclass.reset.call(this);try{success=true;if(typeof(this.keywordsEl)!='undefined'&&this.keywordsEl!==null&&true===this.keywordsEl.changed){this.keywordsEl.reset();}
if(typeof(this.metakeywordsEl)!='undefined'&&this.metakeywordsEl!==null&&true===this.metakeywordsEl.changed){this.metakeywordsEl.reset();}
if(typeof(this.metadescriptionEl)!='undefined'&&this.metadescriptionEl!==null&&true===this.metadescriptionEl.changed){this.metadescriptionEl.reset();}
if(typeof(this.attachmentsEditor)!='undefined'&&this.attachmentsEditor!==null&&true===this.attachmentsEditor.hasChanges()){success=this.attachmentsEditor.reset();}
if(false===success){throw('RESETFAILURE');}
return success;}catch(e){throw(new Pulse.Error({e:'RESETFAILURE',o:''+e},this,'reset.ContentEditor'));}},commit:function(){try{this.commitNameChange();Pulse.ContentEditor.superclass.commit.call(this);success=true;if(typeof(this.attachmentsEditor)!='undefined'&&this.attachmentsEditor!==null&&true===this.attachmentsEditor.hasChanges()){success=this.attachmentsEditor.commit();}
if(false===success){throw('COMMITFAILURE');}
if(typeof(this.keywordsEl)!='undefined'&&this.keywordsEl!==null&&true===this.keywordsEl.changed){this.keywordsEl.commit();}
if(typeof(this.metakeywordsEl)!='undefined'&&this.metakeywordsEl!==null&&true===this.metakeywordsEl.changed){this.metakeywordsEl.commit();}
if(typeof(this.metadescriptionEl)!='undefined'&&this.metadescriptionEl!==null&&true===this.metadescriptionEl.changed){this.metadescriptionEl.commit();}
return success;}catch(e){throw(new Pulse.Error({e:'COMMITFAILURE',o:''+e},this,'commit.ContentEditor'));}},commitNameChange:function(){nameMonitor=Ext.getCmp(this.id+'.nameEditor');if(true===nameMonitor.hasChanges()){changedName=nameMonitor.getChanges()[nameMonitor.getParameterName()];this.setTitle(changedName);}},setTitle:function(title){if(typeof(this.tab)!='undefined'&&this.tab!==null){this.tab.setTitle(title);}
ContentRegistryEditor.renameNodeByContentId(this.getContent().id,title);},initSitemapNodesDisplayer:function(){if(this.DBG){THROW({args:arguments,props:['loadSitemapNodesURL']},this,'initSitemapNodesDisplayer');}
try{if(typeof(this.sitemapNodesStore)!='undefined'){delete this.sitemapNodesStore;}
this.sitemapNodesStore=new Ext.data.JsonStore({url:this.loadSitemapNodesURL,root:'sitemapNodes',fields:['text','locale',{name:'visible',type:'boolean'},'expandInfo','expandIds','contentName']});this.sitemapNodePanelReloadButtonCfg={text:VIEWPORT_PROPERTIES.BUTTON_TEXT_RELOAD,scope:this,handler:function(){this.sitemapNodesStore.load({params:{id:this.getContent().id},scope:this,callback:function(records,options,success){if(false===success){try{this.sitemapNodePanel.body.update('<div>...load failure:</div>'
+'<div>...records: <b>[ '
+records
+' ]</b> </div>'
+'<div>...options: <b>{ '
+options
+' }</b> </div>'
+'<div>...success: <b>'
+success+'</b> </div>');}catch(e){THROW({e:'FATAL',args:arguments,props:['content','content.id','loadSitemapNodesURL']},this,'sitemapNodePanel.reload');}}}});},iconCls:'reloadIconCls'};if(typeof(this.sitemapNodePanel)!='undefined'){delete this.sitemapNodePanel;}
this.sitemapNodePanel=new Ext.Panel({title:VIEWPORT_PROPERTIES.SITEMAP,iconCls:'sitemapIconCls',id:this.getContent().clazz+'.'
+this.getContent().id+'.sitemapNodes.panel',renderTo:this.getContent().clazz+'.'
+this.getContent().id+'.sitemapNodes',collapsible:true,collapsed:true,html:'',tbar:['->','-',this.sitemapNodePanelReloadButtonCfg]});this.sitemapNodePanel.buildExpandInfo=function(nodes){buf=[];for(ii=0;ii<nodes.length;ii++){buf.unshift(' / ');if(true===nodes[ii].visible||'true'==nodes[ii].visible){buf.unshift('>');buf.unshift('style="vertical-align:middle;" border="0"');buf.unshift('width="14" height="14" class="visibleIconCls_14_no"');buf.unshift('<img src="'+Ext.BLANK_IMAGE_URL+'" ');}else{buf.unshift('>');buf.unshift('style="vertical-align:middle;" border="0"');buf.unshift('width="14" height="14" class="invisibleIconCls_14_no"');buf.unshift('<img src="'+Ext.BLANK_IMAGE_URL+'" ');}
buf.unshift('</a> ');buf.unshift(nodes[ii].text+' (id: '+nodes[ii].id+')');buf.unshift('>');buf.unshift(' ext:qtip="show '+nodes[ii].text+' (id: '
+nodes[ii].id+') in sitemap"');buf.unshift('this.blur();return;"');buf.unshift('SitemapTree.expandByIds(null,['
+nodes[ii].expandIds+'],null,\''
+nodes[ii].locale+'\');');buf.unshift(' onclick="');buf.unshift(' style=" "');buf.unshift(' class=" "');buf.unshift('<a href="#"');}
buf.unshift('> '+nodes[nodes.length-1].locale+' : ');buf.unshift('style="vertical-align:middle;" border="0"');buf.unshift('width="16" height="16" class="'
+GETFLAG(nodes[nodes.length-1].locale)+'"');buf.unshift('<img src="'+Ext.BLANK_IMAGE_URL+'" ');return buf;};this.sitemapNodesStore.on('beforeload',function(store,options){this.sitemapNodePanel.getUpdater().showLoading();},this);this.sitemapNodesStore.on('load',function(store,records,options){try{htmlBuf=['<div style="padding:5px;">','<ul ','id="'+this.getContent().clazz+'.'
+this.getContent().id
+'.sitemapNodes"','style="font-weight:bold;list-style:none;"','>'];for(i=0;i<records.length;i++){htmlBuf.push('<li style="padding:1px;">');htmlBuf.push('<img src="'+Ext.BLANK_IMAGE_URL
+'" ');htmlBuf.push('width="16" height="16" class="sitemapIconCls"');htmlBuf.push('style="vertical-align:middle;" border="0"');htmlBuf.push('>');htmlBuf.push(' // ');if(records[i].get('expandInfo').length>0){htmlBuf=htmlBuf.concat(this.sitemapNodePanel.buildExpandInfo(records[i].get('expandInfo')));}else{htmlBuf.push('<img src="'
+Ext.BLANK_IMAGE_URL+'" ');htmlBuf.push('width="16" height="16" class="'
+GETFLAG(records[i].get('locale'))
+'"');htmlBuf.push('style="vertical-align:middle;" border="0"');htmlBuf.push('> '
+records[i].get('locale')+' : ');}
htmlBuf.push('<a href="#"');htmlBuf.push(' class=" "');htmlBuf.push(' style=" "');htmlBuf.push(' ext:qtip="show '
+records[i].get('text')+' (id: '
+records[i].id+') in sitemap"');htmlBuf.push(' onclick="');htmlBuf.push('SitemapTree.expandByIds(null,['
+records[i].get('expandIds')
+'],null,\''
+records[i].get('locale')+'\');');htmlBuf.push('this.blur();return;">');htmlBuf.push(records[i].get('text')+' (id: '
+records[i].id+')');htmlBuf.push('</a> ');if(true===records[i].get('visible')){htmlBuf.push('<img src="'
+Ext.BLANK_IMAGE_URL+'" ');htmlBuf.push('width="14" height="14" class="visibleIconCls_14_no"');htmlBuf.push('style="vertical-align:middle;" border="0"');htmlBuf.push('>');}else{htmlBuf.push('<img src="'
+Ext.BLANK_IMAGE_URL+'" ');htmlBuf.push('width="14" height="14" class="invisibleIconCls_14_no"');htmlBuf.push('style="vertical-align:middle;" border="0"');htmlBuf.push('>');}
htmlBuf.push(' / ');htmlBuf.push(records[i].get('contentName'));htmlBuf.push('</li>');}
htmlBuf.push('</ul></div>');this.sitemapNodePanel.body.update(htmlBuf.join(''));}catch(e){this.sitemapNodePanel.body.update('panel.html.build.error:\n'+e);}},this);this.sitemapNodePanel.on('expand',function(){this.sitemapNodesStore.load({params:{id:this.getContent().id},scope:this,callback:function(records,options,success){if(false===success){try{this.sitemapNodePanel.body.update('<div>...load failure:</div>'
+'<div>...records: <b>[ '
+records
+' ]</b> </div>'
+'<div>...options: <b>{ '
+options
+' }</b> </div>'
+'<div>...success: <b>'
+success
+'</b> </div>');}catch(e){THROW({e:'FATAL',args:arguments,props:['content','content.id','loadSitemapNodesURL']},this,'sitemapNodePanel.reload');}}}});},this);}catch(e){FATAL(e,this,'initSitemapNodesDisplayer');}},initAttachmentsPanel:function(){if(this.DBG){THROW({args:arguments,props:['id','loadAttachmentsURL','tab','tab.id']},this,'initAttachmentsPanel');}
try{if(typeof(this.attachmentsEditor)!='undefined'){delete this.attachmentsEditor;}
_thisConf=this.initialConfig;_thisConf.id=this.content.clazz+'.'+this.content.id
+'.attachments.editor';_thisConf.renderTo=this.content.clazz+'.'+this.content.id
+'.attachments';this.attachmentsEditor=new Pulse.AttachmentsEditor(_thisConf);this.attachmentsEditor.on('MSG',function(msgString,editor){},this);this.addSubEditor(this.attachmentsEditor);}catch(e){FATAL(e,this,'initAttachmentsPanel');}},initNameMonitor:function(el){try{this.nameEl=(typeof(el)!='undefined'&&el!==null)?el:Ext.get(this.getContent().clazz+'.'+this.getContent().id
+'.name');if(typeof(this.nameEl)=='undefined'&&this.nameEl===null){if(this.DBG){FATAL('ELEMENT UNDEFINED',this,'initNameMonitor');}
return;}
nameMonitorCFG={id:this.id+'.nameEditor',el:this.nameEl,allowBlank:false};this.nameMonitor=new Pulse.FieldMonitor(nameMonitorCFG);this.nameMonitor.validate();this.addSubEditor(this.nameMonitor);}catch(e){if(this.DBG){FATAL(e,this,'initNameMonitor');}}},initSuffixMonitor:function(el){try{this.suffixEl=(typeof(el)!='undefined'&&el!==null)?el:Ext.get(this.getContent().clazz+'.'
+this.getContent().id+'.suffix');if(typeof(this.suffixEl)=='undefined'&&this.suffixEl===null){if(this.DBG){FATAL('ELEMENT UNDEFINED',this,'initSuffixMonitor');}
return;}
suffixMonitorCFG={allowBlank:false,id:this.id+'.suffixEditor',el:this.suffixEl};this.suffixMonitor=new Pulse.FieldMonitor(suffixMonitorCFG);this.suffixMonitor.validate();this.addSubEditor(this.suffixMonitor);}catch(e){if(this.DBG){FATAL(e,this,'initSuffixMonitor');}}},initTitleMonitor:function(el){try{this.titleEl=(typeof(el)!='undefined'&&el!==null)?el:Ext.get(this.getContent().clazz+'.'
+this.getContent().id+'.title');if(typeof(this.titleEl)=='undefined'&&this.titleEl===null){if(this.DBG){FATAL('ELEMENT UNDEFINED',this,'initTitleMonitor');}
return;}
titleMonitorCFG={allowBlank:true,id:this.id+'.titleEditor',el:this.titleEl};this.titleMonitor=new Pulse.FieldMonitor(titleMonitorCFG);this.titleMonitor.validate();this.addSubEditor(this.titleMonitor);}catch(e){if(this.DBG){FATAL(e,this,'initTitleMonitor');}}},initFieldMonitoring:function(){this.keywordsEl=Ext.get(this.getContent().clazz+'.'
+this.getContent().id+'.keywords');if(this.DBG){THROW({args:arguments,props:['keywordsEl']},this,'initFieldMonitoring.ContentEditor');}
try{headlineEl=Ext.get(this.getContent().clazz+'.'
+this.getContent().id+'.name');if(typeof(headlineEl)!='undefined'&&headlineEl!==null){this.initNameMonitor(headlineEl);}
suffixEl=Ext.get(this.getContent().clazz+'.'
+this.getContent().id+'.suffix');if(typeof(suffixEl)!='undefined'&&suffixEl!==null){this.initSuffixMonitor(suffixEl);}
if(typeof(this.keywordsEl)!='undefined'&&this.keywordsEl!==null){Pulse.initTextAreaMonitor(this.keywordsEl,this,'keywordsEl');}
titleEl=Ext.get(this.getContent().clazz+'.'
+this.getContent().id+'.title');if(typeof(titleEl)!='undefined'&&titleEl!==null){this.initTitleMonitor(titleEl);}
this.metakeywordsEl=Ext.get(this.getContent().clazz+'.'
+this.getContent().id+'.metakeywords');if(typeof(this.metakeywordsEl)!='undefined'&&this.metakeywordsEl!==null){Pulse.initTextAreaMonitor(this.metakeywordsEl,this,'metakeywordsEl');}
this.metadescriptionEl=Ext.get(this.getContent().clazz+'.'
+this.getContent().id+'.metadescription');if(typeof(this.metadescriptionEl)!='undefined'&&this.metadescriptionEl!==null){Pulse.initTextAreaMonitor(this.metadescriptionEl,this,'metadescriptionEl');}}catch(e){description=(typeof(e)=='object'&&typeof(e.description)!='undefined')?', '+e.description:'';THROW({e:'FATAL',o:{e:e,o:description}},this,'initFieldMonitoring.ContentEditor');}},initReferenceDurationEditorPanel:function(){if(this.DBG){THROW({args:arguments,props:['initReferenceDurationEditorURL']},this,'initReferenceDurationEditorPanel');}
try{if(typeof(this.initReferenceDurationEditorURL)!='string'||this.initReferenceDurationEditorURL===''){if(this.DBG){FATAL({e:'URL UNDEFINED',props:['initReferenceDurationEditorURL']},this,'initReferenceDurationEditorPanel');}
return;}
subEditorPanelCFG={id:this.getContent().clazz+'.'+this.getContent().id
+'.durationEditorPanel',masterEditor:this,url:this.initReferenceDurationEditorURL,params:{id:this.getContent().id},renderTo:this.getContent().clazz+'.'+this.getContent().id
+'.durationEditorDiv',bodyStyle:'padding: 5px 5px 5px 5px;'};if(typeof(this.referenceDurationEditorTitle)=='string'&&this.referenceDurationEditorTitle!==''){subEditorPanelCFG.title=this.referenceDurationEditorTitle;}
subEditorPanel=new Pulse.SubEditorPanel(subEditorPanelCFG);subEditorPanel.on('expand',function(){this.initializePanel();});this.addSubEditor(subEditorPanel);}catch(e){FATAL(e,this,'initReferenceDurationEditorPanel');}},initComponent:function(){Pulse.ContentEditor.superclass.initComponent.call(this);try{if(typeof(this.initContentLocalizationMapURL)=='string'&&this.initContentLocalizationMapURL!==''){ContentLocalizationMapEditor.init(this);}
if(typeof(this.loadSitemapNodesURL)=='string'&&this.loadSitemapNodesURL!==''){this.initSitemapNodesDisplayer();}
if(typeof(this.loadAttachmentsURL)=='string'&&this.loadAttachmentsURL!==''){this.initAttachmentsPanel();}
if(typeof(this.initReferenceDurationEditorURL)=='string'&&this.initReferenceDurationEditorURL!==''){this.initReferenceDurationEditorPanel();}
this.seoPanel=new Ext.Panel({title:'SEO',contentEl:this.getContent().clazz+'.'
+this.getContent().id+'.SEOfields',collapsed:true,collapsible:true,renderTo:this.getContent().clazz+'.'
+this.getContent().id+'.SEOpanel'});}catch(e){FATAL(e,this,'initComponent.ContentEditor');}},getId:function(){if(typeof(this.id)=='undefined'&&(typeof(this.initialConfig.id)=='undefined'||this.initialConfig.id===null)){if(typeof(this.getContent())!='undefined'){this.id=this.getContent().clazz+'.'+this.getContent().id
+'.contentEditor';}else{this.id=this.type+'.'+Ext.id();}}
return this.id;}};Pulse.ContentEditor=Ext.extend(Pulse.Editor,ContentEditor);var ContentLocalizationMapEditor={init:function(config){panel=new Ext.Panel({id:config.content.clazz+'.'+config.content.id+'.contentLocalizationMap.panel',html:'',title:VIEWPORT_PROPERTIES.LOCALIZATIONS+':',collapsible:true,collapsed:true,renderTo:config.content.clazz+'.'+config.content.id+'.contentLocalizationMap',tbar:[new Ext.Action({text:VIEWPORT_PROPERTIES.BUTTON_TEXT_ADD,handler:function(){ContentRegistryEditor.getSelectWindow({getChildrenURL:config.browseContentRegistryURL,selectCallback:function(node){Ext.Ajax.request({url:config.contentLocalizationMapAddURL,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){panel=Ext.getCmp(config.content.clazz+'.'+config.content.id+'.contentLocalizationMap.panel');panel.lastLoadConfig.callback=LPCB;panel.lastLoadConfig.timeout=30;panel.load(panel.lastLoadConfig);}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'ContentLocalizationMapEditor','tbar.add.execute()');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'ContentLocalizationMapEditor','tbar.add.execute()');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'ContentLocalizationMapEditor','tbar.add.execute()');}},params:{id:config.content.id,addid:node.attributes.contentId}});}});},iconCls:'addIconCls'}),'-','->','-',new Ext.Action({text:VIEWPORT_PROPERTIES.BUTTON_TEXT_RELOAD,handler:function(){panel=Ext.getCmp(config.content.clazz+'.'+config.content.id+'.contentLocalizationMap.panel');panel.lastLoadConfig.callback=LPCB;panel.lastLoadConfig.timeout=30;panel.load(panel.lastLoadConfig);},iconCls:'reloadIconCls'})]});loadConfig={url:config.initContentLocalizationMapURL,scripts:true,callback:LPCB,params:{id:config.content.id},text:'loading...',discardUrl:true,nocache:true,timeout:30};panel.lastLoadConfig=loadConfig;panel.load(loadConfig);return panel;},removeContent:function(removeURL,contentclass,contentid,removeid){Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE+':',VIEWPORT_PROPERTIES.MSG_REALLYDELETE,function(response){if('yes'===response){Ext.Ajax.request({url:removeURL,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){panel=Ext.getCmp(contentclass+'.'+contentid+'.contentLocalizationMap.panel');panel.lastLoadConfig.callback=LPCB;panel.lastLoadConfig.timeout=30;panel.load(panel.lastLoadConfig);}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'ContentLocalizationMapEditor','removeContent()');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'ContentLocalizationMapEditor','removeContent()');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'ContentLocalizationMapEditor','removeContent()');}},params:{id:contentid,removeid:removeid}});}},this);}};var ContentRegistryEditor={type:'ContentRegistryEditor',DBG:true,win:null,msgPanel:null,centerPanel:null,contentNameField:null,createNameField:null,selectedNode:null,el:null,tel:null,tree:null,getSelectWindow:function(config){try{pel=VIEWPORT.getEl();if(typeof(pel)=='undefined'){throw('19 :: ContentRegistryEditor.getSelectWindow() :: '+'CHECK for element failed...');}
namePanel=new Ext.Panel({region:'south',margins:'3 3 3 3',bodyStyle:'padding: 5px',autoHeight:true,html:'<table cellpadding="0" cellspacing="0" border="0" style="width:90%" align="center"><tr>'
+'<td>'
+VIEWPORT_PROPERTIES.NAME
+':&#160;</td>'
+'<td style="width:100%"><div id="ContentRegistryEditorWindow.nameField"> </div></td>'
+'</tr></table>'});if(this.el===null){this.el=pel.createChild({tag:'div',id:'ContentRegistryEditorWindow.el'});}
this.msgPanel=new Ext.Panel({id:'ContentRegistryEditorWindow.msgPanel',region:'north',html:'msgs go here',border:false,autoHeight:true});if(this.tel===null){this.tel=pel.createChild({tag:'div',id:'ContentRegistryEditorWindow.tel'});}
tree=this.getTree({renderTo:this.tel,getChildrenURL:config.getChildrenURL,onSelectNodeClick:function(crTreeNode){ContentRegistryEditor.selectedNode=crTreeNode;ContentRegistryEditor.contentNameField.setValue(crTreeNode.text);}});this.centerPanel=new Ext.Panel({region:'center',margins:'3 3 0 3',bodyStyle:'padding:5px;overflow:scroll;',items:[tree]});this.win=new Ext.Window({id:'ContentRegistryEditorWindow.Win',title:VIEWPORT_PROPERTIES.CONTENTREGISTRY+':',iconCls:'contentRegistryIconCls',modal:true,plain:true,renderTo:this.el,height:500,layout:'border',items:[this.msgPanel,this.centerPanel,namePanel],width:400,buttonAlign:'center',buttons:[{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CREATE,handler:function(){if(ContentRegistryEditor.selectedNode===null){return false;}
if(ContentRegistryEditor.contentNameField.getRawValue().trim()!=ContentRegistryEditor.selectedNode.text.trim()){return false;}
if(typeof(config.selectCallback)=='function'){config.selectCallback(ContentRegistryEditor.selectedNode);}else if(typeof(config.scope)=='object'&&config.scope!==null&&typeof(config.selectCallback)=='string'&&typeof(config.scope[config.selectCallback])=='function'){config.scope[config.selectCallback](ContentRegistryEditor.selectedNode);}
ContentRegistryEditor.win.close();}},{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CANCEL,handler:function(){ContentRegistryEditor.win.close();}}]});this.win.on('close',function(){delete this.centerPanel;delete this.tel;delete this.tree;this.centerPanel=null;this.tel=null;this.tree=null;},this);this.win.on('show',function(){this.contentNameField=new Ext.form.TextField({name:'ContentRegistryEditorWindow.nameField.name',renderTo:'ContentRegistryEditorWindow.nameField',style:'width:100%',emptyText:(typeof(config.emptyText)!='undefined')?config.emptyText:VIEWPORT_PROPERTIES.TEXT_CHOOSE_CONTENT,allowBlank:false,readOnly:true});this.win.doLayout(true);},this);this.msgPanel.hide();this.msgPanel.collapse();this.msgPanel.on('hide',function(){ContentRegistryEditor.win.doLayout(true);});this.win.setPagePosition((VIEWPORT.getSize().width/2)-200,50);this.win.show(this);tree.render();tree.getRootNode().expand();this.contentNameField.validate();}catch(windowInitError){alert('windowInitError: \n'+windowInitError);}},getTree:function(config){loaderConf={dataUrl:config.getChildrenURL,uiProviders:{'RegistryTreeNodeUI':PULSE.RegistryTreeNodeUI}};if(typeof(config.baseParams)!='undefined'){loaderConf.baseParams=config.baseParams;}
loader=new Ext.tree.TreeLoader(loaderConf);id=config.id;if(typeof(id)=='undefined'||id===null){id=Ext.id();}
tree=new Ext.tree.TreePanel({id:id,el:config.renderTo,region:(typeof(config.region)=='undefined')?'':config.region,autoScroll:true,autoHeight:(typeof(config.height)!='undefined')?false:true,animate:true,enableDD:(typeof(config.enableDD)!='boolean')?false:config.enableDD,containerScroll:true,rootVisible:false,border:false,loader:loader,onSelectNodeClick:null,editor:this});if(typeof(config.iconRenderer)=='function'){tree.iconRenderer=config.iconRenderer;}
if(typeof(config.height)!='undefined'){tree.setHeight(config.height);}
if(config.enableDD===true){tree.on({'beforenodedrop':{scope:tree,fn:function(e){Ext.Ajax.request({url:e.dropNode.attributes.moveURL,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);targetNode=options.e.target;movenode=options.e.dropNode;oldParent=movenode.parentNode;if(true===decodedResponse.status){switch(options.e.point){case'append':if(!targetNode.isExpanded()){try{if(true===targetNode.isLoaded()){targetNode.expand(false,null,function(){targetNode.appendChild(movenode);}.createDelegate(this));}else{oldParent.removeChild(movenode);targetNode.expand();}}catch(err){targetNode.expand();targetNode.appendChild(movenode);}}else{targetNode.appendChild(movenode);}
break;case'above':targetNode.parentNode.insertBefore(movenode,targetNode);break;case'below':targetNode.parentNode.insertBefore(movenode,targetNode.nextSibling);break;}
if(true===decodedResponse.refreshSitemap){SitemapTree.getRootNode().reload();}}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'ContentRegistryEditor','onbeforenodedrop('
+options.e.dropNode+')');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'ContentRegistryEditor','onbeforenodedrop('
+options.e.dropNode+')');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'ContentRegistryEditor','onbeforenodedrop('
+options.e.dropNode+')');}},e:e,params:{targetnodeid:e.target.id,insertpoint:e.point,movenodeid:e.dropNode.id}});return false;}}});}
if(typeof(config.onSelectNodeClick)=='function'){tree.onSelectNodeClick=config.onSelectNodeClick;}
rootCFG={text:'',draggable:false,allowDrop:false,id:'source.'+Ext.id(),iconCls:'contentRegistryIconCls'};if(typeof(config.mode)=='string'&&config.mode=='edit'){rootCFG.expandEditURL=config.getChildrenURL;}
root=new Ext.tree.AsyncTreeNode(rootCFG);loader.on('beforeload',function(loader,node,callback){if(typeof(this.mode)=='string'&&this.mode=='edit'){loader.dataUrl=node.attributes.expandEditURL;}else if(typeof(node.attributes.expandURL)=='string'&&node.attributes.expandURL!=''){loader.dataUrl=node.attributes.expandURL;}
if(typeof(this.westAnimate)=='object'){if(node.id===Ext.getCmp(this.id).getRootNode().id){try{Ext.get(this.westAnimate.id).replaceClass(this.westAnimate.replaceCls,'loadingIconCls');}catch(e){}}}},config);loader.on('load',function(loader,node,response){if(typeof(this.westAnimate)=='object'){if(node.id===Ext.getCmp(this.id).getRootNode().id){try{Ext.get(this.westAnimate.id).replaceClass('loadingIconCls',this.westAnimate.replaceCls);}catch(e){}}}},config);loader.on('loadexception',function(loader,node,response){if(typeof(response.status)!='undefined'&&response.status==403){PulseError.Throw({e:'SERVER.ERROR',o:{e:response.statusText}},this.type,'browseTree');}else if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this.type,'browseTree');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this.type,'browseTree');}},this);tree.setRootNode(root);return tree;},createNode:function(node){this.selectedNode=node;try{pel=VIEWPORT.getEl();if(typeof(pel)=='undefined'){throw('276 :: ContentRegistryEditor.createNode() :: '+'CHECK for element failed...');}
if(this.el===null){this.el=pel.createChild({tag:'div',id:'ContentRegistryEditorWindow.el'});}
this.centerPanel=new Ext.Panel({margins:'3 3 0 3',html:'center'});this.win=new Ext.Window({id:'ContentRegistryEditorWindow.Win',title:VIEWPORT_PROPERTIES.CONTENTREGISTRY+':',iconCls:'contentRegistryIconCls',modal:true,plain:true,renderTo:this.el,autoHeight:true,items:[this.centerPanel],width:400,buttonAlign:'center',buttons:[{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CANCEL,handler:function(){ContentRegistryEditor.win.close();},iconCls:'cancelIconCls'}]});this.win.on('close',function(){delete this.centerPanel;delete this.createNameField;this.centerPanel=null;this.createNameField=null;},this);this.win.on('show',function(){this.centerPanel.load({url:node.attributes.createURL,method:'POST',scripts:true,callback:LPCB,text:'loading...',discardUrl:true,nocache:true,timeout:30});},this);this.win.setPagePosition((VIEWPORT.getSize().width/2)-200,50);this.win.show(this);}catch(windowInitError){alert('windowInitError: \n'+windowInitError);}},save:function(saveURL){if(this.createNameField===null||this.createNameField.getValue().trim()===''){return;}
Ext.Ajax.request({url:saveURL,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){ContentRegistryEditor.responseId=parseInt(decodedResponse.id,10);ContentRegistryEditor.selectedNode.reload(function(node){n=node.findChild('id',ContentRegistryEditor.responseId);delete ContentRegistryEditor.responseId;ContentRegistryEditor.win.close();n.select();if(typeof(n.attributes.contentId)!='undefined'){ContentRegistryEditor.editNode(n);}});if(true===decodedResponse.refreshSitemap){SitemapTree.getRootNode().reload();}}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'ContentRegistryEditor','save');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'ContentRegistryEditor','save');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'ContentRegistryEditor','save');}},params:{name:this.createNameField.getValue().trim()}});},editNode:function(node){if(typeof(node.attributes.contentId)!='undefined'){PULSE_VIEWPORT_CONTROLLER.openTab({id:node.attributes.contentType+'.'
+node.attributes.contentId+'.editor',title:node.text,tabTip:node.text+' (id: '+node.attributes.contentId+')',iconCls:node.attributes.contentType.split('.').join(''),registeredObject:{node:node},loadParams:{url:node.attributes.editURL}});return;}
Ext.Msg.prompt(VIEWPORT_PROPERTIES.NAME,VIEWPORT_PROPERTIES.TEXT_ENTER_NAME+':',function(btn,text){if(btn==='ok'){if(text.trim()===''){return;}
node.ui.setBusy(true);Ext.Ajax.request({url:node.attributes.editURL,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);options.node.ui.setBusy();if(true===decodedResponse.status){options.node.setText(options.params.name);}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'ContentRegistryEditor','editNode()');}},failure:function(response,options){options.node.ui.setBusy();if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'ContentRegistryEditor','editNode()');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'ContentRegistryEditor','editNode()');}},node:node,params:{id:node.id,name:text}});}},this,false,node.text);},deleteNode:function(node){Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE+':&#160;"'
+node.text+'"',VIEWPORT_PROPERTIES.MSG_REALLYDELETE,function(response){if('yes'===response){node.ui.setBusy(true);Ext.Ajax.request({url:node.attributes.deleteURL,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);node=options.node;parentNode=node.parentNode;if(true===decodedResponse.status){if(typeof(node.attributes.contentId)!='undefined'){tabId=node.attributes.contentType
+'.'
+node.attributes.contentId
+'.editor';PULSE_VIEWPORT_CONTROLLER.closeTab(tabId,true);if(node.childNodes.length>0){for(var i=0;i<node.childNodes.length;i++){if(typeof(node.childNodes[i].attributes.contentId)!='undefined'){tabId=node.childNodes[i].attributes.contentType
+'.'
+node.childNodes[i].attributes.contentId
+'.editor';PULSE_VIEWPORT_CONTROLLER.closeTab(tabId,true);}}}}
parentNode.removeChild(node);if(true===decodedResponse.refreshSitemap){SitemapTree.getRootNode().reload();}}else{node.ui.setBusy();PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'ContentRegistryEditor','deleteNode('+options.node+')');}},failure:function(response,options){options.node.ui.setBusy();if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'ContentRegistryEditor','deleteNode('+options.node+')');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'ContentRegistryEditor','deleteNode('+options.node+')');}},node:node});}},this);},initCreateInputField:function(elId){this.createNameField=new Ext.form.TextField({name:'ContentRegistryEditorWindow.nameField.name',renderTo:elId,style:'width:100%;',emptyText:VIEWPORT_PROPERTIES.TEXT_ENTER_NAME,allowBlank:false});this.createNameField.validate();},renameNodeByContentId:function(contentid,newName){n=this.findChildByContentId(ContentRegistryTree.getRootNode(),contentid);if(typeof(n)!='undefined'){n.setText(newName);n.ui.buildQTip(n.ui,n.attributes);}},findChildByContentId:function(node,contentid){if(node===null){return;}
if(node.attributes===null){return;}
if(node.attributes.contentId==contentid){return node;}
if(node.firstChild!==null){return this.findChildByContentId(node.firstChild,contentid);}else if(node.nextSibling!==null){return this.findChildByContentId(node.nextSibling,contentid);}else{return this.findChildByContentId(node.parentNode.nextSibling,contentid);}},expandByIds:function(node,arrayids,callback,isExpanding){try{if(typeof(node)=='undefined'||node===null){return;}
if(true===Ext.getCmp('ContentRegistry.WEST').isExpanding&&true!==isExpanding){return;}
if(true!==isExpanding){Ext.getCmp('ContentRegistry.WEST').disable();}
Ext.getCmp('ContentRegistry.WEST').isExpanding=true;exp_fn=function(){node.expand(false,true,function(node){c=node.findChild('id',arrayids[0]);if(arrayids.length===1){c.select();Ext.getCmp('ContentRegistry.WEST').isExpanding=false;Ext.getCmp('ContentRegistry.WEST').enable();if(typeof(callback)=='function'){callback(c);}
return;}
arrayids.shift();ContentRegistryEditor.expandByIds(c,arrayids,callback,true);});};if(arrayids.length===2){if(node.isLoaded()){node.reload(exp_fn);}else{exp_fn();}}else{exp_fn();}
return;}catch(e){crPanel=Ext.getCmp('ContentRegistry.WEST');if(typeof(crPanel)!='undefined'&&crPanel!==null){crPanel.isExpanding=false;crPanel.enable();}}},editContent:function(crExpandIdsURL,contentid){Ext.Ajax.request({url:crExpandIdsURL,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){crPanel=Ext.getCmp('ContentRegistry.WEST');crPanel.expand();ContentRegistryEditor.expandByIds(ContentRegistryTree.getRootNode(),decodedResponse.ids,function(node){ContentRegistryEditor.editNode(node);});}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'ContentRegistryEditor','editContent()');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'ContentRegistryEditor','editContent()');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'ContentRegistryEditor','editContent()');}},params:{id:contentid}});}};DBG.ContentGroupEditor=DBG.apply(DBG.ContentEditor,{initFieldMonitoring:{ContentGroupEditor:false},addSubEditor:{ContentGroupEditor:false},hasChanges:{ContentGroupEditor:false},initTab:false,MSG:false});ContentGroupEditor={type:'ContentGroupEditor',DBG:false,getCreateCopyButtonConfig:function(){return{text:VIEWPORT_PROPERTIES.COPYCONTENT,disabled:true,scope:this,handler:function(){this.selectCopyCallback=function(node){Ext.Ajax.request({url:this.copyContentURL,scope:this,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){panel=Ext.getCmp(this.getContent().clazz+'.'+this.getContent().id+'.contentLocalizationMap.panel');panel.lastLoadConfig.callback=LPCB;panel.lastLoadConfig.timeout=30;panel.load(panel.lastLoadConfig);crPanel=Ext.getCmp('ContentRegistry.WEST');crPanel.expand();path=decodedResponse.expandPath;ContentRegistryEditor.expandByIds(ContentRegistryTree.getRootNode(),path,function(node){ContentRegistryEditor.editNode(node);});}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this,'tbar.copy');}
delete this.selectCopyCallback;},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this,'tbar.copy');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this,'tbar.copy');}
delete this.selectCopyCallback;},params:{id:this.getContent().id,toid:node.attributes.id}});};windowCfg={getChildrenURL:this.browseContentRegistryURL+'?mode=folder&bundle='+this.getContent().bundle,emptyText:VIEWPORT_PROPERTIES.TEXT_CHOOSE_FOLDER,scope:this,selectCallback:'selectCopyCallback'};ContentRegistryEditor.getSelectWindow(windowCfg);},iconCls:'copyIconCls'};},getSaveContentButtonConfig:function(){return{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_SAVE,disabled:true,scope:this,handler:function(){if(false===this.hasChanges()){this.reset();return;}
saveValues=this.getChanges({id:this.getContent().id});if(typeof(saveValues)=='undefined'||saveValues===null){if(this.DBG){THROW({e:'NO VALUES TO SAVE THOUGH THERE ARE CHANGES',args:[this.hasChanges(),saveValues]},this,'saveContentButton');}
return;}
this.tab.disable();Ext.Ajax.request({url:this.saveContentURL,method:'POST',scope:this,success:function(response,options){this.tab.enable();decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){this.commit();(function(){this.fireEvent('MSG','savesuccess',this);}).defer(250,this);}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this.type,'tbar.save');}},failure:function(response,options){this.tab.enable();if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this.type,'tbar.save');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this.type,'tbar.save');}},params:saveValues});},iconCls:'saveIconCls'};},getFindButtonConfig:function(){return{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_FIND,disabled:true,scope:this,handler:function(){Ext.Ajax.request({url:this.contentExpandPathURL,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){crPanel=Ext.getCmp('ContentRegistry.WEST');if(typeof(crPanel)=='undefined'||crPanel===null){PULSE_TOOLBAR.openPanel({id:'ContentRegistry.WEST',callback:function(){ContentRegistryEditor.expandByIds(ContentRegistryTree.getRootNode(),decodedResponse.ids);}});return;}
crPanel.expand();ContentRegistryEditor.expandByIds(ContentRegistryTree.getRootNode(),decodedResponse.ids);}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this.type,'tbar.find');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this.type,'tbar.find');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this.type,'tbar.find');}},params:{id:this.getContent().id}});},iconCls:'findIconCls'};},getEditDescriptionButtonConfig:function(){return{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_EDIT,disabled:true,scope:this,handler:function(){fckWinCfg={loadURL:this.initDescriptionEditorURL,loadParams:{id:this.getContent().id},saveURL:this.saveDescriptionURL,saveParams:{id:this.getContent().id},scope:this,onSaveSuccess:'loadDescription'};if(this.DBG){THROW({propsObj:fckWinCfg,props:['loadURL','loadParams','saveURL','saveParams','scope','onSaveSuccess']},this,'editDescription.click');}
AbstractBasicContentEditor.getFCKEditorWindow(fckWinCfg);},iconCls:'editIconCls'};},getReloadDescriptionButtonConfig:function(){return{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_RELOAD,disabled:true,scope:this,handler:function(){this.loadDescription();},iconCls:'reloadIconCls'};},initTab:function(){if(this.DBG){THROW({props:['tab','tab.id']},this,'initTab');}
try{if(typeof(this.tab)!='object'||this.tab===null){THROW({e:'TAB UNDEFINED OR NULL: "['+this.tab+']"'},this,'initTab');return;}
if(true!==this.tab.isInitialized){buttons=[];saveContentButtonConfig=this.getSaveContentButtonConfig();if(typeof(this.saveContentURL)=='string'&&this.saveContentURL!==''){saveContentButtonConfig.disabled=false;saveContentButtonConfig.scope=this;}
buttons.push(saveContentButtonConfig);buttons.push(new Ext.Toolbar.Separator());createCopyButtonConfig=this.getCreateCopyButtonConfig();if(typeof(this.copyContentURL)=='string'&&this.copyContentURL!==''){createCopyButtonConfig.disabled=false;createCopyButtonConfig.scope=this;}
buttons.push(createCopyButtonConfig);buttons.push(new Ext.Toolbar.Separator());findButtonConfig=this.getFindButtonConfig();if(typeof(this.contentExpandPathURL)=='string'&&this.contentExpandPathURL!==''){findButtonConfig.disabled=false;findButtonConfig.scope=this;}
buttons.push(findButtonConfig);buttons.push(new Ext.Toolbar.Separator());this.tab.getTopToolbar().insertButton(0,buttons);this.tab.isInitialized=true;}}catch(e){FATAL(e,this,'initTab');}},initDescriptionPanel:function(){if(this.DBG){THROW({props:['initDescriptionEditorURL','saveDescriptionURL']},this,'initDescriptionPanel');}
try{buttons=[];editDescriptionButtonConfig=this.getEditDescriptionButtonConfig();if(typeof(this.initDescriptionEditorURL)=='string'&&this.initDescriptionEditorURL!==''&&typeof(this.saveDescriptionURL)=='string'&&this.saveDescriptionURL!==''){editDescriptionButtonConfig.disabled=false;editDescriptionButtonConfig.scope=this;}
reloadDescriptionButtonConfig=this.getReloadDescriptionButtonConfig();if(typeof(this.loadDescriptionURL)=='string'&&this.loadDescriptionURL!==''){reloadDescriptionButtonConfig.disabled=false;reloadDescriptionButtonConfig.scope=this;}
tbar=[editDescriptionButtonConfig,'-','->','-',reloadDescriptionButtonConfig];panelCfg={id:this.getContent().clazz+'.'+this.getContent().id+'.description.panel',title:VIEWPORT_PROPERTIES.DESCRIPTION+':',collapsible:true,collapsed:true,renderTo:this.getContent().clazz+'.'+this.getContent().id+'.description',html:'...',bodyStyle:'padding:5px;',tbar:tbar};this.descriptionPanel=new Ext.Panel(panelCfg);this.descriptionPanel.on('expand',function(p){if(true!==this.descriptionPanel.initialExpand){this.loadDescription();this.descriptionPanel.initialExpand=true;}},this);}catch(e){if(this.DBG){FATAL(e,this,'initDescriptionPanel');}}},loadDescription:function(){if(this.DBG){THROW({props:['loadDescriptionURL','content.id']},this,'loadDescripton');}
try{loadCfg={url:this.loadDescriptionURL,method:'POST',callback:LPCB_DISABLE,params:{id:this.getContent().id},text:'loading...',discardUrl:true,nocache:true,timeout:30};this.descriptionPanel.load(loadCfg);}catch(e){FATAL(e,this,'loadDescripton');}},initFieldMonitoring:function(){if(this.DBG){THROW({args:arguments},this,'initFieldMonitoring');}
try{Pulse.ContentGroupEditor.superclass.initFieldMonitoring.call(this);}catch(e){if(this.DBG){FATAL(e,this,'initFieldMonitoring');}}},initComponent:function(boolInitTab){Pulse.ContentGroupEditor.superclass.initComponent.call(this,boolInitTab);try{this.initFieldMonitoring();this.initDescriptionPanel();if(false!==boolInitTab){this.initTab();}}catch(e){FATAL(e,this,'initComponent.ContentGroupEditor');}}};Pulse.ContentGroupEditor=Ext.extend(Pulse.ContentEditor,ContentGroupEditor);DBG.FileContentEditor=DBG.apply(DBG.ContentEditor,{initFieldMonitoring:{FileContentEditor:false},addSubEditor:{FileContentEditor:false},hasChanges:{FileContentEditor:false},initTab:false,initFileEditor:false,MSG:false});FileContentEditor={type:'FileContentEditor',DBG:false,getCreateCopyButtonConfig:function(){return{text:VIEWPORT_PROPERTIES.COPYCONTENT,disabled:true,scope:this,handler:function(){this.selectCopyCallback=function(node){Ext.Ajax.request({url:this.copyContentURL,scope:this,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){panel=Ext.getCmp(this.getContent().clazz+'.'+this.getContent().id+'.contentLocalizationMap.panel');panel.lastLoadConfig.callback=LPCB;panel.lastLoadConfig.timeout=30;panel.load(panel.lastLoadConfig);crPanel=Ext.getCmp('ContentRegistry.WEST');crPanel.expand();path=decodedResponse.expandPath;ContentRegistryEditor.expandByIds(ContentRegistryTree.getRootNode(),path,function(node){ContentRegistryEditor.editNode(node);});}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this,'tbar.copy');}
delete this.selectCopyCallback;},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this,'tbar.copy');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this,'tbar.copy');}
delete this.selectCopyCallback;},params:{id:this.getContent().id,toid:node.attributes.id}});};windowCfg={getChildrenURL:this.browseContentRegistryURL+'?mode=folder&bundle='+this.getContent().bundle,emptyText:VIEWPORT_PROPERTIES.TEXT_CHOOSE_FOLDER,scope:this,selectCallback:'selectCopyCallback'};ContentRegistryEditor.getSelectWindow(windowCfg);},iconCls:'copyIconCls'};},getSaveContentButtonConfig:function(){return{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_SAVE,disabled:true,scope:this,handler:function(){if(false===this.hasChanges()){this.reset();return;}
saveValues=this.getChanges({id:this.getContent().id});if(typeof(saveValues)=='undefined'||saveValues===null){if(this.DBG){THROW({e:'NO VALUES TO SAVE THOUGH THERE ARE CHANGES',args:[this.hasChanges(),saveValues]},this,'saveContentButton');}
return;}
this.tab.disable();Ext.Ajax.request({url:this.saveContentURL,method:'POST',scope:this,success:function(response,options){this.tab.enable();decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){this.commit();if(typeof(this.fileEditorPanel)!='undefined'){this.fileEditorPanel.loadPanel();}
(function(){this.fireEvent('MSG','savesuccess',this);}).defer(250,this);}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this.type,'tbar.save');}},failure:function(response,options){this.tab.enable();if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this.type,'tbar.save');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this.type,'tbar.save');}},params:saveValues});},iconCls:'saveIconCls'};},getFindButtonConfig:function(){return{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_FIND,disabled:true,scope:this,handler:function(){Ext.Ajax.request({url:this.contentExpandPathURL,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){crPanel=Ext.getCmp('ContentRegistry.WEST');if(typeof(crPanel)=='undefined'||crPanel===null){PULSE_TOOLBAR.openPanel({id:'ContentRegistry.WEST',callback:function(){ContentRegistryEditor.expandByIds(ContentRegistryTree.getRootNode(),decodedResponse.ids);}});return;}
crPanel.expand();ContentRegistryEditor.expandByIds(ContentRegistryTree.getRootNode(),decodedResponse.ids);}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this.type,'tbar.find');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this.type,'tbar.find');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this.type,'tbar.find');}},params:{id:this.getContent().id}});},iconCls:'findIconCls'};},initTab:function(){if(this.DBG){THROW({props:['tab','tab.id']},this,'initTab');}
try{if(typeof(this.tab)!='object'||this.tab===null){THROW({e:'TAB UNDEFINED OR NULL: "['+this.tab+']"'},this,'initTab');return;}
if(true!==this.tab.isInitialized){buttons=[];saveContentButtonConfig=this.getSaveContentButtonConfig();if(typeof(this.saveContentURL)=='string'&&this.saveContentURL!==''){saveContentButtonConfig.disabled=false;saveContentButtonConfig.scope=this;}
buttons.push(saveContentButtonConfig);buttons.push(new Ext.Toolbar.Separator());createCopyButtonConfig=this.getCreateCopyButtonConfig();if(typeof(this.copyContentURL)=='string'&&this.copyContentURL!==''){createCopyButtonConfig.disabled=false;createCopyButtonConfig.scope=this;}
buttons.push(createCopyButtonConfig);buttons.push(new Ext.Toolbar.Separator());findButtonConfig=this.getFindButtonConfig();if(typeof(this.contentExpandPathURL)=='string'&&this.contentExpandPathURL!==''){findButtonConfig.disabled=false;findButtonConfig.scope=this;}
buttons.push(findButtonConfig);buttons.push(new Ext.Toolbar.Separator());this.tab.getTopToolbar().insertButton(0,buttons);this.tab.isInitialized=true;}}catch(e){FATAL(e,this,'initTab');}},initFieldMonitoring:function(){if(this.DBG){THROW({args:arguments},this,'initFieldMonitoring');}
try{Pulse.FileContentEditor.superclass.initFieldMonitoring.call(this);}catch(e){if(this.DBG){FATAL(e,this,'initFieldMonitoring');}}},initFileEditor:function(){if(this.DBG){THROW({args:arguments,props:['initFileEditorURL']},this,'initFileEditor');}
try{idPrefix=this.getContent().clazz+'.'+this.getContent().id;el=Ext.get(idPrefix+'.file.container');div=el.insertHtml('afterBegin','<div id="'+idPrefix+'.file"> </div>');if(typeof(this.initFileEditorURL)!='string'||this.initFileEditorURL===''){if(this.DBG){FATAL({e:'URL UNDEFINED',props:['initFileEditorURL']},this,'initFileEditor');}
return;}
subEditorPanelCFG={id:this.id+'.fileSelectorPanel',masterEditor:this,url:this.initFileEditorURL,params:{id:this.getContent().id},renderTo:div,bodyStyle:'padding: 5px 5px 5px 5px;'};if(typeof(this.fileEditorTitle)=='string'&&this.fileEditorTitle!==''){subEditorPanelCFG.title=this.fileEditorTitle;}
this.fileEditorPanel=new Pulse.SubEditorPanel(subEditorPanelCFG);this.fileEditorPanel.on('expand',function(){this.initializePanel();});this.addSubEditor(this.fileEditorPanel);}catch(e){FATAL(e,this,'initFileEditor');}},initIndexFileMonitor:function(){if(this.DBG){THROW({args:arguments},this,'initIndexFileMonitor');}
try{checked='';if(true===this.getContent().indexFile){checked='checked="checked"';}
html=['<div style="padding:0 0 5px 0;">','<table border="0" cellpadding="0" cellspacing="5"><tr><td>','<img src="',Ext.BLANK_IMAGE_URL,'" id="',idPrefix,'.hasChangesIcon"',' class="tabHasChangesIconHidden"/>','<img src="',Ext.BLANK_IMAGE_URL,'" class="searchDocumentIconCls" width="16" height="16" border="0"/>','</td><td>','<input type="checkbox" id="',idPrefix,'.indexFile" name="indexFile"',checked,'/>','</td><td>',':&#160;',VIEWPORT_PROPERTIES.TEXT_INDEX_FILECONTENT_FOR_SEARCH,'</td></tr></table>','</div>'].join('');idPrefix=this.getContent().clazz+'.'+this.getContent().id;el=Ext.get(idPrefix+'.file.container');el.insertHtml('afterBegin',html);box=Ext.get(idPrefix+'.indexFile');indexFileMonitorCFG={id:idPrefix+'.indexFileMonitor',el:box,fieldType:'checkbox'};this.indexFileMonitor=new Pulse.FieldMonitor(indexFileMonitorCFG);this.addSubEditor(this.indexFileMonitor);this.indexFileMonitor.on('MSG',function(msgString,monitor){if(msgString=='change'){this.replaceClass('tabHasChangesIconHidden','tabHasChangesIcon');}else if(msgString=='reset'){this.replaceClass('tabHasChangesIcon','tabHasChangesIconHidden');}},Ext.get(idPrefix+'.hasChangesIcon'));}catch(e){FATAL(e,this,'initIndexFileMonitor');}},initComponent:function(boolInitTab){Pulse.FileContentEditor.superclass.initComponent.call(this,boolInitTab);try{this.initFieldMonitoring();this.initFileEditor();this.initIndexFileMonitor();if(false!==boolInitTab){this.initTab();}}catch(e){FATAL(e,this,'initComponent.FileContentEditor');}}};Pulse.FileContentEditor=Ext.extend(Pulse.ContentEditor,FileContentEditor);var FilterEditor={el:null,win:null,msgPanel:null,editFilters:function(initOverViewTabURL){PULSE_VIEWPORT_CONTROLLER.openTab({id:'FilterEditor.OverView',title:'...loading',iconCls:'contentFilterIconCls',loadParams:{url:initOverViewTabURL}});},editFilter:function(editURL,id){PULSE_VIEWPORT_CONTROLLER.openTab({id:'FilterEditor.'+id,title:'...loading: '+id,tabTip:'(id:'+id+')',iconCls:'contentFilterIconCls',loadParams:{url:editURL,params:{id:id}}});},reloadRules:function(id){store=Ext.getCmp('grid.'+id+'.rules.grid').getStore();store.reload();},reloadOverviewGrid:function(){try{store=Ext.getCmp('FilterOverViewGrid.grid').getStore();store.reload();}catch(e){}},createFilter:function(config,copyId){try{pel=VIEWPORT.getEl();if(typeof(pel)=='undefined'){throw('76 :: FilterEditor.createFilter() :: '+'CHECK for element failed...');}
filterNameFieldCfg={fieldLabel:VIEWPORT_PROPERTIES.NAME,name:'name',width:400,emptyText:VIEWPORT_PROPERTIES.TEXT_ENTER_NAME,allowBlank:false};if(typeof(config.name)!='undefined'&&config.name!==''){filterNameFieldCfg.value=config.name+' copy';}
filterNameField=new Ext.form.TextField(filterNameFieldCfg);formPanel=new Ext.form.FormPanel({id:'newFilterForm',name:'newFilterForm',region:'center',margins:'3 3 3 3',bodyStyle:'padding: 5px',defaultType:'textfield',autoHeight:true,items:[filterNameField]});formPanel.addButton({text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CREATE,handler:function(){if(filterNameField.getValue().trim()===''){return false;}
params={name:filterNameField.getValue()};if(typeof(copyId)=='number'||typeof(parseInt(copyId,10))=='number'){params.copyId=copyId;}
Ext.Ajax.request({url:config.createURL,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){FilterEditor.win.close();FilterEditor.reloadOverviewGrid();FilterEditor.editFilter(options.config.editFilterURL,decodedResponse.id);}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'FilterEditor','createFilter()');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'FilterEditor','createFilter()');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'FilterEditor','createFilter()');}},config:config,params:params});}});formPanel.addButton({text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CANCEL,handler:function(){FilterEditor.win.close();}});if(this.el===null){this.el=pel.createChild({tag:'div',id:'FilterEditorWindow.el'});}
this.msgPanel=new Ext.Panel({id:'FilterEditor.msgPanel',region:'north',html:'msgs go here',border:false,autoHeight:true});this.win=new Ext.Window({id:'FilterEditor.Win',iconCls:'contentFilterIconCls',title:FilterLocalizations.createFilter,modal:true,plain:true,renderTo:this.el,height:130,layout:'border',items:[this.msgPanel,formPanel],width:600});this.msgPanel.hide();this.msgPanel.collapse();this.msgPanel.on('hide',function(){FilterEditor.win.doLayout(true);});this.win.setPagePosition((VIEWPORT.getSize().width/2)-300,100);this.win.show(this);filterNameField.validate();}catch(windowInitError){alert('windowInitError: \n'+windowInitError);}},removeFilter:function(removeFilterURL,id){Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE+':&#160;"'+id
+'"',VIEWPORT_PROPERTIES.MSG_REALLYDELETE,function(response){if('yes'===response){Ext.Ajax.request({url:removeFilterURL,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){grid=Ext.getCmp('FilterOverViewGrid.grid');gridStore=grid.getStore();for(i=0;i<gridStore.getCount();i++){delRec=gridStore.getAt(i);if(delRec.get('id')==options.params.id){break;}}
gridStore.remove(delRec);PULSE_VIEWPORT_CONTROLLER.closeTab('FilterEditor.'
+options.params.id,true);PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:'FilterEditor.OverView'},{n:'msg',o:'DELETESUCCESS'}]});}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'FilterEditor','removeFilter()');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'FilterEditor','removeFilter()');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'FilterEditor','removeFilter()');}},params:{id:id}});}},this);},removeFilterRule:function(removeURL,ruleId,gridId,tabId){Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE+':&#160;"'
+ruleId+'"',VIEWPORT_PROPERTIES.MSG_REALLYDELETE,function(response){if('yes'===response){Ext.Ajax.request({url:removeURL,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){Ext.getCmp(options.gridId).getStore().reload();PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:options.tabId},{n:'msg',o:'DELETESUCCESS'}]});}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'FilterEditor','removeFilterRule()');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'FilterEditor','removeFilterRule()');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'FilterEditor','removeFilterRule()');}},gridId:gridId,tabId:tabId,params:{id:ruleId}});}},this);},initOverViewEditor:function(config){if(typeof(config.tab)!='undefined'){tab=config.tab;if(true!==tab.isInitialized){tabTbar=tab.getTopToolbar().insertButton(0,[new Ext.Action({text:VIEWPORT_PROPERTIES.BUTTON_TEXT_NEW,handler:function(){FilterEditor.createFilter(config);},iconCls:'addIconCls'}),new Ext.Toolbar.Separator()]);tab.isInitialized=true;}}
gridStoreRecord=new Ext.data.Record.create([{name:'id'},{name:'name'}]);gridStore=new Ext.data.JsonStore({pruneModifiedRecords:true,fields:gridStoreRecord,root:'data',remoteSort:true,sortInfo:{field:'name',direction:'ASC'},totalProperty:'total',url:config.loadFiltersURL});pageSizeBox=new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:['size'],sortInfo:{field:'size',direction:"ASC"},data:[[10],[20],[50],[100]]}),displayField:'size',valueField:'size',selectOnFocus:true,mode:'local',triggerAction:'all',width:60,blankText:'10',emptyText:'10'});pagingToolBar=new Ext.PagingToolbar({displayInfo:true,pageSize:10,store:gridStore,items:['-',pageSizeBox]});gridStore.on('beforeLoad',function(store,options){if(pageSizeBox.getRawValue()!==''){try{limit=parseInt(pageSizeBox.getRawValue().trim(),10);pagingToolBar.pageSize=limit;options.params.limit=limit;}catch(e){}}else{pagingToolBar.pageSize=10;options.params.limit=10;}});columns=[{id:'id',header:'id:',dataIndex:'id',sortable:true,width:30,fixed:true},{header:FilterLocalizations.Filter+':',dataIndex:'name',sortable:true}];if(typeof(config.editFilterURL)!='undefined'){columns.push({header:'',dataIndex:'id',width:25,fixed:true,sortable:false,renderer:function(id){return FilterEditor.getGridImageField({functionString:'FilterEditor.editFilter(\''
+config.editFilterURL
+'\','
+id+')',iconCls:'editIconCls_14',qtip:VIEWPORT_PROPERTIES.BUTTON_TEXT_EDIT});}});}
if(typeof(config.removeFilterURL)!='undefined'){columns.push({header:'',dataIndex:'id',width:25,fixed:true,sortable:false,renderer:function(id){return FilterEditor.getGridImageField({functionString:'FilterEditor.removeFilter(\''
+config.removeFilterURL
+'\','+id+')',iconCls:'deleteIconCls_14',qtip:VIEWPORT_PROPERTIES.BUTTON_TEXT_DELETE});}});}
gridCm=new Ext.grid.ColumnModel(columns);grid=new Ext.grid.GridPanel({id:(typeof(config.gridId)=='undefined')?'FilterOverViewGrid.grid':config.gridId,store:gridStore,cm:gridCm,renderTo:(typeof(config.gridId)=='undefined')?'FilterOverViewGrid':config.gridId+'.el',autoExpandColumn:'id',loadMask:true,viewConfig:{forceFit:true},frame:false,style:'border: 1px solid #8DB2E3;',enableHdMenu:false,bbar:pagingToolBar});if(typeof(config.tab)!='undefined'){grid.setWidth(config.tab.getInnerWidth()-10);tabMsgPanel=Ext.getCmp(config.tab.id+'.msgPanel');msgPanelHeight=0;if(tabMsgPanel.isVisible()){msgPanelHeight=tabMsgPanel.getSize().height;}
tabHeader=Ext.get(config.tab.id+'.header');grid.setHeight(config.tab.getInnerHeight()
-tabHeader.getBox().height-msgPanelHeight-10);config.tab.on({'resize':{fn:function(tab,adjWidth,adjHeight,rawWidth,rawHeight){grid=Ext.getCmp('FilterOverViewGrid.grid');tabContentPanel=Ext.getCmp(config.tab.id
+'.contentPanel');grid.setWidth(config.tab.getInnerWidth()-10);tabMsgPanel=Ext.getCmp(config.tab.id+'.msgPanel');msgPanelHeight=0;if(tabMsgPanel.isVisible()){msgPanelHeight=tabMsgPanel.getSize().height;}
tabHeader=Ext.get(config.tab.id+'.header');grid.setHeight(config.tab.getInnerHeight()
-tabHeader.getBox().height-msgPanelHeight
-10);}}});}
gridStore.load({params:{start:0,limit:10}});return grid;},initFilterEditor:function(config){nameEl=Ext.get(config.filterclass+'.'+config.id+'.name');nameEl.initialValue=nameEl.getValue();nameEl.hasChanged=function(){return(this.initialValue!=this.getValue().trim());}
nameEl.on('keyup',function(){if(this.nameEl.dom.value===''){this.nameEl.replaceClass('editorInputField','editorInputFieldRed');this.nameEl.replaceClass('editorInputFieldYellow','editorInputFieldRed');}else{this.nameEl.replaceClass('editorInputField','editorInputFieldYellow');this.nameEl.replaceClass('editorInputFieldRed','editorInputFieldYellow');}
if(true===this.nameEl.hasChanged()){PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:config.tab.id},{n:'msg',o:'change'}]});}else{if(true===Ext.get(this.config.filterclass+'.'
+this.config.id+'.referenceDuration').hasChanged()){return;}
this.nameEl.replaceClass('editorInputFieldYellow','editorInputField');this.nameEl.replaceClass('editorInputFieldRed','editorInputField');PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:config.tab.id},{n:'msg',o:'reset'}]});}},{nameEl:nameEl,config:config});referenceDurationEl=Ext.get(config.filterclass+'.'+config.id
+'.referenceDuration');referenceDurationEl.initialValue=referenceDurationEl.getValue();referenceDurationEl.hasChanged=function(){return(this.initialValue!=this.getValue());}
referenceDurationEl.on('click',function(){if(true===this.referenceDurationEl.dom.checked){this.referenceDurationEl.set({value:true});}else{this.referenceDurationEl.set({value:false});}
if(true===this.referenceDurationEl.hasChanged()){PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:config.tab.id},{n:'msg',o:'change'}]});}else{if(true===Ext.get(this.config.filterclass+'.'
+this.config.id+'.name').hasChanged()){return;}
PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:config.tab.id},{n:'msg',o:'reset'}]});}},{referenceDurationEl:referenceDurationEl,config:config});buttonArray=[{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_SAVE,scope:config.tab,handler:function(){if(true!==this.isDirty){return;}
nameEl=Ext.get(config.filterclass+'.'+config.id+'.name');referenceDurationEl=Ext.get(config.filterclass+'.'
+config.id+'.referenceDuration');if((false===nameEl.hasChanged())&&(false===referenceDurationEl.hasChanged())){return;}
name=nameEl.getValue().trim();if(name===''){return;}
params={id:config.id,name:name};if(true===referenceDurationEl.hasChanged()){params[referenceDurationEl.dom.name]=referenceDurationEl.getValue();}
Ext.Ajax.request({url:config.saveFilterURL,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){options.tab.isDirty=false;options.tab.setTitle(options.params.name);options.nameEl.replaceClass('editorInputFieldRed','editorInputField');options.nameEl.replaceClass('editorInputFieldYellow','editorInputField');if(true===options.nameEl.hasChanged()){options.nameEl.initialValue=options.nameEl.getValue();}
if(true===options.referenceDurationEl.hasChanged()){options.referenceDurationEl.initialValue=options.referenceDurationEl.getValue();}
FilterEditor.reloadOverviewGrid();PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:options.tab.id},{n:'msg',o:'SAVESUCCESS'}]});}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'FilterEditor','saveChangesButton');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'FilterEditor','saveChangesButton');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'FilterEditor','saveChangesButton');}},nameEl:nameEl,referenceDurationEl:referenceDurationEl,tab:this,params:params});},iconCls:'saveIconCls'},new Ext.Toolbar.Separator()];if(typeof(config.createURL)!='undefined'&&config.createURL!==''){buttonArray.push({text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CREATECOPY,scope:this,handler:function(){this.createFilter(config,config.id);},iconCls:'copyFilterIconCls'});buttonArray.push(new Ext.Toolbar.Separator());}
config.tab.getTopToolbar().insertButton(0,buttonArray);this.buildGrid({id:config.id,tab:config.tab,gridId:'grid.'+config.id+'.rules',gridTitle:FilterLocalizations.FilterRule,url:config.loadFilterRulesURL,createFunction:function(){FilterRulesEditor.createFilterRule({filterId:config.id,createURL:config.createFilterRuleURL,editURL:config.editFilterRuleURL});},moveURL:config.moveFilterRuleURL,editURL:config.editFilterRuleURL,editFnString:'FilterRulesEditor.editFilterRule',removeURL:config.removeFilterRuleURL,removeFnString:'FilterEditor.removeFilterRule'});this.buildGrid({id:config.id,tab:config.tab,contentTypeField:true,gridId:'grid.'+config.id+'.matches',gridTitle:FilterLocalizations.FilterMatch,url:config.loadFilterMatchesURL,createFunction:function(){FilterMatchesEditor.addFilterMatch({filterId:config.id,createURL:config.createFilterMatchURL,editURL:config.editFilterMatchURL,browseContentRegistryURL:config.browseContentRegistryURL});},moveURL:config.moveFilterMatchURL,editURL:config.editFilterMatchURL,editFnString:'FilterMatchesEditor.editFilterMatch',removeURL:config.removeFilterMatchURL,removeFnString:'FilterMatchesEditor.removeFilterMatch',localeSelector:true});},buildGrid:function(config){gridStoreRecord=new Ext.data.Record.create([{name:'id'},{name:'name'},{name:'contentType'},{name:'content'}]);gridStore=new Ext.data.JsonStore({pruneModifiedRecords:true,fields:gridStoreRecord,root:'data',url:config.url});editFieldRenderer=function(id){return FilterEditor.getGridImageField({functionString:config.editFnString+'(\''
+config.editURL+'\','+id+')',iconCls:'editIconCls_14',qtip:VIEWPORT_PROPERTIES.BUTTON_TEXT_EDIT});};removeFieldRenderer=function(id){return FilterEditor.getGridImageField({functionString:config.removeFnString+'(\''
+config.removeURL+'\','+id+', \''
+config.gridId+'.grid\', \''+config.tab.id+'\')',iconCls:'deleteIconCls_14',qtip:VIEWPORT_PROPERTIES.BUTTON_TEXT_DELETE});};columns=[{id:'id',header:'id:',dataIndex:'id',width:30,fixed:true,sortable:false}];if(true===config.contentTypeField){contentFieldRenderer=function(content){return FilterEditor.getContentField(content);};columns.push({header:config.gridTitle+':',dataIndex:'content',sortable:false,renderer:contentFieldRenderer});}else{columns.push({header:config.gridTitle+':',dataIndex:'name',sortable:false});}
columns.push({header:'',dataIndex:'id',width:25,fixed:true,sortable:false,renderer:editFieldRenderer});columns.push({header:'',dataIndex:'id',width:25,fixed:true,sortable:false,renderer:removeFieldRenderer});if(typeof(config.moveURL)!='undefined'){upFieldRenderer=function(id){return FilterEditor.getGridImageField({functionString:'FilterEditor.moveRecUp(\''
+config.moveURL+'\','+id+', \''
+config.gridId+'.grid\', \''
+config.tab.id+'\')',iconCls:'upIconCls_14',qtip:VIEWPORT_PROPERTIES.UP});};columns.push({header:'',dataIndex:'id',width:25,fixed:true,sortable:false,renderer:upFieldRenderer});downFieldRenderer=function(id){return FilterEditor.getGridImageField({functionString:'FilterEditor.moveRecDown(\''
+config.moveURL+'\','+id+', \''
+config.gridId+'.grid\', \''
+config.tab.id+'\')',iconCls:'downIconCls_14',qtip:VIEWPORT_PROPERTIES.DOWN});};columns.push({header:'',dataIndex:'id',width:25,fixed:true,sortable:false,renderer:downFieldRenderer});}
gridCm=new Ext.grid.ColumnModel(columns);tbar=[new Ext.Action({text:VIEWPORT_PROPERTIES.BUTTON_TEXT_NEW,handler:function(){config.createFunction();},iconCls:'addIconCls'}),'-'];if(true===config.localeSelector){localeSelector=new Pulse.LocaleSelector({store:gridStore});tbar=tbar.concat(localeSelector.items);tbar.push('-');}
tbar.push('->');tbar.push('-');tbar.push(new Ext.Action({text:VIEWPORT_PROPERTIES.BUTTON_TEXT_RELOAD,handler:function(){if(true===config.localeSelector){Ext.getCmp(config.gridId+'.grid').localeSelector.reset();}
Ext.getCmp(config.gridId+'.grid').getStore().reload();},iconCls:'reloadIconCls'}));grid=new Ext.grid.GridPanel({id:config.gridId+'.grid',store:gridStore,cm:gridCm,renderTo:config.gridId,autoExpandColumn:'id',loadMask:true,viewConfig:{forceFit:true},title:config.gridTitle,frame:false,enableHdMenu:false,tbar:tbar,localeSelector:(typeof(localeSelector)!='undefined')?localeSelector:null});grid.setWidth(config.tab.getInnerWidth()/2-6);maxHeight=config.tab.getInnerHeight()-12;tabMsgPanel=Ext.getCmp(config.tab.id+'.msgPanel');if(tabMsgPanel.hidden!==true){maxHeight=maxHeight-tabMsgPanel.getSize().height;}
tabHeader=Ext.get(config.tab.id+'.header');grid.setHeight(maxHeight-tabHeader.getBox().height);config.tab.on({'resize':{fn:function(tab,adjWidth,adjHeight,rawWidth,rawHeight){grid=Ext.getCmp(config.gridId+'.grid');grid.setWidth(config.tab.getInnerWidth()/2-6);maxHeight=config.tab.getInnerHeight()-12;tabMsgPanel=Ext.getCmp(config.tab.id
+'.msgPanel');if(tabMsgPanel.hidden!==true){maxHeight=maxHeight
-tabMsgPanel.getSize().height;}
tabHeader=Ext.get(config.tab.id+'.header');grid.setHeight(maxHeight
-tabHeader.getBox().height);}}});gridStore.load({params:{id:config.id}});},moveRecUp:function(moveURL,id,gridId,tabId){store=Ext.getCmp(gridId).getStore();rec=store.getAt(0);if(rec.get('id')==id){return;}
Ext.Ajax.request({url:moveURL,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){Ext.getCmp(options.gridId).getStore().reload();PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:options.tabId},{n:'msg',o:'SAVESUCCESS'}]});}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'FilterEditor','moveRecUp()');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'FilterEditor','moveRecUp()');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'FilterEditor','moveRecUp()');}},tabId:tabId,gridId:gridId,params:{id:id,dir:'up'}});},moveRecDown:function(moveURL,id,gridId,tabId){store=Ext.getCmp(gridId).getStore();rec=store.getAt(store.getCount()-1);if(rec.get('id')==id){return;}
Ext.Ajax.request({url:moveURL,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){Ext.getCmp(options.gridId).getStore().reload();PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:options.tabId},{n:'msg',o:'SAVESUCCESS'}]});}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'FilterEditor','moveRecDown()');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'FilterEditor','moveRecDown()');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'FilterEditor','moveRecDown()');}},tabId:tabId,gridId:gridId,params:{id:id,dir:'down'}});},getGridImageField:function(config){html='<a href="#" onclick="'
+config.functionString
+';this.blur();return;" '
+'style="display:block;width:14px;height:14px;margin:0px;padding:0px;border:0px;vertical-align:middle;" '
+'class="'+config.iconCls+'"';if(config.qtip){html+='ext:qtip="'+config.qtip+'"';}
html+='/><img src="'+Ext.BLANK_IMAGE_URL
+'" width="1" height="1" border="0"/></a>';return html;},getContentTypeImageField:function(config){if(typeof(config.contentType)!='undefined'){contentTypeArray=config.contentType.split('.');iconCls=contentTypeArray.join('');}else{iconCls='na';}
html='<img src="'+Ext.BLANK_IMAGE_URL+'" ';html+='width="16" height="16" border="0" style="padding: 0px; margin: 0px;" ';html+='class="'+iconCls+'" ';html+='ext:qtip="<img src=\''
+Ext.BLANK_IMAGE_URL
+'\' '
+'width=\'16\' height=\'16\' border=\'0\' style=\'padding: 0px; margin: 0px;\' '
+'class=\''+iconCls+'\'/>"';html+='/>';return html;},getContentField:function(content){if(typeof(content.contentType)!='undefined'){contentTypeArray=content.contentType.split('.');iconCls=contentTypeArray.join('')+'_14';}else{iconCls='na_14';}
html='<div ';html+='ext:qtip="<img src=\''
+Ext.BLANK_IMAGE_URL
+'\' '
+'width=\'14\' height=\'14\' border=\'0\' style=\'padding:0px; margin:0px;margin-right:5px;vertical-align:middle;\' '
+'class=\''+iconCls+'\'/>'+content.contentType;if(typeof(content.localizationMap)!='undefined'){html+='<hr/><div style=\'font-weight:bold;\'>locales:</div>';for(i=0;i<content.localizationMap.length;i++){entry=content.localizationMap[i];html+='<div>locale: <b>'+entry.locale+'</b>, id: <b>'
+entry.id+'</b></div>';}}
html+='"><img src="'+Ext.BLANK_IMAGE_URL+'" ';html+='width="14" height="14" border="0" style="padding:0px;margin:0px;margin-right:5px;vertical-align:middle;" ';html+='class="'+iconCls+'"/>'+content.name;html+='</div>';return html;}};var FilterLocalizations={Filter:'filter',createFilter:'create filter',FilterRule:'filter-rule',createFilterRule:'create filter-rule',FilterMatch:'filter-match'};var FilterMatchesEditor={el:null,win:null,msgPanel:null,contentPanel:null,lastLoadConfig:null,matchEditor:null,addFilterMatch:function(config){ContentRegistryEditor.getSelectWindow({getChildrenURL:config.browseContentRegistryURL,selectCallback:function(node){Ext.Ajax.request({url:config.createURL,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){Ext.getCmp('grid.'+options.params.id+'.matches.grid').getStore().reload();FilterMatchesEditor.editFilterMatch(config.editURL,decodedResponse.id);}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'FilterMatchesEditor','addFilterMatch()');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'FilterMatchesEditor','addFilterMatch()');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'FilterMatchesEditor','addFilterMatch()');}},params:{id:config.filterId,contentid:node.attributes.contentId}});}});},removeFilterMatch:function(removeURL,matchId,gridId,tabId){Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE+':&#160;"'+matchId+'"',VIEWPORT_PROPERTIES.MSG_REALLYDELETE,function(response){if('yes'===response){Ext.Ajax.request({url:removeURL,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){Ext.getCmp(options.gridId).getStore().reload();PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:options.tabId},{n:'msg',o:'DELETESUCCESS'}]});}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'FilterMatchesEditor','removeFilterMatch()');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'FilterMatchesEditor','removeFilterMatch()');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'FilterMatchesEditor','removeFilterMatch()');}},gridId:gridId,tabId:tabId,params:{id:matchId}});}},this);},editFilterMatch:function(editURL,matchId){try{if(this.el===null){pel=VIEWPORT.getEl();if(typeof(pel)=='undefined'){throw('121 :: FilterMatchesEditor.editFilterMatch() :: '+'CHECK for element failed...');}
this.el=pel.createChild({tag:'div',id:'FilterMatchesEditorWindow.el'});}
this.msgPanel=new Ext.Panel({id:'FilterMatchesEditor.Win.msgPanel',html:'msgs go here',border:false,collapsed:true});this.contentPanel=new Ext.Panel({id:'FilterMatchesEditor.contentPanel',html:'content goes here',border:false});this.win=new Ext.Window({id:'FilterMatchesEditor.Win',title:'LOC: edit matches',iconCls:'contentFilterIconCls',maximizable:false,closable:true,plain:true,modal:true,autoScroll:true,renderTo:this.el,height:300,width:400,items:[this.msgPanel,this.contentPanel],tbar:[new Ext.Action({text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CANCEL,handler:function(){FilterMatchesEditor.win.close();},iconCls:'cancelIconCls'}),'-','->',new Ext.Action({text:VIEWPORT_PROPERTIES.BUTTON_TEXT_RELOAD,handler:function(){if(true===FilterMatchesEditor.contentPanel.getUpdater().isUpdating()){return;}
if(true===FilterMatchesEditor.win.isDirty){Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE,VIEWPORT_PROPERTIES.TEXT_UNSAVEDCHANGES+'<br />'+
VIEWPORT_PROPERTIES.TEXT_REALLYCONTINUE,function(response){if('yes'===response){FilterMatchesEditor.win.isDirty=false;FilterMatchesEditor.lastLoadConfig.callback=LPCB;FilterMatchesEditor.lastLoadConfig.timeout=30;if(false===FilterMatchesEditor.msgPanel.hidden){FilterMatchesEditor.msgPanel.collapse();}
FilterMatchesEditor.contentPanel.load(FilterMatchesEditor.lastLoadConfig);}},this);}else{FilterMatchesEditor.lastLoadConfig.callback=LPCB;FilterMatchesEditor.lastLoadConfig.timeout=30;if(false===FilterMatchesEditor.msgPanel.hidden){FilterMatchesEditor.msgPanel.collapse();}
FilterMatchesEditor.contentPanel.load(FilterMatchesEditor.lastLoadConfig);}},iconCls:'reloadIconCls'})]});this.msgPanel.hide();this.msgPanel.on('collapse',function(p){p.hide();});this.msgPanel.on('hide',function(){(function(){FilterMatchesEditor.win.fireEvent('resize',FilterMatchesEditor.win);}).defer(500);});this.win.setSize({width:VIEWPORT.getSize().width*0.8,height:VIEWPORT.getSize().height*0.8});this.win.show();this.win.setPosition(VIEWPORT.getSize().width*0.1,VIEWPORT.getSize().height*0.1);this.win.on({'beforeclose':{fn:function(win){if(true===win.isDirty){Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE,VIEWPORT_PROPERTIES.TEXT_UNSAVEDCHANGES+'<br />'+
VIEWPORT_PROPERTIES.TEXT_REALLYCONTINUE,function(response){if('yes'===response){win.isDirty=false;win.close();}},this);return false;}}}});this.lastLoadConfig={url:editURL,text:'loading...',scripts:true,callback:LPCB,params:{id:matchId},text:'loading...',discardUrl:true,nocache:true,timeout:30};this.contentPanel.load(this.lastLoadConfig);this.matchEditor=new FilterMatchesEditor.MatchEditor({matchId:matchId});}catch(windowInitError){alert('windowInitError: \n'+windowInitError);}},initFilterMatchEditor:function(config){Ext.getCmp('FilterMatchesEditor.Win').setTitle('('+config.id+') '+
FilterLocalizations.FilterMatch+': '+config.name);propertyGridRecord=new Ext.data.Record.create([{name:'id'},{name:'name'}]);propertyGridStore=new Ext.data.JsonStore({pruneModifiedRecords:true,fields:propertyGridRecord,root:'data',url:config.loadGridURL});propertyGridExpander=new Ext.grid.AjaxRowExpander({spanRows:'3',enableCaching:true,url:config.loadPropsURL,params:{id:config.id}});propertyGridCm=new Ext.grid.ColumnModel([propertyGridExpander,{id:'id',header:'id:',dataIndex:'id',sortable:true,width:30,fixed:true},{header:FilterLocalizations.FilterRule+':',dataIndex:'name'}]);propertyGrid=new Ext.grid.EditorGridPanel({id:'matchesProperties.grid',store:propertyGridStore,cm:propertyGridCm,renderTo:'grid.'+config.id+'.props',autoExpandColumn:'name',loadMask:true,viewConfig:{forceFit:true},plugins:propertyGridExpander,title:'LOC: match-properties',header:false,frame:false,enableHdMenu:false,bodyStyle:'border: 2px solid #8DB2E3;'});propertyGrid.setWidth(Ext.getCmp('FilterMatchesEditor.Win').getInnerWidth()-12);propertyGrid.setHeight(Ext.getCmp('FilterMatchesEditor.Win').getInnerHeight()-12-
Ext.get('FilterMatchEditor.'+config.id+'.header').getBox().height);Ext.getCmp('FilterMatchesEditor.Win').on({'resize':{fn:function(panel,adjWidth,adjHeight,rawWidth,rawHeight){propertyGrid=Ext.getCmp('matchesProperties.grid');propertyGrid.setWidth(panel.getInnerWidth()-12);propertyGrid.setHeight(panel.getInnerHeight()-12-
Ext.get('FilterMatchEditor.'+config.id+'.header').getBox().height);}}});propertyGridStore.load({params:{id:config.id}});winTBar=Ext.getCmp('FilterMatchesEditor.Win').getTopToolbar();if(true!==winTBar.isInitialized){winTBar.insertButton(0,[new Ext.Toolbar.Button(new Ext.Action({text:VIEWPORT_PROPERTIES.BUTTON_TEXT_SAVE,scope:Ext.getCmp('FilterMatchesEditor.Win'),handler:function(){if(true!==this.isDirty){return;}
if(false===FilterMatchesEditor.matchEditor.hasChanges()){PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'win'},{n:'id',o:this.id},{n:'msg',o:'SAVESUCCESS'}]});return;}
Ext.Ajax.request({url:config.saveMatchURL,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);options.win.enable();if(true===decodedResponse.status){options.win.isDirty=false;FilterMatchesEditor.matchEditor.clear();PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'win'},{n:'id',o:options.win.id},{n:'msg',o:'SAVESUCCESS'}]});}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'FilterMatchesEditor','saveChangesButton');}},failure:function(response,options){options.win.enable();if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'FilterMatchesEditor','saveChangesButton');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'FilterMatchesEditor','saveChangesButton');}},win:this,params:{data:FilterMatchesEditor.matchEditor.getChanges()}});},iconCls:'saveIconCls'})),new Ext.Toolbar.Separator()]);winTBar.isInitialized=true;}
return propertyGrid;},editMatch:function(domEl,ruleId){if(true===this.matchEditor.changeRule(ruleId,domEl)){PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'win'},{n:'id',o:'FilterMatchesEditor.Win'},{n:'msg',o:'change'}]});}}};FilterMatchesEditor.MatchEditor=function(config){this.id=config.matchId;this.changes={storeArray:[],push:function(ruleId){changesStore=new ChangesStore({id:ruleId});this.storeArray.push(changesStore);return changesStore;},get:function(id){for(this.i=0;this.i<this.storeArray.length;this.i++){if(this.storeArray[this.i].idv===id){return this.storeArray[this.i];}}},remove:function(id){array=[];chkChgObj=this.storeArray.shift();while(chkChgObj){if(chkChgObj.idv===id){delete chkChgObj;this.storeArray=this.storeArray.concat(array);return true;}
array.push(chkChgObj);chkChgObj=this.storeArray.shift();}
this.storeArray=this.storeArray.concat(array);return false;}};this.changeRule=function(ruleId,chkBoxDom){propId=Ext.get(chkBoxDom).getValue();if(typeof(this.changes.get(ruleId))=='undefined'){changesStore=this.changes.push(ruleId);return changesStore.push(new ChkBoxChange({id:propId,el:chkBoxDom}));}else{changesStore=this.changes.get(ruleId);bool=changesStore.push(new ChkBoxChange({id:propId,el:chkBoxDom}));if(false===bool){if(false===changesStore.hasChanges()){this.changes.remove(ruleId);}}
return bool;}};this.getId=function(){return this.id;};this.hasChanges=function(){if(this.changes.storeArray.length>0){return true;}else{return false;}};this.getChanges=function(bool){if(false===this.hasChanges()){json='{id:'+this.id+',data:[]}';}else{json='{id:'+this.id+',data:[';for(this.i=0;this.i<this.changes.storeArray.length;this.i++){changesStore=this.changes.storeArray[this.i];json+=changesStore.toJson(bool);if(typeof(this.changes.storeArray[this.i+1])!='undefined'){json+=',';}}
json+=']}';}
return json;};this.clear=function(){delete this.changes.storeArray;this.changes.storeArray=[];};};ChangesStore=function(config){this.id='ChangesStore.'+config.id;this.idv=config.id;this.storeArray=[];this.push=function(chgObj){for(this.i=0;this.i<this.storeArray.length;this.i++){if(this.storeArray[this.i].id===chgObj.id){chkChgObj=this.storeArray[this.i];if(true===chkChgObj.compareTo(chgObj)){delete chgObj;if(true===this.remove(chkChgObj.id)){return false;}else{throw(this.id+' remove-error');}}else{chkChgObj.apply(chgObj);delete chgObj;return true;}}}
this.storeArray.push(chgObj);return true;};this.remove=function(id){array=[];chkChgObj=this.storeArray.shift();while(chkChgObj){if(chkChgObj.id===id){delete chkChgObj;this.storeArray=this.storeArray.concat(array);return true;}
array.push(chkChgObj);chkChgObj=this.storeArray.shift();}
this.storeArray=this.storeArray.concat(array);return false;};this.get=function(id){for(this.i=0;this.i<this.storeArray.length;this.i++){if(this.storeArray[this.i].id===id){return this.storeArray[this.i];}}};this.hasChanges=function(){if(this.storeArray.length>0){return true;}else{return false;}};this.toJson=function(bool){if(true===bool){id=this.id;}else{id=this.idv;}
if(false===this.hasChanges()){js='{id:'+id+',data:[]}';}else{js='{id:'+id+',data:[';for(this.i=0;this.i<this.storeArray.length;this.i++){chgObj=this.storeArray[this.i];js+=chgObj.toJson(bool);if(typeof(this.storeArray[this.i+1])!='undefined'){js+=',';}}
js+=']}';}
return js;};};ChkBoxChange=function(config){this.id='ChkBoxChange.'+config.id;this.idv=config.id;this.value=config.el.checked;this.initialValue=!config.el.checked;this.compareTo=function(chkBoxChange){return(this.initialValue===chkBoxChange.value);};this.apply=function(chkBoxChange){this.value=chkBoxChange.value;this.initialValue=chkBoxChange.initialValue;};this.toJson=function(bool){if(true===bool){id=this.id;}else{id=this.idv;}
return'{id:'+id+',value:'+this.value+'}';};};var FilterRulesEditor={el:null,win:null,msgPanel:null,contentPanel:null,lastLoadConfig:null,createFilterRule:function(config){try{if(this.el===null){pel=VIEWPORT.getEl();if(typeof(pel)=='undefined'){throw('29 :: FilterRulesEditor.createFilterRule() :: '+'CHECK for element failed...');}
this.el=pel.createChild({tag:'div',id:'FilterRulesEditorWindow.el'});}
ruleNameField=new Ext.form.TextField({fieldLabel:VIEWPORT_PROPERTIES.NAME,name:'name',width:400,emptyText:VIEWPORT_PROPERTIES.TEXT_ENTER_NAME,allowBlank:false});formPanel=new Ext.form.FormPanel({id:'newRuleForm',name:'newRuleForm',region:'center',margins:'3 3 3 3',bodyStyle:'padding: 5px',defaultType:'textfield',autoHeight:true,items:[ruleNameField]});formPanel.addButton({text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CREATE,handler:function(){if(ruleNameField.getValue().trim()===''){return false;}
Ext.Ajax.request({url:config.createURL,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){FilterRulesEditor.win.close();FilterEditor.reloadRules(options.params.id);FilterRulesEditor.editFilterRule(config.editURL,decodedResponse.id);}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'FilterRulesEditor','createFilterRule()');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'FilterRulesEditor','createFilterRule()');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'FilterRulesEditor','createFilterRule()');}},params:{id:config.filterId,name:ruleNameField.getValue()}});}});formPanel.addButton({text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CANCEL,handler:function(){FilterRulesEditor.win.close();}});this.msgPanel=new Ext.Panel({id:'FilterRulesEditor.msgPanel',region:'north',html:'msgs go here',border:false,autoHeight:true});this.win=new Ext.Window({id:'FilterRulesEditor.Win',title:FilterLocalizations.createFilterRule,iconCls:'contentFilterIconCls',modal:true,plain:true,renderTo:this.el,height:130,layout:'border',items:[this.msgPanel,formPanel],width:600});this.msgPanel.hide();this.msgPanel.collapse();this.msgPanel.on('hide',function(){FilterRulesEditor.win.doLayout(true);});this.win.setPagePosition((VIEWPORT.getSize().width/2)-300,100);this.win.show(this);ruleNameField.validate();}catch(windowInitError){alert('windowInitError: \n'+windowInitError);}},editFilterRule:function(editURL,ruleId){try{if(this.el===null){pel=VIEWPORT.getEl();if(typeof(pel)=='undefined'){throw('156 :: FilterRulesEditor.editFilterRule() :: '+'CHECK for element failed...');}
this.el=pel.createChild({tag:'div',id:'FilterRulesEditorWindow.el'});}
this.msgPanel=new Ext.Panel({id:'FilterRulesEditor.Win.msgPanel',html:'msgs go here',border:false,collapsed:true});this.contentPanel=new Ext.Panel({id:'FilterRulesEditor.contentPanel',html:'content goes here',border:false});this.win=new Ext.Window({id:'FilterRulesEditor.Win',title:'LOC: edit rule',iconCls:'contentFilterIconCls',maximizable:false,closable:true,plain:true,modal:true,autoScroll:true,renderTo:this.el,height:300,width:400,items:[this.msgPanel,this.contentPanel],tbar:[new Ext.Action({text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CANCEL,handler:function(){FilterRulesEditor.win.close();},iconCls:'cancelIconCls'}),'-','->',new Ext.Action({text:VIEWPORT_PROPERTIES.BUTTON_TEXT_RELOAD,handler:function(){if(true===FilterRulesEditor.contentPanel.getUpdater().isUpdating()){return;}
if(true===FilterRulesEditor.win.isDirty){Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE,VIEWPORT_PROPERTIES.TEXT_UNSAVEDCHANGES+'<br />'+
VIEWPORT_PROPERTIES.TEXT_REALLYCONTINUE,function(response){if('yes'===response){FilterRulesEditor.win.isDirty=false;FilterRulesEditor.lastLoadConfig.callback=LPCB;FilterRulesEditor.lastLoadConfig.timeout=30;if(false===FilterRulesEditor.msgPanel.hidden){FilterRulesEditor.msgPanel.collapse();}
FilterRulesEditor.contentPanel.load(FilterRulesEditor.lastLoadConfig);}},this);}else{FilterRulesEditor.lastLoadConfig.callback=LPCB;FilterRulesEditor.lastLoadConfig.timeout=30;if(false===FilterRulesEditor.msgPanel.hidden){FilterRulesEditor.msgPanel.collapse();}
FilterRulesEditor.contentPanel.load(FilterRulesEditor.lastLoadConfig);}},iconCls:'reloadIconCls'})]});this.msgPanel.hide();this.msgPanel.on('collapse',function(p){p.hide();});this.msgPanel.on('hide',function(){(function(){FilterRulesEditor.win.fireEvent('resize',FilterRulesEditor.win);}).defer(500);});this.win.setSize({width:VIEWPORT.getSize().width*0.8,height:VIEWPORT.getSize().height*0.8});this.win.show();this.win.setPosition(VIEWPORT.getSize().width*0.1,VIEWPORT.getSize().height*0.1);this.win.on({'beforeclose':{fn:function(win){if(true===win.isDirty){Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE,VIEWPORT_PROPERTIES.TEXT_UNSAVEDCHANGES+'<br />'+
VIEWPORT_PROPERTIES.TEXT_REALLYCONTINUE,function(response){if('yes'===response){win.isDirty=false;win.close();}},this);return false;}}}});this.lastLoadConfig={url:editURL,scripts:true,callback:LPCB,params:{id:ruleId},text:'loading...',discardUrl:true,nocache:true,timeout:30};this.contentPanel.load(this.lastLoadConfig);}catch(windowInitError){alert('windowInitError: \n'+windowInitError);}},initFilterRuleEditor:function(config){Ext.getCmp('FilterRulesEditor.Win').setTitle(config.name);nameEl=Ext.get(config.ruleclass+'.'+config.id+'.name');nameEl.on('keyup',function(){if(this.dom.value===''){this.replaceClass('editorInputField','editorInputFieldRed');this.replaceClass('editorInputFieldYellow','editorInputFieldRed');}else{this.replaceClass('editorInputField','editorInputFieldYellow');this.replaceClass('editorInputFieldRed','editorInputFieldYellow');}
PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'win'},{n:'id',o:'FilterRulesEditor.Win'},{n:'msg',o:'change'}]});},nameEl);ruleGrid=this.buildRuleLocGrid({id:config.id,url:config.loadRuleLocsURL});propGrid=LocalizationGrid.getGrid({id:'FilterRulePropertyGrid.grid',renderTo:'grid.'+config.id+'.props',header:false,frame:false,style:'border: 1px solid #8DB2E3;',url:config.loadPropsURL,createURL:config.createPropURL,removeURL:config.removePropURL,moveURL:config.movePropURL,params:{id:config.id},handleId:'FilterRulesEditor.Win',handleType:'win',resizeHels:['FilterRuleEditor.'+config.id+'.container']});winTBar=Ext.getCmp('FilterRulesEditor.Win').getTopToolbar();if(true!==winTBar.isInitialized){winTBar.insertButton(0,[new Ext.Toolbar.Button(new Ext.Action({text:VIEWPORT_PROPERTIES.BUTTON_TEXT_SAVE,scope:Ext.getCmp('FilterRulesEditor.Win'),handler:function(){if(true!==this.isDirty){return;}
nameEl=Ext.get(config.ruleclass+'.'+config.id+'.name');name=nameEl.getValue().trim();if(name===''){return;}
ruleStore=ruleGrid.getStore();propStore=propGrid.getStore();this.disable();modifiedRules=ruleStore.getModifiedRecords();rules=[];for(i=0;i<modifiedRules.length;i++){rule=modifiedRules[i];rules.push(Ext.encode({'lang':rule.get('lang'),'localization':rule.get('localization')}));}
encodedRules='{rules:['+rules.concat(',')+']}';modifiedProps=propStore.getModifiedRecords();props=[];for(i=0;i<modifiedProps.length;i++){prop=modifiedProps[i];props.push(Ext.encode({'id':prop.get('id'),'name':prop.get('name'),'langOne':prop.get('langOne'),'valueOne':prop.get('valueOne'),'langTwo':prop.get('langTwo'),'valueTwo':prop.get('valueTwo')}));}
encodedProps='{props:['+props.concat(',')+']}';Ext.Ajax.request({url:config.saveRuleURL,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);options.win.enable();if(true===decodedResponse.status){options.win.isDirty=false;options.win.setTitle(options.params.name);options.nameEl.replaceClass('editorInputFieldRed','editorInputField');options.nameEl.replaceClass('editorInputFieldYellow','editorInputField');options.ruleStore.commitChanges();options.propStore.commitChanges();PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'win'},{n:'id',o:options.win.id},{n:'msg',o:'SAVESUCCESS'}]});}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'FilterRulesEditor','saveChangesButton');}},failure:function(response,options){options.win.enable();if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'FilterRulesEditor','saveChangesButton');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'FilterRulesEditor','saveChangesButton');}},win:this,nameEl:nameEl,ruleStore:ruleStore,propStore:propStore,params:{id:config.id,name:name,rules:encodedRules,props:encodedProps}});},iconCls:'saveIconCls'})),new Ext.Toolbar.Separator()]);winTBar.isInitialized=true;}},buildRuleLocGrid:function(config){gridStoreRecord=new Ext.data.Record.create([{name:'lang'},{name:'localization'}]);gridStore=new Ext.data.JsonStore({pruneModifiedRecords:true,fields:gridStoreRecord,root:'data',url:config.url});langFieldRenderer=function(lang){return'<span style="font-weight:bold;">'+VIEWPORT_PROPERTIES.getLanguage(lang)+'</span>';};gridCm=new Ext.grid.ColumnModel([{id:'lang',header:VIEWPORT_PROPERTIES.LANGUAGE+':',dataIndex:'lang',sortable:true,width:20,renderer:langFieldRenderer},{header:VIEWPORT_PROPERTIES.LOCALIZATIONS+':',dataIndex:'localization',sortable:false,editor:new Ext.form.TextField({allowBlank:true})}]);grid=new Ext.grid.EditorGridPanel({id:'FilterRuleGrid.grid',store:gridStore,cm:gridCm,renderTo:'grid.'+config.id+'.rule',autoExpandColumn:'localization',height:100,loadMask:true,viewConfig:{forceFit:true},title:'LOC: rule-localizations',header:false,frame:false,enableHdMenu:false,bodyStyle:'border: 2px solid #8DB2E3;',clicksToEdit:1});grid.setWidth(Ext.getCmp('FilterRulesEditor.Win').getInnerWidth()-12);Ext.getCmp('FilterRulesEditor.Win').on({'resize':{fn:function(panel,adjWidth,adjHeight,rawWidth,rawHeight){grid=Ext.getCmp('FilterRuleGrid.grid');grid.setWidth(panel.getInnerWidth()-12);}}});grid.on('afteredit',function(){PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'win'},{n:'id',o:'FilterRulesEditor.Win'},{n:'msg',o:'CHANGE'}]});});gridStore.load({params:{id:config.id}});return grid;}};DBG.FilterContentEditor=DBG.apply(DBG.ContentEditor,{initFieldMonitoring:{FilterContentEditor:false},addSubEditor:{FilterContentEditor:false},hasChanges:{FilterContentEditor:false},initTab:false,MSG:false});FilterContentEditor={type:'FilterContentEditor',DBG:false,getCreateCopyButtonConfig:function(){return{text:VIEWPORT_PROPERTIES.COPYCONTENT,disabled:true,scope:this,handler:function(){this.selectCopyCallback=function(node){Ext.Ajax.request({url:this.copyContentURL,scope:this,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){panel=Ext.getCmp(this.getContent().clazz+'.'+this.getContent().id+'.contentLocalizationMap.panel');panel.lastLoadConfig.callback=LPCB;panel.lastLoadConfig.timeout=30;panel.load(panel.lastLoadConfig);crPanel=Ext.getCmp('ContentRegistry.WEST');crPanel.expand();path=decodedResponse.expandPath;ContentRegistryEditor.expandByIds(ContentRegistryTree.getRootNode(),path,function(node){ContentRegistryEditor.editNode(node);});}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this,'tbar.copy');}
delete this.selectCopyCallback;},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this,'tbar.copy');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this,'tbar.copy');}
delete this.selectCopyCallback;},params:{id:this.getContent().id,toid:node.attributes.id}});};windowCfg={getChildrenURL:this.browseContentRegistryURL+'?mode=folder&bundle='+this.getContent().bundle,emptyText:VIEWPORT_PROPERTIES.TEXT_CHOOSE_FOLDER,scope:this,selectCallback:'selectCopyCallback'};ContentRegistryEditor.getSelectWindow(windowCfg);},iconCls:'copyIconCls'};},getSaveContentButtonConfig:function(){return{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_SAVE,disabled:true,scope:this,handler:function(){if(false===this.hasChanges()){this.reset();return;}
saveValues=this.getChanges({id:this.getContent().id});if(typeof(saveValues)=='undefined'||saveValues===null){if(this.DBG){THROW({e:'NO VALUES TO SAVE THOUGH THERE ARE CHANGES',args:[this.hasChanges(),saveValues]},this,'saveContentButton');}
return;}
this.tab.disable();Ext.Ajax.request({url:this.saveContentURL,method:'POST',scope:this,success:function(response,options){this.tab.enable();decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){this.commit();(function(){this.fireEvent('MSG','savesuccess',this);}).defer(250,this);}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this.type,'tbar.save');}},failure:function(response,options){this.tab.enable();if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this.type,'tbar.save');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this.type,'tbar.save');}},params:saveValues});},iconCls:'saveIconCls'};},getFindButtonConfig:function(){return{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_FIND,disabled:true,scope:this,handler:function(){Ext.Ajax.request({url:this.contentExpandPathURL,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){crPanel=Ext.getCmp('ContentRegistry.WEST');if(typeof(crPanel)=='undefined'||crPanel===null){PULSE_TOOLBAR.openPanel({id:'ContentRegistry.WEST',callback:function(){ContentRegistryEditor.expandByIds(ContentRegistryTree.getRootNode(),decodedResponse.ids);}});return;}
crPanel.expand();ContentRegistryEditor.expandByIds(ContentRegistryTree.getRootNode(),decodedResponse.ids);}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this.type,'tbar.find');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this.type,'tbar.find');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this.type,'tbar.find');}},params:{id:this.getContent().id}});},iconCls:'findIconCls'};},initTab:function(){if(this.DBG){THROW({props:['tab','tab.id']},this,'initTab');}
try{if(typeof(this.tab)!='object'||this.tab===null){THROW({e:'TAB UNDEFINED OR NULL: "['+this.tab+']"'},this,'initTab');return;}
if(true!==this.tab.isInitialized){buttons=[];saveContentButtonConfig=this.getSaveContentButtonConfig();if(typeof(this.saveContentURL)=='string'&&this.saveContentURL!==''){saveContentButtonConfig.disabled=false;saveContentButtonConfig.scope=this;}
buttons.push(saveContentButtonConfig);buttons.push(new Ext.Toolbar.Separator());createCopyButtonConfig=this.getCreateCopyButtonConfig();if(typeof(this.copyContentURL)=='string'&&this.copyContentURL!==''){createCopyButtonConfig.disabled=false;createCopyButtonConfig.scope=this;}
buttons.push(createCopyButtonConfig);buttons.push(new Ext.Toolbar.Separator());findButtonConfig=this.getFindButtonConfig();if(typeof(this.contentExpandPathURL)=='string'&&this.contentExpandPathURL!==''){findButtonConfig.disabled=false;findButtonConfig.scope=this;}
buttons.push(findButtonConfig);buttons.push(new Ext.Toolbar.Separator());this.tab.getTopToolbar().insertButton(0,buttons);this.tab.isInitialized=true;}}catch(e){FATAL(e,this,'initTab');}},selectFilter:function(id,clazz){try{pel=VIEWPORT.getEl();if(typeof(pel)=='undefined'){throw('172 :: FilterContentEditor.selectFilter() :: '+'CHECK for element failed...');}
namePanel=new Ext.Panel({region:'south',margins:'3 3 3 3',bodyStyle:'padding: 5px',autoHeight:true,html:'<table cellpadding="0" cellspacing="0" border="0" style="width:90%" align="center"><tr>'+'<td>'+VIEWPORT_PROPERTIES.NAME+':&#160;</td>'+'<td style="width:100%"><div id="'+this.id+'.filterNameField"> </div></td>'+'</tr></table>'});if(this.el===null){this.el=pel.createChild({tag:'div',id:this.id+'.el'});}
this.centerPanel=new Ext.Panel({region:'center',margins:'3 3 0 3',html:'<div id="'+this.id+'.grid.el"> </div>'});addButtonCfg={text:VIEWPORT_PROPERTIES.BUTTON_TEXT_ASSIGN,scope:this,handler:function(){if(this.selectedRecord===null){return false;}
Ext.Ajax.request({url:this.addFilterURL,scope:this,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){this.reloadFilter(id);PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:clazz+'.'+id+'.editor'},{n:'msg',o:'SAVESUCCESS'}]});}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'FilterContentEditor','selectFilter()');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'FilterContentEditor','selectFilter()');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'FilterContentEditor','selectFilter()');}},params:{id:id,filterid:this.selectedRecord.get('id')}});this.win.close();}};cancelButtonCfg={text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CANCEL,scope:this,handler:function(){this.win.close();}};this.win=new Ext.Window({id:this.id+'.win',title:VIEWPORT_PROPERTIES.TEXT_CHOOSE_FILTER,iconCls:'contentFilterIconCls',modal:true,plain:true,renderTo:this.el,height:500,layout:'border',items:[this.centerPanel,namePanel],width:450,buttonAlign:'center',buttons:[addButtonCfg,cancelButtonCfg]});this.win.on('close',function(){delete this.centerPanel;delete this.overViewGrid;this.centerPanel=null;this.overViewGrid=null;},this);this.win.on('show',function(){this.filterNameField=new Ext.form.TextField({name:this.id+'.filterNameField.name',renderTo:this.id+'.filterNameField',style:'width:100%',emptyText:VIEWPORT_PROPERTIES.TEXT_CHOOSE_FILTER,allowBlank:false,readOnly:true});this.filterNameField.validate();overViewGridCfg={gridId:this.id+'.grid',loadFiltersURL:this.loadFiltersURL};this.overViewGrid=FilterEditor.initOverViewEditor(overViewGridCfg);sm=this.overViewGrid.getSelectionModel();sm.on('rowSelect',function(sm,index,record){this.filterNameField.setValue(record.get('name'));this.selectedRecord=record;},this);this.win.doLayout(true);this.overViewGrid.setHeight(this.centerPanel.getInnerHeight()-2);},this);this.win.on('resize',function(){if(typeof(this.overViewGrid)=='object'&&this.overViewGrid!==null){this.overViewGrid.setHeight(this.centerPanel.getInnerHeight()-2);this.overViewGrid.setWidth(this.centerPanel.getInnerWidth()-2);}},this);this.win.setPagePosition((VIEWPORT.getSize().width/2)-200,50);this.win.show(this);}catch(e){alert('windowInitError: \n'+e);}},removeFilter:function(id,clazz){Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE+':&#160;',VIEWPORT_PROPERTIES.MSG_REALLYREMOVE,function(response){if('yes'===response){Ext.Ajax.request({url:this.removeFilterURL,scope:this,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){this.reloadFilter(id);PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:clazz+'.'+id+'.editor'},{n:'msg',o:'DELETESUCCESS'}]});}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'FilterContentEditor','removeFilter()');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'FilterContentEditor','removeFilter()');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'FilterContentEditor','removeFilter()');}},params:{id:id}});}},this);},editFilter:function(id){FilterEditor.editFilter(this.editFilterURL,id);},reloadFilter:function(id){filterEl=Ext.get('FilterContentEditor.'+id+'.filterWrapper');filterEl.getUpdater().update({url:this.loadFilterURL,method:'POST',callback:LPCB,params:{id:id},text:'loading...',discardUrl:true,nocache:true,timeout:30});},initFieldMonitoring:function(){if(this.DBG){THROW({args:arguments},this,'initFieldMonitoring');}
try{Pulse.FilterContentEditor.superclass.initFieldMonitoring.call(this);}catch(e){if(this.DBG){FATAL(e,this,'initFieldMonitoring');}}},initComponent:function(boolInitTab){Pulse.FilterContentEditor.superclass.initComponent.call(this);try{this.initFieldMonitoring();if(false!==boolInitTab){this.initTab();}}catch(e){FATAL(e,this,'initComponent.FilterContentEditor');}}};Pulse.FilterContentEditor=Ext.extend(Pulse.ContentEditor,FilterContentEditor);DBG.URLContentEditor=DBG.apply(DBG.ContentEditor,{initFieldMonitoring:{URLContentEditor:true},addSubEditor:{URLContentEditor:false},hasChanges:{URLContentEditor:false},initURLMonitor:true,initTab:false,MSG:false});URLContentEditor={type:'URLContentEditor',DBG:false,getCreateCopyButtonConfig:function(){return{text:VIEWPORT_PROPERTIES.COPYCONTENT,disabled:true,scope:this,handler:function(){this.selectCopyCallback=function(node){Ext.Ajax.request({url:this.copyContentURL,scope:this,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){panel=Ext.getCmp(this.getContent().clazz+'.'+this.getContent().id+'.contentLocalizationMap.panel');panel.lastLoadConfig.callback=LPCB;panel.lastLoadConfig.timeout=30;panel.load(panel.lastLoadConfig);crPanel=Ext.getCmp('ContentRegistry.WEST');crPanel.expand();path=decodedResponse.expandPath;ContentRegistryEditor.expandByIds(ContentRegistryTree.getRootNode(),path,function(node){ContentRegistryEditor.editNode(node);});}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this,'tbar.copy');}
delete this.selectCopyCallback;},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this,'tbar.copy');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this,'tbar.copy');}
delete this.selectCopyCallback;},params:{id:this.getContent().id,toid:node.attributes.id}});};windowCfg={getChildrenURL:this.browseContentRegistryURL+'?mode=folder&bundle='+this.getContent().bundle,emptyText:VIEWPORT_PROPERTIES.TEXT_CHOOSE_FOLDER,scope:this,selectCallback:'selectCopyCallback'};ContentRegistryEditor.getSelectWindow(windowCfg);},iconCls:'copyIconCls'};},getSaveContentButtonConfig:function(){return{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_SAVE,disabled:true,scope:this,handler:function(){if(false===this.hasChanges()){this.reset();return;}
saveValues=this.getChanges({id:this.getContent().id});if(typeof(saveValues)=='undefined'||saveValues===null){if(this.DBG){THROW({e:'NO VALUES TO SAVE THOUGH THERE ARE CHANGES',args:[this.hasChanges(),saveValues]},this,'saveContentButton');}
return;}
this.tab.disable();Ext.Ajax.request({url:this.saveContentURL,method:'POST',scope:this,success:function(response,options){this.tab.enable();decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){this.commit();(function(){this.fireEvent('MSG','savesuccess',this);}).defer(250,this);}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this.type,'tbar.save');}},failure:function(response,options){this.tab.enable();if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this.type,'tbar.save');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this.type,'tbar.save');}},params:saveValues});},iconCls:'saveIconCls'};},getFindButtonConfig:function(){return{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_FIND,disabled:true,scope:this,handler:function(){Ext.Ajax.request({url:this.contentExpandPathURL,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){crPanel=Ext.getCmp('ContentRegistry.WEST');if(typeof(crPanel)=='undefined'||crPanel===null){PULSE_TOOLBAR.openPanel({id:'ContentRegistry.WEST',callback:function(){ContentRegistryEditor.expandByIds(ContentRegistryTree.getRootNode(),decodedResponse.ids);}});return;}
crPanel.expand();ContentRegistryEditor.expandByIds(ContentRegistryTree.getRootNode(),decodedResponse.ids);}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this.type,'tbar.find');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this.type,'tbar.find');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this.type,'tbar.find');}},params:{id:this.getContent().id}});},iconCls:'findIconCls'};},initTab:function(){if(this.DBG){THROW({props:['tab','tab.id']},this,'initTab');}
try{if(typeof(this.tab)!='object'||this.tab===null){THROW({e:'TAB UNDEFINED OR NULL: "['+this.tab+']"'},this,'initTab');return;}
if(true!==this.tab.isInitialized){buttons=[];saveContentButtonConfig=this.getSaveContentButtonConfig();if(typeof(this.saveContentURL)=='string'&&this.saveContentURL!==''){saveContentButtonConfig.disabled=false;saveContentButtonConfig.scope=this;}
buttons.push(saveContentButtonConfig);buttons.push(new Ext.Toolbar.Separator());createCopyButtonConfig=this.getCreateCopyButtonConfig();if(typeof(this.copyContentURL)=='string'&&this.copyContentURL!==''){createCopyButtonConfig.disabled=false;createCopyButtonConfig.scope=this;}
buttons.push(createCopyButtonConfig);buttons.push(new Ext.Toolbar.Separator());findButtonConfig=this.getFindButtonConfig();if(typeof(this.contentExpandPathURL)=='string'&&this.contentExpandPathURL!==''){findButtonConfig.disabled=false;findButtonConfig.scope=this;}
buttons.push(findButtonConfig);buttons.push(new Ext.Toolbar.Separator());this.tab.getTopToolbar().insertButton(0,buttons);this.tab.isInitialized=true;}}catch(e){FATAL(e,this,'initTab');}},initURLMonitor:function(el){if(this.DBG){THROW({args:arguments},this,'initURLMonitor');}
try{this.urlEl=(typeof(el)!='undefined'&&el!==null)?el:Ext.get(this.getContent().clazz+'.'+this.getContent().id+'.url');if(typeof(this.urlEl)=='undefined'&&this.urlEl===null){if(this.DBG){FATAL('ELEMENT UNDEFINED',this,'initURLMonitor');}
return;}
urlMonitorCFG={id:this.id+'.urlEditor',el:this.urlEl};this.urlMonitor=new Pulse.FieldMonitor(urlMonitorCFG);this.urlMonitor.validate();this.addSubEditor(this.urlMonitor);}catch(e){if(this.DBG){FATAL(e,this,'initURLMonitor');}}},initFieldMonitoring:function(){if(this.DBG){THROW({args:arguments},this,'initFieldMonitoring');}
try{Pulse.URLContentEditor.superclass.initFieldMonitoring.call(this);this.initURLMonitor();}catch(e){if(this.DBG){FATAL(e,this,'initFieldMonitoring');}}},initComponent:function(boolInitTab){Pulse.URLContentEditor.superclass.initComponent.call(this,boolInitTab);try{this.initFieldMonitoring();if(false!==boolInitTab){this.initTab();}}catch(e){FATAL(e,this,'initComponent.URLContentEditor');}}};Pulse.URLContentEditor=Ext.extend(Pulse.ContentEditor,URLContentEditor);Pulse.CountrySelector=function(config){this.type='CountrySelector';this.id=(typeof(config.id)=='undefined')?Ext.id():config.id;if(typeof(config.store)=='undefined'){props=DBG.getPropertyArray(config);FATAL({args:arguments,props:props},this,'constructor');}
this.store=config.store;if(false!==config.listener){this.store.on('beforeload',function(store,opts){opts.params.country=this.getCountry();},this);}
this.countryStore=new Ext.data.SimpleStore({fields:['country'],sortInfo:{field:'country',direction:"ASC"},data:(typeof(config.data)!='undefined')?config.data:VIEWPORT_PROPERTIES.getKnownCountriesForBox()});this.box=new Ext.form.ComboBox({store:this.countryStore,displayField:'country',valueField:'country',mode:'local',triggerAction:'all',editable:false,width:120,emptyText:VIEWPORT_PROPERTIES.TEXT_SELECTCOUNTRY_BOX});this.handler=config.handler;this.scope=config.scope;if(typeof(this.handler!='undefined')){this.box.on('select',function(){if(typeof(this.handler)=='function'){this.handler(this);}else if(typeof(this.handler)=='string'&&typeof(this.scope)=='object'){this.scope[this.handler](this);}else{FATAL(this,this,'handler','EXCEPTION');}},this);}
this.items=[this.box];this.loadButton=new Ext.Toolbar.Button({tooltip:VIEWPORT_PROPERTIES.BUTTON_TEXT_LOAD,text:VIEWPORT_PROPERTIES.BUTTON_TEXT_LOAD,iconCls:'reloadIconCls',handler:function(){this.store.reload();},scope:this});this.items.push('&#160;');this.items.push(this.loadButton);};Pulse.CountrySelector.prototype={getCountry:function(){return this.box.getValue();},reset:function(){this.box.reset();}};DBG.DurationEditor=DBG.apply(DBG.Editor,{initComponent:{DurationEditor:false},onRender:false});DurationEditor={type:'DurationEditor',DBG:DBG.DurationEditor,twentyFour:[[0],[1],[2],[3],[4],[5],[6],[7],[8],[9],[10],[11],[12],[13],[14],[15],[16],[17],[18],[19],[20],[21],[22],[23]],sixty:[[0],[1],[2],[3],[4],[5],[6],[7],[8],[9],[10],[11],[12],[13],[14],[15],[16],[17],[18],[19],[20],[21],[22],[23],[24],[25],[26],[27],[28],[29],[30],[31],[32],[33],[34],[35],[36],[37],[38],[39],[40],[41],[42],[43],[44],[45],[46],[47],[48],[49],[50],[51],[52],[53],[54],[55],[56],[57],[58],[59]],defaultTimeZone:'UTC',getButtons:function(){removeDurationButtonCFG={scope:this,disabled:true,text:VIEWPORT_PROPERTIES.BUTTON_TEXT_REMOVE,iconCls:'deleteIconCls',handler:this.removeDuration};if(typeof(this.removeDurationURL)=='string'&&this.removeDurationURL!==''){removeDurationButtonCFG.disabled=false;}
return[new Ext.Toolbar.Button(removeDurationButtonCFG),new Ext.Toolbar.Separator()];},removeDuration:function(){Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE+':',VIEWPORT_PROPERTIES.MSG_REALLYDELETE,function(response){if('yes'===response){this.masterEditor.disable();requestCFG={url:this.removeDurationURL,scope:this,method:'POST',success:function(response,options){this.masterEditor.enable();decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){this.masterEditor.loadPanel();(function(){this.fireEvent('MSG','savesuccess',this);}).defer(500,this);}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this,'deleteSectionTag');}},failure:function(response,options){this.masterEditor.enable();if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this,'deleteSectionTag');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this,'deleteSectionTag');}},params:{id:this.entity.id}};Ext.Ajax.request(requestCFG);}},this);},hasChanges:function(){if(true===this.aSelectionHasBeenMade&&false===this.initialDurationSet){return true;}
return(this.startHasChanges()||this.endHasChanges());},startHasChanges:function(){return(this.startDateEditor.hasChanges(this.duration.startDateDate)||this.startTimeZoneEditor.hasChanges(this.duration.startTimeZone)||this.startTimeHRSEditor.hasChanges(this.duration.startTime.HRS)||this.startTimeMINSEditor.hasChanges(this.duration.startTime.MINS)||this.startTimeSECSEditor.hasChanges(this.duration.startTime.SECS));},endHasChanges:function(){return(this.endDateEditor.hasChanges(this.duration.endDateDate)||this.endTimeZoneEditor.hasChanges(this.duration.endTimeZone)||this.endTimeHRSEditor.hasChanges(this.duration.endTime.HRS)||this.endTimeMINSEditor.hasChanges(this.duration.endTime.MINS)||this.endTimeSECSEditor.hasChanges(this.duration.endTime.SECS));},getChanges:function(v){if(false===this.hasChanges()){return v;}
if(typeof(v)=='undefined'){v={};}
if(true===this.startHasChanges()||true===this.endHasChanges()||true===this.aSelectionHasBeenMade){startDt=this.startDateEditor.getValue();v.start_YYYY=1900+startDt.getYear();v.start_MM=startDt.getMonth();v.start_DD=startDt.getDate();v.start_tz=this.startTimeZoneEditor.getValue();v.start_hh=this.startTimeHRSEditor.getValue();v.start_mm=this.startTimeMINSEditor.getValue();v.start_ss=this.startTimeSECSEditor.getValue();endDt=this.endDateEditor.getValue();v.end_YYYY=1900+endDt.getYear();v.end_MM=endDt.getMonth();v.end_DD=endDt.getDate();v.end_tz=this.endTimeZoneEditor.getValue();v.end_hh=this.endTimeHRSEditor.getValue();v.end_mm=this.endTimeMINSEditor.getValue();v.end_ss=this.endTimeSECSEditor.getValue();}
return v;},commit:function(){if(false===this.fireEvent('MSG','beforecommit',this)){return false;}
if(true===this.startHasChanges()||true===this.endHasChanges()||true===this.aSelectionHasBeenMade){this.aSelectionHasBeenMade=false;this.duration.startDateDate=this.startDateEditor.getValue();this.duration.startDate.y=this.duration.startDateDate.getYear();this.duration.startDate.m=this.duration.startDateDate.getMonth();this.duration.startDate.d=this.duration.startDateDate.getDate();this.duration.startTimeZone=this.startTimeZoneEditor.getValue();this.duration.startTime.HRS=this.startTimeHRSEditor.getValue();this.duration.startTime.MINS=this.startTimeMINSEditor.getValue();this.duration.startTime.SECS=this.startTimeSECSEditor.getValue();this.duration.endDateDate=this.endDateEditor.getValue();this.duration.endDate.y=this.duration.endDateDate.getYear();this.duration.endDate.m=this.duration.endDateDate.getMonth();this.duration.endDate.d=this.duration.endDateDate.getDate();this.duration.endTimeZone=this.endTimeZoneEditor.getValue();this.duration.endTime.HRS=this.endTimeHRSEditor.getValue();this.duration.endTime.MINS=this.endTimeMINSEditor.getValue();this.duration.endTime.SECS=this.endTimeSECSEditor.getValue();this.masterEditor.loadPanel();}
this.fireEvent('MSG','commit',this);},reset:function(){if(false===this.fireEvent('MSG','beforereset',this)){return false;}
this.aSelectionHasBeenMade=false;if(this.startDateEditor.hasChanges(this.duration.startDateDate)){this.startDateEditor.setValue(this.duration.startDateDate);}
if(this.endDateEditor.hasChanges(this.duration.endDateDate)){this.endDateEditor.setValue(this.duration.endDateDate);}
if(this.startTimeZoneEditor.hasChanges(this.duration.startTimeZone)){this.startTimeZoneEditor.setValue(this.duration.startTimeZone);}
if(this.endTimeZoneEditor.hasChanges(this.duration.endTimeZone)){this.endTimeZoneEditor.setValue(this.duration.endTimeZone);}
if(this.startTimeHRSEditor.hasChanges(this.duration.startTime.HRS)){this.startTimeHRSEditor.setValue(this.duration.startTime.HRS);}
if(this.endTimeHRSEditor.hasChanges(this.duration.endTime.HRS)){this.endTimeHRSEditor.setValue(this.duration.endTime.HRS);}
if(this.startTimeMINSEditor.hasChanges(this.duration.startTime.MINS)){this.startTimeMINSEditor.setValue(this.duration.startTime.MINS);}
if(this.endTimeMINSEditor.hasChanges(this.duration.endTime.MINS)){this.endTimeMINSEditor.setValue(this.duration.endTime.MINS);}
if(this.startTimeSECSEditor.hasChanges(this.duration.startTime.SECS)){this.startTimeSECSEditor.setValue(this.duration.startTime.SECS);}
if(this.endTimeSECSEditor.hasChanges(this.duration.endTime.SECS)){this.endTimeSECSEditor.setValue(this.duration.endTime.SECS);}
this.fireEvent('MSG','reset',this);},onRender:function(){if(this.DBG){THROW({props:['renderTo'],args:arguments},this,'onRender');}
try{}catch(e){FATAL(e,this,'onRender');}},buildDatePickers:function(startDate,endDate){renderTo=this.entity.clazz+'.'+this.entity.id
+'.durationEditor.';startDateEditorCFG=this.getDatePickerCFG(renderTo+'startDate');startDateEditorCFG.durationType='startDate';if(typeof(startDate)!='undefined'&&startDate!==null){startDateEditorCFG.value=startDate;}
this.startDateEditor=new Ext.DatePicker(startDateEditorCFG);if(typeof(startDate)!='undefined'&&startDate!==null){this.startDateEditor.setValue(startDate);}
this.initSelectListener('startDateEditor');endDateEditorCFG=this.getDatePickerCFG(renderTo+'endDate');endDateEditorCFG.durationType='endDate';if(typeof(endDate)!='undefined'&&endDate!==null){endDateEditorCFG.value=endDate;}
this.endDateEditor=new Ext.DatePicker(endDateEditorCFG);if(typeof(endDate)!='undefined'&&endDate!==null){this.endDateEditor.setValue(endDate);}
this.initSelectListener('endDateEditor');},getDatePickerCFG:function(renderTo){return{renderTo:renderTo,hasChanges:function(value){setyear=this.getValue();return((value.getYear()!=setyear.getYear())||(value.getMonth()!=setyear.getMonth())||(value.getDate()!=setyear.getDate()));}};},buildTimeZoneSelectors:function(startTimeZone,endTimeZone){renderTo=this.entity.clazz+'.'+this.entity.id
+'.durationEditor.';startTimeZoneEditorCFG=this.getTimeZoneEditorCFG(renderTo
+'startTimeZone');startTimeZoneEditorCFG.durationType='startTimeZone';if(typeof(startTimeZone)=='string'&&startTimeZone!=''){startTimeZoneEditorCFG.value=startTimeZone;}
this.startTimeZoneEditor=new Ext.form.ComboBox(startTimeZoneEditorCFG);this.initSelectListener('startTimeZoneEditor');endTimeZoneEditorCFG=this.getTimeZoneEditorCFG(renderTo
+'endTimeZone');endTimeZoneEditorCFG.durationType='endTimeZone';if(typeof(endTimeZone)=='string'&&endTimeZone!=''){endTimeZoneEditorCFG.value=endTimeZone;}
this.endTimeZoneEditor=new Ext.form.ComboBox(endTimeZoneEditorCFG);this.initSelectListener('endTimeZoneEditor');},getTimeZoneEditorCFG:function(renderTo){return{store:new Ext.data.SimpleStore({fields:['tz'],sortInfo:{field:'tz',direction:"ASC"},data:this.timeZones}),displayField:'tz',valueField:'tz',mode:'local',triggerAction:'all',editable:false,renderTo:renderTo,width:140,listWidth:220,hasChanges:function(value){return(value!=this.getValue());}};},buildTimeSelectors:function(startTime,endTime){renderTo=this.entity.clazz+'.'+this.entity.id
+'.durationEditor.';startTimeHRSEditorCFG=this.get24EditorCFG(renderTo+'startHRS');startTimeHRSEditorCFG.durationType='startHRS';if(typeof(startTime)=='object'&&startTime!=null){startTimeHRSEditorCFG.value=startTime.HRS;}
this.startTimeHRSEditor=new Ext.form.ComboBox(startTimeHRSEditorCFG);this.initSelectListener('startTimeHRSEditor');startTimeMINSEditorCFG=this.get60EditorCFG(renderTo+'startMINS');startTimeMINSEditorCFG.durationType='startMINS';if(typeof(startTime)=='object'&&startTime!=null){startTimeMINSEditorCFG.value=startTime.MINS;}
this.startTimeMINSEditor=new Ext.form.ComboBox(startTimeMINSEditorCFG);this.initSelectListener('startTimeMINSEditor');startTimeSECSEditorCFG=this.get60EditorCFG(renderTo+'startSECS');startTimeSECSEditorCFG.durationType='startSECS';if(typeof(startTime)=='object'&&startTime!=null){startTimeSECSEditorCFG.value=startTime.SECS;}
this.startTimeSECSEditor=new Ext.form.ComboBox(startTimeSECSEditorCFG);this.initSelectListener('startTimeSECSEditor');endTimeHRSEditorCFG=this.get24EditorCFG(renderTo+'endHRS');endTimeHRSEditorCFG.durationType='endHRS';if(typeof(endTime)=='object'&&endTime!=null){endTimeHRSEditorCFG.value=endTime.HRS;}
this.endTimeHRSEditor=new Ext.form.ComboBox(endTimeHRSEditorCFG);this.initSelectListener('endTimeHRSEditor');endTimeMINSEditorCFG=this.get60EditorCFG(renderTo+'endMINS');endTimeMINSEditorCFG.durationType='endMINS';if(typeof(endTime)=='object'&&endTime!=null){endTimeMINSEditorCFG.value=endTime.MINS;}
this.endTimeMINSEditor=new Ext.form.ComboBox(endTimeMINSEditorCFG);this.initSelectListener('endTimeMINSEditor');endTimeSECSEditorCFG=this.get60EditorCFG(renderTo+'endSECS');endTimeSECSEditorCFG.durationType='endSECS';if(typeof(endTime)=='object'&&endTime!=null){endTimeSECSEditorCFG.value=endTime.SECS;}
this.endTimeSECSEditor=new Ext.form.ComboBox(endTimeSECSEditorCFG);this.initSelectListener('endTimeSECSEditor');},get24EditorCFG:function(renderTo){return{store:new Ext.data.SimpleStore({fields:['t'],sortInfo:{field:'t',direction:"ASC"},data:this.twentyFour}),displayField:'t',valueField:'t',mode:'local',triggerAction:'all',editable:false,renderTo:renderTo,width:50,hasChanges:function(value){return(value!=this.getValue());}};},get60EditorCFG:function(renderTo){return{store:new Ext.data.SimpleStore({fields:['t'],sortInfo:{field:'t',direction:"ASC"},data:this.sixty}),displayField:'t',valueField:'t',mode:'local',triggerAction:'all',editable:false,renderTo:renderTo,width:50,hasChanges:function(value){return(value!=this.getValue());}};},initSelectListener:function(editorName){this[editorName].on('select',function(){this.aSelectionHasBeenMade=true;if(true===this.hasChanges()){this.fireEvent('MSG','change',this);}else{this.fireEvent('MSG','reset',this);}},this);},initComponent:function(){Pulse.DurationEditor.superclass.initComponent.call(this);if(this.DBG){props=['id','type'];props=props.concat(DBG.getPropertyArray(this.initialConfig));THROW({args:arguments,props:props},this,'initComponent.DurationEditor');}
try{this.initialDurationSet=false;this.aSelectionHasBeenMade=false;if(typeof(this.duration)!='object'||this.duration===null){dt=new Date();this.duration={startDateDate:dt,startDate:{y:dt.getYear(),m:dt.getMonth(),d:dt.getDate()},startTimeZone:this.defaultTimeZone,startTime:{HRS:dt.getHours(),MINS:dt.getMinutes(),SECS:dt.getSeconds()},endDateDate:dt,endDate:{y:dt.getYear(),m:dt.getMonth(),d:dt.getDate()},endTimeZone:this.defaultTimeZone,endTime:{HRS:dt.getHours(),MINS:dt.getMinutes(),SECS:dt.getSeconds()}};this.buildDatePickers(this.duration.startDateDate,this.duration.endDateDate);this.buildTimeZoneSelectors(this.duration.startTimeZone,this.duration.endTimeZone);this.buildTimeSelectors(this.duration.startTime,this.duration.endTime);}else{this.initialDurationSet=true;dtStart=new Date();dtStart.setYear(this.duration.startDate.y);dtStart.setMonth(this.duration.startDate.m);dtStart.setDate(this.duration.startDate.d);this.duration.startDateDate=dtStart;dtEnd=new Date();dtEnd.setYear(this.duration.endDate.y);dtEnd.setMonth(this.duration.endDate.m);dtEnd.setDate(this.duration.endDate.d);this.duration.endDateDate=dtEnd;this.buildDatePickers(dtStart,dtEnd);this.buildTimeZoneSelectors(this.duration.startTimeZone,this.duration.endTimeZone);this.buildTimeSelectors(this.duration.startTime,this.duration.endTime);}}catch(e){FATAL(e,this,'initComponent.DurationEditor');}}};Pulse.DurationEditor=Ext.extend(Pulse.Editor,DurationEditor);Pulse.Error=function(error,object,functionName){this.type='Error';this.id=Ext.id();this.errorprops=['type','object','fn','id','e','o','p','args','props','propsObj','handle','handler'];this.error=error;this.object=object;this.fn=functionName;if(typeof(this.error)!='undefined'){if(typeof(this.error.object)=='undefined'){this.error.object=this.object;}
if(typeof(this.error.fn)=='undefined'){this.error.fn=this.fn;}}
this.get=function(prop){if(true===this.isErrorProp(prop)&&typeof(this.error)!='undefined'){return this.error[prop];}};this.isErrorProp=function(string){for(_iii=0;_iii<this.errorprops.length;_iii++){if(this.errorprops[_iii]==string){return true;}}
return false;};};Pulse.Error.Handler={testoutput:{on:true},'deepTestOne':function(pulseError){Pulse.Error.Handler.test('deepTestOne',pulseError);},'deepTestTwo':function(pulseError){Pulse.Error.Handler.test('deepTestTwo',pulseError);},'deepTestThree':function(pulseError){Pulse.Error.Handler.test('deepTestThree',pulseError);},'deepTestFour':function(pulseError){Pulse.Error.Handler.test('deepTestFour',pulseError);},'deepTestFive':function(pulseError){Pulse.Error.Handler.test('deepTestFive',pulseError);},'deepTestSix':function(pulseError){Pulse.Error.Handler.test('deepTestSix',pulseError);},'deepTestSeven':function(pulseError){Pulse.Error.Handler.test('deepTestSeven',pulseError);},'deepTestFailed':function(pulseError){Pulse.Error.Handler.test('deepTestFailed',pulseError);},'stringTest':function(pulseError){Pulse.Error.Handler.test('stringTest',pulseError);},'undefined':function(pulseError){Pulse.Error.Handler.outputError('undefined',pulseError);},test:function(string,pulseError){if(true===this.testoutput.on){this.outputError(string,pulseError);}},outputError:function(string,pulseError){out=[''+string,'HANDLE fn: '+string,''];out=out.concat(Pulse.dbgError(pulseError,true));PulseErrorWindow.Throw(out);}};FCKEditorWindow={type:'FCKEditorWindow',DBG:{initComponent:true},initComponent:function(){try{this.addEvents({'MSG':true,'beforereset':true,'reset':true,'beforeload':true,'load':true});if(typeof(this.initialConfig.id)=='undefined'){this.id=Ext.id(null,this.type+'.');}
this.store=new Pulse.AssorterPanelStore();this.store.on('MSG',function(msgString,store){this.fireEvent('MSG',msgString,this);},this);}catch(e){THROW({e:'FATAL',o:e},this,'initComponent');}}};Pulse.FCKEditorWindow=Ext.extend(Ext.Component,FCKEditorWindow);DBG.FieldMonitor=DBG.apply(DBG.Editor,{validate:{call:false,allowBlank:false,regex:false,handler:false,results:false,result:false},hasChanges:{FieldMonitor:false},getChanges:{FieldMonitor:false},getParameterName:false,getValue:false,setBoxColor:false,keyup:false,getElName:false,showFlag:false,removeFlag:false,getFlagEl:false});FieldMonitor={type:'FieldMonitor',DBG:false,flag:{msg:VIEWPORT_PROPERTIES.TEXT_ENTER_VALID_VALUE,iconCls:'warningIconCls',style:'font-weight:bold;padding-left:18px;'
+'height:18px;vertical-align:middle;',errorIconCls:'errorIconCls',errorStyle:'color:#FF0000;font-weight:bold;padding-left:18px;'
+'height:18px;vertical-align:middle;'},hasChanges:function(){if(this.DBG){THROW({o:(this.initialValue!=this.getValue()),props:['id','type','initialValue'],args:[this.getValue()]},this,'hasChanges.FieldMonitor');}
return(this.initialValue!=this.getValue());},getParameterName:function(){pName=this.getElName();if(typeof(pName)!='string'||pName===''){pName=this.getElId();}
if(typeof(pName)!='string'||pName===''){throw(new Pulse.Error({e:'VALIDATION FAILED',args:arguments,o:'CHANGES: '+this.hasChanges()+', VALIDATE: '+this.validate(),props:['el.dom.name','el.id']},this,'getParameterName'));}
pref='';if(typeof(this.valuePrefix)=='string'){pref=this.valuePrefix;}
if(this.DBG){THROW({o:pref+pName},this,'getParameterName');}
return pref+pName;},getChanges:function(v){if(this.DBG){THROW({args:arguments,props:['id','type']},this,'getChanges.FieldMonitor');}
try{initialV=v;if(typeof(v)!='object'||v===null){v={};}
proceed=this.hasChanges();if(true===proceed){proceed=this.validate();if(true===proceed){v[this.getParameterName()]=this.getValue();}else{throw(new Pulse.Error({e:'VALIDATION FAILED',args:arguments,o:'CHANGES: '+this.hasChanges()+', VALIDATE: '+this.validate(),props:['el.dom.name','el.id']},this,'getChanges.FieldMonitor'));}
return v;}
return initialV;}catch(e){if(typeof(e)=='object'&&e!==null&&e.type=='Error'){THROW(e,this,'getChanges.FieldMonitor');}else{THROW({e:'VALIDATION FAILED',o:e,args:arguments,props:['el.dom.name','el.id']},this,'getChanges.FieldMonitor');}}},commit:function(){if(false===this.fireEvent('MSG','beforecommit',this)){return false;}
try{if(true===this.hasChanges()){this.initialValue=this.getValue();this.setBoxColor();}
this.validate();this.fireEvent('MSG','commit',this);}catch(e){if(this.DBG){FATAL(e,this,'commit');}}},reset:function(){if(false===this.fireEvent('MSG','beforereset',this)){return false;}
try{if(true===this.hasChanges()){this.setValue(this.initialValue,false);this.setBoxColor();}
this.fireEvent('MSG','reset',this);}catch(e){if(this.DBG){FATAL(e,this,'reset');}}},getEl:function(){if(typeof(this.el)=='undefined'||this.el===null){if(this.DBG){THROW({e:'UNDEFINED',props:['el','el.id']},this,'getEl');}}else{return this.el;}},getElId:function(){if(typeof(this.el)=='undefined'||this.el===null){if(this.DBG){THROW({e:'UNDEFINED',props:['el','el.id']},this,'getElId');}}else{return this.el.id;}},getElName:function(){if(this.DBG){THROW({props:['el','el.id','el.dom','el.dom.name']},this,'getElName');}
if(typeof(this.el)=='undefined'||this.el===null){if(this.DBG){THROW({e:'UNDEFINED',props:['el','el.dom','el.dom.name']},this,'getElName');}
return;}
return this.el.dom.name;},setValue:function(v,boolValidate){try{set=true;if(this.fieldType=='checkbox'){if(typeof(v)!='boolean'){throw('INVALID CHECKBOX VALUE: '+v);}
this.getEl().dom.checked=v;}else{if(false!==boolValidate){set=this.validate(v);}
this.getEl().dom.value=v;this.validate();}}catch(e){if(this.DBG){FATAL(e,this,'setValue');}}},getValue:function(){if(this.DBG){THROW({props:['el','el.dom.value']},this,'getValue');}
try{el=this.getEl();if(typeof(el)=='undefined'){THROW({e:'UNDEFINED',props:['el','el.getValue']},this,'getValue');}else{if(this.fieldType=='checkbox'){return this.getValueC(el);}else{return this.getValueT(el);}}}catch(e){if(this.DBG){FATAL(e,this,'getValue');}}},getValueT:function(el){if(typeof(el.getValue)=='function'){v=this.el.getValue();}else{THROW({e:'UNDEFINED',props:['el','el.getValue']},this,'getValue');return;}
v=v.trim();return v;},getValueC:function(el){return el.dom.checked;},validate:function(value){if(this.DBG){THROW({o:'CALL',props:['allowBlank','regex','invalidText','allowSave','handler','scope']},this,'validate.call');}
if(this.fieldType=='checkbox'){if(true===this.hasChanges()){this.setBoxColor('y');this.fireEvent('MSG','change',this);}else{this.setBoxColor();this.fireEvent('MSG','reset',this);}
return true;}
flagMsg=(typeof(this.invalidText)=='string'&&this.invalidText!=='')?this.invalidText:this.flag.msg;flagIconCls=this.flag.iconCls;flagStyle=this.flag.style;showFlag=true;if(typeof(value)!=='undefined'){v=value;showFlag=false;}else{v=this.getValue();}
success=true;try{if(false===this.allowBlank){success=(v!=='');if(this.DBG){THROW({o:'ALLOWBLANK-CHECK: '+success,args:[v],props:['allowBlank']},this,'validate.allowBlank');}}
if(this.DBG){THROW({o:'ALLOWBLANK: '+success,args:[v],props:['allowBlank']},this,'validate.results');}
if(false===success){throw('ALLOWBLANK: '+success+' FOR '+typeof(v)+': "'+v+'" ');}
if(typeof(this.regex)=='object'&&typeof(this.regex.test)=='function'){success=this.regex.test(v);if(this.DBG){THROW({o:'REGEX-CHECK: '+success,args:[v],props:['regex']},this,'validate.regex');}}
if(this.DBG){THROW({o:'REGEX: '+success,args:[v],props:['regex']},this,'validate.results');}
if(false===success&&true!==this.allowSave){throw('REGEX: '+success+' FOR '+typeof(v)+': "'+v+'" ');}
if(typeof(this.handler)!='undefined'){if(typeof(this.handler)=='function'){success=this.handler(v);}else if(typeof(this.handler)=='string'&&typeof(this.scope)=='object'){try{success=this.scope[this.handler](v);}catch(e){throw(new Pulse.Error({e:'HANDLER UNDEFINED',props:['scope','handler']},this,'handler'));}}
if(this.DBG){THROW({o:'HANDLER-CHECK: '+success,args:[v],props:['scope','handler']},this,'validate.handler');}
if(typeof(success)!='boolean'){success=true;}}
if(this.DBG){THROW({o:'HANDLER: '+success,args:[v],props:['scope','handler']},this,'validate.results');}
if(false===success&&true!==this.allowSave){throw('HANDLER: '+success+' FOR '+typeof(v)+': "'+v+'" ');}
if(true===showFlag){if(false===success){this.showFlag(flagMsg,flagStyle,flagIconCls);}else{this.removeFlag();}
if(true===this.hasChanges()){this.setBoxColor('y');this.fireEvent('MSG','change',this);}else{this.setBoxColor();this.fireEvent('MSG','reset',this);}}
if(this.DBG){THROW({o:'SUCCESS: '+success+' FOR '+typeof(v)+': "'+v+'"',props:['allowSave','allowBlank','regex','scope','handler']},this,'validate.result');}
return true;}catch(e){try{processE=true;if(typeof(e)=='string'){flagIconCls=this.flag.errorIconCls;flagStyle=this.flag.errorStyle;processE=((e.indexOf('ALLOWBLANK')+e.indexOf('REGEX')+e.indexOf('HANDLER'))!==-2);if(true===showFlag&&false===processE){this.showFlag(flagMsg,flagStyle,flagIconCls);this.setBoxColor('r');this.fireEvent('MSG','changeNotSaveable',this);}}
if(true===processE){FATAL(e,this,'validate','VALIDATIONFAILURE');}}catch(ee){if(this.DBG){FATAL(ee,this,'validate','VALIDATIONFAILURE');}}
if(this.DBG){THROW({o:'SUCCESS: '+false+' FOR '+typeof(v)+': "'+v+'"',props:['allowSave','allowBlank','regex','scope','handler']},this,'validate.result');}
return false;}},setFlagEl:function(el){if(typeof(el)=='undefined'||el===null){if(this.DBG){THROW({e:'ELEMENT UNDEFINED',args:arguments},this,'setFlagEl');}
return;}
this.flagMsgEl=el;},getFlagEl:function(){if(this.DBG){THROW({args:arguments,props:['el','flagMsgEl']},this,'getFlagEl');}
try{el=this.flagMsgEl;if(typeof(el)!='undefined'&&el!==null){return el;}
el=Ext.get(this.id+'.flagMsgEl');if(typeof(el)!='undefined'&&el!==null){this.setFlagEl(el);return el;}
el=this.el.prev();if(typeof(el)!='undefined'&&el!==null&&(el.id.indexOf('.flagMsgEl')>-1)){this.setFlagEl(el);return el;}}catch(e){if(this.DBG){FATAL(e,this,'getFlagEl');}}},showFlag:function(fMsg,fSty,fIco){if(this.DBG){THROW({args:arguments,props:['flagMsgEl','showFlagMSG']},this,'showFlag');}
if(false===this.showMsgFlag){return;}
try{el=this.getFlagEl();if(typeof(el)!='undefined'){el.update(fMsg);el.dom.className=fIco;el.set({style:fSty});}else{fDiv='<div '+'class="'+fIco+'" '+'style="'+fSty+'" '+'id="'+this.id+'.flagMsgEl">'+
fMsg+'</div>';el=Ext.DomHelper.insertBefore(this.el,fDiv,true);this.setFlagEl(el);}}catch(e){if(this.DBG){FATAL(e,this,'showFlag');}}},removeFlag:function(){if(this.DBG){THROW({args:arguments},this,'removeFlag');}
el=this.getFlagEl();if(typeof(el)!='undefined'){el.remove();delete this.flagMsgEl;}},setBoxColor:function(color){THROW({o:'COLOR',args:arguments},this,'setBoxColor');if(typeof(color)!='string'){this.el.replaceClass(Pulse.fieldCls+'Yellow',Pulse.fieldCls);this.el.replaceClass(Pulse.fieldCls+'Red',Pulse.fieldCls);return;}
_color=color.toUpperCase();switch(_color){case'R':this.el.replaceClass(Pulse.fieldCls,Pulse.fieldCls+'Red');this.el.replaceClass(Pulse.fieldCls+'Yellow',Pulse.fieldCls+'Red');break;case'Y':this.el.replaceClass(Pulse.fieldCls,Pulse.fieldCls+'Yellow');this.el.replaceClass(Pulse.fieldCls+'Red',Pulse.fieldCls+'Yellow');break;default:this.el.replaceClass(Pulse.fieldCls+'Yellow',Pulse.fieldCls);this.el.replaceClass(Pulse.fieldCls+'Red',Pulse.fieldCls);break;}
return;if(typeof(color)=='string'&&color.toUpperCase()=='R'){this.el.replaceClass(Pulse.fieldCls,Pulse.fieldCls+'Red');this.el.replaceClass(Pulse.fieldCls+'Yellow',Pulse.fieldCls+'Red');}else if(typeof(color)=='string'&&color.toUpperCase()=='Y'){this.el.replaceClass(Pulse.fieldCls,Pulse.fieldCls+'Yellow');this.el.replaceClass(Pulse.fieldCls+'Red',Pulse.fieldCls+'Yellow');}else{this.el.replaceClass(Pulse.fieldCls+'Yellow',Pulse.fieldCls);this.el.replaceClass(Pulse.fieldCls+'Red',Pulse.fieldCls);}},initComponent:function(){Pulse.FieldMonitor.superclass.initComponent.call(this);try{evtString='keyup';if(this.fieldType=='checkbox'){evtString='click';}
this.el.on(evtString,function(){success=this.validate();THROW({props:['el','el.dom.value'],args:[success,this.getValue()]},this,'keyup');return;if(false===success){this.setBoxColor('r');this.fireEvent('MSG','changeNotSaveable',this);return;}
if(true===this.hasChanges()){this.setBoxColor('y');this.fireEvent('MSG','change',this);return;}
this.setBoxColor();this.fireEvent('MSG','reset',this);return;},this);this.initialValue=this.getValue();if(true===this.validateOnInit&&true!==this.initialValidation){this.validate();this.initialValidation=true;}}catch(e){FATAL(e,this,'initComponent');}},destroy:function(){this.removeFlag();this.el.remove();props=['el','flagMsgEl'];for(i=0;i<props.length;i++){delete this[props[i]];}
Pulse.FieldMonitor.superclass.destroy.call(this);}};Pulse.FieldMonitor=Ext.extend(Pulse.Editor,FieldMonitor);var FileBrowser={type:'FileBrowser',DBG:false,isReady:false,el:null,win:null,prevEl:null,prevWin:null,prev:true,west:null,tree:null,root:null,center:null,south:null,fileNameField:null,selectedNode:null,restriction:null,restrictions:{img:['JPG','JPEG','PNG','GIF','TIFF'],flash:['SWF'],isRestricted:function(extension){if(typeof(FileBrowser.restriction)=='undefined'||FileBrowser.restriction===null){return false;}
if(typeof(FileBrowser.restrictions[FileBrowser.restriction])!='undefined'){res=FileBrowser.restrictions[FileBrowser.restriction];for(i=0;i<res.length;i++){if(res[i]==extension.toUpperCase()){return false;}}}
return true;}},open:function(config){if(this.DBG){FATAL(config,this,'open');FATAL(config.params,this,'open');}
this.restriction=config.restriction;this.treeSelectMode=config.treeSelectMode;try{pel=VIEWPORT.getEl();if(typeof(pel)=='undefined'){throw('22 :: PULSE.FileBrowser.js.init() :: '+'CHECK for element failed...');}
if(this.win===null){this.loader=new Ext.tree.TreeLoader({dataUrl:config.dataURL,uiProviders:{'FileTreeNodeUI':PULSE.FileTreeNodeUI}});tbar=[];privButton={text:'priv',scope:this,handler:function(){if(typeof(this.loader.baseParams)=='object'){this.loader.baseParams.priv=true;}else{this.loader.baseParams={priv:true};}
this.root.setText('priv');this.root.reload(function(node){node.getOwnerTree().fireEvent('click',node);});},iconCls:'foldersIconCls'};tbar.push(privButton);tbar.push('-');pubButton={text:'pub',scope:this,handler:function(){if(typeof(this.loader.baseParams)=='object'){this.loader.baseParams.priv=false;}else{this.loader.baseParams={priv:false};}
this.root.setText('pub');this.root.reload(function(node){node.getOwnerTree().fireEvent('click',node);});},iconCls:'foldersIconCls'};tbar.push(pubButton);tbar.push('-');uploadButton={text:VIEWPORT_PROPERTIES.BUTTON_TEXT_UPLOADFILE,disabled:true,scope:config,handler:function(){FileBrowser.uploadFile(this.uploadProgressURL);},iconCls:'fileUploadIconCls'};if(true===config.upload&&typeof(config.uploadProgressURL)=='string'&&config.uploadProgressURL!=''){uploadButton.disabled=false;}
tbar.push(uploadButton);tbar.push('-');this.tree=new Ext.tree.TreePanel({id:'FileBrowserWindow.tree',height:200,animate:true,creatingNewNode:false,enableDD:false,autoScroll:true,containerScroll:true,rootVisible:true,border:false,loader:this.loader,tbar:tbar});this.root=new Ext.tree.AsyncTreeNode({text:'pub',draggable:false,id:'source',iconCls:'foldersIconCls'});this.tree.setRootNode(this.root);this.tree.on('click',function(node,e){this.center.disable();params={previewNode:node.id,priv:(typeof(this.loader.baseParams.priv)=='boolean')?this.loader.baseParams.priv:false};loadConfig={url:config.previewURL,method:'POST',scripts:true,callback:this.loadCallback,params:params,text:'loading...',discardUrl:true,nocache:true,timeout:30};this.center.load(loadConfig);if(this.prevWin!==null&&false===this.prevWin.hidden){this.prevWin.hide();}
this.selectedNode=node;if(typeof(this.treeSelectMode)=='string'&&this.treeSelectMode=='selectFolder'){if(node.attributes.type!='dir'){Ext.getCmp('FileBrowserWindow.create.button').disable();this.fileNameField.setValue('');}else{Ext.getCmp('FileBrowserWindow.create.button').enable();this.fileNameField.setValue(node.text);}
this.fileNameField.validate();(function(){this.prev=true;}).defer(100);return;}
if(node.attributes.type!='dir'){if(this.restrictions.isRestricted(node.attributes.extension)){Ext.getCmp('FileBrowserWindow.create.button').disable();this.fileNameField.setValue('');}else{Ext.getCmp('FileBrowserWindow.create.button').enable();this.fileNameField.setValue(node.text);}}else{Ext.getCmp('FileBrowserWindow.create.button').disable();this.fileNameField.setValue('');}
this.fileNameField.validate();(function(){this.prev=true;}).defer(100);},this);this.west=new Ext.Panel({region:'west',id:'FileBrowserWindow.west',split:true,width:270,minSize:250,maxSize:600,collapsible:true,margins:'5 0 5 5',items:[this.tree]});this.west.on({'resize':{scope:this,fn:function(){this.tree.setHeight(this.west.getInnerHeight());}}});this.center=new Ext.Panel({region:'center',id:'FileBrowserWindow.center',html:'preview',autoScroll:true,margins:'5 5 5 0'});this.south=new Ext.Panel({region:'south',id:'FileBrowserWindow.south',margins:'0 5 5 5',autoHeight:true,html:'<table cellpadding="0" cellspacing="0" border="0" style="width:100%;margin:5px;"><tr>'+'<td>'+VIEWPORT_PROPERTIES.FILE+':</td>'+'<td style="width:90%;"><div id="FileBrowserWindow.fileName"> </div></td>'+'</tr></table>'});this.el=pel.createChild({tag:'div',id:'FileBrowserWindow.el'});windowConfig={id:'FileBrowserWindow',maximizable:false,title:VIEWPORT_PROPERTIES.FILEBROWSER_TITLE+':&#160;',closable:true,plain:true,modal:true,renderTo:this.el,height:300,width:400,bodyStyle:'background-color: #FFFFFF;',layout:'border',items:[this.west,this.center,this.south],buttonAlign:'center',buttons:[{id:'FileBrowserWindow.create.button',disabled:true,text:VIEWPORT_PROPERTIES.BUTTON_TEXT_APPLY,handler:function(){if(false===FileBrowser.isReady){return;}
if(FileBrowser.selectedNode===null){return;}
if(FileBrowser.restrictions.isRestricted(FileBrowser.selectedNode.attributes.extension)){return;}
if(FileBrowser.fileNameField.getValue().trim()!=FileBrowser.selectedNode.text.trim()){return;}
if(typeof(config.applyCallback)=='function'){config.applyCallback(FileBrowser.selectedNode);}else if(typeof(config.applyCallback)=='string'&&typeof(config.scope)=='object'){try{config.scope[config.applyCallback](FileBrowser.selectedNode);}catch(e){FATAL(e,this,'FileBrowserApplyCallback');}}
FileBrowser.close();}},{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CANCEL,handler:function(){FileBrowser.close();}}]};this.win=new Ext.Window(windowConfig);}
this.win.on({'beforeclose':{fn:function(win){if(false===FileBrowser.isReady){return false;}}},'close':{fn:function(win){if(FileBrowser.prevWin!==null){FileBrowser.prevWin.close();}
delete FileBrowser.el;delete FileBrowser.win;delete FileBrowser.prevEl;delete FileBrowser.prevWin;delete FileBrowser.prev;delete FileBrowser.west;delete FileBrowser.tree;delete FileBrowser.root;delete FileBrowser.center;delete FileBrowser.south;delete FileBrowser.fileNameField;delete FileBrowser.selectedNode;delete FileBrowser.restriction;FileBrowser.el=null;FileBrowser.win=null;FileBrowser.prevEl=null;FileBrowser.prevWin=null;FileBrowser.prev=true;FileBrowser.west=null;FileBrowser.tree=null;FileBrowser.root=null;FileBrowser.center=null;FileBrowser.south=null;FileBrowser.fileNameField=null;FileBrowser.selectedNode=null;FileBrowser.restriction=null;FileBrowser.isReady=false;}}});this.win.on('show',function(){if(this.fileNameField===null){emptyText=(typeof(this.treeSelectMode)=='string'&&this.treeSelectMode=='selectFolder')?VIEWPORT_PROPERTIES.TEXT_CHOOSE_FOLDER:VIEWPORT_PROPERTIES.TEXT_CHOOSE_FILE;this.fileNameField=new Ext.form.TextField({name:'FileBrowserWindow.fileName.name',renderTo:'FileBrowserWindow.fileName',style:'width:90%;',emptyText:emptyText,allowBlank:false,editable:false});}
this.fileNameField.setValue('');this.selectedNode=null;this.fileNameField.validate();this.win.doLayout(true);this.tree.setHeight(this.west.getInnerHeight());try{this.tree.getRootNode().reload(function(){root=FileBrowser.tree.getRootNode();root.expand(false,true,function(node){if(typeof(config.uri)!='undefined'){splitArray=config.uri.split('/');splitArray=splitArray.slice(3);FileBrowser.expandNodes(node,splitArray);}else{FileBrowser.west.enable();FileBrowser.isReady=true;}});});}catch(error){if(typeof(FileBrowser.west)!='undefined'&&FileBrowser.west!==null){FileBrowser.west.enable();FileBrowser.isReady=true;}}
loadConfig={url:config.previewURL,method:'POST',scripts:true,callback:FileBrowser.loadCallback,params:{previewNode:config.id},text:'loading...',discardUrl:true,nocache:true,timeout:30};FileBrowser.center.load(loadConfig);},this);this.win.setSize({width:VIEWPORT.getSize().width*0.8,height:VIEWPORT.getSize().height*0.8});this.center.disable();this.west.disable();this.win.setPosition(VIEWPORT.getSize().width*0.1,VIEWPORT.getSize().height*0.1);this.win.show();}catch(windowInitError){alert('windowInitError: \n'+windowInitError);}},close:function(){this.win.close();},expandNodes:function(node,pathArray){try{if(false===node.isExpanded()){node.expand(false,true,function(node){string=pathArray.shift();if(typeof(pathArray[0])=='undefined'||pathArray[0]===''){sNode=node.findChild('text',string);sNode.select();FileBrowser.selectedNode=sNode;FileBrowser.west.enable();FileBrowser.isReady=true;return;}
FileBrowser.expandNodes(node.findChild('text',string),pathArray);});}else{string=pathArray.shift();if(typeof(pathArray[0])=='undefined'||pathArray[0]===''){sNode=node.findChild('text',string);sNode.select();FileBrowser.selectedNode=sNode;FileBrowser.west.enable();FileBrowser.isReady=true;return;}
FileBrowser.expandNodes(node.findChild('text',string),pathArray);}}catch(error){FileBrowser.west.enable();FileBrowser.isReady=true;}},loadCallback:function(el,success,response,options){try{FileBrowser.center.enable();}catch(e1){try{Ext.getCmp('popup.VIEWPORT').center.enable();}catch(e2){PulseError.Throw({e:'DBG',o:e2},'FileBrowser','loadCallback');}}
LPCB(el,success,response,options);},init:function(config){try{if(typeof(this.treeSelectMode)=='string'&&this.treeSelectMode=='selectFolder'){return;}
if(FileBrowser.restrictions.isRestricted(config.extension)){this.fileNameField.setValue('');}else{this.fileNameField.setValue(config.name);}}catch(e1){popup=Ext.getCmp('popup.VIEWPORT');if(typeof(popup)=='undefined'||popup===null){return;}
try{if(FileBrowser.restrictions.isRestricted(config.extension)){popup.fileNameField.setValue('');}else{popup.fileNameField.setValue(config.name);}}catch(e2){PulseError.Throw({e:'DBG',o:e2},'FileBrowser','init');}}},folderDblClick:function(folderName){this.prev=false;try{FileBrowser.west.disable();FileBrowser.center.disable();if(typeof(this.selectedNode)!='object'||this.selectedNode===null){n=this.tree.getSelectionModel().getSelectedNode();if(typeof(n)=='object'&&n!==null){this.selectedNode=n;}else{this.selectedNode=this.tree.getRootNode();}}
if(false===this.selectedNode.isExpanded()){this.selectedNode.expand(false,true,function(node){chNodeFound=false;for(var i=0;i<node.childNodes.length;i++){if(node.childNodes[i].text==folderName){node.childNodes[i].select();FileBrowser.west.enable();FileBrowser.tree.fireEvent('click',node.childNodes[i]);chNodeFound=true;break;}}
if(false==chNodeFound){FileBrowser.west.enable();FileBrowser.tree.fireEvent('click',node);}});}else{chNodeFound=false;for(var i=0;i<this.selectedNode.childNodes.length;i++){if(this.selectedNode.childNodes[i].text==folderName){this.selectedNode.childNodes[i].select();FileBrowser.west.enable();FileBrowser.tree.fireEvent('click',this.selectedNode.childNodes[i]);chNodeFound=true;break;}}
if(false==chNodeFound){FileBrowser.west.enable();FileBrowser.tree.fireEvent('click',this.selectedNode);}}}catch(e1){try{_vp=Ext.getCmp('popup.VIEWPORT');_vp.west.disable();_vp.center.disable();if(typeof(_vp.selectedNode)!='object'||_vp.selectedNode===null){n=_vp.tree.getSelectionModel().getSelectedNode();if(typeof(n)=='object'&&n!==null){_vp.selectedNode=n;}else{_vp.selectedNode=_vp.tree.getRootNode();}}
if(false===_vp.selectedNode.isExpanded()){_vp.selectedNode.expand(false,true,function(node){chNodeFound=false;for(var i=0;i<node.childNodes.length;i++){if(node.childNodes[i].text==folderName){node.childNodes[i].select();_vp=Ext.getCmp('popup.VIEWPORT');_vp.west.enable();_vp.tree.fireEvent('click',node.childNodes[i]);chNodeFound=true;break;}}
if(false==chNodeFound){_vp=Ext.getCmp('popup.VIEWPORT');_vp.west.enable();_vp.tree.fireEvent('click',node);}});}else{chNodeFound=false;for(var i=0;i<_vp.selectedNode.childNodes.length;i++){if(_vp.selectedNode.childNodes[i].text==folderName){_vp=Ext.getCmp('popup.VIEWPORT');_vp.selectedNode.childNodes[i].select();_vp.west.enable();_vp.tree.fireEvent('click',_vp.selectedNode.childNodes[i]);chNodeFound=true;break;}}
if(false==chNodeFound){_vp=Ext.getCmp('popup.VIEWPORT');_vp.west.enable();_vp.tree.fireEvent('click',_vp.selectedNode);}}}catch(e2){PulseError.Throw({e:'DBG',o:e2},'FileBrowser','folderDblClick');}}},fileClick:function(fileName){this.folderDblClick(fileName);},selectTreeNode:function(nodeId,fileUri,boolIsFolder){_vp=Ext.getCmp('popup.VIEWPORT');tree=this.tree;if(typeof(_vp)=='object'&&_vp!==null){tree=_vp.tree;}
if(true===boolIsFolder){n=tree.getNodeById(fileUri);}else{n=tree.getNodeById(nodeId);}
if(typeof(n)=='object'&&n!==null){n.select();}
if(typeof(_vp)=='object'&&_vp!==null){_vp.selectedNode=n;}else{this.selectedNode=n;}},showPreviewImage:function(url,name,el){if(this.prevWin!==null){this.prevWin.getUpdater().getEl().update('<div style="border:1px solid #8DB2E3;text-align:center;padding:2px;">'+'<a href="#" onclick="FileBrowser.hidePreviewImage();" '+'style="display:block;text-decoration:none;font-weight:bold;color:#000000;">'+'<img src="'+url+'" /><br/>'+name+'</a>'+'</div>');(function(){if(true===FileBrowser.prev){FileBrowser.prevWin.show();}}).defer(100);return;}
try{pel=Ext.get(document.body);if(typeof(pel)=='undefined'){throw('344 :: PULSE.FileBrowser.js.showPreviewImage() :: '+'CHECK for element failed...');}
if(this.prevEl===null){this.prevEl=pel.createChild({tag:'div',id:'FileBrowserPrevWindow.el'});}
windowConfig={maximizable:false,closable:false,plain:false,modal:false,renderTo:this.prevEl,frame:false,border:false,bodyBorder:true,header:false,bodyStyle:'background-color: #FFFFFF;',autoHeight:true,autoWidth:true,html:'<div style="border:1px solid #8DB2E3;text-align:center;padding:2px;">'+'<a href="#" onclick="FileBrowser.hidePreviewImage();" '+'style="display:block;text-decoration:none;font-weight:bold;color:#000000;">'+'<img src="'+url+'"/><br/>'+name+'</a>'+'</div>'};this.prevWin=new Ext.Window(windowConfig);this.prevWin.on('show',function(win){(function(){win=FileBrowser.prevWin;try{win.setPagePosition((VIEWPORT.getSize().width*0.5)-(win.getSize().width*0.5),(VIEWPORT.getSize().height*0.5)-(win.getSize().height*0.5));}catch(e1){try{_vp=Ext.getCmp('popup.VIEWPORT');win.setPagePosition((_vp.getSize().width*0.5)-(win.getSize().width*0.5),(_vp.getSize().height*0.5)-(win.getSize().height*0.5));}catch(e2){PulseError.Throw({e:'DBG',o:e2},'FileBrowser','showPreviewImage');}}}).defer(100);});(function(){if(true===FileBrowser.prev){FileBrowser.prevWin.show();}}).defer(100);}catch(windowInitError){alert('windowInitError: \n'+windowInitError);}},hidePreviewImage:function(){this.prevWin.hide();},initPopupWindow:function(config){this.restriction=config.restriction;tree=new Ext.tree.TreePanel({id:'popup.FileBrowserWindow.tree',height:200,animate:true,creatingNewNode:false,enableDD:false,autoScroll:true,containerScroll:true,rootVisible:false,border:false,loader:new Ext.tree.TreeLoader({dataUrl:config.dataURL,uiProviders:{'FileTreeNodeUI':PULSE.FileTreeNodeUI}})});root=new Ext.tree.AsyncTreeNode({text:'popup.FileBrowser',draggable:false,id:'source'});tree.setRootNode(root);tree.on({'click':{fn:function(node,e){_vp=Ext.getCmp('popup.VIEWPORT');_vp.center.disable();loadConfig={url:config.previewURL,method:'POST',scripts:true,callback:FileBrowser.loadCallback,params:{previewNode:node.id},text:'loading...',discardUrl:true,nocache:true,timeout:30};_vp.center.load(loadConfig);if(FileBrowser.prevWin!==null&&false===FileBrowser.prevWin.hidden){FileBrowser.prevWin.hide();}
_vp.selectedNode=node;if(node.attributes.type!=='dir'){if(FileBrowser.restrictions.isRestricted(node.attributes.extension)){_vp.fileNameField.setValue('');}else{_vp.fileNameField.setValue(node.text);}}else{_vp.fileNameField.setValue('');}
_vp.fileNameField.validate();(function(){FileBrowser.prev=true;}).defer(100);}}});west=new Ext.Panel({region:'west',id:'popup.FileBrowserWindow.west',split:true,width:270,minSize:250,maxSize:600,collapsible:true,margins:'5 0 5 5',items:[tree]});west.on({'resize':{scope:tree,fn:function(_west,adjWidth,adjHeight,rawWidth,rawHeight){this.setHeight(_west.getInnerHeight());}}});center=new Ext.Panel({region:'center',id:'popup.FileBrowserWindow.center',html:'preview',autoScroll:true,margins:'5 5 5 0'});south=new Ext.Panel({region:'south',id:'popup.FileBrowserWindow.south',margins:'0 5 5 5',autoHeight:true,html:'<table cellpadding="0" cellspacing="0" border="0" style="width:100%;margin:5px;"><tr>'+'<td>'+VIEWPORT_PROPERTIES.FILE+':</td>'+'<td style="width:90%;"><div id="popup.FileBrowserWindow.fileName"> </div></td>'+'</tr></table>',buttonAlign:'center',buttons:[{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_SELECT,handler:function(){_vp=Ext.getCmp('popup.VIEWPORT');if(typeof(_vp.selectedNode)=='undefined'||_vp.selectedNode===null){return;}
if(FileBrowser.restrictions.isRestricted(_vp.selectedNode.attributes.extension)){return;}
config.onSelect(_vp.selectedNode.attributes.httpURI);}},{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CANCEL,handler:function(){window.close();}}]});vpitems=[west,center,south];if(typeof(config.tbar)!='undefined'){tbar=new Ext.Panel({title:VIEWPORT_PROPERTIES.FILES,iconCls:'foldersIconCls',region:'north',tbar:config.tbar,html:'<div style="height:0px;"> </div>'});vpitems.push(tbar);}
vpcfg={initialized:false,id:'popup.VIEWPORT',layout:'border',items:vpitems,tree:tree,west:west,center:center,south:south,listeners:{'afterlayout':{fn:function(_vp){if(true===_vp.initialized){return;}
if(typeof(_vp.fileNameField)=='undefined'||_vp.fileNameField===null){_vp.fileNameField=new Ext.form.TextField({name:'popup.FileBrowserWindow.fileName.name',renderTo:'popup.FileBrowserWindow.fileName',style:'width:90%;',emptyText:VIEWPORT_PROPERTIES.TEXT_CHOOSE_FILE,allowBlank:false,readOnly:true});_vp.doLayout(true);}
_vp.fileNameField.setValue('');_vp.selectedNode=null;_vp.fileNameField.validate();_vp.tree.setHeight(_vp.west.getInnerHeight());try{_vp.tree.getRootNode().reload(function(){root=_vp.tree.getRootNode();root.expand(false,true,function(node){if(typeof(config.uri)!='undefined'){splitArray=config.uri.split('/');splitArray=splitArray.slice(3);FileBrowser.expandNodes(node,splitArray);}else{_vp.west.enable();_vp.isReady=true;}});});}catch(error){if(typeof(_vp.west)!='undefined'&&_vp.west!==null){_vp.west.enable();_vp.isReady=true;}}
loadConfig={url:config.previewURL,method:'POST',scripts:true,callback:FileBrowser.loadCallback,params:{previewNode:config.id},text:'loading...',discardUrl:true,nocache:true,timeout:30};_vp.center.load(loadConfig);_vp.initialized=true;}}}};vp=new Ext.Viewport(vpcfg);},uploadFile:function(updateProgressURL){selectedNode=this.selectedNode;_vp=Ext.getCmp('popup.VIEWPORT');if(typeof(_vp)=='object'&&_vp!==null){selectedNode=_vp.selectedNode;}
if(typeof(updateProgressURL)!='string'||updateProgressURL===''){return;}
if(typeof(selectedNode)!='object'||selectedNode===null||selectedNode.attributes.type!=='dir'){Ext.Msg.alert('',VIEWPORT_PROPERTIES.TEXT_SELECT_A_FOLDER_FOR_UPLOAD);return;}
if(typeof(_vp)=='object'&&_vp!==null){FileUploader.showWin(updateProgressURL,selectedNode,_vp);}else{FileUploader.showWin(updateProgressURL,selectedNode,this);}}};var FileUploader={MAX_RETRIES:20,showWin:function(updateProgressURL,selectedNode,fileBrowser){if(typeof(selectedNode)!='object'||selectedNode===null){return;}
this.fileBrowser=fileBrowser;this.selectedNode=selectedNode;url=selectedNode.attributes.uploadURL;if(typeof(url)!='string'||url===''){Ext.Msg.alert('error','URL undefined: '+url);return;}
if(typeof(updateProgressURL)!='string'||updateProgressURL===''){Ext.Msg.alert('error','updateProgressURL undefined: '+updateProgressURL);return;}
progressId=this.selectedNode.attributes.progressId;this.fileField=new Ext.form.TextField({fieldLabel:'file',name:'file',inputType:'file',allowBlank:false});this.formPanel=new Ext.form.FormPanel({fileUpload:true,bodyStyle:'padding: 5px;',items:[this.fileField]});this.progressBar=new Ext.ProgressBar({hidden:true,id:'progress.bar.'+this.selectedNode.id});this.processingBar=new Ext.ProgressBar({hidden:true,text:'processing file...',style:'margin:3px 0 0 0;',id:'processing.bar.'+this.selectedNode.id});this.formPanel.add(this.progressBar);this.formPanel.add(this.processingBar);submitCFG={scope:this,clientValidation:true,method:'POST',url:url,params:{id:this.selectedNode.id},success:this.createSuccess,failure:this.createFailure};this.createButton=new Ext.Button({scope:this,text:'create',handler:function(){try{if(false===this.formPanel.getForm().isValid()){if(false===this.fileField.isValid()){Ext.Msg.alert("Error","Please add a file!");}
return;}
this.createButton.disable();this.cancelButton.disable();this.progressBar.show();this.uploadIsComplete=false;this.formPanel.getForm().doAction('fileUploadersubmit',submitCFG);this.CURRENT_RETRIES=0;this.STOP_UPDATE_PROGRESS=false;this.updateProgressBar(selectedNode.id,updateProgressURL,progressId);}catch(e){alert('error: '+e);}},iconCls:'saveIconCls'});this.cancelButton=new Ext.Button({scope:this,text:'cancel',handler:function(){this.formWindow.close();},iconCls:'cancelIconCls'});this.confirmButton=new Ext.Button({scope:this,text:'finish',hidden:true,handler:function(){this.selectedNode.reload(function(n){n.expand();});this.fileBrowser.tree.fireEvent('click',this.selectedNode);this.formWindow.close();},iconCls:'selectIconCls'});el=this.getEl();windowCFG={title:'upload and create',modal:true,renderTo:el,items:this.formPanel,buttonAlign:'center',buttons:[this.cancelButton,this.createButton,this.confirmButton]};this.formWindow=new Ext.Window(windowCFG);this.formWindow.on('close',function(){delete this._this.uploadIsComplete;delete this._this.CURRENT_RETRIES;delete this._this.fileBrowser;delete this._this.selectedNode;Ext.Ajax.request({url:this.url,params:{cleanuploadprogress:true}});},{_this:this,url:url});this.formWindow.show(this);if(Ext.isIE6){this.formWindow.setWidth(400);}else{this.formWindow.setWidth(this.formPanel.getSize().width+15);}
halfWindowSize=this.formWindow.getSize().width/2;this.formWindow.setPagePosition((Ext.get(document.body).getSize().width/2)-halfWindowSize,100);this.fileField.validate();},updateProgressBar:function(contentId,updateProgressURL,progressId){if(true===this.STOP_UPDATE_PROGRESS){return;}
requestCFG={scope:this,method:'POST',url:updateProgressURL,params:{id:progressId},callback:this.updateCallBack,contentId:contentId};Ext.Ajax.request(requestCFG);},createSuccess:function(form,action){this.uploadIsComplete=true;this.progressBar.updateProgress(1,'100%');this.processingBar.reset();if(this.processingBar.isVisible()){(function(){this.processingBar.reset();this.processingBar.updateProgress(1,'finished');}).defer(200,this);}
this.cancelButton.hide();this.createButton.hide();this.fileField.disable();this.confirmButton.show();},createFailure:function(form,action){if(this.processingBar.isVisible()){this.processingBar.reset();this.processingBar.updateProgress(0,'failed');Ext.get(this.processingBar.id).first().first('.x-progress-text-back').addClass('progressBarError');}else{this.progressBar.updateProgress(0,'0%');Ext.get(this.progressBar.id).first().first('.x-progress-text-back').addClass('progressBarError');}
this.STOP_UPDATE_PROGRESS=true;this.createButton.disable();this.fileField.disable();this.cancelButton.enable();switch(action.failureType){case Ext.form.Action.CLIENT_INVALID:Ext.Msg.alert('error','Form fields may not be submitted with invalid values');break;case Ext.form.Action.CONNECT_FAILURE:Ext.Msg.alert('error','Ajax communication failed');break;case Ext.form.Action.SERVER_INVALID:Ext.Msg.alert('error',action.result.error.e);default:if(typeof(action.result.error)!='undefined'){Ext.Msg.alert('error',action.result.error.e);}else{Ext.Msg.alert('error','An unknown error has occured!');}}},updateCallBack:function(options,success,response){if(false===success){return;}
decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status&&typeof(decodedResponse.progress)!='undefined'){progress=parseInt(decodedResponse.progress,10);this.progressBar.updateProgress((progress/100),progress+'%');if(progress<100){if(true===this.uploadIsComplete){this.progressBar.updateProgress(1,'100%');}else{(function(_id,_url,_progressId){this.updateProgressBar(_id,_url,_progressId);}).defer(500,this,[options.contentId,options.url,options.params.id]);}}else if(progress===100){this.cancelButton.disable();this.createButton.disable();this.fileField.disable();this.processingBar.show();if(true!==this.uploadIsComplete){this.processingBar.wait({interval:200,increment:15});}else{this.processingBar.updateProgress(1,'finished');}}
return;}else if(false===decodedResponse.status&&typeof(decodedResponse.error)=='object'&&true!==decodedResponse.error.retry){if(this.processingBar.isVisible()){this.processingBar.reset();this.processingBar.updateProgress(0,'failed');Ext.get(this.processingBar.id).first().first('.x-progress-text-back').addClass('progressBarError');}else{this.progressBar.updateProgress(0,'0%');Ext.get(this.progressBar.id).first().first('.x-progress-text-back').addClass('progressBarError');}
this.STOP_UPDATE_PROGRESS=true;this.createButton.disable();this.fileField.disable();this.cancelButton.enable();Ext.Msg.alert('error',decodedResponse.error.e);return;}
if(true!==this.uploadIsComplete){if(typeof(this.CURRENT_RETRIES)=='number'){if(this.CURRENT_RETRIES==this.MAX_RETRIES){return;}
this.CURRENT_RETRIES+=1;}else{this.CURRENT_RETRIES=1;}
(function(_id,_url,_progressId){this.updateProgressBar(_id,_url,_progressId);}).defer(500,this,[options.contentId,options.url,options.params.id]);}},getEl:function(){el=Ext.get('FileUploader.window.el');if(typeof(el)=='undefined'||el===null){el=Ext.get(document.body).createChild({tag:'div',id:'FileUploader.window.el'});}
return el;}};FileUploader.Submit=Ext.extend(Ext.form.Action.Submit,{type:'fileUploadersubmit',handleResponse:function(response){try{return FileUploader.Submit.superclass.handleResponse.apply(this,arguments);}catch(e){error={e:'An unknown error has occurred.'};if(typeof(response)=='object'&&response!==null){try{error={e:Ext.decode(response.responseText)};}catch(e){error={e:response.responseText};}}
return{success:false,error:error};}}});Ext.form.Action.ACTION_TYPES.fileUploadersubmit=FileUploader.Submit;DBG.FileSelector=DBG.apply(DBG.Editor,{initComponent:{FileSelector:false},onRender:false,setFile:false});FileSelector={type:'FileSelector',DBG:DBG.FileSelector,getButtons:function(){buttons=[];buttonCFG={scope:this,disabled:true,handler:this.showFileBrowser,text:VIEWPORT_PROPERTIES.BUTTON_TEXT_ADD,iconCls:'addIconCls'};if(typeof(this.fileBrowserTreeURL)=='string'&&this.fileBrowserTreeURL!==''){buttonCFG.disabled=false;}
buttons.push(new Ext.Toolbar.Button(buttonCFG));buttons.push(new Ext.Toolbar.Separator());removeButtonCFG={scope:this,disabled:true,handler:this.removeFile,text:VIEWPORT_PROPERTIES.BUTTON_TEXT_REMOVE,iconCls:'deleteIconCls'};if(typeof(this.content.file)!='undefined'){removeButtonCFG.disabled=false;}
this.removeButton=new Ext.Toolbar.Button(removeButtonCFG);buttons.push(this.removeButton);buttons.push(new Ext.Toolbar.Separator());return buttons;},removeFile:function(){if(typeof(this.content.file)=='undefined'){return;}
this.monitor.setValue("remove");if(typeof(this.masterEditor=='object')&&(this.masterEditor.type=='SubEditorPanel'||this.masterEditor.type=='SubEditorWindow')){selector='.wrapper_'+this.content.file.id;el=this.masterEditor.body.child(selector);Ext.DomHelper.append(el.dom,{cls:"pulseTransparentMask"},true);this.removeButton.disable();}},setFile:function(node){if(this.DBG){props=DBG.getPropertyArray(node.attributes);THROW({args:arguments,props:props,propsObj:node.attributes},this,'setFile');}
if(typeof(this.content.file)!='undefined'&&this.content.file.id==node.attributes.vfsid){return;}
this.monitor.setValue(node.attributes.vfsid);zindex='position:absolute;z-index:1001;';if(typeof(this.content.file)=='undefined'){zindex='';}
html='<div style="'+zindex
+'padding:5px;font-weight:bold;vertical-align:middle;line-height:16px;">'
+'<img src="'+Ext.BLANK_IMAGE_URL+'" class="tabHasChangesIcon"/>'
+'<img src="'+Ext.BLANK_IMAGE_URL+'" width="16" height="16" border="0" class="file'
+node.attributes.extension+'IconCls" alt="'
+node.attributes.extension+'" valign="middle"/>&#160;'
+'<span style="line-height:16px;">'+VIEWPORT_PROPERTIES.BUTTON_TEXT_NEW+': '
+node.attributes.text+' ('+node.attributes.id+')</span>'+'</div>';if(typeof(this.content.file)=='undefined'){if(typeof(this.masterEditor=='object')&&(this.masterEditor.type=='SubEditorPanel'||this.masterEditor.type=='SubEditorWindow')){el=this.masterEditor.body.child('.noFileAssignedMsg');el.insertHtml('beforeend',html,true).replace(el.first());}
return;}
if(typeof(this.masterEditor=='object')&&(this.masterEditor.type=='SubEditorPanel'||this.masterEditor.type=='SubEditorWindow')){selector='.wrapper_'+this.content.file.id;el=this.masterEditor.body.child(selector);if(true!==el.isMasked){Ext.DomHelper.append(el.dom,{cls:"pulseTransparentMask"},true);el.isMasked=true;}
this.removeButton.disable();}
if(typeof(this.newFilePreview)!='undefined'){this.newFilePreview.remove();}
this.newFilePreview=this.masterEditor.body.insertHtml('afterbegin',html,true);},showFileBrowser:function(){fileBrowserCFG={scope:this,applyCallback:'setFile',dataURL:this.fileBrowserTreeURL,previewURL:this.fileBrowserPreviewURL,upload:true,uploadProgressURL:this.fileBrowserUploadProgressURL};FileBrowser.open(fileBrowserCFG);},onRender:function(){if(this.DBG){THROW({props:['renderTo'],args:arguments},this,'onRender');}
try{if(typeof(this.renderTo=='object')&&(this.renderTo.type=='SubEditorPanel'||this.renderTo.type=='SubEditorWindow')){el=this.renderTo.body;}else{el=Ext.get(this.renderTo);}
field='<input type="hidden" name="vfsid" value="';if(typeof(this.content.file)!='undefined'){field+=this.content.file.id;}
field+='"/>';fieldEl=el.insertHtml('afterBegin',field,true);monitorCFG={id:Ext.id()+'.'+'file.id',el:fieldEl,showMsgFlag:false,allowBlank:true};this.monitor=new Pulse.FieldMonitor(monitorCFG);this.addSubEditor(this.monitor);}catch(e){FATAL(e,this,'onRender');}},initComponent:function(){Pulse.FileSelector.superclass.initComponent.call(this);if(this.DBG){props=['id','type'];props=props.concat(DBG.getPropertyArray(this.initialConfig));THROW({args:arguments,props:props},this,'initComponent.FileSelector');}
try{}catch(e){FATAL(e,this,'initComponent.FileSelector');}}};Pulse.FileSelector=Ext.extend(Pulse.Editor,FileSelector);PULSE.FileTreeNodeUI=function(){PULSE.FileTreeNodeUI.superclass.constructor.apply(this,arguments);};Ext.extend(PULSE.FileTreeNodeUI,Ext.tree.TreeNodeUI,{renderElements:function(n,a,targetNode,bulkRender){if(typeof(a.type)!='undefined'&&(a.type!==null)&&(a.type!="dir")){a.iconCls='file'+a.type+'IconCls';this.iconCls=a.iconCls;}
this.indentMarkup=n.parentNode?n.parentNode.ui.getChildIndent():'';var cb=typeof a.checked=='boolean';var href=a.href?a.href:Ext.isGecko?"":"#";var buf=['<li class="x-tree-node"><div ext:tree-node-id="',n.id,'" class="x-tree-node-el x-tree-node-leaf ',a.cls,'">','<span class="x-tree-node-indent">',this.indentMarkup,"</span>",'<img src="',this.emptyIcon,'" class="x-tree-ec-icon x-tree-elbow" />','<img src="',a.icon||this.emptyIcon,'" class="x-tree-node-icon',(a.icon?" x-tree-node-inline-icon":""),(a.iconCls?" "+a.iconCls:""),'" unselectable="on" style="width:18px"/>',cb?('<input class="x-tree-node-cb" type="checkbox" '+(a.checked?'checked="checked" />':'/>')):'','<a hidefocus="on" class="x-tree-node-anchor" href="',href,'" tabIndex="1" ',a.hrefTarget?' target="'+a.hrefTarget+'"':"",' dir="LTR"><span unselectable="on">',n.text,"</span></a>","</div>",'<ul class="x-tree-node-ct" style="display:none;"></ul>',"</li>"].join('');if(bulkRender!==true&&n.nextSibling&&n.nextSibling.ui.getEl()){this.wrap=Ext.DomHelper.insertHtml("beforeBegin",n.nextSibling.ui.getEl(),buf);}else{this.wrap=Ext.DomHelper.insertHtml("beforeEnd",targetNode,buf);}
this.elNode=this.wrap.childNodes[0];this.ctNode=this.wrap.childNodes[1];var cs=this.elNode.childNodes;this.indentNode=cs[0];this.ecNode=cs[1];this.iconNode=cs[2];var index=3;if(cb){this.checkbox=cs[3];index++;}
this.anchor=cs[index];this.textNode=cs[index].firstChild;}});PULSE.FileRootTreeNodeUI=function(){PULSE.FileRootTreeNodeUI.superclass.constructor.apply(this,arguments);};Ext.extend(PULSE.FileRootTreeNodeUI,PULSE.FileTreeNodeUI,{render:function(){if(!this.rendered){targetNode=this.node.ownerTree.innerCt.dom;this.node.expanded=true;targetNode.innerHTML='<div class="x-tree-root-node"></div>';this.wrap=this.ctNode=targetNode.firstChild;}},collapse:function(){},expand:function(){}});Pulse.MapEntry=function(key,value){if(false===this.isComparable(arguments[0])){throw({e:'MapEntry.EXCEPTION.ARGS[0]',description:'ARGS[0] IS NOT COMPARABLE',args:arguments});}
if(false===this.isComparable(arguments[1])){throw({e:'MapEntry.EXCEPTION.ARGS[1]',description:'ARGS[1] IS NOT COMPARABLE',args:arguments});}
this.key=arguments[0];this.value=arguments[1];};Pulse.MapEntry.prototype={type:'MapEntry',implementsComparable:true,getKey:function(){return this.key;},getValue:function(){return this.value;},hashCode:function(){throw({e:'NOT IMPLEMTED'});},setValue:function(value){if(false===this.isComparable(arguments[0])){throw({e:'MapEntry.EXCEPTION.ARGS[0]',description:'ARGS[0] IS NOT COMPARABLE',args:arguments});}
this.value=arguments[0];},equals:function(o){if(typeof(arguments[0])=='object'&&arguments[0]!==null&&arguments[0].type==this.type){return(arguments[0]==this);}
return false;},toString:function(){return'[{'+this.type+'}@'+this.key+','+this.value+']';},isComparable:function(o){if(typeof(arguments[0])=='undefined'||typeof(arguments[0])=='function'){return false;}
if(typeof(arguments[0])=='object'&&arguments[0]!==null&&true!==arguments[0].implementsComparable){return false;}
return true;}};Pulse.HashMap=function(keyValueMapping){this.id=Pulse.id();this.entries=new Pulse.HashSet();if(arguments[0]){this.putAll(arguments[0]);}};Pulse.HashMap.prototype={type:'HashMap',DBG:true,implementsComparable:true,put:function(key,value){if(typeof(arguments[0])=='number'){internalKey=''+arguments[0];}else{internalKey=arguments[0];}
if(false===this.containsKey(internalKey)){this.entries.add(new Pulse.MapEntry(arguments[0],arguments[1]));}else{iterator=this.entries.iterator();while(iterator.hasNext()){o=iterator.next();if(internalKey==o.getKey()){o.setValue(arguments[1]);break;}}
delete o;delete iterator;}
return true;},values:function(){values=[];if(this.isEmpty()){return values;}
iterator=this.entries.iterator();while(iterator.hasNext()){values.push(iterator.next().value);}
delete iterator;return values;},keySet:function(){keys=[];if(this.isEmpty()){return keys;}
iterator=this.entries.iterator();while(iterator.hasNext()){keys.push(iterator.next().key);}
delete iterator;return keys;},size:function(){return this.entries.length;},containsKey:function(key){if(false===this.isEmpty()&&this.isComparable(arguments[0])){iterator=this.entries.iterator();while(iterator.hasNext()){o=iterator.next();if(this.compare(arguments[0],o)){delete o;delete iterator;return true;}}
delete o;delete iterator;}
return false;},containsValue:function(value){if(false==this.isEmpty()&&this.isComparable(arguments[0])){iterator=this.entries.iterator();while(iterator.hasNext()){o=iterator.next();if(typeof(o.value)=='object'&&o.value!==null){if(true===o.value.equals(arguments[0])){delete o;delete iterator;return true;}}else{if(o.value==arguments[0]){delete o;delete iterator;return true;}}}
delete o;delete iterator;}
return false;},entrySet:function(){return this.entries;},hashCode:function(){throw({e:'HashMap.EXCEPTION',description:'NOT IMPLEMTED'});},putAll:function(keyValueMapping){for(var i=0;i<arguments[0].length;i++){try{this.put(arguments[0][i][0],arguments[0][i][1]);}catch(e){if(typeof(e)=='object'&&e!==null){e.index=i;}
throw(e);}}},remove:function(key){iterator=this.entries.iterator();while(iterator.hasNext()){entry=iterator.next();if(entry.key==key){this.entries.remove(entry);value=entry.value;delete entry;delete iterator;return value;}}
delete entry;delete iterator;},get:function(key){if(false==this.isEmpty()&&this.isComparable(arguments[0])){iterator=this.entries.iterator();while(iterator.hasNext()){o=iterator.next();if(typeof(o.key)=='object'&&o.key!==null){if(true===o.key.equals(arguments[0])){delete iterator;return o.value;}}else{if(o.key==arguments[0]){delete iterator;return o.value;}}
delete o;}
delete iterator;}},clear:function(){this.entries.clear();},isEmpty:function(){return this.entries.isEmpty();},clone:function(){m=new Pulse.HashMap();m.entries=this.entries;return m;},equals:function(o){if(typeof(arguments[0])=='object'&&arguments[0]!==null&&arguments[0].type==this.type){return(arguments[0]==this);}
return false;},toString:function(){return'[{'+this.type+'}@'+this.id+'::'+this.size()+']';},compare:function(key,mapEntry){if(typeof(arguments[1].key)=='object'&&arguments[1].key!==null){return arguments[1].key.equals(arguments[0]);}else{return(arguments[1].key==arguments[0]);}},isComparable:function(o){if(typeof(arguments[0])=='undefined'||typeof(arguments[0])=='function'){return false;}
if(typeof(arguments[0])=='object'&&arguments[0]!==null&&true!==arguments[0].implementsComparable){return false;}
return true;}};Pulse.SetValue=function(length,o){if(typeof(arguments[0])!='number'){throw({e:'SetValue.EXCEPTION.ARGS[0]',args:arguments});}
if(false===this.isComparable(arguments[1])){throw({e:'SetValue.EXCEPTION.ARGS[1]',description:'ARGS[1] IS NOT COMPARABLE',args:arguments});}
this.height=0;this.o=(typeof(arguments[1])=='object'&&arguments[1]!==null)?''+arguments[1]:arguments[1];this.id=arguments[0];};Pulse.SetValue.prototype={type:'SetValue',implementsComparable:true,add:function(val){if(arguments[0]){if(this.equals(arguments[0])){return false;}
if(this.compareTo(arguments[0])){if(this.left){return this.left.add(arguments[0]);}else{arguments[0].parent=this;this.left=arguments[0];if(this.parent){return this.parent.balance();}else{return true;}}}else if(this.right){return this.right.add(arguments[0]);}else{arguments[0].parent=this;this.right=arguments[0];if(this.parent){return this.parent.balance();}else{return true;}}}
return false;},balance:function(){alert('balance: '+this);if(this.left){alert(1+':'+this.left.getHeight(1));if(this.right){alert(1.1+':'+this.right.getHeight(1));c=this.left.getHeight(1)-this.right.getHeight(1);if(c>1){alert(1.11);delete c;return this.rotateRight();}else if(c<-1){alert(1.12);delete c;return this.rotateLeft();}else{alert(1.13);delete c;return true;}}
alert(1.2);if(this.left.getHeight(1)>1){alert(1.21);return this.rotateRight();}}else if(this.right){alert(2+':'+this.right.getHeight(1));if(this.right.getHeight(1)>1){alert(2.1);return this.rotateLeft();}}
return true;},rotateLeft:function(){alert('rotateLeft: '+this);p=this.right;if(this.right.left){this.right.left.parent=this;this.right=this.right.left;}
if(this.parent){if(this.compareTo(this.parent)){p.parent=this.parent;this.parent.right=p;}else{p.parent=this.parent;this.parent.left=p;}
return true;}else{delete p.parent;return true;}
return false;},rotateRight:function(){alert('rotateRight: '+this);p=this.left;if(this.left.right){this.left.right.parent=this;this.left=this.left.right;}
if(this.parent){if(this.compareTo(this.parent)){p.parent=this.parent;this.parent.right=p;}else{p.parent=this.parent;this.parent.left=p;}
return true;}else{delete p.parent;return p;}
return false;},getHeight:function(){if(this.left){if(this.right){l=this.left.getHeight(arguments[0]+1);r=this.right.getHeight(arguments[0]+1);if(l>r){delete l;return r;}else{delete r;return l;}}else{return this.left.getHeight(arguments[0]+1);}}else if(this.right){return this.right.getHeight(arguments[0]+1);}else{if(arguments[0]){return arguments[0];}else{return 0;}}},find:function(o){c=(typeof(arguments[0])=='object'&&arguments[0]!==null)?''+arguments[0]:arguments[0];if(this.compareTo(c)){if(this.left){delete c;return this.left.find(arguments[0]);}}else{if(this.o===c){delete c;return this.id;}else if(this.right){delete c;return this.right.find(arguments[0]);}}
delete c;return-1;},equals:function(o){if(typeof(arguments[0])=='object'&&arguments[0]!==null&&arguments[0].type==this.type){return(arguments[0]==this);}
return false;},toString:function(){return'[{'+this.type+'}@'+typeof(this.o)+','+this.o+']';},destroy:function(){if(this.left){this.left.destroy();}else if(this.right){this.right.destroy();}else if(this.parent){this.parent.pRemove(this);}},isComparable:function(o){if(typeof(arguments[0])=='undefined'||typeof(arguments[0])=='function'){return false;}
if(typeof(arguments[0])=='object'&&arguments[0]!==null&&true!==arguments[0].implementsComparable){return false;}
return true;},compareTo:function(o){if(arguments[0]&&arguments[0].o){return(this.o>arguments[0].o);}
return false;},pRemove:function(o){if(arguments[0].id==this.right.id){delete this.right;}else{delete this.left;}}};Pulse.SetStack=function(){this.id=Pulse.id();this.start=0;this.end=0;this.length=0;};Pulse.SetStack.prototype={implementsComparable:true,type:'SetStack',remove:function(){if(this.length!==(this.end-this.start)){throw({e:'SetStack.EXCEPTION',description:'STACK ERROR',start:this.start,end:this.end,length:this.length});}
this.length-=1;v=this[this.start];delete this[this.start];this.start+=1;return v;},add:function(o){if(arguments[0]){this.length+=1;this.end+=1;this[this.length]=arguments[0];}},equals:function(o){if(typeof(arguments[0])=='object'&&arguments[0]!==null&&arguments[0].type==this.type){return(arguments[0]==this);}
return false;},toString:function(){return'[{'+this.type+'}@'+this.id+']';}};Pulse.HashSet=function(o){this.length=0;this.id=Pulse.id();if(arguments[0]){this.addAll(arguments[0]);}
this.setstack=new Pulse.SetStack();this.setvalues={};};Pulse.HashSet.prototype={type:'HashSet',implementsComparable:true,add:function(o){if(this.rootvalue){value=new Pulse.SetValue(this.length,arguments[0]);if(true===this.rootvalue.add(value)){this[this.length]=arguments[0];this.setvalues[this.length]=value;this.length+=1;while(this.rootvalue.parent){this.rootvalue=this.rootvalue.parent;}
return true;}else{delete value;}}else{this.rootvalue=new Pulse.SetValue(this.length,arguments[0]);this.setvalues[this.length]=this.rootvalue;this[this.length]=arguments[0];this.length+=1;return true;}
return false;},clear:function(){delete this.wait;delete this;delete this.setstack;this.length=0;this.setstack=new Pulse.SetStack();if(this.rootvalue){this.rootvalue.destroy();delete this.rootvalue;}},clone:function(){s=new Pulse.HashSet();s.length=this.length;s.values=this;s.rootvalue=this.rootvalue;return s;},contains:function(o){if(this.isComparable(arguments[0])&&this.rootvalue){return this.rootvalue.find(arguments[0]);}
return-1;},iterator:function(){return new Pulse.SimpleIterator(this);},isEmpty:function(){return(0===this.length);},remove:function(o){if(this.isComparable(arguments[0])&&this.rootvalue){if(-1!==this.rootvalue.find(arguments[0])){if(true===this.wait){this.setstack.add(o);return;}
this.wait=true;pos=this.rootvalue.find(arguments[0]);if(this[pos].parent){if(this[pos].right){if(this[pos]>this[pos].parent){this[pos].right.parent=this[pos].parent;this[pos].parent.right=this[pos].right;if(this[pos].left){if(true===this[pos].parent.add(this[pos].left)){v=this[pos];delete this[pos];this.length-=1;delete this.wait;if(0!==this.setstack.length){return this.remove(this.setstack.remove());}
return v;}}}else{this[pos].right.parent=this[pos].parent;this[pos].parent.left=this[pos].right;this[pos].parent.add(this[pos].left);}}else if(this[pos].left){if(this[pos]>this[pos].parent){this[pos].left.parent=this[pos].parent;this[pos].parent.right=this[pos].left;}else{this[pos].left.parent=this[pos].parent;this[pos].parent.left=this[pos].left;}}else{if(this[pos]>this[pos].parent){delete this[pos].parent.right;}else{delete this[pos].parent.left;}}}else{if(this[pos].right){if(this[pos].left){if(true===this[pos].right.add(this[pos].left)){this.rootvalue=this[pos].right;}}else{this.rootvalue=this[pos].right;}}else if(this[pos].left){this.rootvalue=this[pos].left;}else{delete this.rootvalue;}}
if(this.rootvalue){delete this.rootvalue.parent;}
this.length-=1;v=this[pos].value;delete this[pos];delete this.wait;if(0!==this.setstack.length){return this.remove(this.setstack.remove());}
return v;}}
delete this.wait;if(0!==this.setstack.length){this.remove(this.setstack.remove());}},size:function(){return this.length;},hashCode:function(){throw({e:'HashMap.EXCEPTION',description:'NOT IMPLEMTED'});},removeAll:function(o){iterator=new Pulse.SimpleIterator(arguments[0]);if(iterator.hasNext()){while(iterator.hasNext()){this.remove(iterator.next());}
delete iterator;return true;}
delete iterator;return false;},addAll:function(o){iterator=new Pulse.SimpleIterator(arguments[0]);if(iterator.hasNext()){while(iterator.hasNext()){this.add(iterator.next());}
delete iterator;return true;}
delete iterator;return false;},containsAll:function(o){iterator=new Pulse.SimpleIterator(arguments[0]);while(iterator.hasNext()){pos=this.rootvalue.find(iterator.next());if(-1===pos){delete iterator;return false;}}
delete iterator;return true;},retainAll:function(o){THROW({e:'TODO',o:arguments[0]},this,'retainAll');return false;},toArray:function(){a=[];j=0;for(i in this){if((''+parseInt(''+i,10))!='NaN'){a[j]=this[i].o;j+=1;}}
delete j;return a;},equals:function(o){if(typeof(arguments[0])=='object'&&arguments[0]!==null&&arguments[0].type==this.type){return(arguments[0]==this);}
return false;},toString:function(){return'[{'+this.type+'}@'+this.id+'::'+this.size()+']';},isComparable:function(o){if(typeof(arguments[0])=='undefined'||typeof(arguments[0])=='function'){return false;}
if(typeof(arguments[0])=='object'&&arguments[0]!==null&&true!==arguments[0].implementsComparable){return false;}
return true;}};Pulse.Iterator=function(o){this.id=Pulse.id();this.index=0;this.end=0;this.length=0;if(arguments[0]){if(typeof(arguments[0])=='object'&&arguments[0]!=null){for(i in arguments[0]){if((''+parseInt(''+i,10))!='NaN'){if(typeof(arguments[0][i])!='undefined'){this[this.length]=arguments[0][i];this.length+=1;this.end+=1;}}}
return;}}
throw({e:'Iterator.EXCEPTION',o:o});};Pulse.Iterator.prototype={type:'Iterator',implementsComparable:true,hasNext:function(){return(this.index<this.end);},next:function(){this.index+=1;return this[this.index-1];},remove:function(){if(this.index>0){this.length-=1;delete this[this.index-1];}},equals:function(o){if(typeof(arguments[0])=='object'&&arguments[0]!==null&&arguments[0].type==this.type){return(arguments[0]==this);}
return false;},toString:function(){return'[{'+this.type+'}@'+this.id+'::'+this.length+'.'+this.index+'.'+this.end+']';}};Pulse.SimpleIterator=function(o){this.id=Pulse.id();this.index=0;this.length=0;if(arguments[0]){if(typeof(arguments[0])=='object'&&arguments[0]!=null){if(typeof(arguments[0].length)=='number'){this.length=arguments[0].length;this.o=arguments[0];return;}}}
throw({e:'SimpleIterator.EXCEPTION',o:o});};Pulse.SimpleIterator.prototype={type:'SimpleIterator',implementsComparable:true,hasNext:function(){if(typeof(this.o[this.index])!='undefined'){return true;}else{this.index+=1;if(this.index<this.length){return this.hasNext();}}},next:function(){this.index+=1;if(typeof(this.o[this.index-1])!='undefined'){return this.o[this.index-1];}else{if(this.index<this.length){return this.next();}}},remove:function(){throw({e:'SimpleIterator.EXCEPTION',description:'unsupported'});},equals:function(o){if(typeof(arguments[0])=='object'&&arguments[0]!==null&&arguments[0].type==this.type){return(arguments[0]==this);}
return false;},toString:function(){return'[{'+this.type+'}@'+this.id+'::'+this.length+'.'+this.index+']';}};Pulse.ObjectSorter=function(){this.length=0;};Pulse.ObjectSorter.prototype={add:function(o){},remove:function(){},find:function(){}};DBG.ImageGroupEditor=DBG.apply(DBG.Editor,{getButtons:{ImageGroupEditor:false},renameImageGroup:{click:false,call:false},removeImageGroup:{click:false,call:false},setAsMainImage:{click:false}});ImageGroupEditor={type:'ImageGroupEditor',DBG:false,getRenameButtonConfig:function(boolDisabled){renameButtonConfig={text:VIEWPORT_PROPERTIES.BUTTON_TEXT_RENAME,scope:this,disabled:(typeof(this.renameURL)=='string'&&this.renameURL!=='')?false:true,handler:function(){if(this.DBG){THROW({args:arguments},this,'renameImageGroup.click');}
this.renameImageGroup();},iconCls:'editIconCls'};return renameButtonConfig;},getRemoveButtonConfig:function(boolDisabled){removeButtonConfig={text:VIEWPORT_PROPERTIES.BUTTON_TEXT_DELETE,scope:this,disabled:(typeof(this.removeURL)=='string'&&this.removeURL!=='')?false:true,handler:function(){if(this.DBG){THROW({args:arguments},this,'removeImageGroup.click');}
this.removeImageGroup();},iconCls:'deleteIconCls'};return removeButtonConfig;},getButtons:function(){if(this.DBG){THROW({args:arguments,props:['renameURL','removeURL']},this,'getButtons.ImageGroupEditor');}
this.renameButtonConfig=this.getRenameButtonConfig();this.removeButtonConfig=this.getRemoveButtonConfig();return[new Ext.Toolbar.Button(this.renameButtonConfig),new Ext.Toolbar.Separator(),new Ext.Toolbar.Button(this.removeButtonConfig),new Ext.Toolbar.Separator()];},removeImageGroup:function(){if(this.DBG){THROW({args:arguments,props:['imagegroup','imagegroup.id','imagegroup.name']},this,'removeImageGroup.call');}
Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE+':&#160;"'
+this.imageGroup.name+' ('+this.imageGroup.id+')"',VIEWPORT_PROPERTIES.MSG_REALLYDELETE,function(response){if('yes'===response){params={contentid:this.getContent().id,imagegroupid:this.imageGroup.id};Ext.Ajax.request({url:this.removeURL,scope:this,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){this.masterEditor.destroyEditor(this,true);this.fireEvent('MSG','deletesuccess',this);}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this,'removeImageGroup');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this,'removeImageGroup');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this,'removeImageGroup');}},params:params});}},this);},renameImageGroup:function(){if(this.DBG){THROW({args:arguments,props:['imagegroup','imagegroup.id','imagegroup.name']},this,'renameImageGroup.call');}
Ext.Msg.prompt(VIEWPORT_PROPERTIES.NAME,VIEWPORT_PROPERTIES.TEXT_ENTER_NAME+':',function(btn,text){if(btn==='ok'){if(text.trim()===''){return;}
params={contentid:this.getContent().id,imagegroupid:this.imageGroup.id,name:text.trim()};this.masterEditor.showLoading(true);Ext.Ajax.request({url:this.renameURL,scope:this,method:'POST',success:function(response,options){this.masterEditor.showLoading();decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){this.imageGroup.name=options.params.name;this.masterEditor.setTitle(options.params.name+' (id: '+options.params.imagegroupid+')');this.fireEvent('MSG','savesuccess',this);}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this,'renameImageGroup');}},failure:function(response,options){this.masterEditor.showLoading();if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this,'renameImageGroup');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this,'renameImageGroup');}},params:params});}},this,false,this.imageGroup.name);},editorMSG:function(msgString,editor,masterEditor){if((msgString.toUpperCase()==='SAVESUCCESS')&&(editor.type=='ImageEditor')){this.masterEditor.loadPanel();}
Pulse.SubEditorPanel.superclass.editorMSG.call(this,msgString,editor,masterEditor);return;}};Pulse.ImageGroupEditor=Ext.extend(Pulse.Editor,ImageGroupEditor);DBG.ImageEditor=DBG.apply(DBG.Editor,{setImage:{AJAX:false,call:false}});ImageEditor={type:'ImageEditor',DBG:false,setImage:function(){if(this.DBG){THROW({args:arguments,props:['image.id','image.clazz','image.version','image.uri']},this,'setImage.call');}
if((typeof(this.dataURL)!='string'||this.dataURL==='')||(typeof(this.previewURL)!='string'||this.previewURL==='')){return;}
fileBrowserCFG={restriction:'img',scope:this,applyCallback:'setImageAJAX',id:this.image.id,uri:this.image.uri,dataURL:this.dataURL,previewURL:this.previewURL,upload:true,uploadProgressURL:this.fileBrowserUploadProgressURL};FileBrowser.open(fileBrowserCFG);},setImageAJAX:function(node){if(this.DBG){THROW({args:arguments,props:['image.id','image.clazz','image.version','image.uri']},this,'setImage.AJAX');}
if(typeof(this.changeImageURL)!='string'||this.changeImageURL===''){return;}
params={contentid:this.getContent().id,imagegroupid:this.masterEditor.imageGroup.id,vfsid:node.id,imageversion:this.image.version};Ext.Ajax.request({url:this.changeImageURL,scope:this,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){this.fireEvent('MSG','savesuccess',this);}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this,'setImageAJAX');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this,'setImageAJAX');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this,'setImageAJAX');}},node:node,params:params});}};Pulse.ImageEditor=Ext.extend(Pulse.Editor,ImageEditor);Pulse.LocaleSelector=function(config){this.type='LocaleSelector';this.id=(typeof(config.id)=='undefined')?Ext.id():config.id;if(typeof(config.store)=='undefined'){props=DBG.getPropertyArray(config);FATAL({args:arguments,props:props},this,'constructor');}
this.store=config.store;this.store.on({'beforeload':{fn:function(store,opts){opts.params.locale=this.getLocale();},scope:this}});this.box=new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:['locale'],sortInfo:{field:'locale',direction:"ASC"},data:(typeof(config.data)!='undefined')?config.data:VIEWPORT_PROPERTIES.getKnownLocalesForBox()}),displayField:'locale',valueField:'locale',mode:'local',triggerAction:'all',editable:false,width:120,emptyText:VIEWPORT_PROPERTIES.TEXT_SELECTLOCALE_BOX});this.items=[this.box];this.loadButton=new Ext.Toolbar.Button({tooltip:VIEWPORT_PROPERTIES.BUTTON_TEXT_LOAD,text:VIEWPORT_PROPERTIES.BUTTON_TEXT_LOAD,iconCls:'reloadIconCls',handler:function(){this.store.reload();},scope:this});this.items.push('&#160;');this.items.push(this.loadButton);this.getLocale=function(){return this.box.getValue();};this.reset=function(){this.box.reset();};};var LocalizationGrid={el:null,win:null,msgPanel:null,getGrid:function(config){store=this.buildGridStore(config);tbar=this.buildGridToolbar(config);cm=this.buildGridColumnModel(config);gridConfig={id:config.id,store:store,cm:cm,renderTo:config.renderTo,autoExpandColumn:'id',height:300,loadMask:true,viewConfig:{forceFit:true},title:(typeof(config.title)=='undefined')?VIEWPORT_PROPERTIES.LOCALIZATIONS:config.title,header:(typeof(config.header)=='undefined')?true:config.header,frame:(typeof(config.frame)!='boolean')?true:config.frame,style:(typeof(config.style)=='undefined')?'':config.style,enableHdMenu:false,clicksToEdit:1,tbar:tbar,locGridConfig:config};grid=new Ext.grid.EditorGridPanel(gridConfig);grid.setWidth(Ext.getCmp(config.handleId).getInnerWidth()-12);maxHeight=Ext.getCmp(config.handleId).getInnerHeight()-13;if(typeof(config.resizeHels)!='undefined'){for(i=0;i<config.resizeHels.length;i++){maxHeight=maxHeight-Ext.get(config.resizeHels[i]).getBox().height;}}
tabMsgPanel=Ext.getCmp(config.handleId+'.msgPanel');if(true!==tabMsgPanel.hidden){maxHeight=maxHeight-tabMsgPanel.getSize().height;}
grid.setHeight(maxHeight);Ext.getCmp(config.handleId).on({'resize':{fn:function(panel,adjWidth,adjHeight,rawWidth,rawHeight){grid=Ext.getCmp(config.id);grid.setWidth(panel.getInnerWidth()-12);maxHeight=Ext.getCmp(config.handleId).getInnerHeight()-13;if(typeof(config.resizeHels)!='undefined'){for(i=0;i<config.resizeHels.length;i++){if(typeof(Ext.get(config.resizeHels[i]))!='undefined'){maxHeight=maxHeight-Ext.get(config.resizeHels[i]).getBox().height;}}}
tabMsgPanel=Ext.getCmp(config.handleId+'.msgPanel');if(true!==tabMsgPanel.hidden){maxHeight=maxHeight-tabMsgPanel.getSize().height;}
grid.setHeight(maxHeight);}}});grid.on({'afteredit':{fn:function(obj){PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:config.handleType},{n:'id',o:config.handleId},{n:'msg',o:'CHANGE'}]});}},'beforeedit':{fn:function(obj){if(obj.field=='valueOne'){if(obj.record.get('langOne')===''){return false;}}
if(obj.field=='valueTwo'){if(obj.record.get('langTwo')===''){return false;}}}}});if(typeof(config.params)=='undefined'){params={init:true};}else{params=config.params;params.init=true;}
if(typeof(config.pageable)!='undefined'){params.start=0;params.limit=10;if(typeof(config.pagelimit)=='number'){params.limit=config.pagelimit;}}
store.load({params:params});grid.localizationConfig=config;return grid;},buildGridStore:function(config){storeConfig={pruneModifiedRecords:true,fields:this.getLocalizationRecord(config),root:'data',url:config.url};if(true===config.pageable){storeConfig.totalProperty='total';}
if(true===config.sortable){storeConfig.remoteSort=true;storeConfig.sortInfo={field:'name',direction:'ASC'};}
store=new Ext.data.JsonStore(storeConfig);store.on('beforeload',function(store,options){if(true===options.params.init){delete options.params.init;return;}
if(store.getModifiedRecords().length>0){PulseError.Throw(['DBG','conf-msg']);}
options.params.langOne=Ext.getCmp('box.1.'+config.id).getValue();if(typeof(config.cols)=='undefined'||config.cols!==1){options.params.langTwo=Ext.getCmp('box.2.'+config.id).getValue();}
if(true===config.pageable){}});store.on('load',function(store,loadedRecords,options){cm=Ext.getCmp(config.id).getColumnModel();if(typeof(options.params.langOne)!='undefined'&&options.params.langOne!==''){cm.setColumnHeader(2,VIEWPORT_PROPERTIES.FROM+':&#160;'+
VIEWPORT_PROPERTIES.getLanguage(options.params.langOne));}
if(typeof(options.params.langTwo)!='undefined'&&options.params.langTwo!==''){cm.setColumnHeader(3,VIEWPORT_PROPERTIES.TO+':&#160;'+
VIEWPORT_PROPERTIES.getLanguage(options.params.langTwo));}});return store;},getLocalizationRecord:function(config){arr=[{name:'id'},{name:'name'},{name:'langOne'},{name:'valueOne'}];if(typeof(config.cols)=='undefined'||config.cols!==1){arr.push({name:'langTwo'});arr.push({name:'valueTwo'});}
return new Ext.data.Record.create(arr);},buildGridToolbar:function(config){tbar=[];if(typeof(config.createURL)!='undefined'){tbar.push(new Ext.Action({text:VIEWPORT_PROPERTIES.BUTTON_TEXT_NEW,handler:function(){LocalizationGrid.createLocalization(config);},iconCls:'addIconCls'}));tbar.push('-');}
tbar.push('&#160;'+VIEWPORT_PROPERTIES.FROM+':&#160;');tbar.push(this.getLanguageBox('box.1.'+config.id));tbar.push('&#160;');if(typeof(config.cols)=='undefined'||config.cols!==1){tbar.push('&#160;'+VIEWPORT_PROPERTIES.TO+':&#160;');tbar.push(this.getLanguageBox('box.2.'+config.id));tbar.push('&#160;');}
tbar.push(new Ext.Action({text:VIEWPORT_PROPERTIES.BUTTON_TEXT_LOAD,handler:function(){Ext.getCmp(config.id).getStore().load({params:config.params});},iconCls:'reloadIconCls'}));tbar.push('-');return tbar;},buildGridColumnModel:function(config){columns=[{id:'id',header:'id:',dataIndex:'id',sortable:true,width:30,fixed:true}];if(true===config.sortable){columns.push({header:VIEWPORT_PROPERTIES.IDENTIFIER+':',dataIndex:'name',sortable:true,editor:new Ext.form.TextField({allowBlank:false})});}else{columns.push({header:VIEWPORT_PROPERTIES.IDENTIFIER+':',dataIndex:'name',sortable:false,editor:new Ext.form.TextField({allowBlank:false})});}
columns.push({header:VIEWPORT_PROPERTIES.FROM+':',dataIndex:'valueOne',editor:new Ext.form.TextField()});if(typeof(config.cols)=='undefined'||config.cols!==1){columns.push({header:VIEWPORT_PROPERTIES.TO+':',dataIndex:'valueTwo',editor:new Ext.form.TextField()});}
if(typeof(config.removeURL)!='undefined'){removeFieldRenderer=function(id){return FilterEditor.getGridImageField({functionString:'LocalizationGrid.removeLocalization('+id+',\''+config.id+'\')',iconCls:'deleteIconCls_14',qtip:VIEWPORT_PROPERTIES.BUTTON_TEXT_DELETE});};columns.push({header:'',dataIndex:'id',width:25,fixed:true,sortable:false,renderer:removeFieldRenderer});}
if(typeof(config.moveURL)!='undefined'){upFieldRenderer=function(id){return FilterEditor.getGridImageField({functionString:'LocalizationGrid.moveLocalization(\'up\','+id+', \''+config.id+'\')',iconCls:'upIconCls_14',qtip:VIEWPORT_PROPERTIES.UP});};columns.push({header:'',dataIndex:'id',width:25,fixed:true,sortable:false,renderer:upFieldRenderer});downFieldRenderer=function(id){return FilterEditor.getGridImageField({functionString:'LocalizationGrid.moveLocalization(\'down\','+id+', \''+config.id+'\')',iconCls:'downIconCls_14',qtip:VIEWPORT_PROPERTIES.DOWN});};columns.push({header:'',dataIndex:'id',width:25,fixed:true,sortable:false,renderer:downFieldRenderer});}
return new Ext.grid.ColumnModel(columns);},getLanguageBox:function(boxid){boxStore=new Ext.data.SimpleStore({fields:['code','localization'],data:VIEWPORT_PROPERTIES.getKnownLanguagesForBox()});return new Ext.form.ComboBox({id:boxid,store:boxStore,displayField:'localization',valueField:'code',mode:'local',triggerAction:'all',editable:false,emptyText:VIEWPORT_PROPERTIES.TEXT_SELECTLANGUAGE_BOX});},createLocalization:function(config){try{if(this.el===null){pel=VIEWPORT.getEl();if(typeof(pel)=='undefined'){throw('395 :: LocalizationGrid.createLocalization() :: '+'CHECK for element failed...');}
this.el=pel.createChild({tag:'div',id:'LocalizationGridWindow.el'});}
propNameField=new Ext.form.TextField({fieldLabel:VIEWPORT_PROPERTIES.NAME,name:'name',width:400,emptyText:VIEWPORT_PROPERTIES.TEXT_ENTER_NAME,allowBlank:false});formPanel=new Ext.form.FormPanel({id:'newPropForm',name:'newPropForm',region:'center',margins:'3 3 3 3',bodyStyle:'padding: 5px',defaultType:'textfield',autoHeight:true,items:[propNameField]});formPanel.addButton({text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CREATE,handler:function(){if(propNameField.getValue().trim()===''){return false;}
params=config.params;params.name=propNameField.getValue();Ext.getCmp(config.id).disable();Ext.Ajax.request({url:config.createURL,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);grid=Ext.getCmp(options.localizationGridId);grid.enable();if(true===decodedResponse.status){LocalizationGrid.win.close();Rec=LocalizationGrid.getLocalizationRecord(grid.localizationConfig);recConf={'id':decodedResponse.id,'name':options.params.name};bxOne=Ext.getCmp('box.1.'+options.localizationGridId);if(typeof(bxOne)!='undefined'&&bxOne!==null&&bxOne.getValue()!==''){recConf.langOne=bxOne.getValue();recConf.valueOne='';}
bxTwo=Ext.getCmp('box.2.'+options.localizationGridId);if(typeof(bxTwo)!='undefined'&&bxTwo!==null&&bxTwo.getValue()!==''){recConf.langTwo=bxTwo.getValue();recConf.valueTwo='';}
newRec=new Rec(recConf);grid.getStore().add(newRec);}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'LocalizationGrid','createLocalization()');}},failure:function(response,options){grid=Ext.getCmp(options.localizationGridId);grid.enable();if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'LocalizationGrid','createLocalization()');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'LocalizationGrid','createLocalization()');}},localizationGridId:config.id,params:params});}});formPanel.addButton({text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CANCEL,handler:function(){LocalizationGrid.win.close();}});this.msgPanel=new Ext.Panel({id:'LocalizationGridWindow.msgPanel',region:'north',html:'msgs go here',border:false,autoHeight:true});this.win=new Ext.Window({id:'LocalizationGridWindow',title:VIEWPORT_PROPERTIES.NEW,modal:true,plain:true,renderTo:this.el,height:130,layout:'border',items:[this.msgPanel,formPanel],width:600});this.msgPanel.hide();this.msgPanel.collapse();this.msgPanel.on('hide',function(){LocalizationGrid.win.doLayout(true);});this.win.setPagePosition((VIEWPORT.getSize().width/2)-300,100);this.win.show(this);propNameField.validate();}catch(windowInitError){alert('windowInitError: \n'+windowInitError);}},removeLocalization:function(localizedId,localizationGridId){Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE+':&#160"'+localizedId+'"',VIEWPORT_PROPERTIES.MSG_REALLYDELETE,function(response){if('yes'===response){grid=Ext.getCmp(localizationGridId);grid.disable();params=grid.localizationConfig.params;if(typeof(params)=='undefined'){params={localizedId:localizedId};}else{params.localizedId=localizedId;}
Ext.Ajax.request({url:grid.localizationConfig.removeURL,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);grid=Ext.getCmp(options.localizationGridId);grid.enable();if(true===decodedResponse.status){gridStore=grid.getStore();for(i=0;i<gridStore.getCount();i++){delRec=gridStore.getAt(i);if(delRec.get('id')==options.params.localizedId){gridStore.remove(delRec);break;}}
PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:grid.localizationConfig.handleType},{n:'id',o:grid.localizationConfig.handleId},{n:'msg',o:'DELETESUCCESS'}]});}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'FilterEditor','removeFilter()');}},failure:function(response,options){grid=Ext.getCmp(options.localizationGridId);grid.enable();if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'LocalizationGrid','removeLocalization()');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'LocalizationGrid','removeLocalization()');}},localizationGridId:localizationGridId,params:params});}},this);},moveLocalization:function(dir,localizedId,localizationGridId){grid=Ext.getCmp(localizationGridId);store=grid.getStore();if(dir==='up'){rec=store.getAt(0);if(rec.get('id')==localizedId){return;}}else{rec=store.getAt(store.getCount()-1);if(rec.get('id')==localizedId){return;}}
params=grid.localizationConfig.params;if(typeof(params)=='undefined'){params={localizedid:localizedId,dir:dir};}else{params.localizedid=localizedId;params.dir=dir;}
Ext.Ajax.request({url:grid.localizationConfig.moveURL,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){Ext.getCmp(options.gridId).getStore().reload();PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:grid.localizationConfig.handleType},{n:'id',o:grid.localizationConfig.handleId},{n:'msg',o:'SAVESUCCESS'}]});}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'LocalizationGrid','moveLocalization()');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'LocalizationGrid','moveLocalization()');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'LocalizationGrid','moveLocalization()');}},gridId:localizationGridId,params:params});}};var PulseMessageHandler={type:'MessageHandler',DBG:false,handle:function(handler){try{if(typeof(handler.length)!='number'){throw('handler.length != number');}else{for(i=0;i<handler.length;i++){if(handler[i].n.toUpperCase()=='ID'&&typeof(handler[i].o)=='string'){handleTabId=handler[i].o;}else if(handler[i].n.toUpperCase()=='MSG'&&typeof(handler[i].o)=='string'){handleMsg=handler[i].o.toUpperCase();}}}
tab=Ext.getCmp(handleTabId);tab.show();if(handleMsg=='CHANGE'){tab.isDirty=true;}else if(handleMsg=='SAVESUCCESS'||handleMsg=='RESET'){tab.isDirty=false;}
panelid=handleTabId+'.msgPanel';if(handleMsg=='RESET'){this.closeMsg(panelid);return;}
tabMsgPanel=Ext.getCmp(panelid);if(typeof(tabMsgPanel)=='undefined'||tabMsgPanel===null){if(this.DBG){throw('no msg-panel found...');}
return;}
tabMsgPanel.handleId=handleTabId;fireResize=!tabMsgPanel.isVisible();if(fireResize||tabMsgPanel.currentMsg!=handleMsg){tabMsgPanel.show();msgObj=this.getMsgObject(handleMsg);msgObj.id=panelid;MessageTemplate.overwrite(tabMsgPanel.body,msgObj);tabMsgPanel.currentMsg=handleMsg;tabMsgPanel.expand(true);if(true===fireResize){(function(){tab.fireEvent('resize',tab);}).defer(500);}}}catch(e){THROW({e:'FATAL',o:e,args:arguments,propsObj:handler,props:['length'],p:handler},this,'handle');}
if(this.DBG){THROW({args:arguments,p:handler},this,'handle');}},handleTab:function(handler){this.handle(handler);return;try{if(typeof(handler.length)!='number'){throw('handler.length != number');}else{for(i=0;i<handler.length;i++){if(handler[i].n.toUpperCase()=='ID'&&typeof(handler[i].o)=='string'){handleTabId=handler[i].o;}else if(handler[i].n.toUpperCase()=='MSG'&&typeof(handler[i].o)=='string'){handleMsg=handler[i].o.toUpperCase();}}}
tab=Ext.getCmp(handleTabId);tab.show();if(handleMsg=='CHANGE'){tab.isDirty=true;}else if(handleMsg=='SAVESUCCESS'){tab.isDirty=false;}
panelid=handleTabId+'.msgPanel';tabMsgPanel=Ext.getCmp(panelid);if(typeof(tabMsgPanel)=='undefined'){PulseError.Throw({e:'ERROR',p:[{n:'no msg-panel found...'},{n:'panelid',o:panelid}]},'PulseMessageHandler','handleWin()');}
tabMsgPanel.handleId=handleTabId;fireResize=!tabMsgPanel.isVisible();if(fireResize||tabMsgPanel.currentMsg!=handleMsg){tabMsgPanel.show();msgObj=this.getMsgObject(handleMsg);msgObj.id=panelid;MessageTemplate.overwrite(tabMsgPanel.body,msgObj);tabMsgPanel.currentMsg=handleMsg;tabMsgPanel.expand(true);if(true===fireResize){(function(){tab.fireEvent('resize',tab);}).defer(500);}}}catch(e){THROW({e:'FATAL',o:e,args:arguments,propsObj:handler,props:['length'],p:handler},this,'handle');}},handleWin:function(handler){this.handle(handler);return;try{if(typeof(handler.length)!='number'){PulseErrorWindow.Throw(['ERROR','handler.length != number','PulseMessageHandler','handleWin()']);return;}else{for(i=0;i<handler.length;i++){if(handler[i].n.toUpperCase()=='ID'&&typeof(handler[i].o)=='string'){handleWinId=handler[i].o;}else if(handler[i].n.toUpperCase()=='MSG'&&typeof(handler[i].o)=='string'){handleMsg=handler[i].o.toUpperCase();}}}
win=Ext.getCmp(handleWinId);win.show();if(handleMsg=='CHANGE'){win.isDirty=true;}else if(handleMsg=='SAVESUCCESS'){win.isDirty=false;}
winid=handleWinId+'.msgPanel';winMsgPanel=Ext.getCmp(winid);if(typeof(winMsgPanel)=='undefined'){PulseError.Throw({e:'ERROR',p:[{n:'no msg-panel found...'},{n:'panelid',o:winid}]},'PulseMessageHandler','handleWin()');}
winMsgPanel.handleId=handleWinId;fireResize=!winMsgPanel.isVisible();if(fireResize||winMsgPanel.currentMsg!=handleMsg){winMsgPanel.show();msgObj=this.getMsgObject(handleMsg);msgObj.id=winid;MessageTemplate.overwrite(winMsgPanel.body,msgObj);winMsgPanel.currentMsg=handleMsg;winMsgPanel.expand(true);if(true===fireResize){(function(){win.fireEvent('resize',win);}).defer(500);}}}catch(e){PulseError.Throw({e:'ERROR',o:e},'PulseMessageHandler','handleWin('+handler+')');}},getMsgObject:function(handleMsg){switch(handleMsg){case'CHANGE':return{cls:'yellowPanel',iconCls:'warningIconCls',msg:VIEWPORT_PROPERTIES.TEXT_UNSAVEDCHANGES};case'CHANGENOTSAVEABLE':return{cls:'redPanel',iconCls:'errorIconCls',msg:VIEWPORT_PROPERTIES.TEXT_CANNOTSAVECHANGES};case'SUCCESS':return{cls:'greenPanel',iconCls:'saveSuccessIconCls',msg:VIEWPORT_PROPERTIES.TEXT_SUCCESSDEFAULT};case'SAVESUCCESS':return{cls:'greenPanel',iconCls:'saveSuccessIconCls',msg:VIEWPORT_PROPERTIES.TEXT_SUCCESSSAVE};case'DELETESUCCESS':return{cls:'greenPanel',iconCls:'saveSuccessIconCls',msg:VIEWPORT_PROPERTIES.TEXT_SUCCESSDELETE};case'SAVEFAIL':return{cls:'redPanel',iconCls:'saveFailIconCls',msg:VIEWPORT_PROPERTIES.TEXT_ERRORSAVE};default:PulseErrorWindow.Throw(['TODO','impl switch.case for: "'+handleMsg+'" in PulseMessageHandler.getMsgObj()']);return{cls:'redPanel',iconCls:'warningIconCls',msg:'No LOC for: '+handleMsg};}},closeMsg:function(panelid){try{closeMsgPanel=Ext.getCmp(panelid);if(typeof(closeMsgPanel)!='undefined'&&closeMsgPanel!==null&&closeMsgPanel.isVisible()){closeMsgPanel.on('collapse',function(p){p.hide();panel=Ext.getCmp(p.handleId);if(panel!==null){panel.fireEvent('resize',panel);}});closeMsgPanel.collapse(true);}}catch(e){THROW({e:e,args:arguments},'PulseMessageHandler','closeMsg');}},handleAjaxError:function(error){switch(error.e.toUpperCase()){case'SERVER.ERROR':rc=PulseError.getRootCause(error);if(typeof(VIEWPORT_PROPERTIES[rc.e])!='undefined'){msgText=VIEWPORT_PROPERTIES[rc.e];}else{msgText=rc.e;}
Ext.Msg.show({title:'SERVER.ERROR:',msg:msgText,buttons:Ext.Msg.OK,icon:'errorIconCls_32'});break;case'REQUEST.ERROR':if(typeof(VIEWPORT_PROPERTIES.REQUESTERROR)!='undefined'){msgText=VIEWPORT_PROPERTIES.REQUESTERROR;}else{msgText='REQUEST.ERROR';}
Ext.Msg.show({title:'REQUEST.ERROR:',msg:msgText,buttons:Ext.Msg.OK,icon:'errorIconCls_32'});break;case'REQUEST.FAILED':if(typeof(VIEWPORT_PROPERTIES.REQUESTFAILED)!='undefined'){msgText=VIEWPORT_PROPERTIES.REQUESTFAILED;}else{msgText='REQUEST.FAILED';}
Ext.Msg.show({title:'REQUEST.FAILED:',msg:msgText,buttons:Ext.Msg.OK,icon:'errorIconCls_32'});break;default:PulseErrorWindow.Throw(['ERROR','NO CASE DEFINED: '+error.e.toUpperCase()]);}}};var MessageTemplate=new Ext.XTemplate('<div class="{cls}" style="cursor:pointer;text-align:center;" onclick="PulseMessageHandler.closeMsg(\'{id}\');" ','ext:qtip="'+VIEWPORT_PROPERTIES.BUTTON_TEXT_CLOSE+'">','<table border="0" cellpadding="0" cellspacing="0" style="width:95%;" align="center"><tr>','<td align="left"><img src="'+Ext.BLANK_IMAGE_URL+'" width="16" height="16" border="0" class="{iconCls}"/></td>','<td style="text-align:center;font-weight:bold;">{msg}</td>','<td align="right"><img src="'+Ext.BLANK_IMAGE_URL+'" width="16" height="16" border="0" class="{iconCls}"/></td>','</tr></table>','</div>');Pulse.MessageHandler=PulseMessageHandler;var PulseErrorRegistry={pDebug:false,registryTimestamp:null,ac:false,acInt:60000,cleanOnInit:true,errors:{pDebug:false,currentId:0,p:[],push:function(e){if(typeof(this.p)=='undefined'){this.p=[];}
d=new Date();e.eTimestamp=d.getTime();if(typeof(e.registryId)=='number'){cc=this.getErrors(e.registryId);if(typeof(cc)!='undefined'){if(this.pDebug===true){PulseErrorWindow.Throw(['INFO','PulseErrorRegistry.errors.push('+e+') returns id: '+e.registryId]);}
return e.registryId;}}
this.currentId++;e.registryId=this.currentId;this.p.push(e);if(this.pDebug===true){PulseErrorWindow.Throw(['INFO','PulseErrorRegistry.errors.push('+e+') pushed error id:'+e.registryId]);}
return e.registryId;},remove:function(o){id=o;if(typeof(o)!='number'){id=o.registryId;}
for(i=0;i<this.p.length;i++){e=this.p[i];if(typeof(e)!='undefined'){if(e.registryId==id){if(this.pDebug===true){PulseErrorWindow.Throw(['INFO','PulseErrorRegistry.errors.removed error, '+e.registryId]);}
e=null;break;}}}
this.clean();o=null;},getErrors:function(id){var result=[];for(i=0;i<this.p.length;i++){e=this.p[i];if(typeof(e)!='undefined'){if(e.registryId==id){return e;}
result.push(e);}}
if(typeof(id)!='number'){return result;}},get:function(id){if(this.pDebug===true){PulseErrorWindow.Throw(['INFO','PulseErrorRegistry.errors.get('+id+')']);}
return this.getErrors(id);},getSize:function(){return this.p.length;},clean:function(){this.p=this.getErrors();if(this.pDebug===true){PulseErrorWindow.Throw(['INFO','PulseErrorRegistry.errors.cleaned']);}}},register:function(e){id=this.errors.push(e);if(this.pDebug===true){PulseErrorWindow.Throw(['INFO','PulseErrorRegistry.registered error: '+id,'typeof(id): '+typeof(id)]);}
return id;},clean:function(boolResetErrors){if(boolResetErrors){this.errors.p=null;this.errors.p=[];this.errors.currentId=0;return;}
this.errors.clean();},remove:function(o){this.errors.remove(o);},get:function(id){if(typeof(Number(id))!='number'){if(this.pDebug===true){PulseErrorWindow.Throw(['INFO','PulseErrorRegistry.get() called with invalid id: '+id,'typeof(id): '+typeof(id)]);}
return;}
e=this.errors.get(Number(id));if(this.pDebug===true){PulseErrorWindow.Throw(['INFO','PulseErrorRegistry.get() returns error with id: '+e.registryId]);}
return e;},getSize:function(){size=this.errors.getSize();return size;},init:function(boolAutoClean,intCleanIntervall){if(this.cleanOnInit){this.clean(true);}
if(typeof(boolAutoClean)=='boolean'){this.ac=boolAutoClean;}
if(typeof(intCleanIntervall)=='number'){this.acInt=intCleanIntervall;}
d=new Date();this.registryTimestamp=d.getTime();if(this.pDebug===true){PulseErrorWindow.Throw(['INIT','PulseErrorRegistry','reg.registryTimestamp: '+this.registryTimestamp,'reg.cleanOnInit: '+this.cleanOnInit,'reg.autoclean: '+this.ac,'reg.autoclean-intervall: '+this.acInt]);}}};var PulseError={pDebug:false,getRootCauseMaxDepth:10,getRootCauseMaxDepthOld:10,Throw:function(e,identifier,functionName,handle){try{if(handle===true){throw({e:'HANDLE',o:this.getRootCause(e)});}
if(typeof(e.e)=='string'){if(e.e.toUpperCase()=='HANDLE'){handler=this.getHandle(e).toUpperCase();switch(handler){case'PANEL':PulseMessageHandler.handleTab(e.p);break;case'WIN':PulseMessageHandler.handleWin(e.p);break;default:throw({e:'HANDLE',o:this.getRootCause(e)});}
return;}else if(e.e.toUpperCase()=='SERVER.ERROR'||e.e.toUpperCase()=='REQUEST.ERROR'||e.e.toUpperCase()=='REQUEST.FAILED'){PulseMessageHandler.handleAjaxError(e);return;}}
if(true!==PulseErrorWindowDebug){return;}
if((typeof(e)!='object')){PulseErrorWindow.Throw(e);return;}
if(typeof(e.e)=='object'&&typeof(e.e.type)=='string'){args='';if(typeof(e.args)!='undefined'){args+=Pulse.getArgsString(e.args);}
if(false===e.e.DBG){PulseErrorWindow.Throw(['DBG','DBG.supressed - '+e.e.type+'.'+
functionName+'('+args+')']);return;}else{PulseErrorWindow.Throw(['DBG','DBG - '+e.e.type+'.'+
functionName+'('+args+')']);e.e=e.e.type;}}
if(e===null||(typeof(e.length)=='number')){PulseErrorWindow.Throw(e);return;}
rootCause=''+this.getRootCause(e).e;if(rootCause.charAt(0)=='<'){rootCause=''+e.e;}
outputArray=[rootCause];e.identifier=identifier;e.functionName=functionName;errorArray=this.getStringArray(e);outputArray=outputArray.concat(errorArray);if(true===this.pDebug){PulseErrorWindow.Throw(['INFO','PulseError.Throw(), e: '+e+', e.e: '+e.e+', e.o: '+e.o,'identifier: '+identifier+', functionName: '+functionName,'output.length: '+outputArray.length]);}
PulseErrorWindow.Throw(outputArray);}catch(result){if((typeof(result.e)=='string')&&(result.e=='HANDLE')){alert('TODO: HANDLE: '+e.e);}}
if(eval(handle)===false){PulseErrorWindow.Throw(['INFO','suppressed error -> eval(handle): '+eval(handle),'e.e: '+e.e,e]);return;}},getRootCause:function(e,intMaxDepth){if(true===this.pDebug){PulseErrorWindow.Throw(['INFO','PulseError.getRootCause.called','with e: '+e,'with e.e: '+e.e,'with e.o: '+e.o,'with intMaxDepth: '+intMaxDepth]);}
if(typeof(intMaxDepth)=='number'){this.getRootCauseMaxDepthOld=this.getRootCauseMaxDepth;this.getRootCauseMaxDepth=intMaxDepth;}
error=this.getRootCauseRecursively(e,0);this.getRootCauseMaxDepth=this.getRootCauseMaxDepthOld;if(true===this.pDebug){PulseErrorWindow.Throw(['INFO','PulseError.getRootCause','returns error: '+error,'returns error.e: '+error.e]);}
return error;},getRootCauseRecursively:function(e,intCurrentRecursion){if(true===this.pDebug){PulseErrorWindow.Throw(['INFO','getRootCauseRecursively( '
+e+' , '+intCurrentRecursion+' )']);}
intCurrentRecursion++;if(intCurrentRecursion==this.getRootCauseMaxDepth){if(true===this.pDebug){PulseErrorWindow.Throw(['TODO','CHECK','PulseError','getRootCauseRecursively()','getRootCauseMaxDepth: '+this.getRootCauseMaxDepth+' !!! reached !!!']);}
return e;}
try{checkError=e.e;checkObject=e.o;if(typeof(checkError)!='undefined'&&checkError!==null){if(typeof(checkError)=='object'){e=this.getRootCauseRecursively(checkError,intCurrentRecursion);}
if(typeof(checkError)=='string'){if(typeof(checkObject)!='undefined'){e=this.getRootCauseRecursively(checkObject,intCurrentRecursion);}}}
return e;}catch(recursionError){er={e:'FATAL',p:[{n:'getRootCauseMaxDepth',o:this.getRootCauseMaxDepth},{n:'intCurrentRecursion',o:intCurrentRecursion},{n:'recursionError',o:recursionError}]};return er;}},getStringArray:function(e){try{var errorId=-1;error=[e.e,'e typeof: '+typeof(e),'e.e: '+e.e];error.push('e.identifier: '+e.identifier);error.push('e.functionName: '+e.functionName);if(typeof(e)!='undefined'){error.push('e.o typeof: '+typeof(e.o));error.push('e.o toString: '+e.o);error.push('');error.push('ARGS');try{paramArray=this.getParamStringArray(e.args);error=error.concat(paramArray);}catch(getParamFailure){error.push('ERROR :: getParamFailure: '+getParamFailure);}
error.push('');error.push('PARAMS');try{paramArray=this.getParamStringArray(e.p);error=error.concat(paramArray);}catch(getParamFailure){error.push('ERROR :: getParamFailure: '+getParamFailure);}}
if(typeof(e.e)=='object'){errorId=PulseErrorRegistry.register(e.e);error.push('registered e.e id: '+errorId+', e.e.e: '+e.e.e);}
if((typeof(e.e)=='string')&&(typeof(e.o)=='object')){errorId=PulseErrorRegistry.register(e.o);error.push('registered e.o id: '+errorId+', e.o.e: '+e.o.e);}
if(errorId!=-1){if(errorId==e.registryId){error.push('');error.push('TODO check on error nesting exception');error.push('');}
error.push('**errorid**');error.push(errorId);}
error.push('*');if(true===this.pDebug){PulseErrorWindow.Throw(['INFO','PulseError.getStringArray() :: returns error.length: '+error.length]);}
return error;}catch(getStringArrayError){PulseErrorWindow.Throw(['ERROR','PulseError.getStringArray() :: error.length: '+getStringArrayError.length,'PulseError.getStringArray() :: typeof error: '+typeof(getStringArrayError),'PulseError.getStringArray() :: error: '+getStringArrayError]);return[getStringArrayError];}},getParamStringArray:function(params){try{paramStringArray=['typeof: '+typeof(params)];if(typeof(params)=='undefined'){return paramStringArray;}
if(typeof(params.length)!='number'){paramStringArray.push('typeof: no Array');return paramStringArray;}
paramStringArray.push('length: '+params.length);if(params.length===0){return paramStringArray;}
paramStringArray.push('');for(i=0;i<params.length;i++){param=params[i];paramStringArray.push('['+i+'] typeof: '+typeof(param)+', toString: '+param);if(typeof(param.n)!='undefined'){paramStringArray.push('['+i+'].n typeof: '+typeof(param.n)+', toString: '+param.n);}
if(typeof(param.o)!='undefined'){paramStringArray.push('['+i+'].o typeof: '+typeof(param.o)+', toString: '+param.o);}
paramStringArray.push('');}
return paramStringArray;}catch(getParamStringArrayError){PulseErrorWindow.Throw(['ERROR','PulseError.getParamStringArray() :: error.length: '+getParamStringArrayError.length,'PulseError.getParamStringArray() :: typeof error: '+typeof(getParamStringArrayError),'PulseError.getParamStringArray() :: error: '+getParamStringArrayError]);return[getParamStringArrayError];}},getHandle:function(e){if(typeof(e.p)!='undefined'&&typeof(e.p.length)=='number'&&e.p.length>0){for(i=0;i<e.p.length;i++){if(typeof(e.p[i])=='object'){if(typeof(e.p[i].n)=='string'&&e.p[i].n.toUpperCase()=='HANDLE'&&typeof(e.p[i].o)=='string'){return e.p[i].o.toUpperCase();}}}}}};Ext.onReady(function(){(function(){PulseErrorRegistry.cleanOnInit=false;PulseErrorRegistry.init();}).defer(5000);});var PulseErrorWindow={pDebug:true,acceptState:true,win:null,tabPanel:null,dbgPanel:null,logPanel:null,infoPanel:null,initPanel:null,todoPanel:null,logLevel:{LOG:true,HANDLE:true,TODO:true,DBG:true,INFO:true,INIT:true},buildConfig:[{title:'DBG',id:'PulseError.js.window.dbg.string'},{title:'INFO',id:'PulseError.js.window.info.string'}],panelIds:{DBG:'PulseError.js.window.dbg.string',LOG:'PulseError.js.window.dbg.string',INIT:'PulseError.js.window.info.string',INFO:'PulseError.js.window.info.string'},outputConfig:{fontSize:9,linePrefix:'>> ',separator:'<div style="height: 3px; font-size: 3px;"> </div>',outputContinues:'<div>...</div>',defaultStyle:'',ERROR:'style="color:#FF0000;"',DBG:'',HANDLE:'',INIT:'style="color:#0000FF; font-size: 8px;"',TODO:'style="color:#00CC00;"',INFO:'style="color:#555555;"'},Throw:function(o,boolShow){if(this.acceptState===false){return;}
try{output=this.prepareOutput(o);if(typeof(output.display)!='boolean'){throw({e:'EXPECTED.BOOL',n:'output.display',o:output.display});}
if(output.display===false){return;}
if(this.win===null){this.init();test='DBG';init=this.prepareOutput(['INIT','PulseErrorWindow','PulseErrorWindowDebug :: typeof(eval(PulseErrorWindowDebug): '+
typeof(eval(PulseErrorWindowDebug)),'PulseErrorWindowDebug :: eval(PulseErrorWindowDebug): '+
eval(PulseErrorWindowDebug)+' : str: '+PulseErrorWindowDebug,'TEST :: typeof(eval(true)) : '+typeof(eval(true)),'TEST :: typeof(eval("true")) : '+typeof(eval('true')),'TEST :: typeof(eval("var " + test + ";")) : '+typeof(eval('var '+test+';')),'','TEST :: var test = "DBG";','TEST :: typeof(eval(test + " = new Object();")) : '+typeof(eval(test+' = new Object();')),'TEST :: typeof(this.panelIds.test) : '+typeof(this.panelIds.test)]);this.output(init);}
this.output(output);if(false===boolShow){return;}else{this.win.show();}}catch(ee){args='';try{args=Pulse.getArgsString(arguments);}catch(eee){args=eee;}
alert('FATAL WIN.THROW('+args+')\n\n'+ee);}},prepareOutput:function(o){try{if(PulseErrorWindowDebug!==true){return{display:false};}
if(typeof(o)=='string'){return{display:true,html:o,title:'str'};}
if(typeof(o)!='object'||o===null){html='<div>typeof: '+typeof(o)+'</div>';html='<div>string: '+o+'</div>';return{display:true,html:html,title:'!{o}'};}
if(typeof(o.length)!='number'){html='<div>typeof: '+typeof(o)+'</div>';html='<div>string: '+o+'</div>';return{display:true,html:html,title:'{o}'};}
var string=o[0]+'';if(string===''){html=this.formatArray(o);return{display:true,html:html,title:'[o]'};}
switch(string.toUpperCase()){case'HANDLE':if(this.logLevel.HANDLE!==true){return{display:false};}
html=this.formatArray({array:o,prefix:string,style:this.outputConfig.HANDLE});return{display:true,html:html,type:string,title:string};case'TODO':if(this.logLevel.TODO!==true){return{display:false};}
html=this.formatArray({array:o,prefix:string,style:this.outputConfig.TODO});return{display:true,html:html,type:string,title:string};case'DBG':if(this.logLevel.DBG!==true){return{display:false};}
html=this.formatArray({array:o,prefix:string,style:this.outputConfig.DBG});return{display:true,html:html,type:string,title:string};case'INFO':if(this.logLevel.INFO!==true){return{display:false};}
html=this.formatArray({array:o,prefix:string,style:this.outputConfig.INFO});return{display:true,html:html,type:string,title:string};case'INIT':if(this.logLevel.INIT!==true){return{display:false};}
html=this.formatArray({array:o,prefix:string,style:this.outputConfig.INIT});return{display:true,html:html,type:string,title:string};case'LOG':if(this.logLevel.LOG!==true){return{display:false};}
html=this.formatArray({array:o,prefix:string,style:this.outputConfig.LOG});return{display:true,html:html,type:string,title:string};default:html=this.formatArray(o,true);return{display:true,html:html,title:string};}}catch(prepareOutputError){alert('FATAL :: PulseErrorWindow.prepareOutputError :: \n'+prepareOutputError);}},output:function(out){if(typeof(out.type)=='string'){panel=this.getPropertie(out.type);if(typeof(panel)!='undefined'&&panel!==null){panel.body.createChild({tag:'div',html:out.html});return;}}
title=out.title;if(title.length>15){title=out.title.substring(0,14)+'...';}
this.tabPanel.add({title:title,tabTip:out.title,closable:true,autoscroll:true,html:out.html}).show();},formatArray:function(obj,boolFirstRed){result='';var fetchId=-1;objIsArray=false;if(typeof(obj.length)=='number'){objIsArray=true;if((typeof(boolFirstRed)=='boolean')&&(boolFirstRed===true)){result+='<div '+this.outputConfig.ERROR+'>'+
this.outputConfig.linePrefix+obj[0]+'</div>';for(i=1;i<obj.length;i++){outputObj=obj[i];if(outputObj=='**errorid**'){fetchId=obj[i+1];i+=2;continue;}
result+='<div '+this.outputConfig.defaultStyle+'>'+
this.outputConfig.linePrefix+outputObj+'</div>';}}else{for(i=0;i<obj.length;i++){outputObj=obj[i];result+='<div '+this.outputConfig.defaultStyle+'>'+
this.outputConfig.linePrefix+outputObj+'</div>';}}}else{if(typeof(obj.array)=='undefined'){result+='<div '+this.outputConfig.ERROR+'>'+'ERROR PulseErrorWindow.formatArray<br />'+'ERROR no output object received<br />'+'ERROR object typeof: '+typeof(obj)+'<br />'+'ERROR string version:<br />'+obj+'</div>';}else{style=this.outputConfig.defaultStyle;prefix=this.outputConfig.linePrefix;if(typeof(obj.style)!='undefined'){style=' '+obj.style;}
start=0;if(typeof(obj.prefix)!='undefined'){prefix='['+obj.prefix+'] ';if(obj.array[0]==obj.prefix){start=1;}}
for(i=start;i<obj.array.length;i++){outputObj=obj.array[i];if(outputObj=='**errorid**'){fetchId=obj.array[i+1];i+=2;continue;}
result+='<div'+style+'>'+
prefix+outputObj+'</div>';}}}
if(fetchId!=-1){result+=this.outputConfig.outputContinues;try{result+=this.tryRegisteredError(fetchId);}catch(check){result+='<div>ERROR fetch: '+fetchRegistered+'<br />'+check+'</div>';}}
result+=this.outputConfig.separator;return result;},getPropertie:function(identifier,propertie){if(typeof(identifier)!='string'){return;}
ident=identifier.toUpperCase();var prop;if(typeof(propertie)=='string'&&propertie!==''){prop=propertie.toUpperCase();}
switch(ident){case'DBG':if(typeof(prop)!='string'){return this.dbgPanel;}
break;case'TODO':if(typeof(prop)!='string'){return this.todoPanel;}else{if(prop=='STYLE'){return this.outputConfig.TODO;}}
break;case'INFO':if(typeof(prop)!='string'){return this.infoPanel;}else{if(prop=='STYLE'){return this.outputConfig.INFO;}}
break;case'INIT':if(typeof(prop)!='string'){return this.initPanel;}else{if(prop=='STYLE'){return this.outputConfig.INIT;}}
break;case'LOG':if(typeof(prop)!='string'){return this.logPanel;}else{if(prop=='STYLE'){return this.outputConfig.LOG;}}
break;}
return;},tryRegisteredError:function(id){try{obj=PulseErrorRegistry.get(id);if(typeof(obj)=='undefined'){return'no error received at PulseErrorWindow.tryRegisteredError.PulseErrorRegistry.get(id)';}
if(typeof(obj.eTimestamp)=='undefined'){if(typeof(obj.length)=='number'){return this.formatArray(obj);}
return''+obj;}
errorArray=PulseError.getStringArray(obj);return this.formatArray(errorArray,true);}catch(tryRegisteredErrorError){errorString='<div style="color: red;">>>tryRegisteredError.id: '+id+'</div>';errorString+='<div style="color: red;">>> '+tryRegisteredErrorError+'</div>';return errorString;}},init:function(){try{panels=[];for(i=0;i<this.buildConfig.length;i++){cfgObj=this.buildConfig[i];panel=this.getInitPanel(cfgObj);panels.push(panel);}
tabpanel=new Ext.TabPanel({id:'PulseError.js.window.tabpanel',region:'center',enableTabScroll:true,resizeTabs:false,deferredRender:false,defaults:{autoScroll:true},plugins:new Ext.ux.TabCloseMenu(),activeTab:0,bodyStyle:'font-size: '+this.outputConfig.fontSize+'px;',items:panels});pel=Ext.get(document.body);if(typeof(pel)=='undefined'){throw('618 :: PULSE.PulseError.js.ThrowWindow() :: '+'CHECK for element failed...');}
el=pel.createChild({tag:'div',id:'PulseError.js.window.el'});windowCfg={id:'PulseError.js.window',maximizable:false,title:'PulseErrorWindow.win',closable:true,plain:true,modal:false,renderTo:el,height:300,width:750,layout:'border',items:tabpanel};win=new Ext.Window(windowCfg);win.on({'beforeclose':{fn:function(pwin){pwin.hide();return false;}},'show':{fn:function(pwin){pwin.setPosition(10,10);}}});this.win=win;this.setPanels();}catch(initError){this.acceptState=false;if(this.pDebug===true){alert('window.initError'+initError);}}},getInitPanel:function(cfg){panel=new Ext.Panel({id:cfg.id,title:cfg.title,closable:false,autoscroll:true,html:'...panel initialized'});return panel;},setPanels:function(){this.tabPanel=Ext.getCmp('PulseError.js.window.tabpanel');this.dbgPanel=this.tabPanel.getComponent(this.panelIds.DBG);this.logPanel=this.tabPanel.getComponent(this.panelIds.LOG);this.infoPanel=this.tabPanel.getComponent(this.panelIds.INFO);this.initPanel=this.tabPanel.getComponent(this.panelIds.INIT);this.todoPanel=this.tabPanel.getComponent(this.panelIds.TODO);}};Record={type:'PulseRecord',implementsComparable:true,equals:function(o){if(typeof(o)=='object'&&o!==null&&o.type==this.type){return(o==this);}
return false;},toString:function(){return'[{'+this.type+'}@'+this.id+']';}};Pulse.Record=Ext.extend(Ext.data.Record,Record);Pulse.Record.create=function(o){var f=Ext.extend(Pulse.Record,{});var p=f.prototype;p.fields=new Ext.util.MixedCollection(false,function(field){return field.name;});for(var i=0,len=o.length;i<len;i++){p.fields.add(new Ext.data.Field(o[i]));}
f.getField=function(name){return p.fields.get(name);};return f;};PULSE.RegistryTreeNodeUI=function(){PULSE.RegistryTreeNodeUI.superclass.constructor.apply(this,arguments);};Ext.extend(PULSE.RegistryTreeNodeUI,Ext.tree.TreeNodeUI,{disableFnClicks:false,defaultIconCls:'x-tree-node-icon ',beforeIconCls:'',loadIconCls:'nodeLoadingIconCls',functionsIconSize:14,renderElements:function(n,a,targetNode,bulkRender){if(typeof(n.getOwnerTree().iconRenderer)=='function'){a.iconCls=n.getOwnerTree().iconRenderer(a);}else{if(a.type!='dir'){if(a.bundle){a.iconCls=a.bundle+'BundleIcon';}
if(a.country){a.iconCls=a.country+'FlagCls';}
if(a.contentType){contentTypeArray=a.contentType.split('.');a.iconCls=contentTypeArray.join('');}}}
styleString='margin-bottom: 2px; padding: 0px; border: 0px; vertical-align: middle;';id=Ext.id();var pulseLinkArray=['&#160;<a href="#" style="font-weight: bold" id="selectEl_'+n.id+'.'+id+'">'+'<img src="'+Ext.BLANK_IMAGE_URL+'" '+'width="'+this.functionsIconSize+'" '+'height="'+this.functionsIconSize+'" '+'style="'+styleString+'" '+'class="selectIconCls_'+this.functionsIconSize+'" '+'ext:qtip="'+VIEWPORT_PROPERTIES.BUTTON_TEXT_SELECT+'" />'+'</a>&#160;','&#160;<a href="#" style="font-weight: bold" id="crtEl_'+n.id+'.'+id+'">'+'<img src="'+Ext.BLANK_IMAGE_URL+'" '+'width="'+this.functionsIconSize+'" '+'height="'+this.functionsIconSize+'" '+'style="'+styleString+'" '+'class="addIconCls_'+this.functionsIconSize+'" '+'ext:qtip="'+VIEWPORT_PROPERTIES.BUTTON_TEXT_CREATE+'" />'+'</a>&#160;','&#160;<a href="#" style="font-weight: bold" id="edtEl_'+n.id+'.'+id+'">'+'<img src="'+Ext.BLANK_IMAGE_URL+'" '+'width="'+this.functionsIconSize+'" '+'height="'+this.functionsIconSize+'" '+'style="'+styleString+'" '+'class="editIconCls_'+this.functionsIconSize+'" '+'ext:qtip="'+VIEWPORT_PROPERTIES.BUTTON_TEXT_EDIT+'" />'+'</a>&#160;','&#160;<a href="#" style="font-weight: bold" id="delEl_'+n.id+'.'+id+'">'+'<img src="'+Ext.BLANK_IMAGE_URL+'" '+'width="'+this.functionsIconSize+'" '+'height="'+this.functionsIconSize+'" '+'style="'+styleString+'" '+'class="deleteIconCls_'+this.functionsIconSize+'" '+'ext:qtip="'+VIEWPORT_PROPERTIES.BUTTON_TEXT_DELETE+'" />'+'</a>&#160;'];var pulseLinks='';if(a.mode==='select'){pulseLinks=pulseLinkArray[0];}
if(typeof(a.createURL)!='undefined'){pulseLinks+=pulseLinkArray[1];}
if(typeof(a.editURL)!='undefined'){pulseLinks+=pulseLinkArray[2];}
if(typeof(a.deleteURL)!='undefined'){pulseLinks+=pulseLinkArray[3];}
this.indentMarkup=n.parentNode?n.parentNode.ui.getChildIndent():'';var cb=typeof a.checked=='boolean';var href=a.href?a.href:Ext.isGecko?"":"#";var buf=['<li class="x-tree-node"><div ext:tree-node-id="',n.id,'" class="x-tree-node-el x-tree-node-leaf ',a.cls,'">','<span class="x-tree-node-indent">',this.indentMarkup,"</span>",'<img src="',this.emptyIcon,'" class="x-tree-ec-icon x-tree-elbow" />','<img src="',a.icon||this.emptyIcon,'" class="x-tree-node-icon',(a.icon?" x-tree-node-inline-icon":""),(a.iconCls?" "+a.iconCls:""),'" unselectable="on" style="width:18px"/>',cb?('<input class="x-tree-node-cb" type="checkbox" '+(a.checked?'checked="checked" />':'/>')):'','<a hidefocus="on" class="x-tree-node-anchor" href="',href,'" tabIndex="1" ',a.hrefTarget?' target="'+a.hrefTarget+'"':"",' dir="LTR"><span unselectable="on">',n.text,"</span></a>",pulseLinks,"</div>",'<ul class="x-tree-node-ct" style="display:none;"></ul>',"</li>"].join('');if(bulkRender!==true&&n.nextSibling&&n.nextSibling.ui.getEl()){this.wrap=Ext.DomHelper.insertHtml("beforeBegin",n.nextSibling.ui.getEl(),buf);}else{this.wrap=Ext.DomHelper.insertHtml("beforeEnd",targetNode,buf);}
this.elNode=this.wrap.childNodes[0];this.ctNode=this.wrap.childNodes[1];var cs=this.elNode.childNodes;this.indentNode=cs[0];this.ecNode=cs[1];this.iconNode=cs[2];var index=3;if(cb){this.checkbox=cs[index];index++;}
this.anchor=cs[index];this.textNode=cs[index].firstChild;this.buildQTip(this,a);if(a.mode=='select'){var selectEl=Ext.get('selectEl_'+n.id+'.'+id);selectEl.on('click',this.selectNode,null,{node:n});return;}
if(typeof(a.createURL)!='undefined'){var createEl=Ext.get('crtEl_'+n.id+'.'+id);createEl.on('click',this.createNode,null,{node:n});}
if(typeof(a.editURL)!='undefined'){var editEl=Ext.get('edtEl_'+n.id+'.'+id);editEl.on('click',this.editNode,null,{node:n});}
if(typeof(a.deleteURL)!='undefined'){var deleteEl=Ext.get('delEl_'+n.id+'.'+id);deleteEl.on('click',this.deleteNode,null,{node:n});}},buildQTip:function(ui,a){if(typeof(ui)=='undefined'||typeof(a)=='undefined'||ui===null){return;}
text='<span style="font-style: italic">id:</span> '+a.id;if(typeof(a.locale)!='undefined'){text+='<br /><span style="font-style: italic">locale:</span> '+a.locale;}
if(typeof(a.contentId)!='undefined'){text+='<br /><hr /><span style="font-weight: bold">content</span><br />'+'<span style="font-style: italic">id:</span> '+a.contentId+'<br />'+'<span style="font-style: italic">name:</span> '+a.text+'<br />'+'<span style="font-style: italic">bundle:</span> '+a.bundle+'<br />'+'<span style="font-style: italic">type:</span> '+a.contentType;}
try{Ext.QuickTips.register({target:ui.textNode,title:''+a.text,text:text});}catch(e){PulseError.Throw({e:'DBG',o:e,p:[{n:'error',o:'Ext.QuickTips.register.failed'}]},'PULSE.RegistryTreeNode','buildQTip');}},selectNode:function(ev,target,options){if(this.disableFnClicks===true){return;}
tree=options.node.getOwnerTree();if(tree.onSelectNodeClick!==null){tree.onSelectNodeClick(options.node);}
return false;},createNode:function(ev,target,options){tree=options.node.getOwnerTree();tree.editor.createNode(options.node);return false;},editNode:function(ev,target,options){tree=options.node.getOwnerTree();tree.editor.editNode(options.node);return false;},deleteNode:function(ev,target,options){tree=options.node.getOwnerTree();tree.editor.deleteNode(options.node);return false;},setBusy:function(bool){if(true===bool){this.toggleIconCls(this.loadIconCls);return;}
this.toggleIconCls();},toggleIconCls:function(clsString){if(typeof(clsString)=='string'){if(this.iconNode.getAttributeNode('class').nodeValue!=this.loadIconCls){this.beforeIconCls=this.iconNode.getAttributeNode('class').nodeValue;}
this.iconNode.getAttributeNode('class').nodeValue=this.defaultIconCls+clsString;return;}
if(typeof(this.beforeIconCls)=='string'&&this.beforeIconCls!==''){this.iconNode.getAttributeNode('class').nodeValue=this.beforeIconCls;}},updateExpandIcon:function(){if(this.rendered){var n=this.node,c1,c2;if(true===n.attributes.has_Children&&true===n.isLoaded()&&n.childNodes.length===0){n.attributes.has_Children=false;n.attributes.expandable=false;}
var cls=n.isLast()?"x-tree-elbow-end":"x-tree-elbow";if((true===n.attributes.has_Children&&true===n.attributes.expandable)||(true===n.hasChildNodes()&&true===n.isLoaded()&&n.childNodes.length>0)){if(n.expanded){cls+="-minus";c1="x-tree-node-collapsed";c2="x-tree-node-expanded";}else{cls+="-plus";c1="x-tree-node-expanded";c2="x-tree-node-collapsed";}
this.removeClass("x-tree-node-leaf");if(this.c1!=c1||this.c2!=c2){Ext.fly(this.elNode).replaceClass(c1,c2);this.c1=c1;this.c2=c2;}}else{this.removeClass("x-tree-node-leaf");Ext.fly(this.elNode).replaceClass("x-tree-node-expanded","x-tree-node-collapsed");}
var ecc="x-tree-ec-icon "+cls;this.ecNode.className=ecc;this.ecc=ecc;}}});PULSE.RegistryRootTreeNodeUI=function(){PULSE.RegistryRootTreeNodeUI.superclass.constructor.apply(this,arguments);};Ext.extend(PULSE.RegistryRootTreeNodeUI,PULSE.RegistryTreeNodeUI,{render:function(){if(!this.rendered){var targetNode=this.node.ownerTree.innerCt.dom;this.node.expanded=true;targetNode.innerHTML='<div class="x-tree-root-node"></div>';this.wrap=this.ctNode=targetNode.firstChild;}},collapse:function(){},expand:function(){}});DBG.SelectBoxEditorWrapper=DBG.apply(DBG.Editor,{initComponent:{SelectBoxEditorWrapper:false},onRender:false});SelectBoxEditorWrapper={type:'SelectBoxEditorWrapper',DBG:DBG.SelectBoxEditorWrapper,hasChanges:function(){superBool=Pulse.SelectBoxEditorWrapper.superclass.hasChanges.call(this);return(superBool||(this.initialValue!=this.getValue()));},getChanges:function(v){v=Pulse.SelectBoxEditorWrapper.superclass.getChanges.call(this,v);if(false===this.hasChanges()&&true!==this.getChangesAlways){return v;}
if(typeof(v)=='undefined'){v={};}
v[this.el.dom.name]=this.getValue();return v;},commit:function(){if(false===this.fireEvent('MSG','beforecommit',this)){return false;}
this.initialValue=this.getValue();this.setBoxColor();this.fireEvent('MSG','commit',this);},reset:function(){if(false===this.fireEvent('MSG','beforereset',this)){return false;}
this.setValue(this.initialValue);this.setBoxColor();this.fireEvent('MSG','reset',this);},setValue:function(value){if(this.getValue()==value){return;}
options=this.el.dom.options;contains=false;for(var i=0;i<options.length;i++){if(options[i].value==value){options[i].selected=true;contains=true;}else{options[i].selected=false;}}
if(true===contains){if(value!=this.initialValue){this.fireEvent('MSG','change',this);this.setBoxColor('y');}else{this.fireEvent('MSG','reset',this);this.setBoxColor();}
return;}
throw({e:'UNDEFINED VALUE',o:this,description:'value not in box'});},getValue:function(){return this.el.getValue();},setBoxColor:function(color){THROW({o:'COLOR',args:arguments},this,'setBoxColor');if(typeof(color)!='string'){this.el.replaceClass(Pulse.fieldCls+'Yellow',Pulse.fieldCls);this.el.replaceClass(Pulse.fieldCls+'Red',Pulse.fieldCls);return;}
_color=color.toUpperCase();switch(_color){case'R':this.el.replaceClass(Pulse.fieldCls,Pulse.fieldCls+'Red');this.el.replaceClass(Pulse.fieldCls+'Yellow',Pulse.fieldCls+'Red');break;case'Y':this.el.replaceClass(Pulse.fieldCls,Pulse.fieldCls+'Yellow');this.el.replaceClass(Pulse.fieldCls+'Red',Pulse.fieldCls+'Yellow');break;default:this.el.replaceClass(Pulse.fieldCls+'Yellow',Pulse.fieldCls);this.el.replaceClass(Pulse.fieldCls+'Red',Pulse.fieldCls);break;}
return;},onRender:function(){if(this.DBG){THROW({props:['renderTo'],args:arguments},this,'onRender');}
try{}catch(e){FATAL(e,this,'onRender');}},initComponent:function(){Pulse.SelectBoxEditorWrapper.superclass.initComponent.call(this);if(this.DBG){props=['id','type'];props=props.concat(DBG.getPropertyArray(this.initialConfig));THROW({args:arguments,props:props},this,'initComponent.SelectBoxEditorWrapper');}
try{if(typeof(this.el)=='string'){this.el=Ext.get(this.el);}
if(typeof(this.el)=='undefined'||!this.el.is('select')||typeof(this.el.dom.name)=='undefined'){throw({e:'config.el.UNDEFINED',o:this,description:'initComponent.SelectBoxEditorWrapper'});}
this.initialValue=this.getValue();this.el.on('change',function(){if(this.hasChanges()){this.setBoxColor('y');this.fireEvent('MSG','change',this);}else{this.setBoxColor();this.fireEvent('MSG','reset',this);}},this);}catch(e){FATAL(e,this,'initComponent.SelectBoxEditorWrapper');}}};Pulse.SelectBoxEditorWrapper=Ext.extend(Pulse.Editor,SelectBoxEditorWrapper);var SitemapLocalizations={addToolTip:'add a new menu-item',deleteToolTip:'delete this menu-item',editToolTip:'edit the properties of this menu-item',toggleToolTip:'toggle the visibility of this menu-item',removeViewToolTip:'remove the content from this menu-item',MSG_REALLYREMOVEVIEW_START:'Do you really want to remove the content from menu-item: ',MSG_REALLYREMOVEVIEW_END:'?'};var Sitemap={getTree:function(config){tree=new Ext.tree.TreePanel(this.getTreeCfg(config));tree.setRootNode(this.getRootNode('Sitemap','source'));this.addMoveListener(tree);this.addInlineEditor(tree);if(typeof(config.startEditorFunction)=='function'){tree.startEditorFunction=config.startEditorFunction;}
if(typeof(config.height)!='undefined'){tree.setHeight(config.height);}
return tree;},getTreeCfg:function(config){loader=this.getTreeLoader(config);return{xtype:'treepanel',el:config.renderTo,autoScroll:true,autoHeight:(typeof(config.height)!='undefined')?false:true,animate:true,enableDD:true,containerScroll:true,rootVisible:false,border:false,loader:loader,creatingNewNode:false,hideInlineEditor:false,startEditorFunction:false,dataConnection:new Ext.data.Connection(),editor:null,runOnlyOnceAfterReload:null,removeView:function(node){ViewEditor.removeView(node,config.removeViewURL);},addNewNode:function(node){if(this.creatingNewNode===true){return;}else{this.creatingNewNode=true;}
node.expand(null,false,function(node){newNode=node.appendChild(new Ext.tree.AsyncTreeNode({text:VIEWPORT_PROPERTIES.NEW.toUpperCase(),visible:false,uiProvider:PULSE.SitemapTreeNodeUI}));newNode.select();newNode.ui.setBusy(true);Ext.Ajax.request({url:config.addNodeURL,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);node=options.node;newNode=options.newNode;tree=node.getOwnerTree();if(true===decodedResponse.status){node.ui.toggleElbow(true);newNode.id=decodedResponse.id;tree.reloadNode(newNode);}else{options.node.removeChild(options.newNode);tree.creatingNewNode=false;PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'Sitemap','addNode('+options.node+')');}},failure:function(response,options){node=options.node;newNode=options.newNode;tree=node.getOwnerTree();node.removeChild(newNode);tree.creatingNewNode=false;if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'Sitemap','addNode('+node+')');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'Sitemap','addNode('+node+')');}},node:node,newNode:newNode,params:{id:node.id,name:newNode.text}});}.createDelegate(this));},reloadNode:function(node){node.ui.setBusy(true);Ext.Ajax.request({url:config.loadNodeURL,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);node=options.node;node.ui.setBusy();tree=node.getOwnerTree();if(true===decodedResponse.status){loadedProperties=decodedResponse.node;node.ui.setPropertiesAfterLoad(loadedProperties,node);if(tree.creatingNewNode===true){tree.creatingNewNode=false;tree.editor.triggerEdit(node);}}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'Sitemap','reloadNode('+options.node+')');}
if(typeof(tree.runOnlyOnceAfterReload)=='function'){tree.runOnlyOnceAfterReload(node);tree.runOnlyOnceAfterReload=null;}},failure:function(response,options){options.node.ui.setBusy();if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'Sitemap','reloadNode('+options.node+')');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'Sitemap','reloadNode('+options.node+')');}},node:node,params:{id:node.id}});},deleteNode:function(node){this.hideInlineEditor=true;Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE+':&#160;"'+node.text+'"',VIEWPORT_PROPERTIES.MSG_REALLYDELETE,function(response){if('yes'===response){node.ui.setBusy(true);Ext.Ajax.request({url:config.deleteURL,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);node=options.node;parentNode=node.parentNode;if(true===decodedResponse.status){tabId='ViewEditor.'+node.id;PULSE_VIEWPORT_CONTROLLER.closeTab(tabId,true);parentNode.removeChild(node);(function(){if(parentNode.childNodes.length===0){parentNode.attributes.has_Children=false;parentNode.ui.toggleElbow(false);}}).defer(500);}else{node.ui.setBusy();PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'Sitemap','deleteNode('+options.node+')');}},failure:function(response,options){options.node.ui.setBusy();if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'Sitemap','deleteNode('+options.node+')');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'Sitemap','deleteNode('+options.node+')');}},node:node,params:{id:node.id}});}},this);},toggleNode:function(node){this.hideInlineEditor=true;node.ui.setBusy(true);Ext.Ajax.request({url:config.toggleURL,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);node=options.node;node.ui.setBusy();if(true===decodedResponse.status){node.attributes.visible=decodedResponse.visible;node.ui.toggleNodeText(decodedResponse.visible);node.ui.buildQTip(node.ui,node.attributes);if(true===decodedResponse.reloadNode){node.reload();}}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'Sitemap','toggleNode('+options.node+')');}},failure:function(response,options){options.node.ui.setBusy();if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'Sitemap','toggleNode('+options.node+')');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'Sitemap','toggleNode('+options.node+')');}},node:node,params:{id:node.id}});},onbeforenodedrop:function(e){this.hideInlineEditor=true;Ext.Ajax.request({url:config.moveURL,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);targetNode=options.e.target;movenode=options.e.dropNode;oldParent=movenode.parentNode;if(true===decodedResponse.status){switch(options.e.point){case'append':if(!targetNode.isExpanded()){try{if(true===targetNode.isLoaded()){targetNode.expand(false,null,function(){targetNode.appendChild(movenode);targetNode.ui.toggleElbow(true);if(oldParent.childNodes.length===0){oldParent.ui.toggleElbow(false);}}.createDelegate(this));}else{oldParent.removeChild(movenode);if(oldParent.childNodes.length===0){oldParent.ui.toggleElbow(false);}
targetNode.expand();targetNode.ui.toggleElbow(true);}}catch(err){targetNode.expand();targetNode.appendChild(movenode);targetNode.ui.toggleElbow(true);if(oldParent.childNodes.length===0){oldParent.ui.toggleElbow(false);}}}else{targetNode.appendChild(movenode);targetNode.ui.toggleElbow(true);if(oldParent.childNodes.length===0){oldParent.ui.toggleElbow(false);}}
break;case'above':targetNode.parentNode.insertBefore(movenode,targetNode);if(oldParent.childNodes.length===0){oldParent.ui.toggleElbow(false);}
break;case'below':targetNode.parentNode.insertBefore(movenode,targetNode.nextSibling);if(oldParent.childNodes.length===0){oldParent.ui.toggleElbow(false);}
break;}}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'Sitemap','onbeforenodedrop('+options.e.dropNode+')');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'Sitemap','onbeforenodedrop('+options.e.dropNode+')');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'Sitemap','onbeforenodedrop('+options.e.dropNode+')');}},e:e,params:{targetnodeid:e.target.id,insertpoint:e.point,movenodeid:e.dropNode.id}});return false;},renameNode:function(renameContext){renameContext.node.ui.setBusy(true);Ext.Ajax.request({url:config.renameURL,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);options.renameContext.editor.cancellingEdit=true;options.renameContext.editor.cancelEdit();node=options.renameContext.node;tree=node.getOwnerTree();if(true===decodedResponse.status){tree.reloadNode(node);}else{node.ui.setBusy();PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'Sitemap','renameNode('+node+')');}},failure:function(response,options){options.renameContext.editor.cancellingEdit=true;options.renameContext.editor.cancelEdit();node=options.renameContext.node;node.ui.setBusy();if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'Sitemap','renameNode('+options.renameContext.node+')');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'Sitemap','renameNode('+options.renameContext.node+')');}},renameContext:renameContext,params:{newname:renameContext.newname,id:renameContext.node.id}});},startEditorForNode:function(node){tree.hideInlineEditor=true;if(typeof(this.startEditorFunction)!='function'){alert('ERROR :: node.id:'+node.id+'\ntypeof( startEditorFunction ) != "function": \n'+
typeof(this.startEditorFunction));return;}
try{this.startEditorFunction(node);}catch(startEditorFunctionError){tree.hideInlineEditor=false;}},setEditor:function(editor){this.editor=editor;},onBeforeStartEdit:function(){if(this.hideInlineEditor===true){this.hideInlineEditor=false;return false;}
if(this.creatingNewNode===true){return false;}},onBeforeEditComplete:function(editor,newName,oldName){if(this.creatingNewNode===true){return;}
if(editor.cancellingEdit===true){editor.cancellingEdit=false;return;}
if(newName===oldName){return;}
this.hideInlineEditor=true;this.renameNode({editor:editor,node:editor.editNode,newname:newName,oldname:oldName});return false;},expandByIds:function(node,arrayids,callback,locale,expand){try{if(typeof(node)=='undefined'){return;}else if(node===null){if(typeof(SitemapTree)!='undefined'&&SitemapTree!==null){node=SitemapTree.getRootNode();}else{return;}}
sitemapPanel=Ext.getCmp('SitemapEditor.WEST');if(typeof(sitemapPanel)=='undefined'||sitemapPanel===null){PULSE_TOOLBAR.openPanel({id:'SitemapEditor.WEST',callback:function(){SitemapTree.expandByIds(null,arrayids);}});return;}
sitemapPanel.expand();sitemapPanel.disable();if(true===sitemapPanel.isExpanding&&true!==expand){return;}
sitemapPanel.isExpanding=true;if(typeof(locale)!='undefined'&&locale!==null&&locale!=SitemapTree.getRootNode().attributes.locale){if(true===sitemapPanel.isLoading){return;}
cfg=sitemapPanel.initialConfig.autoLoad;cfg.timeout=30;cfg._arrayids=arrayids;cfg._callback=callback;cfg._sitemapPanel=sitemapPanel;cfg.callback=function(el,success,response,options){cfg._sitemapPanel.isLoading=false;if(true===success){SitemapTree.expandByIds(null,options._arrayids,options._callback,null,true);}else{cfg._sitemapPanel.enable();}
LPCB(el,success,response,options);};cfg.params={'sitemap-locale':locale};sitemapPanel.isLoading=true;(function(){sitemapPanel.load(cfg);}).defer(500);return;}
exp_fn=function(){node.expand(false,true,function(node){c=node.findChild('id',arrayids[0]);if(arrayids.length===1){c.select();sitemapPanel=Ext.getCmp('SitemapEditor.WEST');sitemapPanel.isExpanding=false;sitemapPanel.enable();Ext.getCmp('west-region').doLayout();if(typeof(callback)=='function'){callback(c);}
return;}
arrayids.shift();SitemapTree.expandByIds(c,arrayids,callback,null,true);});};if(arrayids.length===2){if(node.isLoaded()){node.reload(exp_fn);}else{exp_fn();}}else{exp_fn();}
return;}catch(e){sitemapPanel=Ext.getCmp('SitemapEditor.WEST');if(typeof(sitemapPanel)!='undefined'&&sitemapPanel!==null){sitemapPanel.isExpanding=false;sitemapPanel.isLoading=false;sitemapPanel.enable();}}},findChildById:function(id,node){if(typeof(id)=='undefined'||id===null){return;}
if(typeof(node)=='undefined'||node===null){node=SitemapTree.getRootNode();}
if(node.id==id){return node;}
if(node.firstChild!==null){return this.findChildById(id,node.firstChild);}else if(node.nextSibling!==null){return this.findChildById(id,node.nextSibling);}else if(node.parentNode!==null&&node.parentNode.nextSibling!==null){return this.findChildById(id,node.parentNode.nextSibling);}},findChildrenByContentId:function(id,node,list){if(typeof(id)=='undefined'||id===null){return;}
if(typeof(node)=='undefined'||node===null){node=SitemapTree.getRootNode();}
if(typeof(list)=='undefined'||list===null){list=[];}
if(node.attributes.contentId==id){list.push(node);}
if(node.firstChild!==null){return this.findChildrenByContentId(id,node.firstChild,list);}else if(node.nextSibling!==null){return this.findChildrenByContentId(id,node.nextSibling,list);}else if(node.parentNode!==null&&node.parentNode.nextSibling!==null){return this.findChildrenByContentId(id,node.parentNode.nextSibling,list);}
return list;}};},getTreeLoader:function(config){return new Ext.tree.TreeLoader({dataUrl:config.getChildrenURL,uiProviders:{'SitemapTreeNodeUI':PULSE.SitemapTreeNodeUI}});},getRootNode:function(text,id){return new Ext.tree.AsyncTreeNode({text:text,draggable:false,id:id});},addMoveListener:function(tree){tree.on({'beforenodedrop':{scope:tree,fn:tree.onbeforenodedrop}});},addInlineEditor:function(tree){editor=new Ext.tree.TreeEditor(tree,{allowBlank:false,selectOnFocus:true});tree.setEditor(editor);editor.on({'beforestartedit':{scope:tree,fn:tree.onBeforeStartEdit},'beforecomplete':{scope:tree,fn:tree.onBeforeEditComplete}});}};PULSE.SitemapTreeNodeUI=function(){PULSE.SitemapTreeNodeUI.superclass.constructor.apply(this,arguments);};SitemapTreeNodeUI={defaultIconCls:'x-tree-node-icon ',beforeIconCls:'',loadIconCls:'nodeLoadingIconCls',functionsIconSize:14,renderElements:function(n,a,targetNode,bulkRender){a.iconCls='noViewIconCls';removeViewCls='';if(typeof(a.contentType)!='undefined'&&typeof(a.contentType)=='string'&&a.contentType!==''){a.iconCls=a.contentType.replace(/\./g,'');removeViewCls='delete'+a.iconCls+'_'+this.functionsIconSize;}
visibleClass='visibleIconCls_'+this.functionsIconSize;if(a.visible===false||a.visible=='false'){visibleClass='invisibleIconCls_'+this.functionsIconSize;}
styleString='margin-bottom: 2px; padding: 0px; border: 0px; vertical-align: middle;';id=Ext.id();var pulseLinkArray=['&#160;<a href="#" style="font-weight: bold" id="addEl_'+n.id+'.'+id+'">'+'<img src="'+Ext.BLANK_IMAGE_URL+'" '+'width="'+this.functionsIconSize+'" '+'height="'+this.functionsIconSize+'" '+'style="'+styleString+'" '+'class="addIconCls_'+this.functionsIconSize+'" '+'ext:qtip="'+SitemapLocalizations.addToolTip+'" />'+'</a>&#160;','&#160;<a href="#" style="font-weight: bold" id="delEl_'+n.id+'.'+id+'">'+'<img src="'+Ext.BLANK_IMAGE_URL+'" '+'width="'+this.functionsIconSize+'" '+'height="'+this.functionsIconSize+'" '+'style="'+styleString+'" '+'class="deleteIconCls_'+this.functionsIconSize+'" '+'ext:qtip="'+SitemapLocalizations.deleteToolTip+'" />'+'</a>&#160;','&#160;<a href="#" style="font-weight: bold" id="edtEl_'+n.id+'.'+id+'">'+'<img src="'+Ext.BLANK_IMAGE_URL+'" '+'width="'+this.functionsIconSize+'" '+'height="'+this.functionsIconSize+'" '+'style="'+styleString+'" '+'class="editIconCls_'+this.functionsIconSize+'" '+'ext:qtip="'+SitemapLocalizations.editToolTip+'" />'+'</a>&#160;','&#160;<a href="#" style="font-weight: bold" id="tglEl_'+n.id+'.'+id+'">'+'<img src="'+Ext.BLANK_IMAGE_URL+'" '+'width="'+this.functionsIconSize+'" '+'height="'+this.functionsIconSize+'" '+'style="'+styleString+'" '+'class="'+visibleClass+'" '+'id="tglIcon_'+n.id+'" '+'ext:qtip="'+SitemapLocalizations.toggleToolTip+'"/>'+'</a>&#160;','&#160;<a href="#" style="font-weight: bold" id="remEl_'+n.id+'.'+id+'">'+'<img src="'+Ext.BLANK_IMAGE_URL+'" '+'width="'+this.functionsIconSize+'" '+'height="'+this.functionsIconSize+'" '+'style="'+styleString+'" '+'class="'+removeViewCls+'" '+'id="remIcon_'+n.id+'" '+'ext:qtip="'+SitemapLocalizations.removeViewToolTip+'"/>'+'</a>&#160;','&#160;<a href="#" style="font-weight: bold" id="selectEl_'+n.id+'.'+id+'">'+'<img src="'+Ext.BLANK_IMAGE_URL+'" '+'width="'+this.functionsIconSize+'" '+'height="'+this.functionsIconSize+'" '+'style="'+styleString+'" '+'class="selectIconCls_'+this.functionsIconSize+'" '+'ext:qtip="'+VIEWPORT_PROPERTIES.BUTTON_TEXT_SELECT+'" />'+'</a>&#160;'];this.toggleIconId='tglIcon_'+n.id;var pulseLinks=pulseLinkArray[4]+
pulseLinkArray[0]+
pulseLinkArray[1]+
pulseLinkArray[2]+
pulseLinkArray[3];if(a.mode==='select'){pulseLinks=pulseLinkArray[5];}
this.indentMarkup=n.parentNode?n.parentNode.ui.getChildIndent():'';var cb=typeof a.checked=='boolean';var href=a.href?a.href:Ext.isGecko?'':'#';var buf=['<li class="x-tree-node"><div ext:tree-node-id="',n.id,'" class="x-tree-node-el x-tree-node-leaf ',a.cls,'">','<span class="x-tree-node-indent">',this.indentMarkup,'</span>','<img src="',this.emptyIcon,'" class="x-tree-ec-icon x-tree-elbow" />','<img src="',a.icon||this.emptyIcon,'" class="x-tree-node-icon',(a.icon?' x-tree-node-inline-icon':''),(a.iconCls?' '+a.iconCls:''),'" unselectable="on" style="width:18px"/>',(cb?('<input class="x-tree-node-cb" type="checkbox" '+
(a.checked?'checked="checked" />':'/>')):''),'<a hidefocus="on" class="x-tree-node-anchor" href="',href,'" tabIndex="1" ',(a.hrefTarget?' target="'+a.hrefTarget+'"':''),' dir="LTR"><span unselectable="on">',n.text,'</span></a>',(a.type=='VIRTUAL'&&a.mode!='select')?'':pulseLinks,'</div>','<ul class="x-tree-node-ct" style="display:none;"></ul>','</li>'].join('');if(bulkRender!==true&&n.nextSibling&&n.nextSibling.ui.getEl()){this.wrap=Ext.DomHelper.insertHtml("beforeBegin",n.nextSibling.ui.getEl(),buf);}else{this.wrap=Ext.DomHelper.insertHtml("beforeEnd",targetNode,buf);}
this.elNode=this.wrap.childNodes[0];this.ctNode=this.wrap.childNodes[1];var cs=this.elNode.childNodes;this.indentNode=cs[0];this.ecNode=cs[1];this.iconNode=cs[2];var index=3;if(cb){this.checkbox=cs[3];index++;}
this.anchor=cs[index];this.textNode=cs[index].firstChild;if(a.mode=='select'){var selectEl=Ext.get('selectEl_'+n.id+'.'+id);selectEl.on('click',this.selectNode,null,{node:n});}else if(a.type!='VIRTUAL'&&a.mode!='select'){index+=2;this.removeViewFunctionNode=cs[index];index+=2;this.addFunctionNode=cs[index];index+=2;this.deleteFunctionNode=cs[index];index+=2;this.editFunctionNode=cs[index];index+=2;this.toggleFunctionNode=cs[index];}
this.toggleNodeText(a.visible,true);this.buildQTip(this,a);if(a.type!='VIRTUAL'&&a.mode!='select'){var addEl=Ext.get('addEl_'+n.id+'.'+id);addEl.on('click',this.addNode,null,{node:n});var delEl=Ext.get('delEl_'+n.id+'.'+id);delEl.on('click',this.deleteNode,null,{node:n});var edtEl=Ext.get('edtEl_'+n.id+'.'+id);edtEl.on('click',this.editorForNode,null,{node:n});var tglEl=Ext.get('tglEl_'+n.id+'.'+id);tglEl.on('click',this.toggleNode,null,{node:n});if(removeViewCls===''){this.toggleRemoveView(removeViewCls);}
var remEl=Ext.get('remEl_'+n.id+'.'+id);remEl.on('click',this.removeView,null,{node:n});}},selectNode:function(ev,target,options){if(this.disableFnClicks===true){return;}
return false;},removeView:function(ev,target,options){if(this.disableFnClicks===true){return;}
tree=options.node.getOwnerTree();tree.removeView(options.node);return false;},addNode:function(ev,target,options){if(this.disableFnClicks===true){return;}
tree=options.node.getOwnerTree();tree.addNewNode(options.node);return false;},deleteNode:function(ev,target,options){if(this.disableFnClicks===true){return;}
tree=options.node.getOwnerTree();tree.deleteNode(options.node);return false;},editorForNode:function(ev,target,options){if(this.disableFnClicks===true){return;}
tree=options.node.getOwnerTree();tree.startEditorForNode(options.node);return false;},toggleNode:function(ev,target,options){if(this.disableFnClicks===true){return;}
tree=options.node.getOwnerTree();tree.toggleNode(options.node);return false;},setPropertiesAfterLoad:function(loadedNode,node){node.id=loadedNode.id;node.setText(loadedNode.text);node.attributes=loadedNode;iconCls='noViewIconCls';removeViewIconCls='';if(typeof(loadedNode.contentType)!='undefined'&&typeof(loadedNode.contentType)=='string'&&loadedNode.contentType!==''){contentTypeArray=loadedNode.contentType.split('.');iconCls=contentTypeArray.join('');removeViewIconCls='delete'+iconCls+'_'+this.functionsIconSize;}
this.beforeIconCls=this.defaultIconCls+iconCls;this.toggleIconCls(iconCls);this.toggleNodeText(loadedNode.visible);this.buildQTip(node.ui,loadedNode);this.toggleRemoveView(removeViewIconCls);this.toggleElbow(loadedNode.has_Children);},toggleRemoveView:function(clsString){if(typeof(this.removeViewFunctionNode)=='undefined'||this.removeViewFunctionNode===null){return;}
if(clsString===''){this.removeViewFunctionNode.style.cssText='display: none;';}else{this.removeViewFunctionNode.firstChild.className=clsString;this.removeViewFunctionNode.style.cssText='';}},toggleNodeText:function(visible,bRender){visible=eval(visible);if(typeof(visible)!='boolean'){return;}
if(!visible){this.textNode.style.cssText='color: #999999;';}else{this.textNode.style.cssText='color: #000000;';}
if(typeof(bRender)!='boolean'&&bRender!==true){this.toggleToggleIcon(visible);}},toggleToggleIcon:function(visible){tglIconImgEl=Ext.get(this.toggleIconId);if(typeof(tglIconImgEl)=='undefined'||tglIconImgEl===null){return;}
if(visible){tglIconImgEl.replaceClass('invisibleIconCls_'+this.functionsIconSize,'visibleIconCls_'+this.functionsIconSize);}else{tglIconImgEl.replaceClass('visibleIconCls_'+this.functionsIconSize,'invisibleIconCls_'+this.functionsIconSize);}
return;},updateExpandIcon:function(){if(this.rendered){var n=this.node,c1,c2;var cls=n.isLast()?"x-tree-elbow-end":"x-tree-elbow";var hasChild=n.hasChildNodes();if(hasChild||n.attributes.expandable){if(n.expanded){cls+="-minus";c1="x-tree-node-collapsed";c2="x-tree-node-expanded";}else{cls+="-plus";c1="x-tree-node-expanded";c2="x-tree-node-collapsed";}
if(this.wasLeaf){this.removeClass("x-tree-node-leaf");this.wasLeaf=false;}
if(this.c1!=c1||this.c2!=c2){Ext.fly(this.elNode).replaceClass(c1,c2);this.c1=c1;this.c2=c2;}}else{if(!this.wasLeaf){Ext.fly(this.elNode).replaceClass("x-tree-node-expanded","x-tree-node-leaf");delete this.c1;delete this.c2;this.wasLeaf=true;}}
var ecc="x-tree-ec-icon "+cls;if(this.ecc!=ecc){this.ecNode.className=ecc;this.ecc=ecc;}}
this.toggleElbow();},toggleElbow:function(has_Children){if(typeof(has_Children)!='boolean'){if(this.node.attributes.has_Children===false){has_Children=false;}else{has_Children=true;}}
classBefore=this.ecNode.className;classNew=this.node.isLast()?'x-tree-elbow-end':'x-tree-elbow';if(has_Children===true&&this.node.isExpanded()){this.node.attributes.has_Children=true;classNew+='-minus';}else if(has_Children===true&&!this.node.isExpanded()){this.node.attributes.has_Children=true;classNew+='-plus';}else{this.node.attributes.has_Children=false;this.node.expandable=false;}
var ecc="x-tree-ec-icon "+classNew;if(this.ecc!=ecc){this.ecNode.className=ecc;this.ecc=ecc;}
return;},buildQTip:function(ui,a){if(typeof(ui)=='undefined'||typeof(a)=='undefined'||ui===null){return;}
Ext.QuickTips.register({target:ui.textNode,title:''+a.text,text:'<span style="font-style: italic">id:</span> '+a.id+'<br />'+'<span style="font-style: italic">locale:</span> '+a.locale+'<br />'+'<span style="font-style: italic">visible:</span> '+a.visible+'<hr /><span style="font-weight: bold">content</span><br />'+'<span style="font-style: italic">id:</span> '+a.contentId+'<br />'+'<span style="font-style: italic">name:</span> '+a.contentName+'<br />'+'<span style="font-style: italic">bundle:</span> '+a.contentBundle+'<br />'+'<span style="font-style: italic">type:</span> '+a.contentType});},toggleIconCls:function(clsString){if(typeof(clsString)=='string'){if(this.iconNode.getAttributeNode('class').nodeValue!=this.defaultIconCls+this.loadIconCls){this.beforeIconCls=this.iconNode.getAttributeNode('class').nodeValue;}
this.iconNode.getAttributeNode('class').nodeValue=this.defaultIconCls+clsString;return;}
if(typeof(this.beforeIconCls)=='string'&&this.beforeIconCls!==''){this.iconNode.getAttributeNode('class').nodeValue=this.beforeIconCls;}},setBusy:function(bool){if(true===bool){if(true===this.busyBusy){return;}
this.busyBusy=true;this.disableFnClicks=true;this.toggleIconCls(this.loadIconCls);return;}
this.busyBusy=false;this.toggleIconCls();this.disableFnClicks=false;},cleanUp:function(){try{tabId='ViewEditor.'+this.node.id;PULSE_VIEWPORT_CONTROLLER.closeTab(tabId,true);}catch(e){}},afterChange:function(_thisNode){(function(){if(_thisNode.childNodes.length===0){_thisNode.attributes.has_Children=false;_thisNode.ui.toggleElbow(false);}else{_thisNode.attributes.has_Children=true;_thisNode.ui.toggleElbow(true);}}).defer(500);}};Ext.extend(PULSE.SitemapTreeNodeUI,Ext.tree.TreeNodeUI,SitemapTreeNodeUI);PULSE.SitemapRootTreeNodeUI=function(){PULSE.SitemapRootTreeNodeUI.superclass.constructor.apply(this,arguments);};Ext.extend(PULSE.SitemapRootTreeNodeUI,PULSE.SitemapTreeNodeUI,{render:function(){if(!this.rendered){var targetNode=this.node.ownerTree.innerCt.dom;this.node.expanded=true;targetNode.innerHTML='<div class="x-tree-root-node"></div>';this.wrap=this.ctNode=targetNode.firstChild;}},collapse:function(){},expand:function(){}});DBG.EditorPanelComp=DBG.apply(DBG.Editor,{initComponent:{EditorPanel:false}});EditorPanelComp=Editor;EditorPanelComp.initComponent=function(){if(this.initialConfig.DBG){this.DBG=DBG.apply(DBG[this.getTypeString()],this.initialConfig.DBG);}
if(this.DBG){props=['id','type'];props=props.concat(DBG.getPropertyArray(this.initialConfig));THROW({args:arguments,props:props},this,'initComponent.EditorPanel');}
if(typeof(this.subEditors)=='undefined'){this.subEditors=[];}
Pulse.EditorPanel.superclass.initComponent.call(this);this.addEvents({'MSG':true});};Pulse.EditorPanel=Ext.extend(Ext.Panel,EditorPanelComp);DBG.SubEditorPanel=DBG.apply(DBG.EditorPanelComp,{addSubEditor:{SubEditorPanel:false},expand:false,initializePanel:false,loadPanel:{click:false,call:false}});SubEditorPanel={type:'SubEditorPanel',DBG:DBG.SubEditorPanel,getReloadButtonCFG:function(){return{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_RELOAD,scope:this,handler:function(){if(this.DBG){THROW({args:arguments},this,'loadPanel.click');}
this.loadPanel();},iconCls:'reloadIconCls'};},addSubEditor:function(editor){addSuccess=Pulse.SubEditorPanel.superclass.addSubEditor.call(this,editor);if(this.DBG){THROW({o:'ADD: '+addSuccess,props:['id','subEditors.length','subEditors'],p:[{n:'editor.id',o:editor.id},{n:'editor.type',o:editor.type}]},this,'addSubEditor.SubEditorPanel');}
if(true!==addSuccess){if(this.DBG){FATAL(editor,this,'addSubEditor.SubEditorPanel','ADD: '+addSuccess);}
return;}
try{if(typeof(editor.getButtons)=='function'){this.addToolbarButtons(editor.getButtons());}
Pulse.insertHasChangesIcon(this);}catch(e){if(this.DBG){FATAL(e,this,'addSubEditor.SubEditorPanel');}}},editorMSG:function(msgString,editor,masterEditor){this.toggleHasChangesIcon(this.hasChanges());Pulse.SubEditorPanel.superclass.editorMSG.call(this,msgString,editor,masterEditor);},initializePanel:function(){if(this.DBG){THROW({args:arguments,props:['id','url','initialLoad','loadPanel']},this,'initializePanel');}
if(true!==this.initialLoad){this.loadPanel();this.initialLoad=true;}},addToolbarButtons:function(buttons){if(typeof(this.addedButtons)!='undefined'){for(i=0;i<this.addedButtons.length;i++){o=this.addedButtons[i];try{Ext.get(o.getEl()).remove();o.destroy();}catch(e){FATAL(e,this,'addToolbarButtons');}}
delete this.addedButtons;}
this.addedButtons=buttons;this.getTopToolbar().insertButton(0,this.addedButtons);},showLoading:function(boolShow){if(true===boolShow){this.header.child("*[@class*='x-panel-inline-icon']").replaceClass(this.iconCls,'loadingIconCls');return;}else{this.header.child("*[@class*='x-panel-inline-icon']").replaceClass('loadingIconCls',this.iconCls);return;}
if(this.DBG){FATAL('CANNOT RESET ICONCLS',this,'showLoading');}},loadPanel:function(){if(this.DBG){THROW({args:arguments,props:['id','url']},this,'loadPanel.call');}
try{if(true===this.hasChanges()){Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE,VIEWPORT_PROPERTIES.TEXT_UNSAVEDCHANGES+'<br />'+
VIEWPORT_PROPERTIES.TEXT_REALLYCONTINUE,function(response){if('yes'===response){this.reset();this.loadPanel();}},this);return;}
if(true===this.getUpdater().isUpdating()){return;}
if(this.getSubEditors().length>0){this.removeSubEditors();}
if(typeof(this.toggleHasChangesIcon)=='function'){this.toggleHasChangesIcon(false);}
this.load({url:this.url,method:'POST',scripts:true,callback:LPCB,params:this.params,text:'loading...',discardUrl:true,nocache:true,timeout:30});}catch(e){if(this.DBG){FATAL(e,this,'loadPanel');}}},initComponent:function(){try{this.title=(typeof(this.initialConfig.title)!='string')?''+VIEWPORT_PROPERTIES.SUBEDITOR:this.initialConfig.title;this.iconCls=(typeof(this.initialConfig.iconCls)!='string')?'editIconCls':this.initialConfig.iconCls;this.autoScroll=true;this.collapsed=true;this.collapsible=true;this.html='<div style="font-weight:bold;">NOT LOADED</div>';this.reloadButtonCFG=this.getReloadButtonCFG();this.reloadButtonCFG.scope=this;this.tbar=['->','-'];this.tbar.push(this.reloadButtonCFG);Pulse.SubEditorPanel.superclass.initComponent.call(this);}catch(e){FATAL(e,this,'initComponent.SubEditorPanel');}},destroyEditor:function(editor,selfDestroy){if(true===selfDestroy){this.removeSubEditors();this.masterEditor.removeSubEditor(this,true);}else{this.removeSubEditor(editor,true);}}};Pulse.SubEditorPanel=Ext.extend(Pulse.EditorPanel,SubEditorPanel);DBG.EditorWindowComp=DBG.apply(DBG.Editor,{initComponent:{EditorWindow:false}});EditorWindowComp=Editor;EditorWindowComp.initComponent=function(){if(this.initialConfig.DBG){this.DBG=DBG.apply(DBG[this.getTypeString()],this.initialConfig.DBG);}
if(this.DBG){props=['id','type'];props=props.concat(DBG.getPropertyArray(this.initialConfig));THROW({args:arguments,props:props},this,'initComponent.EditorPanel');}
if(typeof(this.subEditors)=='undefined'){this.subEditors=[];}
Pulse.EditorPanel.superclass.initComponent.call(this);this.addEvents({'MSG':true});};Pulse.EditorWindow=Ext.extend(Ext.Window,EditorWindowComp);DBG.SubEditorWindow=DBG.apply(DBG.EditorWindow,{addSubEditor:{SubEditorWindow:false},expand:false,initializePanel:false,loadPanel:{click:false,call:false}});SubEditorWindow={type:'SubEditorWindow',DBG:false,reloadButton:{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_RELOAD,scope:this,handler:function(){if(this.DBG){THROW({args:arguments},this,'loadPanel.click');}
this.loadPanel();},iconCls:'reloadIconCls'},addSubEditor:function(editor){addSuccess=Pulse.SubEditorWindow.superclass.addSubEditor.call(this,editor);if(this.DBG){THROW({o:'ADD: '+addSuccess,props:['id','subEditors.length','subEditors'],p:[{n:'editor.id',o:editor.id},{n:'editor.type',o:editor.type}]},this,'addSubEditor.SubEditorWindow');}
if(true!==addSuccess){if(this.DBG){FATAL(editor,this,'addSubEditor.SubEditorWindow','ADD: '+addSuccess);}
return;}
try{if(typeof(editor.getButtons)=='function'){this.addToolbarButtons(editor.getButtons());}
Pulse.insertHasChangesIcon(this);}catch(e){if(this.DBG){FATAL(e,this,'addSubEditor.SubEditorWindow');}}},editorMSG:function(msgString,editor,masterEditor){this.toggleHasChangesIcon(this.hasChanges());Pulse.SubEditorWindow.superclass.editorMSG.call(this,msgString,editor,masterEditor);},initializePanel:function(){if(this.DBG){THROW({args:arguments,props:['id','url','initialLoad','loadPanel']},this,'initializePanel');}
if(true!==this.initialLoad){this.loadPanel();this.initialLoad=true;}},addToolbarButtons:function(buttons){if(typeof(this.addedButtons)!='undefined'){for(i=0;i<this.addedButtons.length;i++){o=this.addedButtons[i];try{Ext.get(o.getEl()).remove();o.destroy();}catch(e){FATAL(e,this,'addToolbarButtons');}}
delete this.addedButtons;}
this.addedButtons=buttons;this.getTopToolbar().insertButton(0,this.addedButtons);},showLoading:function(boolShow){if(true===boolShow){this.header.child("*[@class*='x-panel-inline-icon']").replaceClass(this.iconCls,'loadingIconCls');return;}else{this.header.child("*[@class*='x-panel-inline-icon']").replaceClass('loadingIconCls',this.iconCls);return;}
if(this.DBG){FATAL('CANNOT RESET ICONCLS',this,'showLoading');}},loadPanel:function(){if(this.DBG){THROW({args:arguments,props:['id','url']},this,'loadPanel.call');}
try{if(true===this.hasChanges()){Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE,VIEWPORT_PROPERTIES.TEXT_UNSAVEDCHANGES+'<br />'+
VIEWPORT_PROPERTIES.TEXT_REALLYCONTINUE,function(response){if('yes'===response){this.reset();this.loadPanel();}},this);return;}
if(true===this.getUpdater().isUpdating()){return;}
if(this.getSubEditors().length>0){this.removeSubEditors();}
if(typeof(this.toggleHasChangesIcon)=='function'){this.toggleHasChangesIcon(false);}
this.load({url:this.url,method:'POST',scripts:true,callback:LPCB,params:this.params,text:'loading...',discardUrl:true,nocache:true,timeout:30});}catch(e){if(this.DBG){FATAL(e,this,'loadPanel');}}},initComponent:function(){try{this.title=(typeof(this.initialConfig.title)!='string')?''+VIEWPORT_PROPERTIES.SUBEDITOR:this.initialConfig.title;this.iconCls=(typeof(this.initialConfig.iconCls)!='string')?'editIconCls':this.initialConfig.iconCls;this.autoScroll=true;this.html='<div style="font-weight:bold;">NOT LOADED</div>';this.reloadButton.scope=this;this.tbar=['->','-'];this.tbar.push(this.reloadButton);Pulse.SubEditorWindow.superclass.initComponent.call(this);}catch(e){FATAL(e,this,'initComponent.SubEditorWindow');}},destroyEditor:function(editor,selfDestroy){if(true===selfDestroy){this.removeSubEditors();this.masterEditor.removeSubEditor(this,true);}else{this.removeSubEditor(editor,true);}}};Pulse.SubEditorWindow=Ext.extend(Pulse.EditorWindow,SubEditorWindow);Toolbar={type:'Toolbar',DBG:{afterRender:{In:false,Out:false},openPanel:false},onRender:function(ct,position){this.el=ct.createChild(Ext.apply({id:this.id},this.autoCreate),position);this.tr=this.el.child("tr",true);},afterRender:function(){Ext.Toolbar.superclass.afterRender.call(this);THROW({props:['ownerCt.id','ownerId','buttons']},this,'afterRender.In');if(this.buttons){this.add.apply(this,this.buttons);delete this.buttons;}
THROW({props:['ownerCt.id','ownerId','buttons']},this,'afterRender.Out');},openPanel:function(config){THROW({args:arguments,propsObj:config,props:['id','decodedResponse','decodedResponse.ids','callback']},this,'openPanel');this.actions[(config.id+'.btn').split('.').join('')].execute(config);}};Pulse.Toolbar=Ext.extend(Ext.Toolbar,Toolbar);Pulse.Tree=function(config){this.type='Tree';try{this.id=Ext.id();this.initialconfig=config;if(typeof(config.url)!='string'||config.url===''){return;throw(new Pulse.Error({e:'config.url.string.error',o:new Pulse.Error({e:'config.url: '+config.url})},'Tree','constructor'));}
if(typeof(config.el)!='string'||config.el===''){return;throw(new Pulse.Error({e:'config.el.string.error',o:new Pulse.Error({e:'config.el: '+config.el})},'Tree','constructor'));}
config.autoScroll=typeof(config.autoScroll)!='boolean'?true:config.autoScroll;config.autoHeight=typeof(config.autoHeight)!='boolean'?true:config.autoHeight;config.animate=typeof(config.animate)!='boolean'?true:config.animate;config.enableDD=typeof(config.enableDD)!='boolean'?true:config.enableDD;config.containerScroll=typeof(config.containerScroll)!='boolean'?true:config.containerScroll;config.rootVisible=typeof(config.rootVisible)!='boolean'?false:config.rootVisible;config.border=typeof(config.border)!='boolean'?false:config.border;config.loader=typeof(config.loader)!='object'?new Ext.tree.TreeLoader({dataUrl:config.url,uiProviders:{'SitemapTreeNodeUI':PULSE.SitemapTreeNodeUI,'AccecssControlTreeNodeUI':PULSE.AccessControlTreeNodeUI}}):config.loader;this.config=config;this.config.pulsetree=this;this.tree=new Ext.tree.TreePanel(this.config);this.tree.setRootNode(new Ext.tree.AsyncTreeNode({text:'root.'+this.id,draggable:false,id:'source.'+this.id}));this.render=function(bool){this.tree.render();if(false===bool){return;}
this.getRootNode().expand();};this.getRootNode=function(){return this.tree.getRootNode();};this.getLoader=function(){return this.tree.getLoader();};this.reload=function(){this.getRootNode().reload();};this.refresh=function(node,callback){try{this.tree.editor.refresh(node,callback);}catch(e){Pulse.Throw(new Pulse.Error({e:'HANDLE',o:e},this,'refresh'));}};this.setBusy=function(node){this.busy=true;if(typeof(node)=='object'){node.ui.setBusy(true);}};this.unBusy=function(node){(function(){this.busy=false;if(typeof(node)=='object'){node.ui.setBusy();}}).defer(500,this);};this.isBusy=function(){if((true===this.busy)||(typeof(this.tree.editor)!='undefined'&&true===this.tree.editor.busy)){return true;}
return false;};this.remove=function(node){if(true===this.isBusy()){return;}
this.setBusy();Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE+':&#160;"'+node.text+'"',VIEWPORT_PROPERTIES.MSG_REALLYDELETE,function(cnfResponse){if('yes'===cnfResponse){this.setBusy(node);Ext.Ajax.request({scope:this,url:(typeof(node.attributes.deleteURL)=='string')?node.attributes.deleteURL:config.deleteURL,method:'POST',success:function(response,options){if(true===Pulse.ajaxSuccess(response,this,'remove',true)){if(typeof(node.ui.cleanUp)=='function'){node.ui.cleanUp();}
parentNode=options.node.parentNode;parentNode.removeChild(options.node);if(typeof(parentNode.ui.afterChange)=='function'){parentNode.ui.afterChange(parentNode);}
this.unBusy();}else{this.unBusy(options.node);}},failure:function(response,options){this.unBusy(options.node);Pulse.ajaxFailure(response,this,'remove',true);},node:node,params:{nodeid:node.id}});}else{this.unBusy();}},this);};this.move=function(e){if(true===this.isBusy()){return;}
this.setBusy();Ext.Ajax.request({scope:this,url:(typeof(e.dropNode.attributes.moveURL)=='string')?e.dropNode.attributes.moveURL:config.moveURL,method:'POST',success:function(response,options){if(true===Pulse.ajaxSuccess(response,this,'move',true)){targetNode=options.e.target;movenode=options.e.dropNode;oldParent=movenode.parentNode;switch(options.e.point){case'append':if(!targetNode.isExpanded()){try{if(true===targetNode.isLoaded()){targetNode.expand(false,null,function(){targetNode.appendChild(movenode);if(typeof(targetNode.ui.afterChange)=='function'){targetNode.ui.afterChange(targetNode);}
if(typeof(oldParent.ui.afterChange)=='function'){oldParent.ui.afterChange(oldParent);}}.createDelegate(this));}else{oldParent.removeChild(movenode);if(typeof(oldParent.ui.afterChange)=='function'){oldParent.ui.afterChange(oldParent);}
targetNode.expand();if(typeof(targetNode.ui.afterChange)=='function'){targetNode.ui.afterChange(targetNode);}}}catch(err){targetNode.expand();targetNode.appendChild(movenode);if(typeof(targetNode.ui.afterChange)=='function'){targetNode.ui.afterChange(targetNode);}
if(typeof(oldParent.ui.afterChange)=='function'){oldParent.ui.afterChange(oldParent);}}}else{targetNode.appendChild(movenode);if(typeof(targetNode.ui.afterChange)=='function'){targetNode.ui.afterChange(targetNode);}
if(typeof(oldParent.ui.afterChange)=='function'){oldParent.ui.afterChange(oldParent);}}
break;case'above':targetNode.parentNode.insertBefore(movenode,targetNode);if(typeof(oldParent.ui.afterChange)=='function'){oldParent.ui.afterChange(oldParent);}
break;case'below':targetNode.parentNode.insertBefore(movenode,targetNode.nextSibling);if(typeof(oldParent.ui.afterChange)=='function'){oldParent.ui.afterChange(oldParent);}
break;}}
this.unBusy();},failure:function(response,options){this.unBusy();Pulse.ajaxFailure(response,this,'move',true);},e:e,params:{targetnodeid:e.target.id,insertpoint:e.point,movenodeid:e.dropNode.id}});return false;};this.tree.on({'beforenodedrop':{scope:this,fn:this.move}});if(typeof(config.editor)=='object'){config.editor.init(this);}
if(typeof(config.onSelectNodeClick)=='function'){this.tree.on('click',function(node){config.onSelectNodeClick(node);});}}catch(e){Pulse.Throw(e);}};TreePagingToolbar={type:'TreePagingToolbar',DBG:false,pageSize:20,displayMsg:'{0} - {1} / {2}',emptyMsg:'--',beforePageText:'',afterPageText:' / {0}',firstText:"First Page",prevText:"Previous Page",nextText:"Next Page",lastText:"Last Page",refreshText:"Refresh",paramNames:{start:'start',limit:'limit'},initComponent:function(){Ext.PagingToolbar.superclass.initComponent.call(this);this.cursor=0;this.bind(this.treeLoader);if(typeof(this.initialConfig.id)=='undefined'){this.id=Ext.id(null,this.type+'.');}},onRender:function(ct,position){Ext.PagingToolbar.superclass.onRender.call(this,ct,position);this.first=this.addButton({tooltip:this.firstText,iconCls:"x-tbar-page-first",disabled:true,handler:this.onClick.createDelegate(this,["first"])});this.prev=this.addButton({tooltip:this.prevText,iconCls:"x-tbar-page-prev",disabled:true,handler:this.onClick.createDelegate(this,["prev"])});this.addSeparator();this.add(this.beforePageText);this.field=Ext.get(this.addDom({tag:"input",type:"text",size:"3",value:"1",cls:"x-tbar-page-number"}).el);this.field.on("keydown",this.onPagingKeydown,this);this.field.on("focus",function(){this.dom.select();});this.afterTextEl=this.addText(String.format(this.afterPageText,1));this.field.setHeight(18);this.addSeparator();this.next=this.addButton({tooltip:this.nextText,iconCls:"x-tbar-page-next",disabled:true,handler:this.onClick.createDelegate(this,["next"])});this.last=this.addButton({tooltip:this.lastText,iconCls:"x-tbar-page-last",disabled:true,handler:this.onClick.createDelegate(this,["last"])});this.addSeparator();this.loading=this.addButton({tooltip:this.refreshText,iconCls:"x-tbar-loading",handler:this.onClick.createDelegate(this,["refresh"])});this.addSeparator();this.pageSizeBox=new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:['size'],sortInfo:{field:'size',direction:"ASC"},data:[[10],[20],[50],[100]]}),forceSelection:false,displayField:'size',valueField:'size',typeAhead:false,selectOnFocus:true,mode:'local',regex:/^[+]?\d*$/,triggerAction:'all',width:40,blankText:''+this.pageSize,emptyText:''+this.pageSize});this.add(this.pageSizeBox);this.pageSizeBox.on('blur',function(box){if(this.pageSizeBox.getRawValue()!==''){try{this.pageSize=parseInt(this.pageSizeBox.getRawValue().trim(),10);}catch(e){this.pageSize=20;}}else{this.pageSize=20;}},this);this.pageSizeBox.on('specialkey',function(box,evt){if(evt.getKey()!=Ext.EventObject.ENTER){return;}
if(this.pageSizeBox.getRawValue()!==''){try{this.pageSize=parseInt(this.pageSizeBox.getRawValue().trim(),10);}catch(e){this.pageSize=20;}}else{this.pageSize=20;}
this.doLoad(this.cursor);},this);if(this.displayInfo){this.displayEl=Ext.fly(this.el.dom).createChild({cls:'x-paging-info'});}
if(this.dsLoaded){this.onLoad.apply(this,this.dsLoaded);}},updateInfo:function(){if(this.displayEl){count=this.node.getCount();total=this.node.getTotalCount();if(total<=this.pageSize){c=0;}else{c=this.cursor;}
msg=count==0?this.emptyMsg:String.format(this.displayMsg,c+1,c+count,total);this.displayEl.update(msg);}},onLoad:function(node){if(!this.rendered){this.dsLoaded=[node];return;}
pn=this.paramNames;if(typeof(this.treeLoader.baseParams)!='object'){this.treeLoader.baseParams={};}
c=this.treeLoader.baseParams[pn.start];this.cursor=(typeof(c)=='number')?c:0;var d=this.getPageData(),ap=d.activePage,ps=d.pages;this.afterTextEl.el.innerHTML=String.format(this.afterPageText,d.pages);this.field.dom.value=ap;this.first.setDisabled(ap==1);this.prev.setDisabled(ap==1);this.next.setDisabled(ap==ps);this.last.setDisabled(ap==ps);this.loading.enable();this.updateInfo();if(typeof(this.editor)!='undefined'){this.editor.fireEvent('load',{assorter:this.editor,node:node});}},getPageData:function(){total=this.node.getTotalCount();return{total:total,activePage:total<this.pageSize?1:Math.ceil((this.cursor+this.pageSize)/this.pageSize),pages:total<this.pageSize?1:Math.ceil(total/this.pageSize)};},onLoadError:function(){if(!this.rendered){return;}
this.loading.enable();},readPage:function(d){var v=this.field.dom.value,pageNum;if(!v||isNaN(pageNum=parseInt(v,10))){this.field.dom.value=d.activePage;return false;}
return pageNum;},onPagingKeydown:function(e){var k=e.getKey(),d=this.getPageData(),pageNum;if(k==e.RETURN){e.stopEvent();if(pageNum=this.readPage(d)){pageNum=Math.min(Math.max(1,pageNum),d.pages)-1;this.doLoad(pageNum*this.pageSize);}}else if(k==e.HOME||k==e.END){e.stopEvent();pageNum=k==e.HOME?1:d.pages;this.field.dom.value=pageNum;}else if(k==e.UP||k==e.PAGEUP||k==e.DOWN||k==e.PAGEDOWN){e.stopEvent();if(pageNum=this.readPage(d)){var increment=e.shiftKey?10:1;if(k==e.DOWN||k==e.PAGEDOWN){increment*=-1;}
pageNum+=increment;if(pageNum>=1&pageNum<=d.pages){this.field.dom.value=pageNum;}}}},beforeLoad:function(){if(this.rendered&&this.loading){this.loading.disable();}},doLoad:function(start){if(typeof(this.editor)!='undefined'){if(true===this.editor.hasChanges()){return;}
if(false===this.editor.fireEvent('beforeload',{assorter:this.editor,node:this.node})){return;}}
pn=this.paramNames;if(!this.treeLoader.baseParams){this.treeLoader.baseParams={};}
this.treeLoader.baseParams[pn.start]=start;this.treeLoader.baseParams[pn.limit]=this.pageSize;this.node.reload();return;},setNode:function(node){this.node=node;this.node.on("beforeload",this.beforeLoad,this);this.node.on("load",this.onLoad,this);this.node.getCount=function(){return this.childNodes.length;};this.node.getTotalCount=function(){return(this.firstChild!==null)?this.firstChild.attributes.total:0;};},onClick:function(which){loadInt=null;switch(which){case"first":loadInt=0;break;case"prev":loadInt=Math.max(0,this.cursor-this.pageSize);break;case"next":loadInt=this.cursor+this.pageSize;break;case"last":total=this.node.getTotalCount();extra=total%this.pageSize;loadInt=extra?(total-extra):total-this.pageSize;break;case"refresh":if(typeof(this.onBeforeRefresh)=='function'){this.onBeforeRefresh(this);}
loadInt=this.cursor;break;}
if(false===this.editor.fireEvent('beforeload',this)){return;}
THROW({args:arguments,p:[{n:'beforereset',o:''+this.editor.fireEvent('beforereset',{assorter:this.editor})},{n:'typeof(this.editor)',o:''+typeof(this.editor)},{n:'this.editor.hasChanges()',o:''+this.editor.hasChanges()}]},this,'onClick');if(typeof(this.editor)!='undefined'&&true===this.editor.hasChanges()){Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE,VIEWPORT_PROPERTIES.TEXT_UNSAVEDCHANGES+'<br />'+
VIEWPORT_PROPERTIES.TEXT_REALLYCONTINUE,function(response){if('yes'===response){if(false===this.editor.fireEvent('beforereset',{assorter:this.editor})){return;}
this.editor.reset();this.doLoad(loadInt);this.editor.refreshPagingBar(this.id,true);}},this);}else{THROW({args:arguments,p:[{n:'typeof(this.editor)',o:''+typeof(this.editor)},{n:'this.editor.hasChanges()',o:''+this.editor.hasChanges()},{n:'loadInt',o:''+loadInt}]},this,'onClick');this.doLoad(loadInt);}},unbind:function(treeLoader){treeLoader.un("loadexception",this.onLoadError,this);this.treeLoader=undefined;},bind:function(treeLoader){treeLoader.on("loadexception",this.onLoadError,this);this.treeLoader=treeLoader;pn=this.paramNames;if(typeof(this.treeLoader.baseParams)!='object'){this.treeLoader.baseParams={};}
this.treeLoader.baseParams[pn.start]=0;this.treeLoader.baseParams[pn.limit]=this.pageSize;}};Pulse.TreePagingToolbar=Ext.extend(Ext.Toolbar,TreePagingToolbar);DBG.ViewEditor=DBG.apply(DBG.Editor,{initComponent:{ViewEditor:true},initTab:true,MSG:false});ViewEditor={type:'ViewEditor',DBG:false,getSaveButtonConfig:function(){return{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_SAVE,disabled:true,handler:function(){if(false===this.hasChanges()){this.reset();return;}
saveValues=this.getChanges({id:this.sitemapNode.id});if(typeof(this.view)!='undefined'&&this.view!==null){saveValues.viewId=this.view.id;}
if(typeof(saveValues)=='undefined'||saveValues===null){if(this.DBG){THROW({e:'NO VALUES TO SAVE THOUGH THERE ARE CHANGES',args:[this.hasChanges(),saveValues]},this,'saveContentButton');}
return;}
if(true===this.applyRolesForChildrenMonitor.hasChanges()){this.applyRolesForChildrenMonitor.reset();try{Ext.get(config.clazz+'.'+config.id+'.applyForChildrenMSG').hide();}catch(e){}}
if(true===this.applySectionTagForChildrenMonitor.hasChanges()){this.applySectionTagForChildrenMonitor.reset();try{Ext.get(this.sitemapNode.clazz+'.'+this.sitemapNode.id+'.applySitemapSectionTagForChildrenMSG').hide();}catch(e){}}
this.tab.disable();Ext.Ajax.request({url:this.saveURL,method:'POST',scope:this,success:function(response,options){this.tab.enable();decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){this.commit();(function(){this.fireEvent('MSG','savesuccess',this);}).defer(250,this);}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this.type,'tbar.save');}},failure:function(response,options){this.tab.enable();if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this.type,'tbar.save');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this.type,'tbar.save');}},params:saveValues});},iconCls:'saveIconCls'};},getRemoveViewButtonConfig:function(){return{text:VIEWPORT_PROPERTIES.TEXT_REMOVE_VIEW,disabled:true,handler:function(){this.removeView(this.tab.registeredObject.node,this.removeViewURL);},iconCls:'deleteIconCls'};},getEditContentButtonConfig:function(){return{text:VIEWPORT_PROPERTIES.EDITCONTENT,disabled:true,handler:function(){node=this.tab.registeredObject.node;openTabCFG={id:node.attributes.contentType+'.'+node.attributes.contentId+'.editor',title:node.attributes.contentName,tabTip:node.attributes.contentName+' (id: '+node.attributes.contentId+')',iconCls:node.attributes.contentType.split('.').join(''),registeredObject:{node:node},loadParams:{url:this.editContentURL,params:{id:node.attributes.contentId}}};PULSE_VIEWPORT_CONTROLLER.openTab(openTabCFG);},iconCls:'editIconCls'};},initTab:function(){if(this.DBG){THROW({props:['tab','tab.id','tab.isInitialized','saveURL','removeViewURL','editContentURL']},this,'initTab');}
try{if(typeof(this.tab)!='object'||this.tab===null){THROW({e:'TAB UNDEFINED OR NULL: "['+this.tab+']"'},this,'initTab');return;}
if(true!==this.tab.isInitialized){buttons=[];saveButtonConfig=this.getSaveButtonConfig();if(typeof(this.saveURL)=='string'&&this.saveURL!==''){saveButtonConfig.disabled=false;saveButtonConfig.scope=this;}
buttons.push(saveButtonConfig);buttons.push(new Ext.Toolbar.Separator());removeViewButtonConfig=this.getRemoveViewButtonConfig();if(typeof(this.removeViewURL)=='string'&&this.removeViewURL!==''){removeViewButtonConfig.disabled=false;removeViewButtonConfig.scope=this;removeViewButtonConfig.iconCls='delete'+this.tab.registeredObject.node.attributes.contentType.split('.').join('');}
buttons.push(removeViewButtonConfig);buttons.push(new Ext.Toolbar.Separator());editContentButtonConfig=this.getEditContentButtonConfig();if(typeof(this.editContentURL)=='string'&&this.editContentURL!==''){editContentButtonConfig.disabled=false;editContentButtonConfig.scope=this;}
buttons.push(editContentButtonConfig);buttons.push(new Ext.Toolbar.Separator());this.tab.getTopToolbar().insertButton(0,buttons);this.tab.isInitialized=true;}}catch(e){FATAL(e,this,'initTab');}},removeView:function(node,removeURL){tree=node.getOwnerTree();tree.hideInlineEditor=true;Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE,SitemapLocalizations.MSG_REALLYREMOVEVIEW,function(response){if('yes'===response){node.ui.setBusy(true);requestCFG={url:removeURL,scope:this,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){tree=SitemapTree;node=SitemapTree.findChildById(options.node.id);if(typeof(node)=='undefined'||node===null){SitemapTree.expandByIds(null,options.node.attributes.expandIds,function(_node){ve=Ext.getCmp('ViewEditor.'+_node.id+'.editor');if(typeof(ve)!='undefined'&&ve!==null){ve.reloadTab(_node);}});}else{tree.runOnlyOnceAfterReload=function(node){ve=Ext.getCmp('ViewEditor.'+node.id+'.editor');if(typeof(ve)!='undefined'&&ve!==null){ve.reloadTab(node);}
node.reload();};tree.reloadNode(node);}}else{options.node.ui.setBusy();PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'ViewEditor','getRemoveViewAction.Action.execute()');}},failure:function(response,options){options.node.ui.setBusy();if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'ViewEditor','getRemoveViewAction.Action.execute()');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'ViewEditor','getRemoveViewAction.Action.execute()');}},node:node,params:{nodeid:node.id}};Ext.Ajax.request(requestCFG);}},this);},reloadTab:function(node){tab=Ext.getCmp('ViewEditor.'+node.id);if(typeof(tab)!='undefined'&&tab!==null){tab.registeredObject.node=node;tab.show();PULSE_VIEWPORT_CONTROLLER.reloadTab(tab,true);}},buildRolesAssorter:function(){if(typeof(this.loadRolesURL)=='undefined'||this.loadRolesURL===''){return;}
this.rolesEditor=new Pulse.AssorterPanel({preLoad:false,title:VIEWPORT_PROPERTIES.ROLES,renderTo:this.sitemapNode.clazz+'.'+this.sitemapNode.id+'.roles',loadURL:this.loadRolesURL+'?snid='+this.sitemapNode.id,editURL:this.editRoleURL,editHandler:function(node){RoleOverviewEditor.editRole(this.editURL,node.attributes.id,node.attributes.clazz);},uiProviders:{'AccessControlTreeNodeUI':PULSE.AccessControlTreeNodeUI}});this.rolesEditor.on('MSG',function(msgString,editor){if(this.DBG){THROW({args:arguments},this,'MSG');}
if(msgString=='change'){if(false===this.hasChanges()){this.tab.toggleHasChangesIcon(false);PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'reset'}]});}else{this.tab.toggleHasChangesIcon(true);PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:msgString}]});}}else{PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:msgString}]});}},this);this.rolesEditor.on('reset',function(eObj){if(true===eObj.success&&false===this.hasChanges()){this.tab.toggleHasChangesIcon(false);PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:'reset'}]});}},this);},initApplyRolesChildrenMonitor:function(){try{this.applyRolesForChildrenEl=Ext.get(this.sitemapNode.clazz+'.'+this.sitemapNode.id+'.applyRolesForChildren');if(typeof(this.applyRolesForChildrenEl)=='undefined'&&this.applyRolesForChildrenEl===null){if(this.DBG){FATAL('ELEMENT UNDEFINED',this,'initApplyRolesChildrenMonitor');}
return;}
applyRolesForChildrenMonitorCFG={id:this.id+'.applyRolesForChildrenEditor',el:this.applyRolesForChildrenEl,fieldType:'checkbox'};this.applyRolesForChildrenMonitor=new Pulse.FieldMonitor(applyRolesForChildrenMonitorCFG);this.addSubEditor(this.applyRolesForChildrenMonitor);try{Ext.get(this.sitemapNode.clazz+'.'+this.sitemapNode.id+'.applyRolesForChildrenMSG').hide();}catch(e){}
this.applyRolesForChildrenMonitor.on('MSG',function(msgString){try{if(msgString=='change'){Ext.get(this.sitemapNode.clazz+'.'+this.sitemapNode.id+'.applyRolesForChildrenMSG').show(true);}else if(msgString=='reset'){Ext.get(this.sitemapNode.clazz+'.'+this.sitemapNode.id+'.applyRolesForChildrenMSG').hide(true);}}catch(e){}},this);}catch(e){if(this.DBG){FATAL(e,this,'initApplyRolesChildrenMonitor');}}},initApplySectionTagChildrenMonitor:function(){try{this.applySectionTagForChildrenEl=Ext.get(this.sitemapNode.clazz+'.'+this.sitemapNode.id+'.applySitemapSectionTagForChildren');if(typeof(this.applySectionTagForChildrenEl)=='undefined'&&this.applySectionTagForChildrenEl===null){if(this.DBG){FATAL('ELEMENT UNDEFINED',this,'initApplySectionTagChildrenMonitor');}
return;}
applySectionTagForChildrenMonitorCFG={id:this.id+'.applySectionTagForChildrenEditor',el:this.applySectionTagForChildrenEl,fieldType:'checkbox'};this.applySectionTagForChildrenMonitor=new Pulse.FieldMonitor(applySectionTagForChildrenMonitorCFG);this.addSubEditor(this.applySectionTagForChildrenMonitor);try{Ext.get(this.sitemapNode.clazz+'.'+this.sitemapNode.id+'.applySitemapSectionTagForChildrenMSG').hide();}catch(e){}
this.applySectionTagForChildrenMonitor.on('MSG',function(msgString){try{if(msgString=='change'){Ext.get(this.sitemapNode.clazz+'.'+this.sitemapNode.id+'.applySitemapSectionTagForChildrenMSG').show(true);}else if(msgString=='reset'){Ext.get(this.sitemapNode.clazz+'.'+this.sitemapNode.id+'.applySitemapSectionTagForChildrenMSG').hide(true);}}catch(e){}},this);}catch(e){if(this.DBG){FATAL(e,this,'initApplySectionTagChildrenMonitor');}}},initSitemapSectionTagEditorPanel:function(){if(this.DBG){THROW({args:arguments,props:['initSitemapSectionTagEditorURL']},this,'initSitemapSectionTagEditorPanel');}
try{if(typeof(this.initSitemapSectionTagEditorURL)!='string'||this.initSitemapSectionTagEditorURL===''){if(this.DBG){FATAL({e:'URL UNDEFINED',props:['initSitemapSectionTagEditorURL']},this,'initSitemapSectionTagEditorPanel');}
return;}
subEditorPanelCFG={id:this.sitemapNode.clazz+'.'+this.sitemapNode.id+'.sitemapSectionTagEditorPanel',masterEditor:this,url:this.initSitemapSectionTagEditorURL,params:{id:this.sitemapNode.id},renderTo:this.sitemapNode.clazz+'.'+this.sitemapNode.id+'.sitemapSectionTagEditorDiv',bodyStyle:'padding: 5px 5px 5px 5px;'};if(typeof(this.sectionTagEditorTitle)=='string'&&this.sectionTagEditorTitle!==''){subEditorPanelCFG.title=this.sectionTagEditorTitle;}
subEditorPanel=new Pulse.SubEditorPanel(subEditorPanelCFG);subEditorPanel.on('expand',function(){this.initializePanel();});this.addSubEditor(subEditorPanel);}catch(e){FATAL(e,this,'initSitemapSectionTagEditorPanel');}},initDurationEditorPanel:function(){if(this.DBG){THROW({args:arguments,props:['initDurationEditorURL']},this,'initDurationEditorPanel');}
try{if(typeof(this.initDurationEditorURL)!='string'||this.initDurationEditorURL===''){if(this.DBG){FATAL({e:'URL UNDEFINED',props:['initDurationEditorURL']},this,'initDurationEditorPanel');}
return;}
subEditorPanelCFG={id:this.sitemapNode.clazz+'.'+this.sitemapNode.id+'.durationEditorPanel',masterEditor:this,url:this.initDurationEditorURL,params:{id:this.sitemapNode.id},renderTo:this.sitemapNode.clazz+'.'+this.sitemapNode.id+'.durationEditorDiv',bodyStyle:'padding: 5px 5px 5px 5px;'};if(typeof(this.durationEditorTitle)=='string'&&this.durationEditorTitle!==''){subEditorPanelCFG.title=this.durationEditorTitle;}
subEditorPanel=new Pulse.SubEditorPanel(subEditorPanelCFG);subEditorPanel.on('expand',function(){this.initializePanel();});this.addSubEditor(subEditorPanel);}catch(e){FATAL(e,this,'initDurationEditorPanel');}},hasChanges:function(){superBool=Pulse.ViewEditor.superclass.hasChanges.call(this);rolesBool=false;if(typeof(this.rolesEditor)!='undefined'&&typeof(this.rolesEditor)!==null){rolesBool=this.rolesEditor.hasChanges();}
return(superBool||rolesBool);},getChanges:function(v){v=Pulse.ViewEditor.superclass.getChanges.call(this,v);try{if(typeof(v)!='object'){v={};}
if(typeof(this.rolesEditor)!='undefined'&&this.rolesEditor!==null){if(true===this.rolesEditor.hasChanges()){chgs=this.rolesEditor.getChanges();if(typeof(chgs.asoc)!='undefined'){v.addroles=chgs.asoc;}
if(typeof(chgs.unasoc)!='undefined'){v.remroles=chgs.unasoc;}}}
return v;}catch(e){THROW({e:'FATAL',o:e},this,'getChanges');}},commit:function(){Pulse.ViewEditor.superclass.commit.call(this);if(typeof(this.rolesEditor)!='undefined'&&this.rolesEditor!==null){if(true===this.rolesEditor.hasChanges()){this.rolesEditor.commit();}}},reset:function(){Pulse.ViewEditor.superclass.reset.call(this);if(typeof(this.rolesEditor)!='undefined'&&this.rolesEditor!==null){this.rolesEditor.reset();}},initComponent:function(boolInitTab){Pulse.ViewEditor.superclass.initComponent.call(this,boolInitTab);if(this.DBG){props=['id','type'];props=props.concat(DBG.getPropertyArray(this.initialConfig));THROW({args:arguments,props:props},this,'initComponent.ViewEditor');}
try{if(false!==boolInitTab){this.initTab();}
this.initApplyRolesChildrenMonitor();this.buildRolesAssorter();this.initApplySectionTagChildrenMonitor();this.initSitemapSectionTagEditorPanel();this.initDurationEditorPanel();}catch(e){FATAL(e,this,'initComponent.ViewEditor');}},createNewView:function(){alert('static access only via ViewEditor.createNewView()');}};Pulse.ViewEditor=Ext.extend(Pulse.Editor,ViewEditor);ViewEditor.createNewView=function(crNode,smNode,createViewURL){Ext.Ajax.request({node:smNode,url:createViewURL,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){tree=SitemapTree;node=SitemapTree.findChildById(options.node.id);if(typeof(node)=='undefined'||node===null){SitemapTree.expandByIds(null,options.node.attributes.expandIds,function(_node){ViewEditor.reloadTab(_node);});}else{tree.runOnlyOnceAfterReload=function(node){ViewEditor.reloadTab(node);node.reload();};tree.reloadNode(node);}}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'ViewEditor','createNewView');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'ViewEditor','createNewView');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'ViewEditor','createNewView');}},params:{crNode:crNode.id,smNode:smNode.id}});};DBG.SitemapSectionTagEditor=DBG.apply(DBG.Editor,{initComponent:{SitemapSectionTagEditor:false},createSitemapSectionTag:false,selectSectionTag:false,editSectionTag:false,deleteSectionTag:false});SitemapSectionTagEditor={type:'SitemapSectionTagEditor',DBG:false,getButtons:function(){createButtonCfg={scope:this,disabled:true,text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CREATE,iconCls:'addIconCls',handler:this.createSitemapSectionTag};removeSelectionButtonCFG={scope:this,text:VIEWPORT_PROPERTIES.BUTTON_TEXT_UNSELECT,iconCls:'isSelectedDisabledIconCls',handler:this.removeSelection};if(typeof(this.createSitemapSectionTagURL)=='string'&&this.createSitemapSectionTagURL!==''){createButtonCfg.disabled=false;}
return[new Ext.Toolbar.Button(createButtonCfg),new Ext.Toolbar.Separator(),new Ext.Toolbar.Button(removeSelectionButtonCFG),new Ext.Toolbar.Separator()];},createSitemapSectionTag:function(){if(this.DBG){THROW(this.masterEditor,this,'createSitemapSectionTag');}
Ext.Msg.prompt(VIEWPORT_PROPERTIES.NAME,VIEWPORT_PROPERTIES.TEXT_ENTER_NAME+':',function(btn,text){if(btn==='ok'){if(text.trim()===''){return;}
this.masterEditor.disable();requestCFG={url:this.createSitemapSectionTagURL,scope:this,method:'POST',success:function(response,options){this.masterEditor.enable();decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){this.masterEditor.loadPanel();}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this,'createSitemapSectionTag');}},failure:function(response,options){this.masterEditor.enable();if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this,'createSitemapSectionTag');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this,'createSitemapSectionTag');}},params:{text:text}};Ext.Ajax.request(requestCFG);}},this,false);},removeSelection:function(){if(typeof(this.sitemapSectionTag)=='undefined'){return;}
Ext.get(this.sitemapSectionTag.clazz+'.'
+this.sitemapSectionTag.id+'.'
+this.sitemapNode.id).dom.checked=false;delete this.sitemapSectionTag;if(true===this.hasChanges()){this.fireEvent('MSG','change',this);}else{this.fireEvent('MSG','reset',this);}},hasChanges:function(){if(typeof(this.sitemapSectionTag)=='undefined'&&typeof(this.initialSelectionTag)=='undefined'){return false;}
if(typeof(this.sitemapSectionTag)!='undefined'&&this.sitemapSectionTag!==null&&typeof(this.initialSelectionTag)!='undefined'&&typeof(this.initialSelectionTag)!==null){return(this.sitemapSectionTag.id!=this.initialSelectionTag.id);}
return true;},getChanges:function(v){if(false===this.hasChanges()){return v;}
if(typeof(v)=='undefined'){v={};}
if(typeof(this.sitemapSectionTag)!='undefined'){v.sitemapSelectionTagId=this.sitemapSectionTag.id;}else{v.sitemapSelectionTagId='undefined';}
return v;},commit:function(){this.initialSelectionTag=this.sitemapSectionTag;this.fireEvent('MSG','commit',this);return;},reset:function(boolFireEvt){if(typeof(this.sitemapSectionTag)!='undefined'){Ext.get(this.sitemapSectionTag.clazz+'.'
+this.sitemapSectionTag.id+'.'
+this.sitemapNode.id).dom.checked=false;}
if(typeof(this.initialSelectionTag)!='undefined'){Ext.get(this.initialSelectionTag.clazz+'.'
+this.initialSelectionTag.id+'.'
+this.sitemapNode.id).dom.checked=true;}
this.sitemapSectionTag=this.initialSelectionTag;if(false===boolFireEvt){return;}
this.fireEvent('MSG','reset',this);},onRender:function(){THROW({props:['renderTo'],args:arguments},this,'onRender');try{}catch(e){description=(typeof(e)=='object'&&typeof(e.description)!='undefined')?', '+e.description:'';THROW({e:'FATAL',o:{e:e,o:description}},this,'onRender');}},selectSectionTag:function(radioEl){if(this.DBG){THROW({propsObj:radioEl,props:['name','value','className']},this,'selectSectionTag');}
this.sitemapSectionTag={id:radioEl.value,clazz:radioEl.className};if(true===this.hasChanges()){this.fireEvent('MSG','change',this);}else{this.fireEvent('MSG','reset',this);}},editSectionTag:function(id,name){if(this.DBG){THROW({props:['editSitemapSectionTagURL'],args:arguments},this,'editSectionTag');}
Ext.Msg.prompt(VIEWPORT_PROPERTIES.NAME,VIEWPORT_PROPERTIES.TEXT_ENTER_NAME+':',function(btn,text){if(btn==='ok'){if(text.trim()===''){return;}
this.masterEditor.disable();requestCFG={url:this.editSitemapSectionTagURL,scope:this,method:'POST',success:function(response,options){this.masterEditor.enable();decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){this.masterEditor.loadPanel();}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this,'createSitemapSectionTag');}},failure:function(response,options){this.masterEditor.enable();if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this,'createSitemapSectionTag');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this,'createSitemapSectionTag');}},params:{text:text,id:id}};Ext.Ajax.request(requestCFG);}},this,false,name);},deleteSectionTag:function(id,name){if(this.DBG){THROW({props:['deleteSitemapSectionTagURL'],args:arguments},this,'deleteSectionTag');}
Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE+':&#160;"'+name+'"',VIEWPORT_PROPERTIES.MSG_REALLYDELETE,function(response){if('yes'===response){this.masterEditor.disable();requestCFG={url:this.deleteSitemapSectionTagURL,scope:this,method:'POST',success:function(response,options){this.masterEditor.enable();decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){this.masterEditor.loadPanel();(function(){this.fireEvent('MSG','savesuccess',this);}).defer(500,this);}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this,'deleteSectionTag');}},failure:function(response,options){this.masterEditor.enable();if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this,'deleteSectionTag');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this,'deleteSectionTag');}},params:{id:id}};Ext.Ajax.request(requestCFG);}},this);},initComponent:function(){Pulse.SitemapSectionTagEditor.superclass.initComponent.call(this);if(this.DBG){props=['id','type'];props=props.concat(DBG.getPropertyArray(this.initialConfig));THROW({args:arguments,props:props},this,'initComponent.SitemapSectionTagEditor');}
try{this.initialSelectionTag=this.initialConfig.sitemapSectionTag;}catch(e){FATAL(e,this,'initComponent.SitemapSectionTagEditor');}}};Pulse.SitemapSectionTagEditor=Ext.extend(Pulse.Editor,SitemapSectionTagEditor);DBG.ViewStyleEditor=DBG.apply(DBG.Editor,{initComponent:{ViewStyleEditor:false}});ViewStyleEditor={type:'ViewStyleEditor',DBG:false,buildPanel:function(){try{this.panel=new Ext.Panel({title:this.title+':',header:true,collapsible:true,collapsed:true,renderTo:this.id+'.el',contentEl:this.id+'.contentEl',bodyStyle:'padding: 5px 5px 5px 5px;'});Pulse.insertHasChangesIcon(this.panel);}catch(e){if(this.DBG){FATAL(e,this,'buildPanel');}}},selectStyle:function(newStyle){if(this.selectedStyle==newStyle){return;}
sitemapNodeId=this.tab.registeredObject.node.id;imgEl=Ext.get(this.selectedStyle+'.'+sitemapNodeId+'.isSelected');if(imgEl.hasClass('isSelectedIconCls')){imgEl.removeClass('isSelectedIconCls');imgEl.setWidth(1);}
imgEl=Ext.get(newStyle+'.'+sitemapNodeId+'.isSelected');imgEl.addClass('isSelectedIconCls');imgEl.setWidth(16);this.selectedStyle=newStyle;if(this.selectedStyle!=this.initialConfig.selectedStyle){this.fireEvent('MSG','change',this);this.panel.toggleHasChangesIcon(true);}else{this.fireEvent('MSG','reset',this);this.panel.toggleHasChangesIcon(false);}},hasChanges:function(){return(this.selectedStyle!=this.initialConfig.selectedStyle);},getChanges:function(v){if(false===this.hasChanges()){return v;}
if(typeof(v)=='undefined'){v={};}
v.style=this.selectedStyle;return v;},commit:function(){this.initialConfig.selectedStyle=this.selectedStyle;this.panel.toggleHasChangesIcon(false);},reset:function(){this.selectedStyle=this.initialConfig.selectedStyle;this.panel.toggleHasChangesIcon(false);},initComponent:function(){Pulse.ViewStyleEditor.superclass.initComponent.call(this);if(this.DBG){props=['id','type'];props=props.concat(DBG.getPropertyArray(this.initialConfig));THROW({args:arguments,props:props},this,'initComponent.ViewStyleEditor');}
try{this.buildPanel();}catch(e){FATAL(e,this,'initComponent.ViewStyleEditor');}}};Pulse.ViewStyleEditor=Ext.extend(Pulse.Editor,ViewStyleEditor);DBG.ViewThemeEditor=DBG.apply(DBG.Editor,{initComponent:{ViewThemeEditor:false}});ViewThemeEditor={type:'ViewThemeEditor',DBG:false,buildPanel:function(){try{this.panel=new Ext.Panel({title:this.title+':',header:true,collapsible:true,collapsed:true,renderTo:this.id+'.el',contentEl:this.id+'.contentEl',bodyStyle:'padding: 5px 5px 5px 5px;'});Pulse.insertHasChangesIcon(this.panel);}catch(e){if(this.DBG){FATAL(e,this,'buildPanel');}}},hasChanges:function(){if(this.DBG){FATAL({e:'IMPLEMENT'},this,'hasChanges');}
return false;},getChanges:function(v){if(this.DBG){FATAL({e:'IMPLEMENT'},this,'getChanges');}
return v;},commit:function(){if(this.DBG){FATAL({e:'IMPLEMENT'},this,'commit');}},reset:function(){if(this.DBG){FATAL({e:'IMPLEMENT'},this,'reset');}},initComponent:function(){Pulse.ViewThemeEditor.superclass.initComponent.call(this);if(this.DBG){props=['id','type'];props=props.concat(DBG.getPropertyArray(this.initialConfig));THROW({args:arguments,props:props},this,'initComponent.ViewThemeEditor');}
try{this.buildPanel();}catch(e){FATAL(e,this,'initComponent.ViewThemeEditor');}}};Pulse.ViewThemeEditor=Ext.extend(Pulse.Editor,ViewThemeEditor);ViewThemeEditor.showSelector=function(sitemapNodeId,editThemesURL){try{pel=VIEWPORT.getEl();if(typeof(pel)=='undefined'){throw('24 :: PULSE.ViewEditor.Themes.js.initEditor() :: '+'CHECK for element failed...');}
if(typeof(this.win)=='undefined'||this.win===null){el=pel.createChild({tag:'div',id:'ThemesEditorWindow.el'});windowCfg={id:'ThemesEditorWindow',maximizable:false,title:VIEWPORT_PROPERTIES.TEXT_VIEWEDITOR_THEMES,iconCls:'sitemapIconCls',closable:true,plain:false,modal:true,autoScroll:true,html:'',renderTo:el,height:300,width:400,bodyStyle:'background-color: #FFFFFF;',tbar:[{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CANCEL,handler:function(){ViewThemeEditor.win.close();},iconCls:'cancelIconCls'}]};this.win=new Ext.Window(windowCfg);}
loadConfig={url:editThemesURL,method:'POST',callback:LPCB,params:{id:sitemapNodeId},text:'loading...',discardUrl:true,nocache:true,timeout:30};this.win.load(loadConfig);this.win.on({'beforeclose':{fn:function(win){win.hide();return false;}}});this.win.setSize({width:VIEWPORT.getSize().width*0.8,height:VIEWPORT.getSize().height*0.8});this.win.show();this.win.setPosition(VIEWPORT.getSize().width*0.1,VIEWPORT.getSize().height*0.1);}catch(windowInitError){alert('windowInitError: \n'+windowInitError);}};ViewThemeEditor.removeTheme=function(sitemapNodeId,removeThemeURL,loadThemeURL){Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE,VIEWPORT_PROPERTIES.TEXT_REALLYRESET,function(response){if('yes'===response){Ext.Ajax.request({url:removeThemeURL,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){ViewThemeEditor.updateTheme(options.params.id,loadThemeURL);}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'ViewEditorThemes','removeTheme');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'ViewEditorThemes','removeTheme');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'ViewEditorThemes','removeTheme');}},params:{id:sitemapNodeId}});}},this);};ViewThemeEditor.applyTheme=function(sitemapNodeId,themeName,applyThemeURL,loadThemeURL){Ext.Ajax.request({url:applyThemeURL,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){ViewThemeEditor.win.close();ViewThemeEditor.updateTheme(options.params.id,loadThemeURL);}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'ViewEditorThemes','applyTheme');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'ViewEditorThemes','applyTheme');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'ViewEditorThemes','applyTheme');}},params:{id:sitemapNodeId,theme:themeName}});};ViewThemeEditor.updateTheme=function(sitemapNodeId,loadThemeURL){themesEl=Ext.get(sitemapNodeId+'.themeReloadWrapper');themesEl.getUpdater().update({url:loadThemeURL,method:'POST',callback:LPCB,params:{id:sitemapNodeId},text:'loading...',discardUrl:true,nocache:true,timeout:30});};var PULSE_VIEWPORT_CONTROLLER={type:'PULSE_VIEWPORT_CONTROLLER',DBG:false,openTab:function(config){if(this.DBG){THROW({args:arguments,propsObj:config,props:['id','loadParams','loadParams.url']},this,'openTab');}
if(typeof(config)=='undefined'||typeof(config.id)=='undefined'){THROW({e:'config.ERROR',propsObj:config,props:['id']},this,'openTab');return;}
pulseLoadConfig=config;if(typeof(CENTER_TAB_PANEL.getComponent(config.id))!='undefined'&&CENTER_TAB_PANEL.getComponent(config.id)!==null){CENTER_TAB_PANEL.getComponent(config.id).show();return;}
if(typeof(config.closable)=='undefined'){config.closable=true;}
config.isDirty=false;msgPanel=new Ext.Panel({id:config.id+'.msgPanel',html:'msgs go here',bodyStyle:'padding:4px;',border:false,collapsed:true});contentPanel=new Ext.Panel({id:config.id+'.contentPanel',html:'content goes here',border:false});actionReloadTab=new Ext.Action({reloadTabId:config.id,text:VIEWPORT_PROPERTIES.BUTTON_TEXT_RELOAD,handler:function(){tab=Ext.getCmp(this.reloadTabId);if(PULSE_VIEWPORT_CONTROLLER.DBG){THROW({propsObj:tab,props:['id','contentPanel'],o:'reloadTabId: '+this.reloadTabId},this,'RELOAD.CLICK');}
if(true===tab.contentPanel.getUpdater().isUpdating()){return;}
PULSE_VIEWPORT_CONTROLLER.reloadTab(tab);return;},iconCls:'reloadIconCls'});toolBar=new Ext.Toolbar({id:config.id+'.toolBar',items:['->',actionReloadTab]});config.type='PulseExtendedTab';config.tbar=toolBar;config.items=[msgPanel,contentPanel];newTab=CENTER_TAB_PANEL.add(config);newTab.msgPanel=msgPanel;newTab.contentPanel=contentPanel;newTab.show();newTab.pulseLoadConfig=pulseLoadConfig;newTab.doLayout();newTab.setEditor=function(editor){if(typeof(editor)=='undefined'||editor===null){FATAL('CANNOT ADD UNDEFINED EDITOR',this,'setEditor');return;}
this.pEditor=editor;this.pEditor.on('MSG',function(msgString,editor){if(typeof(editor.DBG)!='undefined'&&true===editor.DBG.MSG){THROW({o:'PULSE_VIEWPORT_CONTROLLER',args:arguments,p:[{n:'editor',o:editor},{n:'editor.id',o:editor.id},{n:'editor.type',o:editor.type}],props:['id','type']},this,'MSG');}
this.toggleHasChangesIcon(this.pEditor.hasChanges());msg=msgString.toUpperCase();switch(msg){case'RESET':PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.id},{n:'msg',o:'RESET'}]});break;case'COMMIT':PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.id},{n:'msg',o:'SAVESUCCESS'}]});break;case'SAVESUCCESS':PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.id},{n:'msg',o:'SAVESUCCESS'}]});break;case'DELETESUCCESS':PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.id},{n:'msg',o:'DELETESUCCESS'}]});break;case'CHANGE':PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.id},{n:'msg',o:'CHANGE'}]});break;case'CHANGES':PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.id},{n:'msg',o:'CHANGE'}]});break;case'CHANGENOTSAVEABLE':PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.id},{n:'msg',o:'CHANGENOTSAVEABLE'}]});break;default:if(typeof(editor.DBG)!='undefined'&&true===editor.DBG.MSG){THROW({o:'PULSE_VIEWPORT_CONTROLLER',args:arguments,propsObj:editor,props:['tab','tab.id']},editor,'MSG');}
break;}
return;},this);PULSE_VIEWPORT_CONTROLLER.insertHasChangesIcon(this);};newTab.addSubEditor=function(editor){try{if(typeof(editor)=='undefined'||editor===null){throw('CANNOT ADD UNDEFINED EDITOR');}
if(typeof(this.pEditor)=='undefined'||this.pEditor===null){throw('this.pEditor UNDEFINED');}
this.pEditor.addSubEditor(editor);}catch(e){FATAL(e,this,'addSubEditor');}};msgPanel.hide();msgPanel.on('collapse',function(p){msgPanel.hide();});msgPanel.on('hide',function(p){(function(){newTab.fireEvent('resize',newTab);}).defer(500);});if(!config.loadParams){actionReloadTab.disable();}else{if(typeof(config.loadParams.url)=='undefined'||typeof(config.loadParams.url)!='string'||config.loadParams.url===''){THROW({e:'URL for AJAX call undefined',args:arguments,propsObj:config,props:['id','title','iconCls','loadParams','loadParams.url']},this,'openTab');actionReloadTab.disable();return;}
params={};if(typeof(config.loadParams.params)!='undefined'){params=config.loadParams.params;}
scripts=true;if(typeof(config.loadParams.scripts)=='boolean'){scripts=config.loadParams.scripts;}
loadConfig={url:config.loadParams.url,scripts:scripts,callback:LPCB,params:params,text:'loading...',discardUrl:true,nocache:true,timeout:30};contentPanel.loadConfig=loadConfig;contentPanel.load(loadConfig);}
if(typeof(config.initTab)=='function'){config.initTab(config.id);}
if(this.DBG){THROW({args:arguments,propsObj:newTab,props:['contentPanel','msgPanel','contentPanel.id','msgPanel.id']},this,'openTabDbgNewTab');}
(function(_newTab,_config){newTabEl=CENTER_TAB_PANEL.getTabEl(_newTab);if(this.DBG){THROW({args:arguments,o:{o:'deferredTabActivation',propsObj:newTabEl,props:['id','className']},propsObj:_config,props:['id']},this,'openTabDeferredActivation');}
if(newTabEl.className.indexOf('x-tab-strip-active')==-1){newTabEl.className+=' x-tab-strip-active';if(this.DBG){THROW({o:'deferredTabActivation.true',propsObj:_config,props:['id']},this,'openTabDeferredActivation');}}}).defer(200,this,[newTab,config]);if(this.DBG){THROW({o:'finished',propsObj:config,props:['id']},this,'openTab');}},reloadTab:function(tab,disregardChanges){THROW({args:arguments},this,'reloadTab');tab.reloadTab=true;if(typeof(disregardChanges)=='boolean'&&disregardChanges===true){tab.disregardChanges=true;}
CENTER_TAB_PANEL.remove(tab.id,true);},closeTab:function(tabId,disregardChanges){THROW({args:arguments},this,'closeTab');if(typeof(disregardChanges)=='boolean'&&disregardChanges===true){tab=Ext.getCmp(tabId);if(typeof(tab)!='undefined'){tab.disregardChanges=true;}
CENTER_TAB_PANEL.remove(tabId,true);}else{CENTER_TAB_PANEL.remove(tabId,true);}},onBeforeTabClose:function(tabPanel,tab){THROW({args:arguments,propsObj:tab,props:['id','isDirty','disregardChanges','reloadTab']},this,'onBeforeTabClose');if(typeof(tab.tabIsDirty)=='boolean'){onBeforeTabClose(tabPanel,tab);return;}
if(true===tab.reloadTab&&true===tab.disregardChanges){if(typeof(tab.toggleHasChangesIcon)=='function'){tab.toggleHasChangesIcon(false);}
return;}
if(typeof(tab.pEditor)!='undefined'){if(true===tab.pEditor.hasChanges()){Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE,VIEWPORT_PROPERTIES.TEXT_UNSAVEDCHANGES+'<br />'+
VIEWPORT_PROPERTIES.TEXT_REALLYCONTINUE,function(response){if('yes'===response){tab.isDirty=false;if(typeof(tab.toggleHasChangesIcon)=='function'){tab.toggleHasChangesIcon(false);}
if(typeof(tab.pEditor.reset)=='function'){tab.pEditor.reset();}else{tab.pEditor.commitChanges();}
CENTER_TAB_PANEL.remove(tab.id,true);}else{tab.reloadTab=false;}},this);return false;}}else{if(true===tab.isDirty){Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE,VIEWPORT_PROPERTIES.TEXT_UNSAVEDCHANGES+'<br />'+
VIEWPORT_PROPERTIES.TEXT_REALLYCONTINUE,function(response){if('yes'===response){tab.isDirty=false;if(typeof(tab.toggleHasChangesIcon)=='function'){tab.toggleHasChangesIcon(false);}
CENTER_TAB_PANEL.remove(tab.id,true);}else{tab.reloadTab=false;}},this);return false;}}
if(typeof(tab.toggleHasChangesIcon)=='function'){tab.toggleHasChangesIcon(false);}},onAfterTabClose:function(tabPanel,tab){if(this.DBG){THROW({args:arguments,propsObj:tab,props:['id','isDirty','disregardChanges','reloadTab']},this,'onAfterTabClose');}
if(true===tab.reloadTab){tab.reloadTab=false;tab.disregardChanges=false;tab.isDirty=false;PULSE_VIEWPORT_CONTROLLER.openTab(tab.pulseLoadConfig);}},insertHasChangesIcon:function(tab,tabPanel){if(typeof(tab)=='undefined'||tab===null){return;}
try{if(typeof(tab.toggleHasChangesIcon)=='function'){return;}
if(typeof(tabPanel)=='undefined'||tabPanel===null){pnlTabEl=CENTER_TAB_PANEL.getTabEl(tab);}else{pnlTabEl=tabPanel.getTabEl(tab);}
if(typeof(pnlTabEl)=='undefined'||pnlTabEl===null){THROW({e:'tab: El undefined',args:arguments,o:{props:['className'],propsObj:pnlTabEl},propsObj:tab,props:['id']},this,'insertHasChangesIcon');return;}
extPnlTabElTitleDom=Ext.DomQuery.selectNode("*[@class*='x-tab-strip-inner']",pnlTabEl);hasChangesIconImgEl=document.createElement('img');hasChangesIconImgEl.id=tab.id+'.hasChangesIconImgEl';hasChangesIconImgEl.src=Ext.BLANK_IMAGE_URL;hasChangesIconImgEl.className='tabHasChangesIconHidden';if(extPnlTabElTitleDom.firstChild!==null){if(extPnlTabElTitleDom.firstChild.id!==tab.id+'.hasChangesIconImgEl'){extPnlTabElTitleDom.insertBefore(hasChangesIconImgEl,extPnlTabElTitleDom.firstChild);tab.hasChangesIconImgEl=hasChangesIconImgEl;}else{tab.hasChangesIconImgEl=Ext.get(tab.id+'.hasChangesIconImgEl').dom;}}else{return;}
tab.toggleHasChangesIcon=function(bool){if(typeof(bool)!='boolean'){if(this.hasChangesIconImgEl.className=='tabHasChangesIconHidden'){if(this.hasChangesIconImgEl.nextSibling.className.indexOf('m16left')===-1){this.hasChangesIconImgEl.nextSibling.className+=' m16left';}
this.hasChangesIconImgEl.className='tabHasChangesIcon';}else{this.hasChangesIconImgEl.nextSibling.className=this.hasChangesIconImgEl.nextSibling.className.replace(' m16left','');this.hasChangesIconImgEl.className='tabHasChangesIconHidden';}}else{if(true===bool){if(this.hasChangesIconImgEl.nextSibling.className.indexOf('m16left')===-1){this.hasChangesIconImgEl.nextSibling.className+=' m16left';}
this.hasChangesIconImgEl.className='tabHasChangesIcon';}else{this.hasChangesIconImgEl.nextSibling.className=this.hasChangesIconImgEl.nextSibling.className.replace(' m16left','');this.hasChangesIconImgEl.className='tabHasChangesIconHidden';}}};}catch(e){description=(typeof(e)=='object')?', '+e.description:'';THROW({e:'FATAL',o:''+e+description},this,'insertHasChangesIcon');}
return;},displayPanelError:function(tab,identifier){contentPanel=Ext.getCmp(tab.id+'.contentPanel');PulseError.Throw({e:'TODO',p:[{n:'tab',o:tab},{n:'contentPanel',o:contentPanel}]},'PULSE_VIEWPORT_CONTROLLER','displayPanelError()');return;switch(identifier){case'':alert('ERROR :: PULSE_VIEWPORT_CONTROLLER.displayPanelError(tab, identifier): identifier cannot be: ""');break;default:tab.getEl().update('NO CASE DEFINED :: PULSE_VIEWPORT_CONTROLLER.displayPanelError().switch( "'+identifier+'" )');}}};Pulse.test=function(){FATAL({e:'TODO',description:'{@see PULSE.test.js}'},this,'test');};DBG.CMSContentEditor=DBG.apply(DBG.ContentEditor,{initFieldMonitoring:{CMSContentEditor:false},addSubEditor:{CMSContentEditor:false},hasChanges:{CMSContentEditor:false},initTab:false,MSG:false});CMSContentEditor={type:'CMSContentEditor',DBG:false,getCreateCopyButtonConfig:function(){return{text:VIEWPORT_PROPERTIES.COPYCONTENT,disabled:true,scope:this,handler:function(){this.selectCopyCallback=function(node){Ext.Ajax.request({url:this.copyContentURL,scope:this,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){panel=Ext.getCmp(this.getContent().clazz+'.'+this.getContent().id+'.contentLocalizationMap.panel');panel.lastLoadConfig.callback=LPCB;panel.lastLoadConfig.timeout=30;panel.load(panel.lastLoadConfig);crPanel=Ext.getCmp('ContentRegistry.WEST');crPanel.expand();path=decodedResponse.expandPath;ContentRegistryEditor.expandByIds(ContentRegistryTree.getRootNode(),path,function(node){ContentRegistryEditor.editNode(node);});}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this,'tbar.copy');}
delete this.selectCopyCallback;},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this,'tbar.copy');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this,'tbar.copy');}
delete this.selectCopyCallback;},params:{id:this.getContent().id,toid:node.attributes.id}});};windowCfg={getChildrenURL:this.browseContentRegistryURL+'?mode=folder&bundle='+this.getContent().bundle,emptyText:VIEWPORT_PROPERTIES.TEXT_CHOOSE_FOLDER,scope:this,selectCallback:'selectCopyCallback'};ContentRegistryEditor.getSelectWindow(windowCfg);},iconCls:'copyIconCls'};},getSaveContentButtonConfig:function(){return{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_SAVE,disabled:true,scope:this,handler:function(){if(false===this.hasChanges()){this.reset();return;}
if(false===Ext.getCmp(this.id+'.nameEditor').validate()||false===Ext.getCmp(this.id+'.suffixEditor').validate()){return;}
saveValues=this.getChanges({id:this.getContent().id});saveValues.pages=this.getPageOrder();if(typeof(saveValues)=='undefined'||saveValues===null){if(this.DBG){THROW({e:'NO VALUES TO SAVE THOUGH THERE ARE CHANGES',args:[this.hasChanges(),saveValues]},this,'saveContentButton');}
return;}
this.tab.disable();Ext.Ajax.request({url:this.saveContentURL,method:'POST',scope:this,success:function(response,options){this.tab.enable();decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){this.commit();(function(){this.fireEvent('MSG','savesuccess',this);}).defer(250,this);}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this.type,'tbar.save');}},failure:function(response,options){this.tab.enable();if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this.type,'tbar.save');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this.type,'tbar.save');}},params:saveValues});},iconCls:'saveIconCls'};},getFindButtonConfig:function(){return{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_FIND,disabled:true,scope:this,handler:function(){Ext.Ajax.request({url:this.contentExpandPathURL,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){crPanel=Ext.getCmp('ContentRegistry.WEST');if(typeof(crPanel)=='undefined'||crPanel===null){PULSE_TOOLBAR.openPanel({id:'ContentRegistry.WEST',callback:function(){ContentRegistryEditor.expandByIds(ContentRegistryTree.getRootNode(),decodedResponse.ids);}});return;}
crPanel.expand();ContentRegistryEditor.expandByIds(ContentRegistryTree.getRootNode(),decodedResponse.ids);}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this.type,'tbar.find');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this.type,'tbar.find');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this.type,'tbar.find');}},params:{id:this.getContent().id}});},iconCls:'findIconCls'};},getCreatePageButtonConfig:function(){return{text:VIEWPORT_PROPERTIES.NEWPAGE,disabled:true,scope:this,handler:function(){AbstractBasicContentEditor.getFCKEditorWindow({scope:this,onSaveSuccess:'saveNewPageSuccess',loadURL:this.editPageURL,saveURL:this.savePageURL,saveParams:{contentid:this.getContent().id}});},iconCls:'newPageIconCls'};},saveNewPageSuccess:function(){pagesEl=Ext.get('pagesWrapper.'+this.getContent().id);updateCfg={url:this.loadPagesURL,scripts:true,method:'POST',callback:LPCB,params:{id:this.getContent().id},text:'loading...',discardUrl:true,nocache:true,timeout:30};pagesEl.getUpdater().update(updateCfg);},initTab:function(){if(this.DBG){THROW({props:['tab','tab.id']},this,'initTab');}
try{if(typeof(this.tab)!='object'||this.tab===null){THROW({e:'TAB UNDEFINED OR NULL: "['+this.tab+']"'},this,'initTab');return;}
if(true!==this.tab.isInitialized){buttons=[];saveContentButtonConfig=this.getSaveContentButtonConfig();if(typeof(this.saveContentURL)=='string'&&this.saveContentURL!==''){saveContentButtonConfig.disabled=false;saveContentButtonConfig.scope=this;}
buttons.push(saveContentButtonConfig);buttons.push(new Ext.Toolbar.Separator());createCopyButtonConfig=this.getCreateCopyButtonConfig();if(typeof(this.copyContentURL)=='string'&&this.copyContentURL!==''){createCopyButtonConfig.disabled=false;createCopyButtonConfig.scope=this;}
buttons.push(createCopyButtonConfig);buttons.push(new Ext.Toolbar.Separator());findButtonConfig=this.getFindButtonConfig();if(typeof(this.contentExpandPathURL)=='string'&&this.contentExpandPathURL!==''){findButtonConfig.disabled=false;findButtonConfig.scope=this;}
buttons.push(findButtonConfig);buttons.push(new Ext.Toolbar.Separator());createPageButtonConfig=this.getCreatePageButtonConfig();if(typeof(this.savePageURL)=='string'&&this.savePageURL!==''){createPageButtonConfig.disabled=false;createPageButtonConfig.scope=this;}
buttons.push(createPageButtonConfig);buttons.push(new Ext.Toolbar.Separator());this.tab.getTopToolbar().insertButton(0,buttons);this.tab.isInitialized=true;}}catch(e){FATAL(e,this,'initTab');}},initFieldMonitoring:function(){if(this.DBG){THROW({args:arguments},this,'initFieldMonitoring');}
try{Pulse.CMSContentEditor.superclass.initFieldMonitoring.call(this);}catch(e){if(this.DBG){FATAL(e,this,'initFieldMonitoring');}}},hasChanges:function(){try{superBool=Pulse.CMSContentEditor.superclass.hasChanges.call(this);return(superBool||this.pageOrderChanged);}catch(e){if(this.DBG){FATAL(e,this,'hasChanges');}}},commit:function(){try{Pulse.CMSContentEditor.superclass.commit.call(this);this.pageOrderChanged=false;}catch(e){if(this.DBG){FATAL(e,this,'hasChanges');}}},reset:function(){try{Pulse.CMSContentEditor.superclass.reset.call(this);this.pageOrderChanged=false;}catch(e){if(this.DBG){FATAL(e,this,'hasChanges');}}},getPageOrder:function(){pagesTable=Ext.get('Pages.'+this.getContent().id);pageids=[];if(pagesTable.dom.getElementsByTagName('tr').length>0){child=Ext.get(pagesTable.dom.getElementsByTagName('tr')[0]);while(child!==null){pageids.push(child.id.split('.')[2]);child=child.next();}}
return pageids;},initComponent:function(boolInitTab){Pulse.CMSContentEditor.superclass.initComponent.call(this);try{this.initFieldMonitoring();if(false!==boolInitTab){this.initTab();}
this.pageOrderChanged=false;}catch(e){FATAL(e,this,'initComponent.CMSContentEditor');}}};Pulse.CMSContentEditor=Ext.extend(Pulse.ContentEditor,CMSContentEditor);var CMSPageEditor={LOC:{pageToSummary:'this page as summary'},buildPagePanel:function(config){pagePanel=new Ext.Panel({id:'PagePanel.'+config.contentid+'.'+config.pageid,renderTo:'Page.'+config.contentid+'.'+config.pageid,contentEl:'Page.'+config.contentid+'.'+config.pageid+'.content',title:VIEWPORT_PROPERTIES.PAGE+' (id: '+config.pageid+')',iconCls:'pageIconCls',collapsible:true,collapsed:true,tbar:[new Ext.Action({text:VIEWPORT_PROPERTIES.BUTTON_TEXT_EDIT,handler:function(){AbstractBasicContentEditor.getFCKEditorWindow({loadURL:config.editURL,loadParams:{id:config.pageid},saveURL:config.saveURL,saveParams:{id:config.pageid,contentid:config.contentid},onSaveSuccess:function(decodedResponse){thisPanel=Ext.getCmp('PagePanel.'+config.contentid+'.'+config.pageid);thisPanel.reloadContentAction.execute();}});},iconCls:'editIconCls'}),'-',new Ext.Action({text:this.LOC.pageToSummary,handler:function(){Ext.Ajax.request({url:config.toSummaryURL,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){summaryPanel=Ext.getCmp(config.contentclass+'.'+config.contentid+'.summary.panel');summaryPanel.reloadContentAction.execute();PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:config.contentclass+'.'+config.contentid+'.editor'},{n:'msg',o:'SUCCESS'}]});}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'CMSPageEditor','tbar.toSummary.Action.execute()');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'CMSPageEditor','tbar.toSummary.Action.execute()');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'CMSPageEditor','tbar.toSummary.Action.execute()');}},params:{id:config.pageid,contentid:config.contentid}});},iconCls:'asSummaryIconCls'}),'-',new Ext.Action({text:VIEWPORT_PROPERTIES.BUTTON_TEXT_DELETE,handler:function(){Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE+':&#160;"'+VIEWPORT_PROPERTIES.PAGE+'-'+config.pageid+'"',VIEWPORT_PROPERTIES.MSG_REALLYDELETE,function(response){if('yes'===response){Ext.Ajax.request({url:config.deleteURL,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){pagesEl=Ext.get('pagesWrapper.'+config.contentid);pagesEl.getUpdater().update({url:config.loadPagesURL,scripts:true,method:'POST',callback:LPCB,params:{id:config.contentid},text:'loading...',discardUrl:true,nocache:true,timeout:30});PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:config.contentclass+'.'+config.contentid+'.editor'},{n:'msg',o:'SUCCESS'}]});}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},'CMSPageEditor','tbar.deletePage.Action.execute()');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},'CMSPageEditor','tbar.deletePage.Action.execute()');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},'CMSPageEditor','tbar.deletePage.Action.execute()');}},params:{id:config.pageid,contentid:config.contentid}});}},this);},iconCls:'deletePageIconCls'}),'-'],tools:[{id:'up',handler:function(){liEl=Ext.get('Page.'+config.contentid+'.'+config.pageid+'.tr');if(liEl.prev()!==null){liElExtPrv=Ext.get(liEl.prev().dom.id);liEl.insertBefore(liElExtPrv);Ext.getCmp(config.contentclass+'.'+config.contentid+'.contentEditor').pageOrderChanged=true;PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:config.contentclass+'.'+config.contentid+'.editor'},{n:'msg',o:'change'}]});}},qtip:VIEWPORT_PROPERTIES.UP},{id:'down',handler:function(){liEl=Ext.get('Page.'+config.contentid+'.'+config.pageid+'.tr');if(liEl.next()!==null){liElExtNxt=Ext.get(liEl.next().dom.id);liEl.insertAfter(liElExtNxt);Ext.getCmp(config.contentclass+'.'+config.contentid+'.contentEditor').pageOrderChanged=true;PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:config.contentclass+'.'+config.contentid+'.editor'},{n:'msg',o:'change'}]});}},qtip:VIEWPORT_PROPERTIES.DOWN}],reloadContentAction:new Ext.Action({text:'reloads the content.div',handler:function(){contentEl=Ext.get('Page.'+config.contentid+'.'+config.pageid+'.content');contentEl.getUpdater().update({url:config.loadURL,method:'POST',callback:LPCB,params:{id:config.pageid},text:'loading...',discardUrl:true,nocache:true,timeout:30});}})});pagePanel.on('expand',function(p){pgElem=p.getEl().last().child('.x-panel-body');if(true!==pgElem.pulseMask){Ext.DomHelper.append(pgElem.dom,{cls:"pulseTransparentMask"},true);pgElem.pulseMask=true;}});}};DBG.StoreContentEditor=DBG.apply(DBG.ContentEditor,{initFieldMonitoring:{StoreContentEditor:false},addSubEditor:{StoreContentEditor:false},initTab:false,editDescription:{click:false},initDescriptionPanel:false,loadDescripton:false,createImage:{click:false,call:false,success:false},showCreateImageEditor:false,createNewImageGroupPanel:false,initImageGroupPanel:false,setAsMainImage:false,setMainImageGroupEditor:false,setMainImageGroupPanel:false,setMainImageGroupPanelUI:false,loadVariantsEanContainer:false,createVariant:{click:false,call:false},createVariantAJAX:false,createNewVariantPanel:false,initVariantPanel:false,createOrderCode:{click:false,call:false,success:false},MSG:false});StoreContentEditor={type:'StoreContentEditor',DBG:false,getCreateCopyButtonConfig:function(){return{text:VIEWPORT_PROPERTIES.COPYCONTENT,disabled:true,scope:this,handler:function(){this.selectCopyCallback=function(node){Ext.Ajax.request({url:this.copyContentURL,scope:this,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){panel=Ext.getCmp(this.getContent().clazz+'.'+this.getContent().id+'.contentLocalizationMap.panel');panel.lastLoadConfig.callback=LPCB;panel.lastLoadConfig.timeout=30;panel.load(panel.lastLoadConfig);crPanel=Ext.getCmp('ContentRegistry.WEST');crPanel.expand();path=decodedResponse.expandPath;ContentRegistryEditor.expandByIds(ContentRegistryTree.getRootNode(),path,function(node){ContentRegistryEditor.editNode(node);});}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this,'tbar.copy');}
delete this.selectCopyCallback;},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this,'tbar.copy');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this,'tbar.copy');}
delete this.selectCopyCallback;},params:{id:this.getContent().id,toid:node.attributes.id}});};windowCfg={getChildrenURL:this.browseContentRegistryURL+'?mode=folder&bundle='+this.getContent().bundle,emptyText:VIEWPORT_PROPERTIES.TEXT_CHOOSE_FOLDER,scope:this,selectCallback:'selectCopyCallback'};ContentRegistryEditor.getSelectWindow(windowCfg);},iconCls:'copyIconCls'};},getSaveContentButtonConfig:function(){return{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_SAVE,disabled:true,scope:this,handler:function(){if(false===this.hasChanges()){this.reset();return;}
saveValues=this.getChanges({id:this.getContent().id});if(typeof(saveValues)=='undefined'||saveValues===null){if(this.DBG){THROW({e:'NO VALUES TO SAVE THOUGH THERE ARE CHANGES',args:[this.hasChanges(),saveValues]},this,'saveContentButton');}
return;}
this.tab.disable();Ext.Ajax.request({url:this.saveContentURL,method:'POST',scope:this,success:function(response,options){this.tab.enable();decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){this.commit();(function(){this.fireEvent('MSG','savesuccess',this);}).defer(250,this);}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this.type,'tbar.save');}},failure:function(response,options){this.tab.enable();if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this.type,'tbar.save');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this.type,'tbar.save');}},params:saveValues});},iconCls:'saveIconCls'};},getCreateImageButtonConfig:function(){return{text:VIEWPORT_PROPERTIES.NEWIMAGE,disabled:true,scope:this,handler:function(){if(this.DBG){THROW({args:arguments},this,'createImage.click');}
this.createImage();},iconCls:'addImageIconCls'};},getFindButtonConfig:function(){return{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_FIND,disabled:true,scope:this,handler:function(){Ext.Ajax.request({url:this.contentExpandPathURL,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){crPanel=Ext.getCmp('ContentRegistry.WEST');if(typeof(crPanel)=='undefined'||crPanel===null){PULSE_TOOLBAR.openPanel({id:'ContentRegistry.WEST',callback:function(){ContentRegistryEditor.expandByIds(ContentRegistryTree.getRootNode(),decodedResponse.ids);}});return;}
crPanel.expand();ContentRegistryEditor.expandByIds(ContentRegistryTree.getRootNode(),decodedResponse.ids);}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this.type,'tbar.find');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this.type,'tbar.find');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this.type,'tbar.find');}},params:{id:this.getContent().id}});},iconCls:'findIconCls'};},getEditDescriptionButtonConfig:function(){return{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_EDIT,disabled:true,scope:this,handler:function(){fckWinCfg={loadURL:this.initDescriptionEditorURL,loadParams:{id:this.getContent().id},saveURL:this.saveDescriptionURL,saveParams:{id:this.getContent().id},scope:this,onSaveSuccess:'loadDescription'};if(this.DBG){THROW({propsObj:fckWinCfg,props:['loadURL','loadParams','saveURL','saveParams','scope','onSaveSuccess']},this,'editDescription.click');}
AbstractBasicContentEditor.getFCKEditorWindow(fckWinCfg);},iconCls:'editIconCls'};},getReloadDescriptionButtonConfig:function(){return{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_RELOAD,disabled:true,scope:this,handler:function(){this.loadDescription();},iconCls:'reloadIconCls'};},getCreateVariantButtonConfig:function(){return{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CREATEVARIANT,disabled:true,scope:this,handler:function(){if(this.DBG){THROW({args:arguments},this,'createVariant.click');}
this.createVariant();},iconCls:'addIconCls'};},getCreateOrderCodeButtonConfig:function(){return{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CREATEORDERCODE,disabled:true,scope:this,handler:function(){if(this.DBG){THROW({args:arguments},this,'createOrderCode.click');}
this.createOrderCode();},iconCls:'addIconCls'};},createVariant:function(){if(this.DBG){THROW({args:arguments},this,'createVariant.call');}
if(typeof(this.getSubEditor(this.id+'.orderCodeEditor'))!='undefined'){Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE,VIEWPORT_PROPERTIES.TEXT_WARN_REMOVE_ORDERCODE+'<br />'+
VIEWPORT_PROPERTIES.TEXT_REALLYCONTINUE,function(response){if('yes'===response){this.showCreateFormWindow({fields:[{fieldLabel:VIEWPORT_PROPERTIES.NAME,name:'name',emptyText:VIEWPORT_PROPERTIES.TEXT_ENTER_NAME},{fieldLabel:VIEWPORT_PROPERTIES.ORDERCODE,name:'orderCode',emptyText:VIEWPORT_PROPERTIES.TEXT_ENTER_ORDERCODE}],handler:'createVariantAJAX'});}},this);return;}
this.showCreateFormWindow({fields:[{fieldLabel:VIEWPORT_PROPERTIES.NAME,name:'name',emptyText:VIEWPORT_PROPERTIES.TEXT_ENTER_NAME},{fieldLabel:VIEWPORT_PROPERTIES.ORDERCODE,name:'orderCode',emptyText:VIEWPORT_PROPERTIES.TEXT_ENTER_ORDERCODE}],handler:'createVariantAJAX'});},createImage:function(){if(this.DBG){THROW({args:arguments},this,'createImage.call');}
this.showCreateFormWindow({fields:[{fieldLabel:VIEWPORT_PROPERTIES.NAME,name:'name',emptyText:VIEWPORT_PROPERTIES.TEXT_ENTER_NAME}],handler:'showCreateImageEditor'});},showCreateImageEditor:function(_this,createFormWindowConfig){params=this.getCreateFormParams({id:this.getContent().id});if(this.DBG){THROW({args:arguments,propsObj:params,props:['id','name']},this,'showCreateImageEditor');}
StoreContentImageGroupCreator.create(this,params.name);this.closeCreateFormWindow();},createVariantAJAX:function(_this,createFormWindowConfig){if(this.DBG){THROW({args:arguments,props:['orderCodeMonitor','orderCodeMonitor.id','orderCodeMonitor.type','createVariantURL']},this,'createVariantAJAX');}
params=this.getCreateFormParams({id:this.getContent().id});Ext.Ajax.request({url:this.createVariantURL,scope:this,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){if(this.DBG){THROW({propsObj:decodedResponse,props:['id','clazz']},this,'createVariantAJAX');}
if(typeof(this.getSubEditor(this.id+'.orderCodeEditor'))!='undefined'){this.getSubEditor(this.id+'.orderCodeEditor').reset();this.removeSubEditor(this.id+'.orderCodeEditor',true);if(this.createOrderCodeButton instanceof Ext.Toolbar.Button){this.createOrderCodeButton.enable();}
this.loadVariantsEanContainer();}else{this.createNewVariantPanel({id:decodedResponse.id,clazz:decodedResponse.clazz,name:options.params.name});}
this.closeCreateFormWindow();}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this,'tbar.createVariant');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this,'tbar.createVariant');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this,'tbar.createVariant');}},params:params});},loadVariantsEanContainer:function(){if(this.DBG){THROW({props:['loadVariantOrOrderCodeURL']},this,'loadVariantsEanContainer');}
Ext.get(this.getContent().clazz+'.'+this.getContent().id+'.variantsOrderCodeContainer').load({url:this.loadVariantOrOrderCodeURL,method:'POST',callback:LPCB,params:{id:this.getContent().id},text:'loading...',scripts:true,discardUrl:true,nocache:true,timeout:30});},createOrderCode:function(){if(this.DBG){THROW({args:arguments,props:['removeAllVariantsURL']},this,'createOrderCode.call');}
Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE,VIEWPORT_PROPERTIES.TEXT_WARN_REMOVE_VARIANTS+'<br />'+
VIEWPORT_PROPERTIES.TEXT_REALLYCONTINUE,function(response){if('yes'===response){params={id:this.getContent().id};Ext.Ajax.request({url:this.removeAllVariantsURL,scope:this,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){if(this.DBG){THROW({propsObj:decodedResponse,props:['status']},this,'createOrderCode.success');}
this.createOrderCodeButton.disable();this.loadVariantsEanContainer();}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this,'createOrderCode');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this,'createOrderCode');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this,'createOrderCode');}},params:params});}},this);},initTab:function(){if(this.DBG){THROW({props:['tab','tab.id']},this,'initTab');}
try{if(typeof(this.tab)!='object'||this.tab===null){THROW({e:'TAB UNDEFINED OR NULL: "['+this.tab+']"'},this,'initTab');return;}
if(true!==this.tab.isInitialized){buttons=[];saveContentButtonConfig=this.getSaveContentButtonConfig();if(typeof(this.saveContentURL)=='string'&&this.saveContentURL!==''){saveContentButtonConfig.disabled=false;saveContentButtonConfig.scope=this;}
buttons.push(saveContentButtonConfig);buttons.push(new Ext.Toolbar.Separator());createCopyButtonConfig=this.getCreateCopyButtonConfig();if(typeof(this.copyContentURL)=='string'&&this.copyContentURL!==''){createCopyButtonConfig.disabled=false;createCopyButtonConfig.scope=this;}
buttons.push(createCopyButtonConfig);buttons.push(new Ext.Toolbar.Separator());findButtonConfig=this.getFindButtonConfig();if(typeof(this.contentExpandPathURL)=='string'&&this.contentExpandPathURL!==''){findButtonConfig.disabled=false;findButtonConfig.scope=this;}
buttons.push(findButtonConfig);buttons.push(new Ext.Toolbar.Separator());createImageButtonConfig=this.getCreateImageButtonConfig();if(typeof(this.saveNewImageGroupURL)=='string'&&this.saveNewImageGroupURL!==''){createImageButtonConfig.disabled=false;createImageButtonConfig.scope=this;}
buttons.push(createImageButtonConfig);buttons.push(new Ext.Toolbar.Separator());createVariantButtonConfig=this.getCreateVariantButtonConfig();createVariantButtonConfig.disabled=false;createVariantButtonConfig.scope=this;buttons.push(createVariantButtonConfig);buttons.push(new Ext.Toolbar.Separator());createOrderCodeButtonConfig=this.getCreateOrderCodeButtonConfig();if(typeof(this.removeAllVariantsURL)=='string'&&this.removeAllVariantsURL!==''&&typeof(this.getSubEditor(this.id+'.orderCodeEditor'))=='undefined'){createOrderCodeButtonConfig.disabled=false;}
createOrderCodeButtonConfig.scope=this;this.createOrderCodeButton=new Ext.Toolbar.Button(createOrderCodeButtonConfig);buttons.push(this.createOrderCodeButton);buttons.push(new Ext.Toolbar.Separator());this.tab.getTopToolbar().insertButton(0,buttons);this.tab.isInitialized=true;}}catch(e){FATAL(e,this,'initTab');}},loadDescription:function(){if(this.DBG){THROW({props:['loadDescriptionURL','content.id']},this,'loadDescripton');}
try{loadCfg={url:this.loadDescriptionURL,method:'POST',callback:LPCB_DISABLE,params:{id:this.getContent().id},text:'loading...',discardUrl:true,nocache:true,timeout:30};this.descriptionPanel.load(loadCfg);}catch(e){FATAL(e,this,'loadDescripton');}},addSubEditor:function(editor){addSuccess=Pulse.StoreContentEditor.superclass.addSubEditor.call(this,editor);if(this.DBG){THROW({o:'ADD: '+addSuccess,props:['id','subEditors.length','subEditors'],p:[{n:'editor.id',o:editor.id},{n:'editor.type',o:editor.type}]},this,'addSubEditor.StoreContentEditor');}
if(true!==addSuccess){if(this.DBG){FATAL(editor,this,'addSubEditor.StoreContentEditor','ADD: '+addSuccess);}
return;}
if(editor.type==='SubEditorPanel'&&true===editor.isMainImagePanel){this.setMainImageGroupPanel(editor);this.setMainImageGroupEditor(editor.getSubEditors()[i]);}},editorMSG:function(msgString,editor,masterEditor){msg=msgString.toUpperCase();if(msg=='DELETESUCCESS'){if(editor.type=='StoreVariantEditor'){if(true===editor.wasLastVariant){this.removeSubEditor(editor.masterEditor,true);this.loadVariantsEanContainer();}else{this.removeSubEditor(editor.masterEditor,true);}}}
Pulse.StoreContentEditor.superclass.editorMSG.call(this,msgString,editor,masterEditor);},setMainImageGroupPanel:function(subEditorPanel){if(this.DBG){THROW({propsObj:subEditorPanel,props:['id','type']},this,'setMainImageGroupPanel');}
this.mainImageGroupPanel=subEditorPanel;},setMainImageGroupEditor:function(imageGroupEditor){if(this.DBG){THROW({propsObj:imageGroupEditor,props:['id','type']},this,'setMainImageGroupEditor');}
this.mainImageGroupEditor=imageGroupEditor;},setMainImageGroupPanelUI:function(subEditorPanel){if(this.DBG){THROW({propsObj:subEditorPanel,props:['id','type']},this,'setMainImageGroupPanelUI');}
if(typeof(this.mainImageGroupPanel)!='undefined'&&this.mainImageGroupPanel!==null){Ext.get(this.getContent().clazz+'.'+this.getContent().id+'.alternativeImagesContainer').appendChild(this.mainImageGroupPanel.getEl());}
Ext.get(this.getContent().clazz+'.'+this.getContent().id+'.mainImageContainer').appendChild(subEditorPanel.getEl());this.setMainImageGroupPanel(subEditorPanel);},setAsMainImage:function(imageGroupEditor){if(this.DBG){THROW({propsObj:imageGroupEditor,props:['id','type']},this,'setAsMainImage');}
this.setMainImageGroupEditor(imageGroupEditor);this.setMainImageGroupPanelUI(imageGroupEditor.masterEditor);},setAsMainImageAJAX:function(imageGroupEditor){if(this.DBG){THROW({propsObj:imageGroupEditor,props:['id','type','imageGroup','imageGroup.id','imageGroup.main']},this,'setAsMainImage');}
if(typeof(this.setMainImageGroupURL)!='string'||this.setMainImageGroupURL===''){if(this.DBG){FATAL('UNDEFINED setMainImageGroupURL',this,'setAsMainImage');}
return;}
Ext.Ajax.request({url:this.setMainImageGroupURL,scope:this,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){this.setAsMainImage(options.imageGroupEditor);this.fireEvent('MSG','savesuccess',this);}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this,'setAsMainImage');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this,'setAsMainImage');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this,'setAsMainImage');}},imageGroupEditor:imageGroupEditor,params:{imagegroupid:imageGroupEditor.imageGroup.id,contentid:this.getContent().id}});},initOrderCodeMonitor:function(el){try{this.orderCodeEl=(typeof(el)!='undefined'&&el!==null)?el:Ext.get(this.getContent().clazz+'.'+this.getContent().id+'.orderCode');if(typeof(this.orderCodeEl)=='undefined'&&this.orderCodeEl===null){if(this.DBG){FATAL('ELEMENT UNDEFINED',this,'initOrderCodeMonitor');}
return;}
this.orderCodeMonitorCFG={id:this.id+'.orderCodeEditor',el:this.orderCodeEl,invalidText:''+VIEWPORT_PROPERTIES.TEXT_NOT_EANCODE,regex:/(\b([0-9]{8})\b)|(\b([0-9]{13})\b)/,handler:function(v){return(v.trim().length===8||v.trim().length===13);if(v.trim().length===8||v.trim().length===13){return true;}
return false;},allowSave:true};this.orderCodeMonitor=new Pulse.FieldMonitor(this.orderCodeMonitorCFG);this.orderCodeMonitor.validate();this.addSubEditor(this.orderCodeMonitor);}catch(e){if(this.DBG){FATAL(e,this,'initOrderCodeMonitor');}}},createNewImageGroupPanel:function(imageGroup){if(this.DBG){THROW({args:arguments,propsObj:imageGroup,props:['id','clazz','name','main']},this,'createNewImageGroupPanel');}
try{el=Ext.get('imageGroup.'+this.getContent().id+'.'+imageGroup.id);if(typeof(el)==='undefined'||el===null){if(true===imageGroup.main){if(typeof(mainImageGroupPanel)!='undefined'){throw('INCONSISTENT DATA: a main-image already exists in ui -> reload content?');}
containerEl=Ext.get(this.getContent().clazz+'.'+this.getContent().id+'.mainImageContainer');}else{containerEl=Ext.get(this.getContent().clazz+'.'+this.getContent().id+'.alternativeImagesContainer');}
containerEl.createChild({tag:'div',id:'imageGroup.'+this.getContent().id+'.'+imageGroup.id});}}catch(e){if(this.DBG){FATAL(e,this,'createNewImageGroupPanel');}}
this.initImageGroupPanel(imageGroup);},initImageGroupPanel:function(imageGroup){if(this.DBG){THROW({args:arguments,propsObj:imageGroup,props:['id','clazz','name']},this,'initImageGroupPanel');}
try{if(typeof(this.loadImageGroupURL)!='string'||this.loadImageGroupURL===''){if(this.DBG){THROW({e:'URL UNDEFINED',props:['loadImageGroupURL']},this,'initImageGroupPanel');}
return;}
var params={contentid:this.getContent().id,imagegroupid:imageGroup.id};var subEditorPanel=new Pulse.SubEditorPanel({isMainImagePanel:imageGroup.main,content:this.getContent(),title:imageGroup.name+' (id: '+imageGroup.id+')',id:imageGroup.clazz+'.'+imageGroup.id+'.editor',url:this.loadImageGroupURL,params:params,renderTo:'imageGroup.'+this.getContent().id+'.'+imageGroup.id,bodyStyle:'background-color:#EDF5FF;padding:5px;padding-bottom:15px;',style:'margin-bottom:5px;',iconCls:'imageGroupIconCls'});subEditorPanel.on('expand',function(){if(this.DBG){THROW({props:['id','url','initializePanel','loadPanel']},this,'expand');}
this.initializePanel();});this.addSubEditor(subEditorPanel);}catch(e){if(this.DBG){FATAL(e,this,'initImageGroupPanel');}}},createNewVariantPanel:function(variant){if(this.DBG){THROW({args:arguments,propsObj:variant,props:['id','clazz','name']},this,'createNewVariantPanel');}
try{el=Ext.get(variant.clazz+'.'+variant.id);if(typeof(el)==='undefined'||el===null){variantsEl=Ext.get(this.getContent().clazz+'.'+this.getContent().id+'.variants');variantsEl.createChild({tag:'div',id:variant.clazz+'.'+variant.id},variantsEl.first());}}catch(e){if(this.DBG){FATAL(e,this,'createNewVariantPanel');}}
this.initVariantPanel(variant);},initVariantPanel:function(variant){if(this.DBG){THROW({args:arguments,propsObj:variant,props:['id','clazz','name']},this,'initVariantPanel');}
try{if(typeof(this.editVariantURL)!='string'||this.editVariantURL===''){if(this.DBG){throw('URL UNDEFINED this.editVariantURL: '+this.editVariantURL);}
return;}
var params={id:variant.id};var subEditorPanel=new Pulse.SubEditorPanel({iconCls:'variantIconCls',content:variant,title:variant.name,id:variant.clazz+'.'+variant.id+'.editor',masterEditor:this,url:this.editVariantURL,params:params,renderTo:variant.clazz+'.'+variant.id,bodyStyle:'background-color:#EDF5FF;padding:5px;padding-bottom:15px;',style:'margin-bottom:15px;'});subEditorPanel.on('expand',function(){if(this.DBG){THROW({props:['id','url','initializePanel','loadPanel']},this,'expand');}
this.initializePanel();});this.addSubEditor(subEditorPanel);}catch(e){if(this.DBG){FATAL(e,this,'initVariantPanel');}}},initDescriptionPanel:function(){if(this.DBG){THROW({props:['initDescriptionEditorURL','saveDescriptionURL']},this,'initDescriptionPanel');}
try{buttons=[];editDescriptionButtonConfig=this.getEditDescriptionButtonConfig();if(typeof(this.initDescriptionEditorURL)=='string'&&this.initDescriptionEditorURL!==''&&typeof(this.saveDescriptionURL)=='string'&&this.saveDescriptionURL!==''){editDescriptionButtonConfig.disabled=false;editDescriptionButtonConfig.scope=this;}
reloadDescriptionButtonConfig=this.getReloadDescriptionButtonConfig();if(typeof(this.loadDescriptionURL)=='string'&&this.loadDescriptionURL!==''){reloadDescriptionButtonConfig.disabled=false;reloadDescriptionButtonConfig.scope=this;}
tbar=[editDescriptionButtonConfig,'-','->','-',reloadDescriptionButtonConfig];panelCfg={id:this.getContent().clazz+'.'+this.getContent().id+'.description.panel',title:VIEWPORT_PROPERTIES.DESCRIPTION+':',collapsible:true,collapsed:true,renderTo:this.getContent().clazz+'.'+this.getContent().id+'.description',html:'...',bodyStyle:'padding:5px;',tbar:tbar};this.descriptionPanel=new Ext.Panel(panelCfg);this.descriptionPanel.on('expand',function(p){if(true!==this.descriptionPanel.initialExpand){this.loadDescription();this.descriptionPanel.initialExpand=true;}},this);}catch(e){if(this.DBG){FATAL(e,this,'initDescriptionPanel');}}},initFieldMonitoring:function(){if(this.DBG){THROW({args:arguments,props:['orderCodeEl']},this,'initFieldMonitoring');}
try{Pulse.StoreContentEditor.superclass.initFieldMonitoring.call(this);el=Ext.get(this.getContent().clazz+'.'+this.getContent().id+'.orderCode');if(typeof(el)!='undefined'&&el!==null){this.initOrderCodeMonitor(el);}}catch(e){if(this.DBG){FATAL(e,this,'initFieldMonitoring');}}},initComponent:function(boolInitTab){Pulse.StoreContentEditor.superclass.initComponent.call(this);try{this.initDescriptionPanel();this.initFieldMonitoring();if(false!==boolInitTab){this.initTab();}}catch(e){FATAL(e,this,'initComponent.StoreContentEditor');}}};Pulse.StoreContentEditor=Ext.extend(Pulse.ContentEditor,StoreContentEditor);DBG.StoreContentImageGroupCreator={create:{call:false,success:false}};StoreContentImageGroupCreator={type:'StoreContentImageGroupCreator',DBG:false,newImageGroup:{type:'StoreContentImageGroupCreator.newImageGroup',DBG:true,versions:null,optionalVersions:null,clear:function(){if(this.versions!==null){for(i=0;i<this.versions.length;i++){this[this.versions[i]]=null;}}
if(this.optionalVersions===null){return;}
for(i=0;i<this.optionalVersions.length;i++){this[this.optionalVersions[i]]=null;}},isValid:function(){for(i=0;i<this.versions.length;i++){if(typeof(this[this.versions[i]])=='undefined'||this[this.versions[i]]===null||this[this.versions[i]]===''){return false;}}
return true;},applyImages:function(object){if(typeof(object)!='object'||object===null){FATAL({args:arguments},this,'applyImages','objectUNDEFINED');return object;}
if(!this.isValid()){FATAL({args:arguments},this,'applyImages','imageGroupIsINVALID');return object;}
for(i=0;i<this.versions.length;i++){object[this.versions[i]]=this[this.versions[i]];}
if(this.optionalVersions===null){return object;}
for(i=0;i<this.optionalVersions.length;i++){if(!this.hasVersion(this.optionalVersions[i])){continue;}
object[this.optionalVersions[i]]=this[this.optionalVersions[i]];}
return object;},hasVersion:function(versionName){return(typeof(this[versionName])!='undefined'&&this[versionName]!==null&&this[versionName]!=='');}},create:function(editor,newName){this.newImageGroup.clear();this.editor=editor;if(this.DBG){THROW({args:arguments,propsObj:editor,props:['id','type','saveNewImageGroupURL','createNewImageGroupURL']},this,'create.call');}
try{pel=VIEWPORT.getEl();if(typeof(pel)=='undefined'){throw('ELEMENT CHECK FAILED');}
if(this.el===null){this.el=pel.createChild({tag:'div',id:'StoreContentImageGroupCreator.el'});}
this.contentPanel=new Ext.Panel({id:'StoreContentImageGroupCreator.contentPanel',region:'center',html:'content goes here',border:false,autoScroll:true});createButtonConfig={text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CREATE,disabled:true,scope:this,handler:function(){if(false===this.newImageGroup.isValid()){return;}
params=this.newImageGroup.applyImages({contentid:this.editor.getContent().id,name:newName});Ext.Ajax.request({url:this.editor.saveNewImageGroupURL,scope:this,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){if(this.DBG){THROW({propsObj:decodedResponse.imageGroup,props:['id','clazz','name','main']},this,'create.success');}
this.editor.createNewImageGroupPanel(decodedResponse.imageGroup);this.win.close();}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this,'create');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this,'create');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this,'create');}},params:params});},iconCls:'addIconCls'};this.createButton=new Ext.Button(createButtonConfig);this.closeButtonConfig={text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CANCEL,scope:this,handler:function(){this.win.close();},iconCls:'deleteIconCls'};this.win=new Ext.Window({id:'StoreContentImageGroupCreator.Win',title:VIEWPORT_PROPERTIES.IMAGE,iconCls:'imageGroupIconCls',renderTo:this.el,maximizable:false,closable:true,modal:true,plain:true,autoScroll:true,height:130,width:600,layout:'border',items:[this.contentPanel],buttonAlign:'center',buttons:[this.createButton,this.closeButtonConfig]});this.win.on('beforeclose',function(){if(true===this.win.isDirty){Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE,VIEWPORT_PROPERTIES.TEXT_UNSAVEDCHANGES
+'<br />'
+VIEWPORT_PROPERTIES.TEXT_REALLYCONTINUE,function(response){if('yes'===response){this.win.isDirty=false;this.win.close();}},this);return false;}},this);this.win.on('close',function(){delete this.editor;delete this.el;delete this.win;delete this.contentPanel;delete this.closeButtonConfig;delete this.createButton;this.newImageGroup.clear();},this);this.win.on('show',function(){loadConfig={url:this.editor.createNewImageGroupURL,scripts:true,callback:LPCB,params:{name:newName},text:'loading...',discardUrl:true,nocache:true,timeout:30};this.contentPanel.load(loadConfig);},this);this.contentPanel.on('load',function(){this.win.doLayout(true);},this);this.win.setSize({width:VIEWPORT.getSize().width*0.8,height:VIEWPORT.getSize().height*0.8});this.win.show();this.win.setPosition(VIEWPORT.getSize().width*0.1,VIEWPORT.getSize().height*0.1);}catch(windowInitError){alert('windowInitError: \n'+windowInitError);}},edit:function(editInfo){if(this.newImageGroup.versions===null&&this.newImageGroup.optionalVersions===null){FATAL(this.newImageGroup,this,'edit','newImageGroup.versions.NULL');return;}
FileBrowser.open({restriction:'img',applyCallback:function(node){imgDom=Ext.get(editInfo.imageversion+'.newImageGroup.image').dom;imgDom.src=node.attributes.httpURI;linkDom=Ext.get(editInfo.imageversion
+'.newImageGroup.image.link').dom;linkDom.removeAttribute('onclick');newOnclick=document.createAttribute('onclick');newOnclick.nodeValue='StoreContentImageGroupCreator.edit({'
+'dataURL:\''+editInfo.dataURL+'\','
+'previewURL:\''+editInfo.previewURL+'\','
+'fileBrowserUploadProgressURL:\''
+editInfo.fileBrowserUploadProgressURL+'\','
+'imageversion:\''+editInfo.imageversion+'\','
+'imageVFSid:\''+node.attributes.fileId+'\','
+'imageURI:\''+node.attributes.httpURI+'\''
+'});this.blur();return;';linkDom.setAttributeNode(newOnclick);StoreContentImageGroupCreator.newImageGroup[editInfo.imageversion]=node.attributes.fileId;if(true===StoreContentImageGroupCreator.newImageGroup.isValid()){StoreContentImageGroupCreator.createButton.enable();}else{StoreContentImageGroupCreator.createButton.disable();}
return;},id:editInfo.imageVFSid,uri:editInfo.imageURI,dataURL:editInfo.dataURL,previewURL:editInfo.previewURL,upload:true,uploadProgressURL:editInfo.fileBrowserUploadProgressURL,params:{imageVFSid:editInfo.imageVFSid,imageversion:editInfo.imageversion}});}};Pulse.LOC.StoreContentImageGroupEditor={toMainImage:'set this as main-image'};DBG.StoreContentImageGroupEditor=DBG.apply(DBG.ImageGroupEditor,{getButtons:{StoreContentImageGroupEditor:true},setUpMainImageListener:{MSG:false,call:false}});StoreContentImageGroupEditor={type:'StoreContentImageGroupEditor',DBG:false,getMainImageButtonConfig:function(boolDisabled){cEditor=Ext.getCmp(this.getContent().clazz+'.'+this.getContent().id+'.contentEditor');toMainImageButtonConfig={text:Pulse.LOC.StoreContentImageGroupEditor.toMainImage,scope:this,disabled:(true!==this.imageGroup.main&&(typeof(cEditor.setMainImageGroupURL)=='string'&&cEditor.setMainImageGroupURL!==''))?false:true,handler:function(){if(this.DBG){THROW({args:arguments},this,'setAsMainImage.click');}
cEditor=Ext.getCmp(this.getContent().clazz+'.'+this.getContent().id+'.contentEditor');cEditor.setAsMainImageAJAX(this);},iconCls:'asSummaryIconCls'};this.setUpMainImageListener();return toMainImageButtonConfig;},setUpMainImageListener:function(){if(this.DBG){THROW({o:'Ext.getCmp("'+this.getContent().clazz+'.'+this.getContent().id+'.contentEditor"): '+
Ext.getCmp(this.getContent().clazz+'.'+this.getContent().id+'.contentEditor')},this,'setUpMainImageListener.call');}
this.contentEditor=Ext.getCmp(this.getContent().clazz+'.'+this.getContent().id+'.contentEditor');this.contentEditor.on('MSG',function(msgString,editor){if(this.DBG){THROW({args:arguments},this,'setUpMainImageListener.MSG');}
msg=msgString.toUpperCase();if(msg=='SAVESUCCESS'){if(typeof(this.contentEditor.mainImageGroupEditor)!='undefined'){if(this.contentEditor.mainImageGroupEditor.id==this.id){this.imageGroup.main=true;if(typeof(this.toMainImageButton)!='undefined'){this.toMainImageButton.disable();}}else{this.imageGroup.main=false;if(typeof(this.toMainImageButton)!='undefined'){this.toMainImageButton.enable();}}}}},this);},getButtons:function(){btnArray=Pulse.StoreContentImageGroupEditor.superclass.getButtons.call(this);if(this.DBG){THROW({args:arguments,props:['renameURL','removeURL'],p:btnArray},this,'getButtons.StoreContentImageGroupEditor');}
this.toMainImageButtonConfig=this.getMainImageButtonConfig();this.toMainImageButton=new Ext.Toolbar.Button(this.toMainImageButtonConfig);btnArray.push(this.toMainImageButton);btnArray.push(new Ext.Toolbar.Separator());return btnArray;}};Pulse.StoreContentImageGroupEditor=Ext.extend(Pulse.ImageGroupEditor,StoreContentImageGroupEditor);DBG.StoreVariantEditor=DBG.apply(DBG.StoreContentEditor,{getButtons:false,initNameMonitor:false,removeVariant:{click:false,call:false},DBGButton:false});StoreVariantEditor={type:'StoreVariantEditor',DBG:false,getRemoveButtonConfig:function(){return{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_DELETE,scope:this,disabled:true,handler:function(){if(this.DBG){THROW({args:arguments},this,'removeVariant.click');}
this.removeVariant();},iconCls:'deleteIconCls'};},getButtons:function(){THROW({props:['saveNewImageGroupURL']},this,'getButtons');try{buttons=[];createImageButtonCFG=this.getCreateImageButtonConfig();if(typeof(this.saveNewImageGroupURL)=='string'&&this.saveNewImageGroupURL!==''){createImageButtonCFG.disabled=false;createImageButtonCFG.scope=this;}
buttons.push(new Ext.Toolbar.Button(createImageButtonCFG));buttons.push(new Ext.Toolbar.Separator());removeButtonCFG=this.getRemoveButtonConfig();if(typeof(this.removeURL)=='string'&&this.removeURL!==''){removeButtonCFG.disabled=false;removeButtonCFG.scope=this;}
buttons.push(new Ext.Toolbar.Button(removeButtonCFG));buttons.push(new Ext.Toolbar.Separator());createVariantButtonConfig=this.getCreateVariantButtonConfig();createVariantButtonConfig.disabled=false;createVariantButtonConfig.scope=this;buttons.push(new Ext.Toolbar.Button(createVariantButtonConfig));buttons.push(new Ext.Toolbar.Separator());if(this.DBG&&true===this.DBG.DBGButton){DBGButtonCFG={text:'DBG',scope:this,handler:function(){FATAL(this,this,'DBG','DBG');}};buttons.push(new Ext.Toolbar.Button(DBGButtonCFG));buttons.push(new Ext.Toolbar.Separator());}
return buttons;}catch(e){FATAL(e,this,'getButtons');}},removeVariant:function(){if(this.DBG){THROW({args:arguments,props:['variant','variant.id','variant.clazz','variant.name']},this,'removeVariant.call');}
Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE+':&#160;"'
+'(id: '+this.getContent().id+')"',VIEWPORT_PROPERTIES.MSG_REALLYDELETE,function(response){if('yes'===response){params={id:this.getContent().id};if(typeof(this.getContent().parentVariantId)=='number'){params.variantId=this.getContent().parentVariantId;}
Ext.Ajax.request({url:(typeof(this.getContent().parentVariantId)=='number')?this.removeSubVariantURL:this.removeURL,scope:this,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){if(0===decodedResponse.noOfVariantsLeft){this.wasLastVariant=true;}
this.fireEvent('MSG','deletesuccess',this);}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this,'removeVariant');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this,'removeVariant');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this,'removeVariant');}},params:params});}},this);},initOrderCodeMonitor:function(el){try{this.orderCodeEl=(typeof(el)!='undefined'&&el!==null)?el:Ext.get(this.getContent().clazz+'.'+this.getContent().id+'.orderCode');if(typeof(this.orderCodeEl)=='undefined'&&this.orderCodeEl===null){if(this.DBG){FATAL('ELEMENT UNDEFINED',this,'initOrderCodeMonitor');}
return;}
this.orderCodeMonitorCFG={valuePrefix:'variant_'+this.getContent().id+'_',id:this.id+'.orderCodeEditor',el:this.orderCodeEl,invalidText:''+VIEWPORT_PROPERTIES.TEXT_NOT_EANCODE,regex:/(\b([0-9]{8})\b)|(\b([0-9]{13})\b)/,handler:function(v){return(v.trim().length===8||v.trim().length===13);if(v.trim().length===8||v.trim().length===13){return true;}
return false;},allowSave:true};this.orderCodeMonitor=new Pulse.FieldMonitor(this.orderCodeMonitorCFG);this.orderCodeMonitor.validate();this.addSubEditor(this.orderCodeMonitor);}catch(e){if(this.DBG){FATAL(e,this,'initOrderCodeMonitor');}}},initNameMonitor:function(el){if(this.DBG){THROW({args:arguments},this,'initNameMonitor');}
try{this.nameEl=(typeof(el)!='undefined'&&el!==null)?el:Ext.get(this.getContent().clazz+'.'+this.getContent().id+'.name');if(typeof(this.nameEl)=='undefined'&&this.nameEl===null){if(this.DBG){FATAL('ELEMENT UNDEFINED',this,'initNameMonitor');}
return;}
nameMonitorCFG={valuePrefix:'variant_'+this.getContent().id+'_',id:this.id+'.nameEditor',el:this.nameEl,allowBlank:false};this.nameMonitor=new Pulse.FieldMonitor(nameMonitorCFG);this.nameMonitor.validate();this.addSubEditor(this.nameMonitor);}catch(e){if(this.DBG){FATAL(e,this,'initNameMonitor');}}},setTitle:function(title){if(typeof(this.masterEditor)!='undefined'&&this.masterEditor!==null){this.masterEditor.setTitle(title+' (id: '+this.getContent().id+')');}},getContent:function(){return this.variant;},initComponent:function(){Pulse.StoreVariantEditor.superclass.initComponent.call(this,false);try{}catch(e){FATAL(e,this,'initComponent.StoreVariantEditor');}}};Pulse.StoreVariantEditor=Ext.extend(Pulse.StoreContentEditor,StoreVariantEditor);DBG.ShopPricesEditor=DBG.apply(DBG.Editor,{onRender:false,buildGrid:false,getRenderer:false,validateAmount:{click:false,call:false},getButtons:false,hasChanges:{ShopPricesEditor:false},updatePriceInfo:false,removeSelectedPrices:false,createPrice:false,editPriceRoles:false});ShopPricesEditor={type:'ShopPricesEditor',DBG:false,getButtons:function(){if(this.DBG){THROW({args:arguments},this,'getButtons');}
disabled=false;if(this.shopSettings.error){disabled=true;}
deleteButtonConfig={scope:this,disabled:disabled,text:VIEWPORT_PROPERTIES.BUTTON_TEXT_REMOVE,handler:this.removeSelectedPrices,iconCls:'deleteIconCls'};createButtonConfig={scope:this,disabled:disabled,text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CREATE,handler:this.createPrice,iconCls:'addIconCls'};return[new Ext.Toolbar.Button(deleteButtonConfig),new Ext.Toolbar.Separator(),new Ext.Toolbar.Button(createButtonConfig),new Ext.Toolbar.Separator()];},createPrice:function(){this.grid.stopEditing(true);if(this.DBG){THROW({args:arguments},this,'createPrice');}
try{pel=VIEWPORT.getEl();if(typeof(pel)=='undefined'){throw('ELEMENT-CHECK FAILED');}
taxGroupStoreCFG={fields:[{name:'id'},{name:'displayInfo'}],data:this.getTaxGroupsForComboBox()};this.taxGroupCombo=new Ext.form.ComboBox({mode:'local',forceSelection:true,triggerAction:'all',selectOnFocus:true,editable:false,displayField:'displayInfo',valueField:'id',fieldLabel:VIEWPORT_PROPERTIES.TAX,name:'taxGroupId',width:300,emptyText:VIEWPORT_PROPERTIES.TEXT_CHOOSE_TAXGROUP,allowBlank:false,store:new Ext.data.SimpleStore(taxGroupStoreCFG)});this.taxGroupCombo.on('select',function(box,rec,index){});this.priceStateCombo=new Ext.form.ComboBox({fieldLabel:VIEWPORT_PROPERTIES.STATUS,name:'status',width:300,emptyText:VIEWPORT_PROPERTIES.TEXT_CHOOSE_PRICESTATUS,allowBlank:false,editable:false,store:this.shopSettings.priceStates});formPanel=new Ext.form.FormPanel({id:'createPriceForm',name:'createPriceForm',region:'center',margins:'3 3 3 3',bodyStyle:'padding: 5px',autoHeight:true,labelWidth:100,items:[this.taxGroupCombo,this.priceStateCombo]});formPanel.addButton({text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CREATE,scope:this,handler:function(){if(true!==(this.taxGroupCombo.isValid()&&this.priceStateCombo.isValid())){return;}
this.addPrice(this.taxGroupCombo.getValue(),this.priceStateCombo.getValue());this.win.close();}});formPanel.addButton({text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CANCEL,scope:this,handler:function(){this.win.close();}});if(this.el===null){this.el=pel.createChild({tag:'div',id:'createPrice.win.el'});}
this.win=new Ext.Window({id:'createPrice.win',iconCls:'addIconCls',title:VIEWPORT_PROPERTIES.NEW,modal:true,plain:true,renderTo:this.el,height:160,layout:'border',items:[formPanel],width:450});this.win.on('close',function(){delete this.win;delete this.el;delete this.taxGroupCombo;delete this.priceStateCombo;},this);this.win.setPagePosition((VIEWPORT.getSize().width/2)-300,100);this.win.show(this);this.taxGroupCombo.validate();this.priceStateCombo.validate();}catch(e){if(this.DBG){FATAL(e,this,'createPrice');}}},getTaxGroupsForComboBox:function(){taxGroups=[];for(i=0;i<this.shopSettings.taxGroups.length;i++){taxGroups.push([this.shopSettings.taxGroups[i].id,this.shopSettings.taxGroups[i].percentage+' % '+'('+this.shopSettings.taxGroups[i].name+')']);}
return taxGroups;},getRecord:function(){return new Pulse.Record.create([{name:'id'},{name:'clazz'},{name:'status'},{name:'currency'},{name:'isNetBased'},{name:'amount'},{name:'minOrderSize'},{name:'maxOrderSize'},{name:'taxGroupId'},{name:'taxGroup'},{name:'noOfRoles'}]);},addPrice:function(taxGroupId,status){Record=this.getRecord();id=Ext.id();newRec={id:id,clazz:'',status:status,currency:this.shopSettings.currency,isNetBased:this.shopSettings.netBased,amount:'0',minOrderSize:1,maxOrderSize:'',taxGroupId:taxGroupId,taxGroup:{},noOfRoles:0};this.store.addSorted(new Record(newRec));this.store.addIds.push(id);this.fireEvent('MSG','change',this);},buildGrid:function(){if(this.DBG){THROW({args:arguments,props:['gridId','url','expandURL']},this,'buildGrid');}
try{storeCFG={pEditor:this,pruneModifiedRecords:true,fields:this.getRecord(),root:'data',totalProperty:'total',baseParams:{id:this.getContent().id},url:'',removeIds:[],addIds:[]};if(typeof(this.url)=='string'&&this.url!==''){storeCFG.url=this.url;}else{storeCFG.data={data:[]};}
this.store=new Ext.data.JsonStore(storeCFG);this.store.on('remove',function(_store,record,index){if(typeof(record.get('id'))=='number'){_store.removeIds.push(record.get('id'));}else{for(i=0;i<this.addIds.length;i++){if(this.addIds[i]==record.get('id')){this.addIds.splice(i,1);break;}}}
if(false===this.pEditor.hasChanges()){this.fireEvent('MSG','reset',this);}});this.sm=new Ext.grid.CheckboxSelectionModel();amountEditorConfig={pEditor:this,validator:function(v){if(this.pEditor.DBG){THROW({args:arguments,props:['pEditor']},this.pEditor,'validateAmount.click');}
return this.pEditor.validateAmount(v);}};taxGroupEditorBoxCFG={typeAhead:true,triggerAction:'all',transform:this.getContent().clazz+'.'+this.getContent().id+'.taxGroupSelector',lazyRender:true,listClass:'x-combo-list-small'};taxGroupField=new Pulse.TaxGroupColumn({pEditor:this,header:VIEWPORT_PROPERTIES.TAX,dataIndex:'taxGroupId',sortable:true,editor:new Ext.form.ComboBox(taxGroupEditorBoxCFG)});columns=[this.sm];priceStatesEditorBoxCFG={typeAhead:true,triggerAction:'all',transform:this.getContent().clazz+'.'+this.getContent().id+'.priceStatusSelector',lazyRender:true,listClass:'x-combo-list-small'};columns=columns.concat([{header:'id',dataIndex:'id',sortable:true,width:50,fixed:true,renderer:this.getRenderer('id')},{header:VIEWPORT_PROPERTIES.STATUS,dataIndex:'status',css:'text-align:center;',sortable:true,editor:new Ext.form.ComboBox(priceStatesEditorBoxCFG)},{header:VIEWPORT_PROPERTIES.NETBASED,width:70,fixed:true,dataIndex:'isNetBased',sortable:true,renderer:function(v){if(false===v){return'';}
return'<div style="text-align:center;"><img src="'+Ext.BLANK_IMAGE_URL+'" width="14" height="14" border="0" '
+'class="isSelectedIconCls_14_big" style="vertical-align:middle;text-align:center;" '
+'/></div>';}},{header:VIEWPORT_PROPERTIES.CURRENCY,dataIndex:'currency',sortable:true,css:'text-align:center;',renderer:this.getRenderer('currency')},{header:''+VIEWPORT_PROPERTIES.PRICE,dataIndex:'amount',sortable:true,renderer:this.getRenderer('amount'),editor:new Ext.form.TextField(amountEditorConfig)},taxGroupField,{header:'min-'+VIEWPORT_PROPERTIES.ORDERSIZE,dataIndex:'minOrderSize',sortable:true,css:'text-align:right;',editor:new Ext.form.TextField({regex:/\b^[0-9]+\b/})},{header:'max-'+VIEWPORT_PROPERTIES.ORDERSIZE,dataIndex:'maxOrderSize',sortable:true,css:'text-align:right;',editor:new Ext.form.TextField({regex:/\b^[0-9]+\b/})},{header:VIEWPORT_PROPERTIES.ROLES,dataIndex:'noOfRoles',width:50,fixed:true,css:'text-align:center;',sortable:true}]);if(typeof(this.initPriceRoleEditorURL)=='string'&&this.initPriceRoleEditorURL!==''){columns.push({dataIndex:'id',width:30,fixed:true,renderer:this.getRenderer('editPriceRolesBtn')});}
this.cm=new Ext.grid.ColumnModel(columns);height=this.getHeight();plugins=[taxGroupField];this.grid=new Ext.grid.EditorGridPanel({pEditor:this,plugins:plugins,disabled:true,store:this.store,cm:this.cm,sm:this.sm,renderTo:this.gridId,height:height,autoExpandColumn:'id',loadMask:true,viewConfig:{forceFit:true},border:false,frame:false,clicksToEdit:1});this.grid.on('afteredit',function(evt){if(evt.value==evt.originalValue){return;}
this.fireEvent('MSG','change',this);},this);if(typeof(this.url)=='string'&&this.url!==''){this.loadStore();this.grid.enable();}}catch(e){FATAL(e,this,'buildGrid');}},removeSelectedPrices:function(){if(this.DBG){THROW({args:arguments,props:['grid','store']},this,'removeSelectedPrices');}
try{arr=this.grid.getSelectionModel().getSelections();for(i=0;i<arr.length;i++){this.store.remove(arr[i]);}
if(arr.length>0){this.fireEvent('MSG','change',this);}
delete arr;if(false===this.hasChanges()){this.reset();}}catch(e){if(this.DBG){FATAL(e,this,'removeSelectedPrices');}}},loadStore:function(params){this.store.load({url:this.url,params:params});},getTaxGroup:function(taxGroupId){for(i=0;i<this.shopSettings.taxGroups.length;i++){if(taxGroupId==this.shopSettings.taxGroups[i].id){return this.shopSettings.taxGroups[i];}}},getHeight:function(){if(typeof(this.initialConfig.height)=='number'){return this.initialConfig.height;}
if(typeof(this.renderTo)=='object'&&this.renderTo!==null&&this.renderTo.type=='SubEditorPanel'){return this.renderTo.getInnerHeight()-1;}
if(typeof(this.grid)=='undefined'){return;}
return this.grid.getSize().height;},getRenderer:function(field){try{fieldUP=field.toUpperCase();switch(fieldUP){case'ID':renderer=function(v,leftNeighBourCell,rec,rowIdx,colIdx,store){try{if(typeof(v)=='number'){return v;}else{return'*';}}catch(re){return v+' : '+re;}};break;case'CURRENCY':renderer=function(v,leftNeighBourCell,rec,rowIdx,colIdx,store){try{symbol='<span'+'>';if(typeof(v.symbol)=='string'&&v.symbol!==''){symbol+=v.symbol+'&#160;';}
return symbol+'('+v.currencyCode+')</span>';}catch(re){return v+' : '+re;}};break;case'TAXGROUP':renderer=function(v,leftNeighBourCell,rec,rowIdx,colIdx,store){try{return'<span ext:qtip="'+v.clazz+'&#160;('+v.id+')">'+
v.percentage+'&#160;%&#160;('+v.name+')'+'</span>';}catch(re){return v+' : '+re;}};break;case'AMOUNT':renderer=function(v,leftNeighBourCell,rec,rowIdx,colIdx,store){try{currency=rec.get('currency');start=0;preDot=v;appendString='.';if(v.indexOf('.')!==-1){splitArray=v.split('.');preDot=splitArray[0];appendString='.'+splitArray[1];start=splitArray[1].length;}
for(i=start;i<currency.defaultFractionDigits;i++){appendString+=0;}
if(appendString.length>(currency.defaultFractionDigits+1)){appendString=appendString.substring(0,currency.defaultFractionDigits+1);}
return'<div style="text-align:right;">'+
parseInt(preDot,10)+appendString+'</div>';}catch(re){return v+' : '+re;}};break;case'EDITPRICEROLESBTN':renderer=function(v,leftNeighBourCell,rec,rowIdx,colIdx,store){try{start='<a href="#" ';if(typeof(v)!='string'){start+='onclick="Ext.getCmp(\''+store.pEditor.id+'\').editPriceRoles(\''+rec.get('clazz')+'\','+v+');'+'this.blur();return;"';}
return start+' style="display:block;width:14px;height:14px;margin:0px;padding:0px;border:0px;vertical-align:middle;" '+'class="editIconCls_14" '+'ext:qtip="'+VIEWPORT_PROPERTIES.BUTTON_TEXT_EDIT+': '+VIEWPORT_PROPERTIES.ROLES+'">'+'<img src="'+Ext.BLANK_IMAGE_URL+'" width="1" height="1" border="0"/>'+'</a>';}catch(re){return v+' : '+re;}};break;default:FATAL(field,this,'getRenderer','NO MATCHING RENDERER');return;}
return renderer;}catch(e){FATAL(field,this,'getRenderer','CANNOT PROCESS FIELD');return;}},editPriceRoles:function(priceClazz,priceId){if(this.DBG){THROW({args:arguments},this,'editPriceRoles');}
try{pel=VIEWPORT.getEl();if(typeof(pel)=='undefined'){throw('ELEMENT-CHECK FAILED');}
if(this.el===null){this.el=pel.createChild({tag:'div',id:'editPriceRoles.win.el'});}
vpSize=VIEWPORT.getSize();params={id:priceId,contentid:this.getContent().id};winCfg={url:this.initPriceRoleEditorURL,params:params,id:priceClazz+'.'+priceId+'.roles.editor',title:VIEWPORT_PROPERTIES.ROLES,modal:true,plain:true,renderTo:this.el,width:((vpSize.width-200)<800)?vpSize.width-200:800,height:((vpSize.height-200)<550)?vpSize.height-200:550,iconCls:'roleIconCls'};this.win=new Pulse.SubEditorWindow(winCfg);this.win.on('show',function(){this.win.initializePanel();},this);this.win.on('MSG',function(msgString,_priceRoleEditor,_win){msg=msgString.toUpperCase();if(msg=='SAVESUCCESS'&&_priceRoleEditor.price){rc=this.store.getAt(this.store.find('id',_priceRoleEditor.price.id));if(rc.get('noOfRoles')!=_priceRoleEditor.price.noOfRoles){rc.beginEdit();rc.set('noOfRoles',_priceRoleEditor.price.noOfRoles);rc.endEdit();}
delete rc;}
delete msg;},this);this.win.setPagePosition((vpSize.width/2)-300,100);this.win.show(this);}catch(e){if(this.DBG){FATAL(e,this,'editPriceRoles');}}},validateAmount:function(v){if(this.DBG){THROW({args:arguments},this,'validateAmount.call');}
_split=v.split('.');if(_split.length>2){return false;}
regex=/(\b^\d+\b)/;success=regex.test(_split[0]);if(typeof(_split[1])=='undefined'||_split[1]===''){return success;}
success=(success&&regex.test(_split[1]));if(true===success){success=(success&&(_split[1].length<=this.shopSettings.currency.defaultFractionDigits));}
return success;},onRender:function(){THROW({props:['renderTo'],args:arguments},this,'onRender');try{if(typeof(this.renderTo)=='object'&&this.renderTo!==null&&this.renderTo.type=='SubEditorPanel'){if(this.shopSettings.error){this.renderTo.body.createChild({tag:'div',style:'color:red;font-weight:bold;text-align:center;padding-top:50px;',html:this.shopSettings.error});}else{this.gridId=this.id+'.gridDiv';el=this.renderTo.body.createChild({tag:'div',id:this.gridId});this.buildGrid();}}else{THROW({e:'TODO',props:['renderTo'],args:arguments},this,'onRender');}}catch(e){FATAL(e,this,'onRender');}},getChanges:function(v){if(typeof(this.valPrefix)=='undefined'){this.valPrefix='';}
v=Pulse.ShopPricesEditor.superclass.getChanges.call(this,v);if(true===this.hasChanges()){if(typeof(v)=='undefined'||v===null){v={};}
try{if(this.store.addIds.length>0){for(i=0;i<this.store.addIds.length;i++){rec=this.store.getAt(this.store.find('id',this.store.addIds[i]));prefix=this.valPrefix+'price_'+rec.get('id')+'_';for(o in rec.data){valString=prefix+o;v[valString]=rec.data[o];}}}
modRecs=this.store.getModifiedRecords();if(modRecs.length>0){for(i=0;i<modRecs.length;i++){rec=modRecs[i];prefix=this.valPrefix+'price_'+rec.get('id')+'_';if(typeof(rec.get('id'))=='string'){continue;}else{chg=rec.getChanges();for(o in chg){valString=prefix+o;v[valString]=chg[o];}}}}
if(this.store.removeIds.length>0){v[this.valPrefix+'removePriceIds']=this.store.removeIds;}}catch(e){if(this.DBG){FATAL(e,this,'getChanges');}}}
return v;},hasChanges:function(){superBool=Pulse.ShopPricesEditor.superclass.hasChanges.call(this);bool=((this.store.getModifiedRecords().length>0)||(this.store.removeIds.length>0)||(this.store.addIds.length>0));if(this.DBG){THROW({args:arguments,p:[{n:'superBool',o:superBool},{n:'bool',o:bool}]},this,'hasChanges.ShopPricesEditor');}
return superBool||bool;},commit:function(v){Pulse.ShopPricesEditor.superclass.commit.call(this);this.store.commitChanges();this.store.removeIds=[];this.store.addIds=[];this.fireEvent('MSG','commit',this);},reset:function(){Pulse.ShopPricesEditor.superclass.reset.call(this);this.store.rejectChanges();this.store.removeIds=[];this.store.addIds=[];this.fireEvent('MSG','reset',this);}};Pulse.ShopPricesEditor=Ext.extend(Pulse.Editor,ShopPricesEditor);DBG.ShopPriceRoleEditor=DBG.apply(DBG.Editor,{onRender:false,init:false});ShopPriceRoleEditor={type:'ShopPriceRoleEditor',DBG:DBG.ShopPriceRoleEditor,init:function(editor){if(this.DBG){THROW({args:arguments,props:['url','saveURL','price.id','price.clazz']},this,'init');}
try{if(typeof(editor)!='object'||editor===null){throw({e:'EDITOR.TYPE.EXCEPTION',description:'EDITOR CONNOT BE UNDEFINED OR NULL',editor:editor,editorToString:''+editor,editorType:typeof(editor)});}
if(true!==(editor.type!='SubEditorPanel'||editor.type!='SubEditorWindow')){throw({e:'EDITOR.TYPE.EXCEPTION',description:'MUST BE SubEditorPanel or SubEditorWindow',editor:editor,editorToString:''+editor,editorType:typeof(editor)});}
this.editor=editor;if(this.editor.type=='SubEditorWindow'){this.editor.on('beforeClose',function(){if(true===this.hasChanges()){Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE,VIEWPORT_PROPERTIES.TEXT_UNSAVEDCHANGES,function(response){if('yes'===response){this.reset();this.editor.close();}},this);return false;}},this);}
this.rolesEditor=new Pulse.AssorterPanel({height:editor.getInnerHeight()+21,header:false,collapsible:false,border:false,collapsed:false,renderTo:this.price.clazz+'.'+this.price.id+'.roles',loadURL:this.url+'?id='+this.price.id,editURL:this.editURL,editHandler:function(node){RoleOverviewEditor.editRole(this.editURL,node.attributes.id,node.attributes.clazz);},uiProviders:{'AccessControlTreeNodeUI':PULSE.AccessControlTreeNodeUI}});this.rolesEditor.on('MSG',function(msgString,_editor){THROW({args:arguments},this,'MSG');if(msgString=='change'){if(false===_editor.hasChanges()){this.editor.toggleHasChangesIcon(false);}else{this.editor.toggleHasChangesIcon(true);}}else{PulseError.Throw({e:'HANDLE',p:[{n:'handle',o:'panel'},{n:'id',o:this.tab.id},{n:'msg',o:msgString}]});}
this.fireEvent('MSG',msgString,this,_editor);},this);this.rolesEditor.on('reset',function(eObj){if(true===eObj.success&&false===eObj.assorter.hasChanges()){this.editor.toggleHasChangesIcon(false);}
this.fireEvent('MSG','reset',this,_editor);},this);}catch(e){if(this.DBG){FATAL(e,this,'init');}}},hasChanges:function(){if(this.rolesEditor){return this.rolesEditor.hasChanges();}
return false;},getChanges:function(v){if(this.rolesEditor&&this.rolesEditor.hasChanges()){if(typeof(v)=='undefined'){v={id:this.price.id,contentid:this.content.id};}
chgs=this.rolesEditor.getChanges();if(typeof(chgs.asoc)!='undefined'){v.addroles=chgs.asoc;}
if(typeof(chgs.unasoc)!='undefined'){v.remroles=chgs.unasoc;}}
return v;},commit:function(){if(this.rolesEditor){return this.rolesEditor.commit();}
return false;},reset:function(){if(this.rolesEditor){return this.rolesEditor.reset();}
return false;},getButtons:function(){saveButtonConfig={scope:this,disabled:true,text:VIEWPORT_PROPERTIES.BUTTON_TEXT_SAVE,handler:this.savePriceRoles,iconCls:'saveIconCls'};closeButtonConfig={scope:this,text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CANCEL,handler:function(){this.editor.close();},iconCls:'deleteIconCls'};if(typeof(this.saveURL)=='string'&&this.saveURL!==''){saveButtonConfig.disabled=false;}
return[new Ext.Toolbar.Button(saveButtonConfig),new Ext.Toolbar.Separator(),new Ext.Toolbar.Button(closeButtonConfig),new Ext.Toolbar.Separator()];},savePriceRoles:function(){if(typeof(this.saveURL)!='string'||this.saveURL===''){return;}
if(false===this.hasChanges()){return;}
params=this.getChanges();Ext.Ajax.request({url:this.saveURL,method:'POST',scope:this,success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){this.commit();if(this.editor){this.editor.toggleHasChangesIcon(false);}
this.price=decodedResponse.price;this.fireEvent('MSG','savesuccess',this);}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this.type,'tbar.savePriceRoles');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this.type,'tbar.savePriceRoles');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this.type,'tbar.savePriceRoles');}},params:params});}};Pulse.ShopPriceRoleEditor=Ext.extend(Pulse.Editor,ShopPriceRoleEditor);Pulse.TaxGroupColumn=function(config){Ext.apply(this,config);if(!this.id){this.id=Ext.id();}
this.renderer=this.renderer.createDelegate(this);};Pulse.TaxGroupColumn.prototype={DBG:false,type:'CheckColumn',init:function(grid){this.grid=grid;},renderer:function(v,p,record,rowIdx,colIdx,store){taxGroup=this.pEditor.getTaxGroup(v);return'<span ext:qtip="'+taxGroup.clazz+'&#160;('+taxGroup.id+')">'+
taxGroup.percentage+'&#160;%&#160;('+taxGroup.name+')'+'</span>';}};Pulse.CheckColumn=function(config){Ext.apply(this,config);if(!this.id){this.id=Ext.id();}
this.renderer=this.renderer.createDelegate(this);};Pulse.CheckColumn.prototype={DBG:false,type:'CheckColumn',init:function(grid){this.grid=grid;this.grid.on('render',function(){var view=this.grid.getView();view.mainBody.on('mousedown',this.onMouseDown,this);},this);},onMouseDown:function(e,t){this.grid.stopEditing(true);if(t.className&&t.className.indexOf('x-grid3-cc-'+this.id)!==-1){e.stopEvent();var index=this.grid.getView().findRowIndex(t);var record=this.grid.store.getAt(index);record.set(this.dataIndex,!record.get(this.dataIndex));this.grid.fireEvent('afterEdit',{grid:this.grid,record:record,field:this.dataIndex,value:record.get(this.dataIndex),originalValue:!record.get(this.dataIndex),row:index});}},renderer:function(v,p,record,rowIdx,colIdx,store){p.css+=' x-grid3-check-col-td';return'<div class="x-grid3-check-col'+((true===v)?'-on':'')+' x-grid3-cc-'+this.id+'">&#160;</div>';}};DBG.ShopContentEditor=DBG.apply(DBG.StoreContentEditor,{initPricesEditorPanel:false});ShopContentEditor={type:'ShopContentEditor',DBG:false,initPricesEditorPanel:function(){if(this.DBG){THROW({props:['content.id','content.clazz','content.bundle','initPricesEditorURL']},this,'initPricesEditorPanel');}
try{if(typeof(this.initPricesEditorURL)!='string'||this.initPricesEditorURL===''){if(this.DBG){throw('URL UNDEFINED this.initPricesEditorURL: '+this.initPricesEditorURL);}
return;}
var params={id:this.getContent().id};var subEditorPanel=new Pulse.SubEditorPanel({iconCls:'priceIconCls',title:''+VIEWPORT_PROPERTIES.PRICES,id:this.getContent().clazz+'.'+this.getContent().id+'.prices.editor',masterEditor:this,url:this.initPricesEditorURL,params:params,renderTo:this.getContent().clazz+'.'+this.getContent().id+'.prices',style:'margin-bottom:5px;',height:350});subEditorPanel.on('expand',function(){if(this.DBG){THROW({props:['id','url','initializePanel','loadPanel']},this,'expand');}
this.initializePanel();});this.addSubEditor(subEditorPanel);}catch(e){if(this.DBG){FATAL(e,this,'initPricesEditorPanel');}}},editorMSG:function(msgString,editor,masterEditor){msg=msgString.toUpperCase();if(msg=='DELETESUCCESS'){if(editor.type=='ShopVariantEditor'){if(true===editor.wasLastVariant){this.removeSubEditor(editor.masterEditor,true);this.loadVariantsEanContainer();}else{this.removeSubEditor(editor.masterEditor,true);}}}
Pulse.ShopContentEditor.superclass.editorMSG.call(this,msgString,editor,masterEditor);},hasChanges:function(){superBool=Pulse.ShopContentEditor.superclass.hasChanges.call(this);if(this.statusBox){return this.statusBox.changed||superBool;}
return superBool;},getChanges:function(v){v=Pulse.ShopContentEditor.superclass.getChanges.call(this,v);if(this.statusBox&&true===this.statusBox.changed){v[this.statusBox.valuePrefix+'status']=this.statusBox.getValue();}
return v;},commit:function(){if(this.statusBox&&true===this.statusBox.changed){this.statusBox.commit();}
Pulse.ShopContentEditor.superclass.commit.call(this);},reset:function(){if(this.statusBox&&true===this.statusBox.changed){this.statusBox.reset();}
Pulse.ShopContentEditor.superclass.reset.call(this);},initStatusBox:function(){this.statusBox=Ext.get(this.getContent().clazz+'.'+this.getContent().id+'.statusSelector');if(this.statusBox){this.statusBox.changed=false;this.statusBox.initialValue=this.statusBox.getValue();this.statusBox.valuePrefix='';this.statusBox.pEditor=this;this.statusBox.on('change',function(){if(this.statusBox.initialValue==arguments[1].value){this.statusBox.changed=false;if(false===this.hasChanges()){this.statusBox.replaceClass(Pulse.fieldCls+'Yellow',Pulse.fieldCls);this.reset();}
return;}
this.statusBox.changed=true;this.statusBox.replaceClass(Pulse.fieldCls,Pulse.fieldCls+'Yellow');this.fireEvent('MSG','change',this);},this);this.statusBox.commit=function(){if(true===this.changed){this.changed=false;this.initialValue=this.getValue();this.replaceClass(Pulse.fieldCls+'Yellow',Pulse.fieldCls);}};this.statusBox.reset=function(){if(true===this.changed){this.changed=false;this.replaceClass(Pulse.fieldCls+'Yellow',Pulse.fieldCls);options=document[this.pEditor.getContent().clazz+'.'+this.pEditor.getContent().id+'.statusSelector.form']['status'];for(i=0;i<options.length;i++){if(this.initialValue==options[i].value){options[i].selected=true;}}}};}},initComponent:function(boolInitTab){Pulse.ShopContentEditor.superclass.initComponent.call(this,boolInitTab);try{this.initStatusBox();this.initPricesEditorPanel();}catch(e){FATAL(e,this,'initComponent.ShopContentEditor');}}};Pulse.ShopContentEditor=Ext.extend(Pulse.StoreContentEditor,ShopContentEditor);ShopOrderViewer={type:'ShopOrderViewer',defaultOverviewPageSize:20,buildGrid:function(){this.store=this.getStore();this.pageSizeBox=new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:['size'],sortInfo:{field:'size',direction:"ASC"},data:[[10],[20],[50],[100]]}),displayField:'size',valueField:'size',selectOnFocus:true,mode:'local',triggerAction:'all',width:60,blankText:''+this.defaultOverviewPageSize,emptyText:''+this.defaultOverviewPageSize});this.pagingToolBar=new Ext.PagingToolbar({displayInfo:true,pageSize:this.defaultOverviewPageSize,store:this.store,items:['-',this.pageSizeBox]});this.store.on('beforeLoad',function(store,options){if(this.pageSizeBox.getRawValue()!==''){try{limit=parseInt(this.pageSizeBox.getRawValue().trim(),10);this.pagingToolBar.pageSize=limit;options.params.limit=limit;}catch(e){}}else{this.pagingToolBar.pageSize=this.defaultOverviewPageSize;options.params.limit=this.defaultOverviewPageSize;}},this);columns=[{header:'id',dataIndex:'id',sortable:true,width:50,hidden:true},{header:VIEWPORT_PROPERTIES.EMAIL,dataIndex:'emailAddress',sortable:true,hideable:false},{header:VIEWPORT_PROPERTIES.CURRENCY,dataIndex:'currency',sortable:true,renderer:this.currencyFieldRenderer,width:75,fixed:true,hideable:false},{header:VIEWPORT_PROPERTIES.NETAMOUNT,dataIndex:'netTotal',sortable:true,hideable:false},{header:VIEWPORT_PROPERTIES.GROSSAMOUNT,dataIndex:'grossTotal',sortable:true,hideable:false},{header:VIEWPORT_PROPERTIES.SHIPMENT_METHOD,dataIndex:'shipmentMethod',sortable:true,renderer:this.idCodeFieldRenderer,hideable:false},{header:VIEWPORT_PROPERTIES.PAYMENT_METHOD,dataIndex:'paymentMethod',sortable:true,renderer:this.idCodeFieldRenderer,hideable:false},{header:VIEWPORT_PROPERTIES.ORDER_START_DATE,dataIndex:'startDate',sortable:true,hidden:true},{header:VIEWPORT_PROPERTIES.ORDER_END_DATE,dataIndex:'endDate',sortable:true,hideable:false},{header:'locale',dataIndex:'locale',sortable:true,hidden:true},{header:'bundle',dataIndex:'bundle',sortable:true,renderer:this.bundleFieldRenderer,hidden:true}];if(typeof(this.loadOrderURL)=='string'&&this.loadOrderURL!==''){gridExpander=new Ext.grid.AjaxRowExpander({spanRows:'8',enableCaching:true,url:this.loadOrderURL});columns=[gridExpander].concat(columns);}
this.cm=new Ext.grid.ColumnModel(columns);gridCFG={disabled:true,store:this.store,cm:this.cm,renderTo:this.gridId,height:this.tab.getInnerHeight(),width:this.tab.getInnerWidth(),loadMask:true,viewConfig:{forceFit:true},border:false,frame:false,tbar:this.buildToolbar(),bbar:this.pagingToolBar};if(typeof(this.loadOrderURL)=='string'&&this.loadOrderURL!==''){gridCFG.plugins=gridExpander;}
this.grid=new Ext.grid.GridPanel(gridCFG);if(typeof(this.loadURL)=='string'&&this.loadURL!==''){this.loadStore({start:0,bundleName:this.bundleName});this.grid.enable();}
this.tab.on('resize',function(){this.grid.setHeight(this.tab.getInnerHeight());this.grid.setWidth(this.tab.getInnerWidth());},this);},buildToolbar:function(){try{buttons=[];this.emailField=new Ext.form.TextField({blankText:'search email'});this.startDateField=new Ext.form.DateField({editable:false,blankText:'start date'});this.endDateField=new Ext.form.DateField({editable:false,blankText:'end date'});buttons.push(VIEWPORT_PROPERTIES.EMAIL+': ');buttons.push(this.emailField);buttons.push(' ');buttons.push(VIEWPORT_PROPERTIES.FROM+': ');buttons.push(this.startDateField);buttons.push(' ');buttons.push(VIEWPORT_PROPERTIES.TO_TEMP+': ');buttons.push(this.endDateField);searchButtonCFG={scope:this,handler:function(){params={start:0,sEmail:this.emailField.getValue()};sDate=this.startDateField.getValue();if(typeof(sDate)=='object'&&sDate!==null){params.sStart=sDate.getTime();}
sDate=this.endDateField.getValue();if(typeof(sDate)=='object'&&sDate!==null){params.sEnd=sDate.getTime();}
this.loadStore(params);},iconCls:'findIconCls'};buttons.push(' ');buttons.push(searchButtonCFG);buttons.push(new Ext.Toolbar.Separator());return new Ext.Toolbar({items:buttons});}catch(e){FATAL(e,this,'buildToolbar');}},hasChanges:function(){return false;},bundleFieldRenderer:function(o){return'<div ext:qtip="id:&#160;'+o.id+'">'+o.name+'</div>';},currencyFieldRenderer:function(o){return'<div ext:qtip="code:&#160;'+o.currencyCode+'">'+o.symbol+'</div>';},idCodeFieldRenderer:function(o){return'<div ext:qtip="id:&#160;'+o.id+'">'+o.idCode+'</div>';},loadStore:function(params){this.store.load({url:this.loadURL,params:params});},getStore:function(){storeCFG={pEditor:this,pruneModifiedRecords:true,fields:this.getRecord(),root:'data',totalProperty:'total',url:this.loadURL,remoteSort:true,sortInfo:{field:'id',direction:'ASC'}};return new Ext.data.JsonStore(storeCFG);},getRecord:function(){return new Pulse.Record.create([{name:'id'},{name:'clazz'},{name:'bundle'},{name:'locale'},{name:'currency'},{name:'userId'},{name:'emailAddress'},{name:'shipmentMethod'},{name:'paymentMethod'},{name:'noOfPositions'},{name:'netTotal'},{name:'grossTotal'},{name:'startDate'},{name:'endDate'}]);},initComponent:function(boolInitTab){Pulse.ShopOrderViewer.superclass.initComponent.call(this,boolInitTab);this.buildGrid();}};Pulse.ShopOrderViewer=Ext.extend(Ext.grid.GridPanel,ShopOrderViewer);DBG.ShopSettingsEditor=DBG.apply(DBG.Editor,{initComponent:{ShopSettingsEditor:false},tbar:{save:true},initTab:true,initTaxgroupsEditorPanel:true,initCurrencyMonitor:true,initNetBasedMonitor:true});ShopSettingsEditor={type:'ShopSettingsEditor',DBG:false,getSaveButtonConfig:function(){return{text:VIEWPORT_PROPERTIES.BUTTON_TEXT_SAVE,disabled:true,scope:this,handler:function(){if(false===this.hasChanges()){this.reset();return;}
if(false===this.currencyMonitor.validate()){return;}
vals={id:this.shopSettings.id};saveValues=this.getChanges(vals);if(typeof(saveValues)=='undefined'||saveValues===null){if(this.DBG){THROW({e:'NO VALUES TO SAVE THOUGH THERE ARE CHANGES',args:[this.hasChanges(),saveValues]},this,'tbar.save');}
return;}
this.tab.disable();Ext.Ajax.request({url:this.saveURL,method:'POST',scope:this,success:function(response,options){this.tab.enable();decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){if(true===this.currencyMonitor.hasChanges()){this.currencyMonitor.setValue(decodedResponse.shopSettings.currency.currencyCode);}
this.commit();(function(){this.fireEvent('MSG','savesuccess',this);}).defer(250,this);}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this.type,'tbar.save');}},failure:function(response,options){this.tab.enable();if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this.type,'tbar.save');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this.type,'tbar.save');}},params:saveValues});},iconCls:'saveIconCls'};},initTab:function(){if(this.DBG){THROW({props:['tab','tab.id']},this,'initTab');}
try{if(typeof(this.tab)!='object'||this.tab===null){THROW({e:'TAB UNDEFINED OR NULL: "['+this.tab+']"'},this,'initTab');return;}
if(true!==this.tab.isInitialized){saveButtonConfig=this.getSaveButtonConfig();if(typeof(this.saveURL)=='string'&&this.saveURL!==''){saveButtonConfig.disabled=false;saveButtonConfig.scope=this;}
this.tab.getTopToolbar().insertButton(0,[saveButtonConfig,new Ext.Toolbar.Separator()]);this.tab.isInitialized=true;}}catch(e){FATAL(e,this,'initTab');}},initTaxgroupsEditorPanel:function(){if(this.DBG){THROW({props:['content.id','content.clazz','content.bundle','initPricesEditorURL']},this,'initTaxgroupsEditorPanel');}
try{if(typeof(this.initTaxgroupsEditorURL)!='string'||this.initTaxgroupsEditorURL===''){if(this.DBG){throw('URL UNDEFINED this.initTaxgroupsEditorURL: '+this.initTaxgroupsEditorURL);}
return;}
var params={id:this.shopSettings.id};var subEditorPanel=new Pulse.SubEditorPanel({iconCls:'percentageIconCls',title:''+VIEWPORT_PROPERTIES.TAX,id:this.shopSettings.clazz+'.'+this.shopSettings.id+'.taxGroups.editor',masterEditor:this,url:this.initTaxgroupsEditorURL,params:params,renderTo:this.shopSettings.clazz+'.'+this.shopSettings.id+'.taxGroups',style:'margin-bottom:5px;',height:350});subEditorPanel.on('expand',function(){if(this.DBG){THROW({props:['id','url','initializePanel','loadPanel']},this,'expand');}
this.initializePanel();});this.addSubEditor(subEditorPanel);}catch(e){if(this.DBG){FATAL(e,this,'initTaxgroupsEditorPanel');}}},initCurrencyMonitor:function(el){try{this.currencyEl=(typeof(el)!='undefined'&&el!==null)?el:Ext.get(this.shopSettings.clazz+'.'+this.shopSettings.id+'.currency');if(typeof(this.currencyEl)=='undefined'&&this.currencyEl===null){if(this.DBG){FATAL('ELEMENT UNDEFINED',this,'initCurrencyMonitor');}
return;}
currencyMonitorCFG={id:this.id+'.currencyEditor',el:this.currencyEl,allowBlank:false};this.currencyMonitor=new Pulse.FieldMonitor(currencyMonitorCFG);this.currencyMonitor.validate();this.addSubEditor(this.currencyMonitor);}catch(e){if(this.DBG){FATAL(e,this,'initCurrencyMonitor');}}},initNetBasedMonitor:function(el){try{this.netBasedEl=(typeof(el)!='undefined'&&el!==null)?el:Ext.get(this.shopSettings.clazz+'.'+this.shopSettings.id+'.netBased');if(typeof(this.netBasedEl)=='undefined'&&this.netBasedEl===null){if(this.DBG){FATAL('ELEMENT UNDEFINED',this,'initNetBasedMonitor');}
return;}
netBasedMonitorCFG={id:this.id+'.netBasedEditor',el:this.netBasedEl,fieldType:'checkbox'};netBasedMonitor=new Pulse.FieldMonitor(netBasedMonitorCFG);this.addSubEditor(netBasedMonitor);}catch(e){if(this.DBG){FATAL(e,this,'initNetBasedMonitor');}}},initComponent:function(boolInitTab){Pulse.ShopSettingsEditor.superclass.initComponent.call(this);if(this.DBG){props=['type'];props=props.concat(DBG.getPropertyArray(this.initialConfig));THROW({args:arguments,props:props},this,'initComponent.ShopSettingsEditor');}
try{this.initCurrencyMonitor();this.initNetBasedMonitor();this.initTaxgroupsEditorPanel();if(false!==boolInitTab){this.initTab();}}catch(e){FATAL(e,this,'initComponent.ShopSettingsEditor');}}};Pulse.ShopSettingsEditor=Ext.extend(Pulse.Editor,ShopSettingsEditor);Pulse.ShopSettingsTree={type:'ShopSettingsTree',DBG:{addTreeListeners:false},getTree:function(config){treeCfg={xtype:'treepanel',el:config.el,autoScroll:true,autoHeight:true,animate:true,enableDD:false,containerScroll:true,rootVisible:false,border:false,loader:new Ext.tree.TreeLoader({dataUrl:config.dataURL,uiProviders:{'ShopSettingsTreeNodeUI':PULSE.ShopSettingsTreeNodeUI}}),treeEditor:new Pulse.ShopSettingsTreeEditor(config)};if(typeof(config.viewOrdersURL)=='string'&&config.viewOrdersURL!==''){viewOrdersCFG={text:VIEWPORT_PROPERTIES.ORDERS,scope:config,handler:function(){PULSE_VIEWPORT_CONTROLLER.openTab({id:this.bundleName+'.orders',title:this.bundleName+': '+VIEWPORT_PROPERTIES.ORDERS,loadParams:{url:this.viewOrdersURL,params:{bundleName:this.bundleName}}});}};treeCfg.tbar=[viewOrdersCFG];}
tree=new Ext.tree.TreePanel(treeCfg);tree.setRootNode(new Ext.tree.AsyncTreeNode({text:config.el+'.root',draggable:false,id:config.el+'.root.id'}));this.addTreeListeners(tree);return tree;},addTreeListeners:function(tree){tree.on('click',function(node,evt){if(typeof(evt.handle)!='undefined'){THROW({args:arguments,propsObj:node,props:['text','id'],p:[{n:'evt.handle',o:evt.handle}]},Pulse.ShopSettingsTree,'addTreeListeners');switch(evt.handle){case'edit':evt.handle=null;delete evt.handle;if(typeof(this.treeEditor.editHandler)=='function'){this.treeEditor.editHandler(node);}
break;default:THROW({e:'ERROR',args:arguments,p:[{n:'node',o:node.text},{n:'id',o:node.id},{n:'UNKNOWN HANDLE:',o:evt.handle}]},Pulse.ShopSettingsTree,'addTreeListeners');evt.handle=null;delete evt.handle;}}},tree);}};Pulse.ShopSettingsTreeEditor=function(config){this.initialConfig=config;Ext.apply(this,config);if(typeof(this.id)=='undefined'){this.id=Ext.id();}else{this.id+='.editor';}};Pulse.ShopSettingsTreeEditor.prototype={type:'ShopSettingsTreeEditor',DBG:false,editHandler:function(node){if(typeof(node.attributes.shopSettings)!='undefined'){this.editSettings(node);}else{this.createNewSettings(node);}},editSettings:function(node){if(this.DBG){THROW({propsObj:node,props:['attributes.bundle.name','attributes.locale','attributes.shopSettings']},this,'editSettings');}
PULSE_VIEWPORT_CONTROLLER.openTab({id:node.attributes.shopSettings.clazz+'.'+node.attributes.shopSettings.id+'.editor',title:node.attributes.bundle.name+'.'+node.attributes.locale,tabTip:node.attributes.bundle.name+'.'+node.attributes.locale+' (id:'+node.attributes.shopSettings.id+')',iconCls:node.attributes.shopSettings.clazz.replace(/\./g,''),loadParams:{url:this.editURL,params:{id:node.attributes.shopSettings.id}}});},createNewSettings:function(node){if(this.DBG){THROW({propsObj:node,props:['attributes.bundle.name','attributes.locale']},this,'createNewSettings');}
Ext.Msg.confirm(VIEWPORT_PROPERTIES.BUTTON_TEXT_CREATE,VIEWPORT_PROPERTIES.TEXT_CREATE_SHOPSETTINGS,function(yesNo){if(yesNo=='yes'){this.scope[this.execute](this.node);}},{node:node,execute:'createAjax',scope:this});},createAjax:function(node){try{Ext.Ajax.request({url:this.createURL,scope:this,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){node=options.node;node.attributes.shopSettings=decodedResponse.shopSettings;node.ui.reBuildQTip();this.editSettings(node);}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this,'createAjax');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this,'createAjax');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this,'createAjax');}},node:node,params:{bundle:node.attributes.bundle.name,locale:node.attributes.locale}});}catch(e){FATAL(e,this,'createAjax');}}};PULSE.ShopSettingsTreeNodeUI=function(){PULSE.ShopSettingsTreeNodeUI.superclass.constructor.apply(this,arguments);};Ext.extend(PULSE.ShopSettingsTreeNodeUI,Ext.tree.TreeNodeUI,{type:'ShopSettingsTreeNodeUI',DBG:false,functionsIconSize:14,renderElements:function(n,a,targetNode,bulkRender){this.indentMarkup=n.parentNode?n.parentNode.ui.getChildIndent():'';styleString='margin-bottom: 2px; padding: 0px; border: 0px; vertical-align: middle;';id=Ext.id();editBtn='';editHandler=false;if(typeof(n.getOwnerTree().treeEditor)!='undefined'&&typeof(n.getOwnerTree().treeEditor.editHandler)=='function'){editHandler=true;editBtn='&#160;<a href="#" style="font-weight: bold" id="edtEl_'+n.id+'.'+id+'">'+'<img src="'+Ext.BLANK_IMAGE_URL+'" '+'width="'+this.functionsIconSize+'" '+'height="'+this.functionsIconSize+'" '+'style="'+styleString+'" '+'class="editIconCls_'+this.functionsIconSize+'" '+'ext:qtip="'+VIEWPORT_PROPERTIES.BUTTON_TEXT_EDIT+'" />'+'</a>&#160;';}
deleteBtn='';deleteHandler=false;if(typeof(n.getOwnerTree().treeEditor)!='undefined'&&typeof(n.getOwnerTree().treeEditor.deleteHandler)=='function'){deleteHandler=true;deleteBtn='&#160;<a href="#" style="font-weight: bold" id="delEl_'+n.id+'.'+id+'">'+'<img src="'+Ext.BLANK_IMAGE_URL+'" '+'width="'+this.functionsIconSize+'" '+'height="'+this.functionsIconSize+'" '+'style="'+styleString+'" '+'class="deleteIconCls_'+this.functionsIconSize+'" '+'ext:qtip="'+VIEWPORT_PROPERTIES.BUTTON_TEXT_REMOVE+'" />'+'</a>&#160;';}
href=a.href?a.href:Ext.isGecko?"":"#";buf=['<li class="x-tree-node">','<div ext:tree-node-id="',n.id,'" class="x-tree-node-el x-tree-node-leaf ',a.cls,'">','<span class="tabHasChangesIconHidden">*</span>','<img src="',a.icon||this.emptyIcon,'" class="x-tree-node-icon',(a.icon?" x-tree-node-inline-icon":""),(a.iconCls?" "+a.iconCls:""),'" unselectable="on" style="width:18px"/>','<a hidefocus="on" class="x-tree-node-anchor" href="',href,'" tabIndex="1" ',a.hrefTarget?' target="'+a.hrefTarget+'"':'',' dir="LTR">','<span unselectable="on" ext:qtip="id: '+n.id+'">',n.text,'</span></a>',editBtn,deleteBtn,"</div>",'<ul class="x-tree-node-ct" style="display:none;"></ul>',"</li>"].join('');if(bulkRender!==true&&n.nextSibling&&n.nextSibling.ui.getEl()){this.wrap=Ext.DomHelper.insertHtml("beforeBegin",n.nextSibling.ui.getEl(),buf);}else{this.wrap=Ext.DomHelper.insertHtml("beforeEnd",targetNode,buf);}
this.elNode=this.wrap.childNodes[0];this.ctNode=this.wrap.childNodes[1];cs=this.elNode.childNodes;this.hasChangesNode=cs[0];this.iconNode=cs[1];this.anchor=cs[2];this.textNode=cs[2].firstChild;if(true===editHandler){var editEl=Ext.get('edtEl_'+n.id+'.'+id);if(typeof(editEl)!='undefined'&&editEl!==null){editEl.on('click',this.handleClick,this,'edit');}}
if(true===deleteHandler){var deleteEl=Ext.get('delEl_'+n.id+'.'+id);if(typeof(deleteEl)!='undefined'&&deleteEl!==null){deleteEl.on('click',this.handleClick,this,'delete');}}
this.buildQTip(this,a);},handleClick:function(event,elClicked,handle){THROW({args:arguments,props:['id','type','node','node.id','node.text']},this,'handleClick');event.handle=handle;},updateExpandIcon:function(){},getChildIndent:function(){},renderIndent:function(){},buildQTip:function(ui,a){if(typeof(ui)=='undefined'||typeof(a)=='undefined'||ui===null){return;}
text=(typeof(a.shopSettings)=='undefined')?'ShopSettings: '+a.shopSettings:'ShopSettings:<br /><hr />id: '+a.shopSettings.id;qtipCFG={target:ui.textNode,text:text};Ext.QuickTips.register(qtipCFG);},reBuildQTip:function(){Ext.QuickTips.unregister(this.textNode);this.buildQTip(this,this.node.attributes);},setChanged:function(bool){THROW({o:bool},this,'setChanged');if(true===bool){Ext.fly(this.hasChangesNode).removeClass("tabHasChangesIconHidden");return;}
Ext.fly(this.hasChangesNode).replaceClass("","tabHasChangesIconHidden");}});PULSE.ShopSettingsRootTreeNodeUI=function(){PULSE.ShopSettingsRootTreeNodeUI.superclass.constructor.apply(this,arguments);};Ext.extend(PULSE.ShopSettingsRootTreeNodeUI,PULSE.ShopSettingsTreeNodeUI,{render:function(){if(!this.rendered){targetNode=this.node.ownerTree.innerCt.dom;this.node.expanded=true;targetNode.innerHTML='<div class="x-tree-root-node"></div>';this.wrap=this.ctNode=targetNode.firstChild;}},collapse:function(){},expand:function(){}});DBG.ShopVariantEditor=DBG.apply(DBG.ShopContentEditor,{getButtons:false,initNameMonitor:false,removeVariant:{click:false,call:false}});ShopVariantEditor={type:'ShopVariantEditor',DBG:false,getRemoveButtonConfig:function(boolDisabled){removeButtonConfig={text:VIEWPORT_PROPERTIES.BUTTON_TEXT_DELETE,scope:this,disabled:(typeof(this.removeURL)=='string'&&this.removeURL!=='')?false:true,handler:function(){if(this.DBG){THROW({args:arguments},this,'removeVariant.click');}
this.removeVariant();},iconCls:'deleteIconCls'};return removeButtonConfig;},getButtons:function(){THROW({props:['saveNewImageGroupURL']},this,'getButtons');try{createImageButtonConfig=this.getCreateImageButtonConfig();if(typeof(this.saveNewImageGroupURL)=='string'&&this.saveNewImageGroupURL!==''){createImageButtonConfig.disabled=false;createImageButtonConfig.scope=this;}
createVariantButtonConfig=this.getCreateVariantButtonConfig();createVariantButtonConfig.disabled=false;createVariantButtonConfig.scope=this;return[new Ext.Toolbar.Button(createImageButtonConfig),new Ext.Toolbar.Separator(),new Ext.Toolbar.Button(this.getRemoveButtonConfig()),new Ext.Toolbar.Separator(),new Ext.Toolbar.Button(createVariantButtonConfig),new Ext.Toolbar.Separator()];}catch(e){FATAL(e,this,'getButtons');}},removeVariant:function(){if(this.DBG){THROW({args:arguments,props:['variant','variant.id','variant.clazz','variant.name']},this,'removeVariant.call');}
Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE+':&#160;"'
+'(id: '+this.getContent().id+')"',VIEWPORT_PROPERTIES.MSG_REALLYDELETE,function(response){if('yes'===response){params={id:this.getContent().id};if(typeof(this.getContent().parentVariantId)=='number'){params.variantId=this.getContent().parentVariantId;}
Ext.Ajax.request({url:(typeof(this.getContent().parentVariantId)=='number')?this.removeSubVariantURL:this.removeURL,scope:this,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){if(0===decodedResponse.noOfVariantsLeft){this.wasLastVariant=true;}
this.fireEvent('MSG','deletesuccess',this);}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this,'removeVariant');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this,'removeVariant');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this,'removeVariant');}},params:params});}},this);},initOrderCodeMonitor:function(el){try{this.orderCodeEl=(typeof(el)!='undefined'&&el!==null)?el:Ext.get(this.getContent().clazz+'.'+this.getContent().id+'.orderCode');if(typeof(this.orderCodeEl)=='undefined'&&this.orderCodeEl===null){if(this.DBG){FATAL('ELEMENT UNDEFINED',this,'initOrderCodeMonitor');}
return;}
this.orderCodeMonitorCFG={valuePrefix:'variant_'+this.getContent().id+'_',id:this.id+'.orderCodeEditor',el:this.orderCodeEl,invalidText:''+VIEWPORT_PROPERTIES.TEXT_NOT_EANCODE,regex:/(\b([0-9]{8})\b)|(\b([0-9]{13})\b)/,handler:function(v){return(v.trim().length===8||v.trim().length===13);if(v.trim().length===8||v.trim().length===13){return true;}
return false;},allowSave:true};this.orderCodeMonitor=new Pulse.FieldMonitor(this.orderCodeMonitorCFG);this.orderCodeMonitor.validate();this.addSubEditor(this.orderCodeMonitor);}catch(e){if(this.DBG){FATAL(e,this,'initOrderCodeMonitor');}}},initNameMonitor:function(el){if(this.DBG){THROW({args:arguments},this,'initNameMonitor');}
try{this.nameEl=(typeof(el)!='undefined'&&el!==null)?el:Ext.get(this.getContent().clazz+'.'+this.getContent().id+'.name');if(typeof(this.nameEl)=='undefined'&&this.nameEl===null){if(this.DBG){FATAL('ELEMENT UNDEFINED',this,'initNameMonitor');}
return;}
this.nameMonitorCFG={valuePrefix:'variant_'+this.getContent().id+'_',id:this.id+'.nameEditor',el:this.nameEl,allowBlank:false};this.nameMonitor=new Pulse.FieldMonitor(this.nameMonitorCFG);this.nameMonitor.validate();this.addSubEditor(this.nameMonitor);}catch(e){if(this.DBG){FATAL(e,this,'initNameMonitor');}}},setTitle:function(title){if(typeof(this.masterEditor)!='undefined'&&this.masterEditor!==null){this.masterEditor.setTitle(title+' (id: '+this.getContent().id+')');}},getContent:function(){return this.variant;},initStatusBox:function(){this.statusBox=Ext.get(this.getContent().clazz+'.'+this.getContent().id+'.statusSelector');if(this.statusBox){this.statusBox.changed=false;this.statusBox.initialValue=this.statusBox.getValue();this.statusBox.valuePrefix='variant_'+this.getContent().id+'_';this.statusBox.pEditor=this;this.statusBox.on('change',function(){if(this.statusBox.initialValue==arguments[1].value){this.statusBox.changed=false;if(false===this.hasChanges()){this.statusBox.replaceClass(Pulse.fieldCls+'Yellow',Pulse.fieldCls);this.reset();}
return;}
this.statusBox.changed=true;this.statusBox.replaceClass(Pulse.fieldCls,Pulse.fieldCls+'Yellow');this.fireEvent('MSG','change',this);},this);this.statusBox.commit=function(){if(true===this.changed){this.changed=false;this.initialValue=this.getValue();this.replaceClass(Pulse.fieldCls+'Yellow',Pulse.fieldCls);}};this.statusBox.reset=function(){if(true===this.changed){this.changed=false;this.replaceClass(Pulse.fieldCls+'Yellow',Pulse.fieldCls);options=document[this.pEditor.getContent().clazz+'.'+this.pEditor.getContent().id+'.statusSelector.form']['status'];for(i=0;i<options.length;i++){if(this.initialValue==options[i].value){options[i].selected=true;}}}};}},initComponent:function(){Pulse.ShopVariantEditor.superclass.initComponent.call(this,false);try{}catch(e){FATAL(e,this,'initComponent.ShopVariantEditor');}}};Pulse.ShopVariantEditor=Ext.extend(Pulse.ShopContentEditor,ShopVariantEditor);DBG.ShopTaxGroupsEditor=DBG.apply(DBG.Editor,{getButtons:true,removeSelectedTaxgroups:true,createTaxgroup:true,addTaxGroup:true,onRender:true,buildGrid:true,hasChanges:{ShopTaxGroupsEditor:true}});ShopTaxGroupsEditor={type:'ShopTaxGroupsEditor',DBG:false,getButtons:function(){if(this.DBG){THROW({args:arguments},this,'getButtons');}
createButtonConfig={scope:this,disabled:false,text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CREATE,handler:this.createTaxgroup,iconCls:'addIconCls'};return[new Ext.Toolbar.Button(createButtonConfig),new Ext.Toolbar.Separator()];},createTaxgroup:function(){this.grid.stopEditing(true);if(this.DBG){THROW({args:arguments},this,'createTaxgroup');}
try{this.showCreateFormWindow({fields:[{fieldLabel:VIEWPORT_PROPERTIES.NAME,name:'name',emptyText:VIEWPORT_PROPERTIES.TEXT_ENTER_NAME},{fieldLabel:VIEWPORT_PROPERTIES.TAX,name:'percentage',emptyText:VIEWPORT_PROPERTIES.TEXT_ENTER_VALUE,validator:function(v){this.validates=/^(100|100.0|100.00|100.000|([0-9]?[0-9]?(\.[0-9][0-9]?[0-9]?)?))$/.test(v);return this.validates;}}],handler:'addTaxGroup'});}catch(e){if(this.DBG){FATAL(e,this,'createTaxgroup');}}},addTaxGroup:function(){if(this.DBG){THROW({args:arguments},this,'addTaxGroup');}
Record=this.getRecord();id=Ext.id();params=this.getCreateFormParams();newRec={id:id,clazz:'',name:params.name,percentage:params.percentage};this.store.addSorted(new Record(newRec));this.store.addIds.push(id);this.closeCreateFormWindow();this.fireEvent('MSG','change',this);},deleteTaxGroupDLG:function(id){Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE+':&#160;"'+'(id: '+id+')"',VIEWPORT_PROPERTIES.MSG_REALLYDELETE,function(response){if('yes'===response){this.scope.deleteTaxGroup(this.id);}},{scope:this,id:id});},deleteTaxGroup:function(id){if(this.DBG){THROW({args:arguments},this,'removeTaxGroup');}
rec=this.store.getAt(this.store.find('id',id));if(isNaN(id)){this.store.remove(rec);if(false===this.hasChanges()){this.reset();}}else{ajaxCFG={url:this.deleteURL,scope:this,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){this.store.remove(options.rec);this.fireEvent('MSG','deletesuccess',this);}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this,'deleteTaxGroup');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this,'deleteTaxGroup');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this,'deleteTaxGroup');}},rec:rec,params:{id:id}};Ext.Ajax.request(ajaxCFG);}},onRender:function(){THROW({props:['renderTo'],args:arguments},this,'onRender');try{if(typeof(this.renderTo)=='object'&&this.renderTo!==null&&this.renderTo.type=='SubEditorPanel'){this.gridId=this.id+'.gridDiv';el=this.renderTo.body.createChild({tag:'div',id:this.gridId});this.buildGrid();}else{THROW({e:'TODO',props:['renderTo'],args:arguments},this,'onRender');}}catch(e){FATAL(e,this,'onRender');}},buildGrid:function(){if(this.DBG){THROW({args:arguments,props:['gridId','url']},this,'buildGrid');}
try{this.store=this.getStore();this.addStoreListeners(this.store);columns=[{header:'id',dataIndex:'id',sortable:true,width:50,fixed:true,renderer:this.getRenderer('id')},{header:VIEWPORT_PROPERTIES.NAME,dataIndex:'name',sortable:true,editor:new Ext.form.TextField({allowBlank:false})},{header:VIEWPORT_PROPERTIES.TAX,dataIndex:'percentage',sortable:true,editor:new Ext.form.TextField({allowBlank:false,validator:function(v){this.validates=/^(100|100.0|100.00|100.000|([0-9]?[0-9]?(\.[0-9][0-9]?[0-9]?)?))$/.test(v);return this.validates;}})}];if(typeof(this.deleteURL)!='undefined'&&this.deleteURL!==''){delColCFG={header:'',dataIndex:'id',width:25,fixed:true,sortable:false,renderer:function(id,meta,rec,colIndex,rowIndex,store){try{delFieldCFG={functionString:'Ext.getCmp(\''+store.pEditor.id+'\').deleteTaxGroupDLG(\''+id+'\')',iconCls:'deleteIconCls_14',qtip:VIEWPORT_PROPERTIES.BUTTON_TEXT_DELETE};return FilterEditor.getGridImageField(delFieldCFG);}catch(renderError){return'<img src="'+Ext.BLANK_IMAGE_URL+'" width="14" height="14" '+'border="0" class="errorIconCls_14" ext:qtip="render-error: '+'try to reload ('+renderError+')"/>';}}};columns.push(delColCFG);}
this.cm=new Ext.grid.ColumnModel(columns);height=this.getHeight();plugins=[];this.grid=new Ext.grid.EditorGridPanel({pEditor:this,plugins:plugins,disabled:true,store:this.store,cm:this.cm,renderTo:this.gridId,height:height,autoExpandColumn:'id',loadMask:true,viewConfig:{forceFit:true},border:false,frame:false,clicksToEdit:1});this.grid.on('afteredit',function(evt){if(evt.value==evt.originalValue){return;}
this.fireEvent('MSG','change',this);},this);if(typeof(this.url)=='string'&&this.url!==''){this.loadStore();this.grid.enable();}}catch(e){FATAL(e,this,'buildGrid');}},loadStore:function(params){this.store.load({url:this.url,params:params});},getStore:function(){storeCFG={pEditor:this,pruneModifiedRecords:true,fields:this.getRecord(),root:'data',totalProperty:'total',baseParams:{id:this.shopSettings.id},url:'',removeIds:[],addIds:[]};if(typeof(this.url)=='string'&&this.url!==''){storeCFG.url=this.url;}else{storeCFG.data={data:[]};}
return new Ext.data.JsonStore(storeCFG);},addStoreListeners:function(store){store.on('remove',function(_store,record,index){if(isNaN(record.get('id'))){for(i=0;i<this.addIds.length;i++){if(this.addIds[i]==record.get('id')){this.addIds.splice(i,1);break;}}}
if(false===this.pEditor.hasChanges()){this.fireEvent('MSG','reset',this);}});},getRecord:function(){return new Pulse.Record.create([{name:'id'},{name:'clazz'},{name:'name'},{name:'percentage'}]);},getRenderer:function(field){try{fieldUP=field.toUpperCase();switch(fieldUP){case'ID':renderer=function(v,leftNeighBourCell,rec,rowIdx,colIdx,store){try{if(typeof(v)=='number'){return v;}else{return'*';}}catch(re){return v+' : '+re;}};break;default:FATAL(field,this,'getRenderer','NO MATCHING RENDERER');return;}
return renderer;}catch(e){FATAL(field,this,'getRenderer','CANNOT PROCESS FIELD');return;}},getHeight:function(){if(typeof(this.initialConfig.height)=='number'){return this.initialConfig.height;}
if(typeof(this.renderTo)=='object'&&this.renderTo!==null&&this.renderTo.type=='SubEditorPanel'){return this.renderTo.getInnerHeight()-1;}
if(typeof(this.grid)=='undefined'){return;}
return this.grid.getSize().height;},getChanges:function(v){if(typeof(this.valPrefix)=='undefined'){this.valPrefix='';}
v=Pulse.ShopTaxGroupsEditor.superclass.getChanges.call(this,v);if(true===this.hasChanges()){if(typeof(v)=='undefined'||v===null){v={};}
try{if(this.store.addIds.length>0){for(i=0;i<this.store.addIds.length;i++){rec=this.store.getAt(this.store.find('id',this.store.addIds[i]));prefix=this.valPrefix+'taxGroup_'+rec.get('id')+'_';for(o in rec.data){valString=prefix+o;v[valString]=rec.data[o];}}}
modRecs=this.store.getModifiedRecords();if(modRecs.length>0){for(i=0;i<modRecs.length;i++){rec=modRecs[i];prefix=this.valPrefix+'taxGroup_'+rec.get('id')+'_';if(typeof(rec.get('id'))=='string'){continue;}else{chg=rec.getChanges();for(o in chg){valString=prefix+o;v[valString]=chg[o];}}}}}catch(e){if(this.DBG){FATAL(e,this,'getChanges');}}}
return v;},hasChanges:function(){superBool=Pulse.ShopTaxGroupsEditor.superclass.hasChanges.call(this);bool=((this.store.getModifiedRecords().length>0)||(this.store.addIds.length>0));if(this.DBG){THROW({args:arguments,p:[{n:'superBool',o:superBool},{n:'bool',o:bool}]},this,'hasChanges.ShopTaxGroupsEditor');}
return superBool||bool;},commit:function(v){Pulse.ShopTaxGroupsEditor.superclass.commit.call(this);this.store.commitChanges();this.store.addIds=[];this.fireEvent('MSG','commit',this);},reset:function(){Pulse.ShopTaxGroupsEditor.superclass.reset.call(this);this.store.rejectChanges();this.store.addIds=[];this.fireEvent('MSG','reset',this);}};Pulse.ShopTaxGroupsEditor=Ext.extend(Pulse.Editor,ShopTaxGroupsEditor);PULSE.GroupAnalysisTreeNodeUI=function(){PULSE.GroupAnalysisTreeNodeUI.superclass.constructor.apply(this,arguments);};Ext.extend(PULSE.GroupAnalysisTreeNodeUI,Ext.tree.TreeNodeUI,{cellwidth:'75px',cellbordercolor:'#99BBE8',renderElements:function(n,a,targetNode,bulkRender){this.indentMarkup=n.parentNode?n.parentNode.ui.getChildIndent():'';var href=a.href?a.href:Ext.isGecko?"":"#";var buf=['<li class="x-tree-node">','<div ext:tree-node-id="',n.id,'" class="x-tree-node-el x-tree-node-leaf ',a.cls,'" style="border-bottom:1px dotted '
+this.cellbordercolor+';',(n.parentNode===null)?'border-top:1px dotted '
+this.cellbordercolor+';">':'">','<span class="x-tree-node-indent">',this.indentMarkup,'</span>','<img src="',this.emptyIcon,'" class="x-tree-ec-icon x-tree-elbow" />','<a hidefocus="on" class="x-tree-node-anchor" href="',href,'" tabIndex="1" ',a.hrefTarget?' target="'+a.hrefTarget+'"':'',' dir="LTR"><span unselectable="on">',n.text,'</span></a>','<div style="float:right;margin:0;padding:0;',(true===Ext.isGecko||true===Ext.isIE7)?'position:relative;top:-18px;margin:0 0 -18px 0;">':'">',this.createField(a.leaves),this.createField(a.entries),this.createField(a.childBounces),this.createField(a.bounces),this.createField(a.childHits),this.createField(a.hits),this.createField(parseInt(a.hits,10)
+parseInt(a.childHits,10)),'</div>','</div>','<ul class="x-tree-node-ct" style="display:none;"></ul>','</li>'].join('');if(bulkRender!==true&&n.nextSibling&&n.nextSibling.ui.getEl()){this.wrap=Ext.DomHelper.insertHtml("beforeBegin",n.nextSibling.ui.getEl(),buf);}else{this.wrap=Ext.DomHelper.insertHtml("beforeEnd",targetNode,buf);}
this.elNode=this.wrap.childNodes[0];this.ctNode=this.wrap.childNodes[1];var cs=this.elNode.childNodes;this.indentNode=cs[0];this.ecNode=cs[1];this.anchor=cs[2];this.textNode=cs[2].firstChild;},createField:function(string){return'<div style="border-left:1px dotted '+this.cellbordercolor
+';padding:0 4px 0 4px;width:'+this.cellwidth
+';float:right;margin:0;">'+string+'</div>';},beforeLoad:function(){if(this.textNode){Ext.fly(this.textNode).setStyle('font-style','italic');}},afterLoad:function(){if(this.textNode){Ext.fly(this.textNode).setStyle('font-style','normal');}},updateExpandIcon:function(){if(this.rendered){var n=this.node,c1,c2;var cls=n.isLast()?"x-tree-elbow-end":"x-tree-elbow";var hasChild=n.hasChildNodes();if((hasChild||n.attributes.expandable)&&n.attributes.expandable!=='false'){if(n.expanded){cls+="-minus";c1="x-tree-node-collapsed";c2="x-tree-node-expanded";}else{cls+="-plus";c1="x-tree-node-expanded";c2="x-tree-node-collapsed";}
if(this.wasLeaf){this.removeClass("x-tree-node-leaf");this.wasLeaf=false;}
if(this.c1!=c1||this.c2!=c2){Ext.fly(this.elNode).replaceClass(c1,c2);this.c1=c1;this.c2=c2;}}else{if(!this.wasLeaf){Ext.fly(this.elNode).replaceClass("x-tree-node-expanded","x-tree-node-leaf");delete this.c1;delete this.c2;this.wasLeaf=true;}}
var ecc="x-tree-ec-icon "+cls;if(this.ecc!=ecc){this.ecNode.className=ecc;this.ecc=ecc;}}}});PULSE.GroupAnalysisRootTreeNodeUI=function(){PULSE.GroupAnalysisRootTreeNodeUI.superclass.constructor.apply(this,arguments);};Ext.extend(PULSE.GroupAnalysisRootTreeNodeUI,PULSE.GroupAnalysisTreeNodeUI,{render:function(){if(!this.rendered){targetNode=this.node.ownerTree.innerCt.dom;this.node.expanded=true;targetNode.innerHTML='<div class="x-tree-root-node"></div>';this.wrap=this.ctNode=targetNode.firstChild;}},collapse:function(){},expand:function(){}});PULSE.RefererAnalysisTreeNodeUI=function(){PULSE.RefererAnalysisTreeNodeUI.superclass.constructor.apply(this,arguments);};Ext.extend(PULSE.RefererAnalysisTreeNodeUI,Ext.tree.TreeNodeUI,{cellbordercolor:'#99BBE8',renderElements:function(n,a,targetNode,bulkRender){this.indentMarkup=n.parentNode?n.parentNode.ui.getChildIndent():'';var href=a.href?a.href:Ext.isGecko?"":"#";var buf=['<li class="x-tree-node">','<div ext:tree-node-id="',n.id,'" class="x-tree-node-el x-tree-node-leaf ',a.cls,'" style="border-bottom:1px dotted '
+this.cellbordercolor+';',(n.parentNode===null)?'border-top:1px dotted '
+this.cellbordercolor+';">':'">','<span class="x-tree-node-indent">',this.indentMarkup,'</span>','<img src="',this.emptyIcon,'" class="x-tree-ec-icon x-tree-elbow" />','<a hidefocus="on" class="x-tree-node-anchor" href="',href,'" tabIndex="1" ',a.hrefTarget?' target="'+a.hrefTarget+'"':'',' dir="LTR"><span unselectable="on">',n.text,'</span></a>','<div style="float:right;width:60%;margin:0;padding:0;',(true===Ext.isGecko||true===Ext.isIE7)?'position:relative;top:-18px;margin:0 0 -18px 0;">':'">',this.createField(a.hits),'</div>',"</div>",'<ul class="x-tree-node-ct" style="display:none;"></ul>',"</li>"].join('');if(bulkRender!==true&&n.nextSibling&&n.nextSibling.ui.getEl()){this.wrap=Ext.DomHelper.insertHtml("beforeBegin",n.nextSibling.ui.getEl(),buf);}else{this.wrap=Ext.DomHelper.insertHtml("beforeEnd",targetNode,buf);}
this.elNode=this.wrap.childNodes[0];this.ctNode=this.wrap.childNodes[1];var cs=this.elNode.childNodes;this.indentNode=cs[0];this.ecNode=cs[1];this.anchor=cs[2];this.textNode=cs[2].firstChild;},createField:function(string){return'<div style="border-left:1px dotted '
+this.cellbordercolor
+';padding:0 4px 0 4px;float:left;">'+string
+'</div>';},beforeLoad:function(){if(this.textNode){Ext.fly(this.textNode).setStyle('font-style','italic');}},afterLoad:function(){if(this.textNode){Ext.fly(this.textNode).setStyle('font-style','normal');}},updateExpandIcon:function(){if(this.rendered){var n=this.node,c1,c2;var cls=n.isLast()?"x-tree-elbow-end":"x-tree-elbow";var hasChild=n.hasChildNodes();if((hasChild||n.attributes.expandable)&&n.attributes.expandable!=='false'){if(n.expanded){cls+="-minus";c1="x-tree-node-collapsed";c2="x-tree-node-expanded";}else{cls+="-plus";c1="x-tree-node-expanded";c2="x-tree-node-collapsed";}
if(this.wasLeaf){this.removeClass("x-tree-node-leaf");this.wasLeaf=false;}
if(this.c1!=c1||this.c2!=c2){Ext.fly(this.elNode).replaceClass(c1,c2);this.c1=c1;this.c2=c2;}}else{if(!this.wasLeaf){Ext.fly(this.elNode).replaceClass("x-tree-node-expanded","x-tree-node-leaf");delete this.c1;delete this.c2;this.wasLeaf=true;}}
var ecc="x-tree-ec-icon "+cls;if(this.ecc!=ecc){this.ecNode.className=ecc;this.ecc=ecc;}}}});PULSE.RefererAnalysisRootTreeNodeUI=function(){PULSE.RefererAnalysisRootTreeNodeUI.superclass.constructor.apply(this,arguments);};Ext.extend(PULSE.RefererAnalysisRootTreeNodeUI,PULSE.RefererAnalysisTreeNodeUI,{render:function(){if(!this.rendered){targetNode=this.node.ownerTree.innerCt.dom;this.node.expanded=true;targetNode.innerHTML='<div class="x-tree-root-node"></div>';this.wrap=this.ctNode=targetNode.firstChild;}},collapse:function(){},expand:function(){}});Pulse.UserStatistics={open:function(url,title){PULSE_VIEWPORT_CONTROLLER.openTab({id:'Pulse.UserStatistics',title:title,iconCls:'statisticsIconCls',loadParams:{url:url}});},insertPDFExportButton:function(url,text){Pulse.Statistics.insertExportButton(url,text,'Pulse.UserStatistics','PDF');}};Pulse.Statistics={open:function(url,title){PULSE_VIEWPORT_CONTROLLER.openTab({id:'Pulse.Statistics',title:title,iconCls:'statisticsIconCls',loadParams:{url:url}});},getBaseParams:function(){return{serverId:Pulse.Statistics.serverSelector.getValue()};},initStatisticsOverView:function(url,title){PULSE_VIEWPORT_CONTROLLER.openTab({id:'Pulse.Statistics.OverView.'
+Pulse.Statistics.serverSelector.getValue(),title:'<span style="color:blue;float:left;">'
+Pulse.Statistics.serverSelector.getTextFieldValue()+'</span> - '+title,iconCls:'statisticsIconCls',loadParams:{url:url,params:Pulse.Statistics.getBaseParams()}});},initStatisticsGroupAnalysisView:function(url,title){PULSE_VIEWPORT_CONTROLLER.openTab({id:'Pulse.Statistics.GroupAnalysisView.'
+Pulse.Statistics.serverSelector.getValue(),title:'<span style="color:blue;float:left;">'
+Pulse.Statistics.serverSelector.getTextFieldValue()+'</span> - '+title,iconCls:'statisticsIconCls',loadParams:{url:url,params:Pulse.Statistics.getBaseParams()}});},initStatisticsTimeAnalysisView:function(url,title){PULSE_VIEWPORT_CONTROLLER.openTab({id:'Pulse.Statistics.TimeAnalysisView.'
+Pulse.Statistics.serverSelector.getValue(),title:'<span style="color:blue;float:left;">'
+Pulse.Statistics.serverSelector.getTextFieldValue()+'</span> - '+title,iconCls:'statisticsIconCls',loadParams:{url:url,params:Pulse.Statistics.getBaseParams()}});},initStatisticsTechnicalInformationView:function(url,title){PULSE_VIEWPORT_CONTROLLER.openTab({id:'Pulse.Statistics.TechnicalInformationView.'
+Pulse.Statistics.serverSelector.getValue(),title:'<span style="color:blue;float:left;">'
+Pulse.Statistics.serverSelector.getTextFieldValue()+'</span> - '+title,iconCls:'statisticsIconCls',loadParams:{url:url,params:Pulse.Statistics.getBaseParams()}});},initStatisticsRefererAnalysisView:function(url,title){PULSE_VIEWPORT_CONTROLLER.openTab({id:'Pulse.Statistics.RefererAnalysisView.'
+Pulse.Statistics.serverSelector.getValue(),title:'<span style="color:blue;float:left;">'
+Pulse.Statistics.serverSelector.getTextFieldValue()+'</span> - '+title,iconCls:'statisticsIconCls',loadParams:{url:url,params:Pulse.Statistics.getBaseParams()}});},initServerSelector:function(options){if(typeof(Pulse.Statistics.serverSelector)!='undefined'&&Pulse.Statistics.serverSelector instanceof Ext.form.ComboBox){return;}
spacer=Ext.getCmp(options.westPanelId).getTopToolbar().insertButton(0,new Ext.Toolbar.Spacer());el=Ext.get(spacer.getEl()).insertHtml('beforeBegin','<div> </div>',true);data=Pulse.Statistics.buildServerSelectorData(options.servers);Pulse.Statistics.serverSelector=new Ext.form.ComboBox({renderTo:el,store:new Ext.data.SimpleStore({fields:['id','hostName'],sortInfo:{field:'hostName',direction:"ASC"},data:data}),displayField:'hostName',valueField:'id',mode:'local',triggerAction:'all',editable:false,allowBlank:false,forceSelection:true,listWidth:200});Pulse.Statistics.serverSelector.getTextFieldValue=function(){return this.el.getValue();};if(data.length>0){Pulse.Statistics.serverSelector.setValue(data[0][0]);}},buildServerSelectorData:function(servers){serversData=[];for(var i=0;i<servers.length;i++){serversData.push([servers[i].id.toString(),servers[i].hostName]);}
return serversData;},insertExportButton:function(url,text,tabId,type){tab=Ext.getCmp(tabId);scope={url:url,tabId:tabId};buttonCfg={id:tabId+'.export.'+type,text:(typeof(text)=='string'&&text!=='')?text:type,scope:scope,handler:function(){tab=Ext.getCmp(this.tabId);if(typeof(tab)=='undefined'||typeof(tab.statisticsToolbar)=='undefined'){document.location.href=this.url;return;}
document.location.href=tab.statisticsToolbar.appendDuration(this.url);},iconCls:'file'+type+'IconCls',disabled:true};if(typeof(url)=='string'&&url!==''){buttonCfg.disabled=false;}
tab.getTopToolbar().insertButton(0,new Ext.Toolbar.Separator());tab.getTopToolbar().insertButton(0,buttonCfg);},initStatisticsToolbar:function(options){loadButtonCfg={scope:options.tab,handler:function(){if(typeof(this.pulseLoadConfig.loadParams.params)=='object'){this.pulseLoadConfig.loadParams.params.duration=this.statisticsToolbar.getDuration();if(typeof(this.statisticsToolbar.getResolution)=='function'){this.pulseLoadConfig.loadParams.params.resolution=this.statisticsToolbar.getResolution();}}else{params={duration:this.statisticsToolbar.getDuration};if(typeof(this.statisticsToolbar.getResolution())=='function'){params.resolution=this.statisticsToolbar.getResolution();}
this.pulseLoadConfig.loadParams.params=params;}
PULSE_VIEWPORT_CONTROLLER.reloadTab(this);},iconCls:'arrowForwardIconCls'};loadPeriodButtonCfg={iconCls:'arrowForwardIconCls',handler:function(){this.showMenu();},menu:{items:[{scope:options.tab,text:'DAY',handler:function(){if(typeof(this.pulseLoadConfig.loadParams.params)=='object'){this.pulseLoadConfig.loadParams.params.duration='DAY';if(typeof(this.statisticsToolbar.getResolution)=='function'){this.pulseLoadConfig.loadParams.params.resolution=this.statisticsToolbar.getResolution();}}else{params={duration:'DAY'};if(typeof(this.statisticsToolbar.getResolution())=='function'){params.resolution=this.statisticsToolbar.getResolution();}
this.pulseLoadConfig.loadParams.params=params;}
PULSE_VIEWPORT_CONTROLLER.reloadTab(this);}},{scope:options.tab,text:'WEEK',handler:function(){if(typeof(this.pulseLoadConfig.loadParams.params)=='object'){this.pulseLoadConfig.loadParams.params.duration='WEEK';if(typeof(this.statisticsToolbar.getResolution)=='function'){this.pulseLoadConfig.loadParams.params.resolution=this.statisticsToolbar.getResolution();}}else{params={duration:'WEEK'};if(typeof(this.statisticsToolbar.getResolution())=='function'){params.resolution=this.statisticsToolbar.getResolution();}
this.pulseLoadConfig.loadParams.params=params;}
PULSE_VIEWPORT_CONTROLLER.reloadTab(this);}},{scope:options.tab,text:'MONTH',handler:function(){if(typeof(this.pulseLoadConfig.loadParams.params)=='object'){this.pulseLoadConfig.loadParams.params.duration='MONTH';if(typeof(this.statisticsToolbar.getResolution)=='function'){this.pulseLoadConfig.loadParams.params.resolution=this.statisticsToolbar.getResolution();}}else{params={duration:'MONTH'};if(typeof(this.statisticsToolbar.getResolution())=='function'){params.resolution=this.statisticsToolbar.getResolution();}
this.pulseLoadConfig.loadParams.params=params;}
PULSE_VIEWPORT_CONTROLLER.reloadTab(this);}},{scope:options.tab,text:'YEAR',handler:function(){if(typeof(this.pulseLoadConfig.loadParams.params)=='object'){this.pulseLoadConfig.loadParams.params.duration='YEAR';if(typeof(this.statisticsToolbar.getResolution)=='function'){this.pulseLoadConfig.loadParams.params.resolution=this.statisticsToolbar.getResolution();}}else{params={duration:'YEAR'};if(typeof(this.statisticsToolbar.getResolution())=='function'){params.resolution=this.statisticsToolbar.getResolution();}
this.pulseLoadConfig.loadParams.params=params;}
PULSE_VIEWPORT_CONTROLLER.reloadTab(this);}}]}};statisticsToolbar={getDuration:function(){return this.dateFromField.getValue(true).getTime()+'-'
+this.dateToField.getValue(true).getTime();},appendDuration:function(url){if(typeof(url)!='string'||url===''){throw(this+'.appendDuration(url): Invalid url given');}
if(url.indexOf('?')===-1){return url+'?duration='+this.getDuration();}else{return url+'&duration='+this.getDuration();}}};options.tab.getTopToolbar().insertButton(0,new Ext.Toolbar.Separator());options.tab.getTopToolbar().insertButton(0,new Ext.Toolbar.SplitButton(loadPeriodButtonCfg));options.tab.getTopToolbar().insertButton(0,new Ext.Toolbar.Separator());options.tab.getTopToolbar().insertButton(0,new Ext.Toolbar.Button(loadButtonCfg));options.tab.getTopToolbar().insertButton(0,new Ext.Toolbar.TextItem('&#160;'));spacer_To=options.tab.getTopToolbar().insertButton(0,new Ext.Toolbar.Spacer());el_To=Ext.get(spacer_To.getEl()).insertHtml('beforeBegin','<div> </div>',true);statisticsToolbar.dateToField=new Pulse.Statistics.DateField({renderTo:el_To,allowBlank:false,readOnly:true,width:175,setValueModeEnd:true});options.tab.getTopToolbar().insertButton(0,new Ext.Toolbar.TextItem('&#160;-&#160;'));spacer_From=options.tab.getTopToolbar().insertButton(0,new Ext.Toolbar.Spacer());el_From=Ext.get(spacer_From.getEl()).insertHtml('beforeBegin','<div> </div>',true);statisticsToolbar.dateFromField=new Pulse.Statistics.DateField({renderTo:el_From,allowBlank:false,readOnly:true,width:175});fDate=new Date(options.from);fDate.isFromServer=true;statisticsToolbar.dateFromField.setValue(fDate);tDate=new Date(options.to);tDate.isFromServer=true;statisticsToolbar.dateToField.setValue(tDate);if(true===Ext.isArray(options.resolutions)){options.tab.getTopToolbar().insertButton(0,new Ext.Toolbar.TextItem('&#160;'));spacer_Resolutions=options.tab.getTopToolbar().insertButton(0,new Ext.Toolbar.Spacer());el_Resolutions=Ext.get(spacer_Resolutions.getEl()).insertHtml('beforeBegin','<div> </div>',true);statisticsToolbar.resolutionsField=new Ext.form.ComboBox({renderTo:el_Resolutions,store:new Ext.data.SimpleStore({fields:['resolution'],sortInfo:{field:'resolution',direction:"ASC"},data:options.resolutions}),displayField:'resolution',valueField:'resolution',mode:'local',triggerAction:'all',allowBlank:false,readOnly:true,forceSelection:true,width:70});statisticsToolbar.getResolution=function(){return this.resolutionsField.getValue();};if(typeof(options.resolution)=='string'&&options.resolution!==''){statisticsToolbar.resolutionsField.setValue(options.resolution);}
options.tab.getTopToolbar().insertButton(0,new Ext.Toolbar.TextItem('res:&#160;'));}
if(Ext.isArray(options.exports)&&options.exports.length>0){for(var i=0;i<options.exports.length;i++){Pulse.Statistics.insertExportButton(options.exports[i].url,options.exports[i].text,options.tab.id,options.exports[i].type);}}
options.tab.statisticsToolbar=statisticsToolbar;if(typeof(options.clearSessionDataURL)=='string'&&options.clearSessionDataURL!==''){options.tab.on('destroy',function(){Ext.Ajax.request({url:this.clearSessionDataURL,method:'POST',params:{serverId:this.serverId}});},options);}},initGFXel:function(options){if(typeof(options)!='object'||options===null){return;}
if(typeof(options.url)!='string'||options.url===''){return;}
div=Ext.get(options.id);strParams='serverId='+options.serverId;strParams+='&duration='+options.tab.statisticsToolbar.getDuration();src=options.url;if(src.indexOf('?')===-1){src+='?'+strParams;}else{src+='&'+strParams;}
src+='&'+new Date().getTime();div.elLoadOptions={src:src,xy:(typeof(options.xy)!='number')?1/2:options.xy,widthOffset:options.widthOffset};options.tab.on('resize',function(){Pulse.Statistics.loadGFXel(this);},div);Pulse.Statistics.loadGFXel(div);},loadGFXel:function(el,additionalOptions){if(typeof(el.elLoadOptions)!='object'||el.elLoadOptions===null){throw({e:el+'.elLoadOptions UNDEFINED',description:'Given el.elLoadOptions must not be undefined or null!'});}
options=el.elLoadOptions;width=el.getSize().width-25;if(typeof(options.widthOffset)=='number'){width-=options.widthOffset;}
src=options.src+'&width='+Math.ceil(width)+'&height='
+Math.ceil(width*options.xy);if(typeof(additionalOptions)=='object'&&additionalOptions!==null){for(var option in additionalOptions){if(Pulse.Statistics.isValidAdditionalOption(additionalOptions[option])){src+='&'+option+'='+additionalOptions[option];}}}
(function(){this.el.update('<img src="'+this.src+'" width="'+this.width
+'" '+'height="'+this.height
+'" style="border:0;padding:0;margin:0;"/>');}).defer(500,{el:el,src:src,width:Math.ceil(width),height:Math.ceil(width*options.xy)});},isValidAdditionalOption:function(value){if(typeof(value)=='string'){return true;}
if(typeof(value)=='number'){return true;}
if(typeof(value)=='boolean'){return true;}
return false;}};Pulse.Statistics.DateField=Ext.extend(Ext.form.DateField,{setValue:function(date){if(true===date.isFromServer){this.date=date;}else{this.date=new Date(date.getFullYear(),date.getMonth(),date.getDate(),0,0,0,0);this.date.setTime(this.date.getTime()
-(this.date.getTimezoneOffset()*60000));if(this.setValueModeEnd===true){this.date.setUTCMilliseconds(999);this.date.setUTCSeconds(59);this.date.setUTCMinutes(59);this.date.setUTCHours(23);}else{this.date.setUTCMilliseconds(0);this.date.setUTCSeconds(0);this.date.setUTCMinutes(0);this.date.setUTCHours(0);}}
this.setRawValue(this.date.toUTCString());},validateValue:function(){return true;},getValue:function(bool){if(true===bool){return this.date;}
if(this.date instanceof Date){return new Date(this.date.getUTCFullYear(),this.date.getUTCMonth(),this.date.getUTCDate());}}});Pulse.StatisticsTrees={FIVE_MINUTES:1000*60*5,initGroupAnalysisView:function(options){loaderConf={dataUrl:options.dataURL,uiProviders:{'GroupAnalysisTreeNodeUI':PULSE.GroupAnalysisTreeNodeUI},baseParams:{serverId:options.server.id,duration:options.duration}};loader=new Pulse.StatisticsTrees.Loader(loaderConf);loader.on('beforeload',function(loader,node,callback){this.tab.disable();},options);loader.on('load',function(loader,node,response){if(true===loader.baseParams.loadMaximumNumberOfNodes){delete loader.baseParams.loadMaximumNumberOfNodes;}
this.tab.enable();},options);loader.on('loadexception',function(loader,node,response){if(true===loader.baseParams.loadMaximumNumberOfNodes){delete loader.baseParams.loadMaximumNumberOfNodes;}
try{var res=eval("("+response.responseText+")");if(typeof(res.error)=='object'&&res.error!==null){if(res.error['@type']=='EXCEEDS_MAX_NODES_TO_BE_DISPLAYED'){this.node=node;Ext.Msg.confirm(res.error['@type'],'This node has <b>'
+res.error.message
+'</b> children, but the display limit is: <b>'
+res.configuration['max-nodes-to-be-displayed']
+'</b>.<br/><br/>If you continue <b>'
+res.configuration['max-nodes-to-be-displayed']
+'</b> nodes will be loaded.'
+'<br/><br/>Do you want to continue?',function(text){if(text==='yes'){this.node.getOwnerTree().getLoader().baseParams.loadMaximumNumberOfNodes=true;this.node.reload();}else{this.node.collapse();this.node.loaded=false;this.tab.enable();}},this);return;}else{throw({name:res.error['@type'],description:res.error.message});}}else{throw({description:'An undefined loader exception has occurred.\n'});}}catch(e){descr='';if(typeof(e.description)!='undefined'){descr+=e.description;}
if(typeof(e.message)!='undefined'){if(descr!==''){descr+='; ';}
descr+=e.message;}
if(typeof(e)=='object'&&typeof(e.name)=='string'&&e.name!==''){Ext.Msg.alert('error',e.name+': '+descr,function(){this.tab.enable();},this);}else{eString='';if(typeof(e)=='object'&&e!==null){for(var o in e){if(typeof(e[o])!='function'){eString+='<br/>{'+o+'}: '+e[o];}}}else{eString+='<br/>'+e;}
Ext.Msg.alert('error','An error has occured: '+descr
+eString,function(){this.tab.enable();},this);}}},options);root=new Ext.tree.AsyncTreeNode({text:'',draggable:false,allowDrop:false,id:'root.'+options.server.id});tree=new Ext.tree.TreePanel({id:options.renderTo+'.tree',renderTo:options.renderTo,autoScroll:true,autoHeight:true,animate:true,enableDD:false,containerScroll:true,rootVisible:false,border:false,bodyStyle:'margin:0px;padding:0px;',loader:loader,root:root});if(Pulse.StatisticsTrees.isURL(options.contextMenu.deleteNodeURL)||Pulse.StatisticsTrees.isURL(options.contextMenu.degunkNodeURL)){tree.menu=new Ext.menu.Menu({items:[{text:options.contextMenu.deleteNodeText,disabled:!Pulse.StatisticsTrees.isURL(options.contextMenu.deleteNodeURL),scope:{tree:tree,options:options},handler:function(){this.node=this.tree.selectedNode;Ext.Msg.confirm(this.tree.selectedNode.text,'Do you really want to delete: <b>'
+this.tree.selectedNode.text
+'</b>?<br/><br/>This change <b>cannot</b> be reverted.',function(text){if('yes'===text){Pulse.StatisticsTrees.deleteNodeGroupAnalysisView(this);}},this);}},{text:options.contextMenu.degunkNodeText,disabled:!Pulse.StatisticsTrees.isURL(options.contextMenu.degunkNodeURL),scope:{tree:tree,options:options},handler:function(){this.node=this.tree.selectedNode;Pulse.StatisticsTrees.showNodeGroupAnalysisViewDialog(this);}}]});tree.menu.on('hide',function(){delete this.selectedNode;},tree);tree.on('contextmenu',function(node,evt){this.tree.selectedNode=node;this.tree.menu.show(node.ui.getTextEl());},{tree:tree,options:options});}
root.expand();},deleteNodeGroupAnalysisView:function(context){context.options.tab.disable();Ext.Ajax.request({url:context.options.contextMenu.deleteNodeURL,method:'POST',scope:context,success:function(response,options){this.options.tab.enable();decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){Pulse.StatisticsTrees.statisticsExpandContext={node:this.node.parentNode.parentNode,id:this.node.parentNode.id};this.node.parentNode.parentNode.reload(function(){node=Pulse.StatisticsTrees.statisticsExpandContext.node.findChild('id',Pulse.StatisticsTrees.statisticsExpandContext.id);if(typeof(node)=='object'&&node!==null){node.expand();node.select();}
delete Pulse.StatisticsTrees.statisticsExpandContext;});}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this.type,'statistics.deleteNodeGroupAnalysisView');}},failure:function(response,options){this.options.tab.enable();if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this.type,'statistics.deleteNodeGroupAnalysisView');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this.type,'statistics.deleteNodeGroupAnalysisView');}},params:{id:context.node.id}});},showNodeGroupAnalysisViewDialog:function(context){Ext.Msg.prompt(context.node.text,'Do you really want to degunk: <b>'
+context.node.text
+'</b>?<br/><br/>This change <b>cannot</b> be reverted.'
+'<br/><br/>This operation may take a while - '
+'<br/>depending on the number of child leaf nodes...'
+'<br/><br/>Number of leafs to keep:',function(text,value){if('ok'===text){Pulse.StatisticsTrees.degunkNodeGroupAnalysisView(this,value);}},context,false,'0');},degunkNodeGroupAnalysisView:function(context,value){if(isNaN(value)||value<0){Ext.Msg.alert('error','Only numeric values &gt;= 0 are allowed!',function(){Pulse.StatisticsTrees.showNodeGroupAnalysisViewDialog(this);},context);return;}
context.options.tab.disable();Ext.Ajax.request({url:context.options.contextMenu.degunkNodeURL,method:'POST',scope:context,timeout:2*Pulse.StatisticsTrees.FIVE_MINUTES,success:function(response,options){this.options.tab.enable();decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){Pulse.StatisticsTrees.statisticsExpandContext={node:this.node.parentNode,id:this.node.id};this.node.parentNode.reload(function(){node=Pulse.StatisticsTrees.statisticsExpandContext.node.findChild('id',Pulse.StatisticsTrees.statisticsExpandContext.id);if(typeof(node)=='object'&&node!==null){node.expand();node.select();}
delete Pulse.StatisticsTrees.statisticsExpandContext;});}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this.type,'statistics.degunkNodeGroupAnalysisView');}},failure:function(response,options){this.options.tab.enable();if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this.type,'statistics.degunkNodeGroupAnalysisView');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this.type,'statistics.degunkNodeGroupAnalysisView');}},params:{id:context.node.id,keep:value}});},initRefererAnalysisView:function(options){loaderConf={dataUrl:options.dataURL,uiProviders:{'RefererAnalysisTreeNodeUI':PULSE.RefererAnalysisTreeNodeUI},baseParams:{serverId:options.server.id,duration:options.duration}};loader=new Pulse.StatisticsTrees.Loader(loaderConf);loader.on('beforeload',function(loader,node,callback){this.tab.disable();},options);loader.on('load',function(loader,node,response){this.tab.enable();},options);loader.on('loadexception',function(loader,node,response){try{var res=eval("("+response.responseText+")");if(typeof(res.error)=='object'&&res.error!==null){throw({name:res.error['@type'],description:res.error.message});}else{throw({description:'An undefined loader exception has occurred.\n'});}}catch(e){descr='';if(typeof(e.description)!='undefined'){descr+=e.description;}
if(typeof(e.message)!='undefined'){if(descr!==''){descr+='; ';}
descr+=e.message;}
if(typeof(e)=='object'&&typeof(e.name)=='string'&&e.name!==''){Ext.Msg.alert('error',e.name+': '+descr,function(){this.tab.enable();},this);}else{eString='';if(typeof(e)=='object'&&e!==null){for(var o in e){if(typeof(e[o])!='function'){eString+='<br/>{'+o+'}: '+e[o];}}}else{eString+='<br/>'+e;}
Ext.Msg.alert('error','An error has occured: '+descr
+eString,function(){this.tab.enable();},this);}}},options);root=new Ext.tree.AsyncTreeNode({text:'',draggable:false,allowDrop:false,id:'root.'+options.server.id});tree=new Ext.tree.TreePanel({id:options.renderTo+'.tree',renderTo:options.renderTo,autoScroll:true,autoHeight:true,animate:true,enableDD:false,containerScroll:true,rootVisible:false,border:false,bodyStyle:'margin:0px;padding:0px;',loader:loader,root:root});root.expand();},isURL:function(string){if(typeof(string)!='string'||string===''){return false;}
if(string.indexOf('http')!==0&&string.indexOf('/')!==0){return false;}
return true;}};Pulse.StatisticsTrees.Loader=Ext.extend(Ext.tree.TreeLoader,{processResponse:function(response,node,callback){var json=response.responseText;try{var res=eval("("+json+")");o=[];if(null!==res.data.nodes){o=(Ext.isArray(res.data.nodes.node))?res.data.nodes.node:[res.data.nodes.node];}
node.beginUpdate();for(var i=0,len=o.length;i<len;i++){var n=this.createNode(o[i]);if(n){node.appendChild(n);}}
node.endUpdate();if(typeof(callback)=="function"){callback(this,node);}}catch(e){this.handleFailure(response);}},requestData:function(node,callback){if(this.fireEvent("beforeload",this,node,callback)!==false){this.transId=Ext.Ajax.request({method:this.requestMethod,url:this.dataUrl||this.url,success:this.handleResponse,failure:this.handleFailure,scope:this,argument:{callback:callback,node:node},params:this.getParams(node),timeout:Pulse.StatisticsTrees.FIVE_MINUTES});}else{if(typeof callback=="function"){callback();}}}});Pulse.util={type:'Pulse.util',DBG:{openRetailerOverview:false,openRepresentativeOverview:false},openRetailerOverview:function(url){if(this.DBG){THROW({args:arguments},this,'openRetailerOverview');}
PULSE_VIEWPORT_CONTROLLER.openTab({id:'Pulse.util.retailers.overview',title:'...loading',loadParams:{url:url}});},openRepresentativeOverview:function(url){if(this.DBG){THROW({args:arguments},this,'openRepresentativeOverview');}
PULSE_VIEWPORT_CONTROLLER.openTab({id:'Pulse.util.representatives.overview',title:'...loading',loadParams:{url:url}});}};Pulse.util.FieldBuilder={component:'util',type:'FieldBuilder',DBG:false,buildSelectBoxMonitor:function(el,config){try{width=config.width;if(typeof(width)!='number'&&typeof(width)!='string'){width='95%';}else if(typeof(width)=='number'){width+='px';}
field=['<select size="1" class="editorInputField" name="'+config.name+'"','style="padding:1px 1px 1px 1px;width:'+width+';">'];if(typeof(config.object)!='undefined'){objectValue=config.object[config.name];}
for(var i=0;i<config.options.length;i++){if(typeof(config.options[i])=='undefined'||typeof(config.options[i].value)=='undefined'){throw({e:'CONFIGURATION.EXECPTION',description:'buildSelectBoxMonitor',o:this});}
option='<option value="'+config.options[i].value+'" ';if(typeof(objectValue)!='undefined'&&objectValue==config.options[i].value){option+='selected="selected">';}else{option+='>';}
if(typeof(config.options[i].name)=='string'){option+=config.options[i].name;}else{option+=config.options[i].value;}
option+='</option>';field.push(option);}
field.push('</select>');fieldEl=el.insertHtml('afterBegin',field.join(''),true);monitorCFG={id:Ext.id()+'.'+config.name,el:fieldEl,getChangesAlways:(typeof(config.getChangesAlways)=='boolean')?config.getChangesAlways:false};monitor=new Pulse.SelectBoxEditorWrapper(monitorCFG);if(typeof(config.editor)!='object'){return monitor;}
config.editor.addSubEditor(monitor);return monitor;}catch(e){FATAL(e,this,'buildSelectBoxMonitor');}},buildTextFieldMonitor:function(el,config){try{width=config.width;if(typeof(width)!='number'&&typeof(width)!='string'){width='95%';}else if(typeof(width)=='number'){width+='px';}
field='<input type="text" class="editorInputField" '+'name="'+config.name+'" style="padding:1px 1px 1px 1px;width:'+width+';" value="'
if(typeof(config.object)!='undefined'&&(typeof(config.object[config.name])=='string'||typeof(config.object[config.name])=='number')){field+=config.object[config.name];}
field+='"/>';fieldEl=el.insertHtml('afterBegin',field,true);monitorCFG={id:Ext.id()+'.'+config.name,el:fieldEl,showMsgFlag:(typeof(config.showMsgFlag)=='boolean')?config.showMsgFlag:false,allowBlank:(typeof(config.allowBlank)!='boolean')?false:config.allowBlank,getChangesAlways:(typeof(config.getChangesAlways)=='boolean')?config.getChangesAlways:false};monitor=new Pulse.FieldMonitor(monitorCFG);monitor.validate();if(typeof(config.editor)!='object'){return monitor;}
config.editor.addSubEditor(monitor);return monitor;}catch(e){FATAL(e,this,'buildTextFieldMonitor');}},buildCheckboxMonitor:function(el,config){try{field='<input type="checkbox" name="'+config.name+'" class="editorInputField"';if(true===config.checked){field+=' checked="checked"';}
field+='/>';fieldEl=el.insertHtml('afterBegin',field,true);monitorCFG={id:Ext.id()+'.'+name,el:fieldEl,fieldType:'checkbox',getChangesAlways:(typeof(config.getChangesAlways)=='boolean')?config.getChangesAlways:false};monitor=new Pulse.FieldMonitor(monitorCFG);if(typeof(config.editor)!='object'){return monitor;}
config.editor.addSubEditor(monitor);return monitor;}catch(e){FATAL(e,this,'buildCheckboxMonitor');}}}
DBG.RepresentativeEditor=DBG.apply(DBG.Editor,{initComponent:{RepresentativeEditor:false},onRender:false,buildEditor:false,showDBGButton:false});RepresentativeEditor={component:'util',type:'RepresentativeEditor',implementsConfigurable:true,DBG:DBG.RepresentativeEditor,saveRepresentative:function(){if(false===this.hasChanges()){return;}
if(typeof(this.requiredFieldMonitors)!='undefined'){for(var i=0;i<this.requiredFieldMonitors.length;i++){if(false===this.requiredFieldMonitors[i].validate()){return;}}}
if(typeof(this.representative)!='undefined'){params=this.getChanges({id:this.representative.id});}else{params=this.getChanges({});}
requestCFG={url:this.saveURL,scope:this,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){this.commit();if(typeof(this.masterEditor)!='undefined'){if(typeof(this.masterEditor.params)!='undefined'){this.masterEditor.params.id=decodedResponse.data.id;}else{this.masterEditor.params={id:decodedResponse.data.id};}}
this.masterEditor.loadPanel();this.fireEvent('MSG','savesuccess',this);}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this,'create');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this,'create');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this,'create');}},params:params};Ext.Ajax.request(requestCFG);},getButtons:function(){buttons=[];saveButtonCFG={scope:this,disabled:true,handler:this.saveRepresentative,iconCls:'saveIconCls',text:VIEWPORT_PROPERTIES.BUTTON_TEXT_SAVE};if(typeof(this.saveURL)=='string'&&this.saveURL!==''){saveButtonCFG.disabled=false;}
buttons.push(new Ext.Toolbar.Button(saveButtonCFG));buttons.push(new Ext.Toolbar.Separator());if(typeof(this.masterEditor)=='object'&&this.masterEditor.type=='SubEditorWindow'){closeButtonCFG={scope:this,disabled:false,handler:function(){this.masterEditor.close();},iconCls:'deleteIconCls',text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CLOSE};buttons.push(new Ext.Toolbar.Button(closeButtonCFG));buttons.push(new Ext.Toolbar.Separator());}
if(this.DBG&&true===this.DBG.showDBGButton){DBGButtonCFG={scope:this,disabled:false,handler:function(){FATAL(this,this,'DBG','DBG');},text:'DBG'}
buttons.push(new Ext.Toolbar.Button(DBGButtonCFG));buttons.push(new Ext.Toolbar.Separator());}
return buttons;},buildEditor:function(el){if(this.DBG){THROW({args:arguments,props:['renderTo']},this,'buildEditor');}
try{ids={representsRegion:Ext.id(),representsCountry:Ext.id(),representsState:Ext.id(),name:Ext.id(),nameAffix:Ext.id(),contactPerson:Ext.id(),street:Ext.id(),postalCode:Ext.id(),city:Ext.id(),state:Ext.id(),country:Ext.id(),addressAffix:Ext.id(),phoneNumber:Ext.id(),mobilePhoneNumber:Ext.id(),faxNumber:Ext.id(),email:Ext.id(),url:Ext.id()};table=['<table border="0" cellpadding="0" cellspacing="5" style="width:100">','<tr>','<td colspan="2" style="font-weight:bold;">'+VIEWPORT_PROPERTIES.UTIL_REPRESENTATIVE+'</td>','</tr>','<tr>','<td width="25%">'+VIEWPORT_PROPERTIES.UTIL_REPRESENTSREGION+':</td>','<td width="75%" id="'+ids.representsRegion+'"> </td>','</tr>','<tr>','<td width="25%">'+VIEWPORT_PROPERTIES.UTIL_REPRESENTSCOUNTRY+':</td>','<td width="75%" id="'+ids.representsCountry+'"> </td>','</tr>','<tr>','<td width="25%">'+VIEWPORT_PROPERTIES.UTIL_REPRESENTSSTATE+':</td>','<td width="75%" id="'+ids.representsState+'"> </td>','</tr>','<tr>','<td width="25%">'+VIEWPORT_PROPERTIES.UTIL_NAME+':</td>','<td width="75%" id="'+ids.name+'"> </td>','</tr>','<tr>','<td width="25%">'+VIEWPORT_PROPERTIES.UTIL_NAMEAFFIX+':</td>','<td width="75%" id="'+ids.nameAffix+'"> </td>','</tr>','<tr>','<td width="25%">'+VIEWPORT_PROPERTIES.UTIL_CONTACTPERSON+':</td>','<td width="75%" id="'+ids.contactPerson+'"> </td>','</tr>','<tr>','<td width="25%">'+VIEWPORT_PROPERTIES.UTIL_STREET+':</td>','<td width="75%" id="'+ids.street+'"> </td>','</tr>','<tr>','<td width="25%">'+VIEWPORT_PROPERTIES.UTIL_POSTALCODE+':</td>','<td width="75%" id="'+ids.postalCode+'"> </td>','</tr>','<tr>','<td width="25%">'+VIEWPORT_PROPERTIES.UTIL_CITY+':</td>','<td width="75%" id="'+ids.city+'"> </td>','</tr>','<tr>','<td width="25%">'+VIEWPORT_PROPERTIES.UTIL_STATE+':</td>','<td width="75%" id="'+ids.state+'"> </td>','</tr>','<tr>','<td width="25%">'+VIEWPORT_PROPERTIES.UTIL_COUNTRY+':</td>','<td width="75%" id="'+ids.country+'"> </td>','</tr>','<tr>','<td width="25%">'+VIEWPORT_PROPERTIES.UTIL_ADDRESSAFFIX+':</td>','<td width="75%" id="'+ids.addressAffix+'"> </td>','</tr>','<tr>','<td width="25%">'+VIEWPORT_PROPERTIES.UTIL_PHONE+':</td>','<td width="75%" id="'+ids.phoneNumber+'"> </td>','</tr>','<tr>','<td width="25%">'+VIEWPORT_PROPERTIES.UTIL_MOBILEPHONE+':</td>','<td width="75%" id="'+ids.mobilePhoneNumber+'"> </td>','</tr>','<tr>','<td width="25%">'+VIEWPORT_PROPERTIES.UTIL_FAX+':</td>','<td width="75%" id="'+ids.faxNumber+'"> </td>','</tr>','<tr>','<td width="25%">'+VIEWPORT_PROPERTIES.UTIL_EMAIL+':</td>','<td width="75%" id="'+ids.email+'"> </td>','</tr>','<tr>','<td width="25%">'+VIEWPORT_PROPERTIES.UTIL_WEBSITEURL+':</td>','<td width="75%" id="'+ids.url+'"> </td>','</tr>','</table>'].join('');el.insertHtml('afterBegin',table);Pulse.util.FieldBuilder.buildSelectBoxMonitor(Ext.get(ids.representsRegion),{name:'representsRegion',getChangesAlways:true,object:this.representative,options:this.configuration.get('representsRegion'),editor:this});representsCountryMonitor=Pulse.util.FieldBuilder.buildTextFieldMonitor(Ext.get(ids.representsCountry),{name:'representsCountry',width:50,showMsgFlag:false,object:this.representative,editor:this});this.requiredFieldMonitors.push(representsCountryMonitor);Pulse.util.FieldBuilder.buildTextFieldMonitor(Ext.get(ids.representsState),{name:'representsState',width:50,allowBlank:true,showMsgFlag:false,object:this.representative,editor:this});nameMonitor=Pulse.util.FieldBuilder.buildTextFieldMonitor(Ext.get(ids.name),{name:'name',showMsgFlag:false,object:this.representative,editor:this});this.requiredFieldMonitors.push(nameMonitor);Pulse.util.FieldBuilder.buildTextFieldMonitor(Ext.get(ids.nameAffix),{name:'nameAffix',allowBlank:true,showMsgFlag:false,object:this.representative,editor:this});Pulse.util.FieldBuilder.buildTextFieldMonitor(Ext.get(ids.contactPerson),{name:'contactPerson',allowBlank:true,showMsgFlag:false,object:this.representative,editor:this});Pulse.util.FieldBuilder.buildTextFieldMonitor(Ext.get(ids.street),{name:'street',allowBlank:true,showMsgFlag:false,object:this.representative,editor:this});Pulse.util.FieldBuilder.buildTextFieldMonitor(Ext.get(ids.postalCode),{name:'postalCode',allowBlank:true,width:50,showMsgFlag:false,object:this.representative,editor:this});Pulse.util.FieldBuilder.buildTextFieldMonitor(Ext.get(ids.city),{name:'city',allowBlank:true,showMsgFlag:false,object:this.representative,editor:this});Pulse.util.FieldBuilder.buildTextFieldMonitor(Ext.get(ids.state),{name:'state',allowBlank:true,showMsgFlag:false,object:this.representative,editor:this});countryMonitor=Pulse.util.FieldBuilder.buildTextFieldMonitor(Ext.get(ids.country),{name:'country',width:50,showMsgFlag:false,object:this.representative,editor:this});this.requiredFieldMonitors.push(countryMonitor);Pulse.util.FieldBuilder.buildTextFieldMonitor(Ext.get(ids.addressAffix),{name:'addressAffix',allowBlank:true,showMsgFlag:false,object:this.representative,editor:this});Pulse.util.FieldBuilder.buildTextFieldMonitor(Ext.get(ids.phoneNumber),{name:'phoneNumber',allowBlank:true,showMsgFlag:false,object:this.representative,editor:this});Pulse.util.FieldBuilder.buildTextFieldMonitor(Ext.get(ids.mobilePhoneNumber),{name:'mobilePhoneNumber',allowBlank:true,showMsgFlag:false,object:this.representative,editor:this});Pulse.util.FieldBuilder.buildTextFieldMonitor(Ext.get(ids.faxNumber),{name:'faxNumber',allowBlank:true,showMsgFlag:false,object:this.representative,editor:this});Pulse.util.FieldBuilder.buildTextFieldMonitor(Ext.get(ids.email),{name:'email',allowBlank:true,showMsgFlag:false,object:this.representative,editor:this});Pulse.util.FieldBuilder.buildTextFieldMonitor(Ext.get(ids.url),{name:'url',allowBlank:true,showMsgFlag:false,object:this.representative,editor:this});}catch(e){FATAL(e,this,'buildEditor');}},onRender:function(){if(this.DBG){THROW({props:['renderTo','renderTo.body','masterEditor'],args:arguments},this,'onRender');}
try{if(this.renderTo.type=='SubEditorWindow'||this.renderTo.type=='SubEditorPanel'){this.buildEditor(this.renderTo.body);}else{FATAL('TODO',this,'onRender');}}catch(e){FATAL(e,this,'onRender');}},initComponent:function(){Pulse.util.RepresentativeEditor.superclass.initComponent.call(this);if(this.DBG){props=['id','type'];props=props.concat(DBG.getPropertyArray(this.initialConfig));THROW({args:arguments,props:props},this,'initComponent.RepresentativeEditor');}
try{if(typeof(this.requiredFieldMonitors)=='undefined'){this.requiredFieldMonitors=[];}}catch(e){FATAL(e,this,'initComponent.RepresentativeEditor');}}};Pulse.util.RepresentativeEditor=Ext.extend(Pulse.Editor,RepresentativeEditor);DBG.RepresentativesEditor=DBG.apply(DBG.Editor,{initComponent:{RepresentativesEditor:false},initTab:false,onRender:false,editRepresentative:false,deleteRepresentative:false,showDBGButton:false});RepresentativesEditor={component:'util',type:'RepresentativesEditor',DBG:DBG.RepresentativesEditor,initTab:function(){if(this.DBG){THROW({args:arguments},this,'initTab');}
try{if(true!==this.tab.isInitialized){this.tab.getTopToolbar().insertButton(0,this.getButtons());this.tab.isInitialized=true;}}catch(e){FATAL(e,this,'initTab');}},getButtons:function(){buttons=[];editButtonCFG={scope:this,disabled:true,handler:function(){this.showRepresentativeEditorWindow(null);},iconCls:'addIconCls',text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CREATE};if(typeof(this.editURL)=='string'&&this.editURL!==''&&typeof(this.saveURL)=='string'&&this.saveURL!==''){editButtonCFG.disabled=false;}
this.editButton=new Ext.Toolbar.Button(editButtonCFG);buttons.push(this.editButton);buttons.push(new Ext.Toolbar.Separator());if(this.DBG&&true===this.DBG.showDBGButton){DBGButtonCFG={scope:this,disabled:false,handler:function(){FATAL(this,this,'DBG','DBG');},text:'DBG'}
buttons.push(new Ext.Toolbar.Button(DBGButtonCFG));buttons.push(new Ext.Toolbar.Separator());}
return buttons;},showRepresentativeEditorWindow:function(id){try{if(typeof(this.windowElement)=='undefined'||this.windowElement===null){this.windowElement=VIEWPORT.getEl().createChild({tag:'div',id:this.id+'.createFormWindow.el'});}
representativeEditorWindowCFG={html:'...',title:VIEWPORT_PROPERTIES.BUTTON_TEXT_EDIT,modal:true,autoScroll:true,renderTo:this.windowElement,height:400,width:500,resizable:true,id:this.id+'.representativeEditorWindow',masterEditor:this,url:this.editURL,params:{id:id}};this.representativeEditorWindow=new Pulse.SubEditorWindow(representativeEditorWindowCFG);this.representativeEditorWindow.on('show',function(){this.initializePanel();});this.representativeEditorWindow.on('beforeclose',function(){if(true===this.representativeEditorWindow.hasChanges()){Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE,VIEWPORT_PROPERTIES.TEXT_UNSAVEDCHANGES+'<br />'+
VIEWPORT_PROPERTIES.TEXT_REALLYCONTINUE,function(response){if('yes'===response){this.representativeEditorWindow.reset();this.representativeEditorWindow.close();}},this);return false;}},this);this.representativeEditorWindow.on('MSG',function(msgString,editor){if(msgString.toUpperCase()=='SAVESUCCESS'){this.gridStore.reload();}},this);this.representativeEditorWindow.show(this.representativeEditorWindow);this.representativeEditorWindow.setPosition(this.grid.getPosition());}catch(e){FATAL(e,this,'showRepresentativeEditorWindow');}},onRender:function(){if(this.DBG){THROW({props:['renderTo'],args:arguments},this,'onRender');}
try{this.buildGrid(this.renderTo);}catch(e){FATAL(e,this,'onRender');}},getRecord:function(){return new Ext.data.Record.create([{name:'id'},{name:'representsRegion'},{name:'representsCountry'},{name:'representsState'},{name:'name'},{name:'nameAffix'},{name:'contactPerson'},{name:'addressAffix'},{name:'street'},{name:'postalCode'},{name:'city'},{name:'state'},{name:'country'},{name:'phoneNumber'},{name:'faxNumber'},{name:'url'}]);},getStore:function(record){return new Ext.data.JsonStore({pruneModifiedRecords:true,fields:record,root:'data',remoteSort:true,sortInfo:{field:this.defaultSortField,direction:this.defaultSortDirection},totalProperty:'total',url:this.loadURL});},getPagingToolbar:function(){this.pageSizeBox=new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:['size'],sortInfo:{field:'size',direction:"ASC"},data:[[10],[20],[50],[100]]}),displayField:'size',valueField:'size',selectOnFocus:true,mode:'local',triggerAction:'all',width:60,blankText:''+this.defaultPageSize,emptyText:''+this.defaultPageSize,enableKeyEvents:true});this.pageSizeBox.on('keydown',function(box,evt){if(evt.getKey()==Ext.EventObject.ENTER){this.gridStore.reload();}},this);return new Ext.PagingToolbar({displayInfo:true,pageSize:this.defaultPageSize,store:this.gridStore,items:['-',this.pageSizeBox]});},editRepresentative:function(representativeId){if(this.DBG){THROW({args:arguments},this,'editRepresentative');}
if(typeof(representativeId)!='number'){return;}
try{this.showRepresentativeEditorWindow(representativeId);}catch(e){FATAL(e,this,'editRepresentative');}},deleteRepresentative:function(representativeId){if(this.DBG){THROW({args:arguments},this,'deleteRepresentative');}
if(typeof(representativeId)!='number'){return;}
try{rec=null;if(typeof(this.gridStore)!='undefined'&&this.gridStore!==null){this.gridStore.each(function(r){if(r.get('id')==representativeId){rec=r;return false;}});}
if(rec===null){return;}
Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE+':&#160;"'+representativeId+'"',VIEWPORT_PROPERTIES.MSG_REALLYDELETE+'<br/>"'+rec.get('name')+'"',function(response){if('yes'===response){requestCFG={url:this.deleteURL,method:'POST',scope:this,success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){this.gridStore.remove(options.rec);this.fireEvent('MSG','deletesuccess',this);}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this,'deleteRepresentative');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this,'deleteRepresentative');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this,'deleteRepresentative');}},rec:rec,params:{id:representativeId}};Ext.Ajax.request(requestCFG);}},this);}catch(e){FATAL(e,this,'deleteRepresentative');}},getColumnModel:function(gridSm){columns=[{dataIndex:'representsRegion',header:VIEWPORT_PROPERTIES.UTIL_REPRESENTSREGION,width:75,sortable:true},{dataIndex:'representsCountry',header:VIEWPORT_PROPERTIES.UTIL_REPRESENTSCOUNTRY,width:75,sortable:true},{dataIndex:'representsState',header:VIEWPORT_PROPERTIES.UTIL_REPRESENTSSTATE,width:75,sortable:true},{dataIndex:'name',header:VIEWPORT_PROPERTIES.UTIL_NAME,id:'name',width:90,sortable:true},{dataIndex:'nameAffix',header:VIEWPORT_PROPERTIES.UTIL_NAMEAFFIX,width:90,sortable:true},{dataIndex:'contactPerson',header:VIEWPORT_PROPERTIES.UTIL_CONTACTPERSON,width:90,sortable:true},{dataIndex:'street',header:VIEWPORT_PROPERTIES.UTIL_STREET,width:90,sortable:true},{dataIndex:'postalCode',header:VIEWPORT_PROPERTIES.UTIL_POSTALCODE,width:50,sortable:true},{dataIndex:'city',header:VIEWPORT_PROPERTIES.UTIL_CITY,width:90,sortable:true},{dataIndex:'country',header:VIEWPORT_PROPERTIES.UTIL_COUNTRY,width:45,sortable:true}];if(typeof(this.editURL)!='undefined'&&this.editURL!==''){_id=this.id;columns.push({header:'',dataIndex:'id',width:25,fixed:true,sortable:false,renderer:function(id){try{return FilterEditor.getGridImageField({functionString:'Ext.getCmp(\''+_id+'\').editRepresentative('+id+')',iconCls:'editIconCls_14',qtip:VIEWPORT_PROPERTIES.BUTTON_TEXT_EDIT});}catch(renderError){return'<img src="'+Ext.BLANK_IMAGE_URL+'" width="14" height="14" '+'border="0" class="errorIconCls_14" ext:qtip="render-error: '+'try to reload ('+renderError+')"/>';}}});}
if(typeof(this.deleteURL)!='undefined'&&this.deleteURL!==''){columns.push({header:'',dataIndex:'id',width:25,fixed:true,sortable:false,renderer:function(id){try{return FilterEditor.getGridImageField({functionString:'Ext.getCmp(\''+_id+'\').deleteRepresentative('+id+')',iconCls:'deleteIconCls_14',qtip:VIEWPORT_PROPERTIES.BUTTON_TEXT_DELET});}catch(renderError){return'<img src="'+Ext.BLANK_IMAGE_URL+'" width="14" height="14" '+'border="0" class="errorIconCls_14" ext:qtip="render-error: '+'try to reload ('+renderError+')"/>';}}});}
return new Ext.grid.ColumnModel(columns);},buildGrid:function(elId){if(typeof(elId)!='string'||elId===''){FATAL({args:arguments},this,'buildGrid','element.id undefined');}
gridStoreRecord=this.getRecord();this.gridStore=this.getStore(gridStoreRecord);this.pagingToolBar=this.getPagingToolbar();this.gridStore.on('beforeLoad',function(store,options){store.isLoading=true;if(this.pageSizeBox.getRawValue()!==''){try{limit=parseInt(this.pageSizeBox.getRawValue().trim(),10);this.pagingToolBar.pageSize=limit;options.params.limit=limit;}catch(e){}}else{this.pagingToolBar.pageSize=this.defaultPageSize;options.params.limit=this.defaultPageSize;}
if(typeof(this.filterIds)!='undefined'){for(i=0;i<this.filterIds.length;i++){filterEl=Ext.get(config.filterIds[i]);if(typeof(filterEl)!='undefined'){try{pname=filterEl.dom.name;pvalue=filterEl.getValue().trim();options.params[pname]=pvalue;}catch(e){}}}}},this);this.gridStore.on('load',function(store,recs,options){(function(){this.isLoading=false;}).defer(500,this);},this.gridStore);this.gridStore.on('loadexception',function(){(function(){this.isLoading=false;}).defer(500,this);},this.gridStore);if(typeof(this.filterIds)!='undefined'){for(i=0;i<this.filterIds.length;i++){filterEl=Ext.get(this.filterIds[i]);if(typeof(filterEl)!='undefined'){filterEl.on({'keyup':{scope:this.gridStore,fn:function(evt,el,opts){(function(){if(true===this.isLoading){return;}
this.reload();}).defer(500,this);}}},this.gridStore);}}}
gridCm=this.getColumnModel();gridCFG={store:this.gridStore,cm:gridCm,renderTo:elId,autoExpandColumn:'id',loadMask:true,viewConfig:{forceFit:true},frame:false,bbar:this.pagingToolBar};this.grid=new Ext.grid.GridPanel(gridCFG);if(typeof(this.tab)!='undefined'){this.grid.setWidth(this.tab.getInnerWidth());tabMsgPanel=Ext.getCmp(this.tab.id+'.msgPanel');msgPanelHeight=0;if(tabMsgPanel.isVisible()){msgPanelHeight=tabMsgPanel.getSize().height;}
this.grid.setHeight(this.tab.getInnerHeight()-msgPanelHeight);this.tab.on({'resize':{scope:this,fn:function(tab,adjWidth,adjHeight,rawWidth,rawHeight){tabContentPanel=Ext.getCmp(this.tab.id+'.contentPanel');this.grid.setWidth(this.tab.getInnerWidth());tabMsgPanel=Ext.getCmp(this.tab.id+'.msgPanel');msgPanelHeight=0;if(tabMsgPanel.isVisible()){msgPanelHeight=tabMsgPanel.getSize().height;}
this.grid.setHeight(this.tab.getInnerHeight()-msgPanelHeight);}}},this);}
this.gridStore.load({params:{start:this.defaultPageStart,limit:this.defaultPageSize}});return this.grid;},setDefaults:function(){if(typeof(this.defaultPageStart)!='number'){this.defaultPageStart=0;}
if(typeof(this.defaultPageSize)!='number'){this.defaultPageSize=25;}
if(typeof(this.defaultSortField)!='string'){this.defaultSortField='name';}
if(typeof(this.defaultSortDirection)!='string'){this.defaultSortDirection='ASC';}
return;},initComponent:function(boolInitTab){Pulse.util.RepresentativesEditor.superclass.initComponent.call(this,boolInitTab);if(this.DBG){props=['id','type','subEditors'];props=props.concat(DBG.getPropertyArray(this.initialConfig));THROW({args:arguments,props:props},this,'initComponent.RepresentativesEditor');}
try{this.setDefaults();if(typeof(this.tab)!='undefined'&&false!==boolInitTab){this.initTab();}}catch(e){FATAL(e,this,'initComponent.RepresentativesEditor');}}};Pulse.util.RepresentativesEditor=Ext.extend(Pulse.Editor,RepresentativesEditor);DBG.RetailerEditor=DBG.apply(DBG.Editor,{initComponent:{RetailerEditor:false},initTab:true,onRender:false,buildEditor:false,showDBGButton:false,initialize:{Editor:false}});RetailerEditor={component:'util',type:'RetailerEditor',implementsConfigurable:true,DBG:DBG.RetailerEditor,saveRetailer:function(){if(false===this.hasChanges()){return;}
if(typeof(this.requiredFieldMonitors)!='undefined'){for(var i=0;i<this.requiredFieldMonitors.length;i++){if(false===this.requiredFieldMonitors[i].validate()){return;}}}
params=this.getChanges({country:this.country});if(typeof(this.retailer)!='undefined'){params.id=this.retailer.id;}
requestCFG={url:this.saveURL,scope:this,method:'POST',success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){this.commit();if(typeof(this.masterEditor)!='undefined'){if(typeof(this.masterEditor.params)!='undefined'){this.masterEditor.params.id=decodedResponse.data.id;}else{this.masterEditor.params={id:decodedResponse.data.id};}
this.masterEditor.loadPanel();}
this.fireEvent('MSG','savesuccess',this);}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this,'create');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this,'create');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this,'create');}},params:params};Ext.Ajax.request(requestCFG);},getButtons:function(){buttons=[];saveButtonCFG={scope:this,disabled:true,handler:this.saveRetailer,iconCls:'saveIconCls',text:VIEWPORT_PROPERTIES.BUTTON_TEXT_SAVE};if(typeof(this.saveURL)=='string'&&this.saveURL!==''){saveButtonCFG.disabled=false;}
buttons.push(new Ext.Toolbar.Button(saveButtonCFG));buttons.push(new Ext.Toolbar.Separator());if(typeof(this.masterEditor)=='object'&&this.masterEditor.type=='SubEditorWindow'){closeButtonCFG={scope:this,disabled:false,handler:function(){this.masterEditor.close();},iconCls:'deleteIconCls',text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CLOSE};buttons.push(new Ext.Toolbar.Button(closeButtonCFG));buttons.push(new Ext.Toolbar.Separator());}
if(this.DBG&&true===this.DBG.showDBGButton){DBGButtonCFG={scope:this,disabled:false,handler:function(){FATAL(this,this,'DBG','DBG');},text:'DBG'}
buttons.push(new Ext.Toolbar.Button(DBGButtonCFG));buttons.push(new Ext.Toolbar.Separator());DBGConfigurationButtonCFG={scope:this,disabled:false,handler:function(){FATAL(this.configuration.getConfiguration(),this,'DBGC','DBGC');},text:'DBGC'}
buttons.push(new Ext.Toolbar.Button(DBGConfigurationButtonCFG));buttons.push(new Ext.Toolbar.Separator());}
return buttons;},buildRetailerPropertiesEditor:function(el){if(this.DBG){THROW({args:arguments,props:['renderTo']},this,'buildRetailerPropertiesEditor');}
try{if(this.country===null){throw({e:'EXCEPTION',args:arguments,description:'COUNTRY.UNDEFINED'});}
ids={customerNumber:Ext.id(),type:Ext.id(),name:Ext.id(),contactPerson:Ext.id(),street:Ext.id(),postalCode:Ext.id(),city:Ext.id(),state:Ext.id(),country:Ext.id(),phoneNumber:Ext.id(),mobilePhoneNumber:Ext.id(),faxNumber:Ext.id(),email:Ext.id(),url:Ext.id()};table=['<input type="hidden" name="country" value="'+country+'"/>','<table border="0" cellpadding="0" cellspacing="5" style="width:100%;">','<tr>','<td colspan="2" style="font-weight:bold;">'+VIEWPORT_PROPERTIES.UTIL_RETAILER+'</td>','</tr>','<tr>','<td width="25%">'+VIEWPORT_PROPERTIES.UTIL_CUSTOMERNUMBER+':</td>','<td width="75%" id="'+ids.customerNumber+'"> </td>','</tr>','<tr>','<td width="25%">'+VIEWPORT_PROPERTIES.UTIL_TYPE+':</td>','<td width="75%" id="'+ids.type+'"> </td>','</tr>','<tr>','<td width="25%">'+VIEWPORT_PROPERTIES.UTIL_NAME+':</td>','<td width="75%" id="'+ids.name+'"> </td>','</tr>','<tr>','<td width="25%">'+VIEWPORT_PROPERTIES.UTIL_CONTACTPERSON+':</td>','<td width="75%" id="'+ids.contactPerson+'"> </td>','</tr>','<tr>','<td width="25%">'+VIEWPORT_PROPERTIES.UTIL_STREET+':</td>','<td width="75%" id="'+ids.street+'"> </td>','</tr>','<tr>','<td width="25%">'+VIEWPORT_PROPERTIES.UTIL_POSTALCODE+':</td>','<td width="75%" id="'+ids.postalCode+'"> </td>','</tr>','<tr>','<td width="25%">'+VIEWPORT_PROPERTIES.UTIL_CITY+':</td>','<td width="75%" id="'+ids.city+'"> </td>','</tr>','<tr>','<td width="25%">'+VIEWPORT_PROPERTIES.UTIL_STATE+':</td>','<td width="75%" id="'+ids.state+'"> </td>','</tr>','<tr>','<td width="25%">'+VIEWPORT_PROPERTIES.UTIL_PHONE+':</td>','<td width="75%" id="'+ids.phoneNumber+'"> </td>','</tr>','<tr>','<td width="25%">'+VIEWPORT_PROPERTIES.UTIL_MOBILEPHONE+':</td>','<td width="75%" id="'+ids.mobilePhoneNumber+'"> </td>','</tr>','<tr>','<td width="25%">'+VIEWPORT_PROPERTIES.UTIL_FAX+':</td>','<td width="75%" id="'+ids.faxNumber+'"> </td>','</tr>','<tr>','<td width="25%">'+VIEWPORT_PROPERTIES.UTIL_EMAIL+':</td>','<td width="75%" id="'+ids.email+'"> </td>','</tr>','<tr>','<td width="25%">'+VIEWPORT_PROPERTIES.UTIL_WEBSITEURL+':</td>','<td width="75%" id="'+ids.url+'"> </td>','</tr>','</table>'].join('');el.insertHtml('beforeEnd',table);customerNumberMonitor=Pulse.util.FieldBuilder.buildTextFieldMonitor(Ext.get(ids.customerNumber),{name:'customerNumber',showMsgFlag:false,object:this.retailer,editor:this,allowBlank:(true===this.mandatoryCustomerNumber[country])?false:true});if(true===this.mandatoryCustomerNumber[country]){this.requiredFieldMonitors.push(customerNumberMonitor);}
Pulse.util.FieldBuilder.buildSelectBoxMonitor(Ext.get(ids.type),{name:'type',getChangesAlways:true,object:this.retailer,options:this.configuration.get('type'),editor:this});nameMonitor=Pulse.util.FieldBuilder.buildTextFieldMonitor(Ext.get(ids.name),{name:'name',showMsgFlag:false,object:this.retailer,editor:this});this.requiredFieldMonitors.push(nameMonitor);Pulse.util.FieldBuilder.buildTextFieldMonitor(Ext.get(ids.contactPerson),{name:'contactPerson',allowBlank:true,showMsgFlag:false,object:this.retailer,editor:this});Pulse.util.FieldBuilder.buildTextFieldMonitor(Ext.get(ids.street),{name:'street',allowBlank:true,showMsgFlag:false,object:this.retailer,editor:this});Pulse.util.FieldBuilder.buildTextFieldMonitor(Ext.get(ids.postalCode),{name:'postalCode',allowBlank:true,width:'50%',showMsgFlag:false,object:this.retailer,editor:this});Pulse.util.FieldBuilder.buildTextFieldMonitor(Ext.get(ids.city),{name:'city',allowBlank:true,showMsgFlag:false,object:this.retailer,editor:this});Pulse.util.FieldBuilder.buildTextFieldMonitor(Ext.get(ids.state),{name:'state',allowBlank:true,showMsgFlag:false,object:this.retailer,editor:this});Pulse.util.FieldBuilder.buildTextFieldMonitor(Ext.get(ids.mobilePhoneNumber),{name:'mobilePhoneNumber',allowBlank:true,showMsgFlag:false,object:this.retailer,editor:this});Pulse.util.FieldBuilder.buildTextFieldMonitor(Ext.get(ids.phoneNumber),{name:'phoneNumber',allowBlank:true,showMsgFlag:false,object:this.retailer,editor:this});Pulse.util.FieldBuilder.buildTextFieldMonitor(Ext.get(ids.faxNumber),{name:'faxNumber',allowBlank:true,showMsgFlag:false,object:this.retailer,editor:this});Pulse.util.FieldBuilder.buildTextFieldMonitor(Ext.get(ids.email),{name:'email',allowBlank:true,showMsgFlag:false,object:this.retailer,editor:this});Pulse.util.FieldBuilder.buildTextFieldMonitor(Ext.get(ids.url),{name:'url',allowBlank:true,showMsgFlag:false,object:this.retailer,editor:this});}catch(e){FATAL(e,this,'buildRetailerPropertiesEditor');}},buildRetailerLogoEditor:function(el){try{checked=false;if(typeof(this.retailer)!='undefined'&&typeof(this.retailer.logo)!='undefined'){checked=true;}
logoId=Ext.id();table=['<table border="0" cellpadding="0" cellspacing="5" style="width:100%;">','<tr>','<td colspan="2" style="font-weight:bold;">'+VIEWPORT_PROPERTIES.UTIL_LOGO+'</td>','</tr>','<tr>','<td width="25%">'+VIEWPORT_PROPERTIES.UTIL_LINKLOGO+':</td>','<td width="75%" id="'+logoId+'"> </td>','</tr>','</table>'].join('');el.insertHtml('beforeEnd',table);Pulse.util.FieldBuilder.buildCheckboxMonitor(Ext.get(logoId),{name:'logo',checked:checked,editor:this});}catch(e){FATAL(e,this,'buildRetailerLogoEditor');}},buildFilterEditor:function(el,prefix){try{header=null;size=null;filterLabels=null;bitset=null;switch(prefix){case'rsfCat':header=VIEWPORT_PROPERTIES.UTIL_RETAILSTORE;size=this.retailStoreFilterSize;if(typeof(this.retailStoreFilterCategories)=='undefined'){filterLabels=this.configuration.get('retailStoreFilter');}else{filterLabels=this.retailStoreFilterCategories;}
if(typeof(this.retailer)!='undefined'){bitset=this.retailer.retailStoreFilter;}
break;case'wsfCat':header=VIEWPORT_PROPERTIES.UTIL_WEBSHOP;size=this.webShopFilterSize;if(typeof(this.webShopFilterCategories)=='undefined'){filterLabels=this.configuration.get('webShopFilter');}else{filterLabels=this.webShopFilterCategories;}
if(typeof(this.retailer)!='undefined'){bitset=this.retailer.webShopFilter;}
break;default:throw({e:'EXCEPTION',args:arguments,description:'FILTER.UNDEFINED'});}
filterIds={};table=['<table border="0" cellpadding="0" cellspacing="5" style="width:100%;">','<tr>','<td colspan="4" style="font-weight:bold;">'+header+'</td>','</tr>'];even=false;for(var i=0;i<size;i++){c=i;if(false!==even){even=false;continue;}else{filterIds[c]=Ext.id();table.push('<tr>');table.push('<td width="25%">'+filterLabels[c]+'</td>');table.push('<td width="25%" id="'+filterIds[c]+'"> </td>');if(c+1>=size){table.push('<td colspan="2" width="50%"> </td>');}else{filterIds[c+1]=Ext.id();table.push('<td width="25%">'+filterLabels[c+1]+'</td>');table.push('<td width="25%" id="'+filterIds[c+1]+'"> </td>');}
table.push('</tr>');even=true;}}
table.push('</table>');el.insertHtml('beforeEnd',table.join(''));for(var i=0;i<size;i++){checked=false;if(typeof(bitset)!='undefined'&&bitset!==null&&true===bitset[i]){checked=true;}
Pulse.util.FieldBuilder.buildCheckboxMonitor(Ext.get(filterIds[i]),{name:prefix+i,checked:checked,editor:this});}}catch(e){FATAL(e,this,'buildFilterEditor');}},addEditorSpacer:function(el){try{el.insertHtml('beforeEnd','<div style="padding:5px 5px 5px 5px;"><hr class="adminHr"/></div>');}catch(e){FATAL(e,this,'addEditorSpacer');}},buildEditor:function(el){if(this.DBG){THROW({args:arguments,props:['renderTo']},this,'buildEditor');}
try{this.buildRetailerPropertiesEditor(el);if(null!==this.configuration.get('logo')){this.addEditorSpacer(el);this.buildRetailerLogoEditor(el);}
if(null!==this.configuration.get('retailStoreFilter')){if(typeof(this.retailStoreFilterSize)=='number'||this.retailStoreFilterSize!==0){this.addEditorSpacer(el);this.buildFilterEditor(el,'rsfCat');}}
if(null!==this.configuration.get('webShopFilter')){if(typeof(this.webShopFilterSize)=='number'||this.webShopFilterSize!==0){this.addEditorSpacer(el);this.buildFilterEditor(el,'wsfCat');}}}catch(e){FATAL(e,this,'buildEditor');}},onRender:function(){if(this.DBG){THROW({props:['renderTo','renderTo.body','masterEditor'],args:arguments},this,'onRender');}
try{if(this.renderTo.type=='SubEditorWindow'||this.renderTo.type=='SubEditorPanel'){this.buildEditor(this.renderTo.body);}else{FATAL('TODO',this,'onRender');}}catch(e){FATAL(e,this,'onRender');}},initComponent:function(){Pulse.util.RetailerEditor.superclass.initComponent.call(this);if(this.DBG){props=['id','type'];props=props.concat(DBG.getPropertyArray(this.initialConfig));THROW({args:arguments,props:props},this,'initComponent.RetailerEditor');}
try{this.country=null;if(typeof(this.retailer)!='undefined'&&typeof(this.retailer.country)=='string'&&this.retailer.country!==''){this.country=this.retailer.country;}else if(typeof(this.renderTo.params.country)=='string'&&this.renderTo.params.country!==''){this.country=this.renderTo.params.country;}
if(typeof(this.requiredFieldMonitors)=='undefined'){this.requiredFieldMonitors=[];}}catch(e){FATAL(e,this,'initComponent.RetailerEditor');}}};Pulse.util.RetailerEditor=Ext.extend(Pulse.Editor,RetailerEditor);DBG.RetailersEditor=DBG.apply(DBG.Editor,{initComponent:{RetailersEditor:false},initTab:false,onRender:false,editRetailer:false,deleteRetailer:false,showDBGButton:false});RetailersEditor={component:'util',type:'RetailersEditor',DBG:DBG.RetailersEditor,initTab:function(){if(this.DBG){THROW({args:arguments},this,'initTab');}
try{if(true!==this.tab.isInitialized){this.tab.getTopToolbar().insertButton(0,this.getButtons());this.tab.isInitialized=true;}}catch(e){FATAL(e,this,'initTab');}},getButtons:function(){buttons=[];editButtonCFG={scope:this,disabled:true,handler:function(){this.showRetailerEditorWindow(null);},iconCls:'addIconCls',text:VIEWPORT_PROPERTIES.BUTTON_TEXT_CREATE};if(typeof(this.editURL)=='string'&&this.editURL!==''&&typeof(this.saveURL)=='string'&&this.saveURL!==''){editButtonCFG.disabled=false;}
this.editButton=new Ext.Toolbar.Button(editButtonCFG);buttons.push(this.editButton);buttons.push(new Ext.Toolbar.Separator());for(var i=0;i<this.exportButtons.length;i++){buttonCFG={scope:this,disabled:true,exportNo:i,handler:function(_button,evt){this.exportRetailer(_button.exportNo);},iconCls:'file'+this.exportButtons[i].type+'IconCls',text:VIEWPORT_PROPERTIES.BUTTON_TEXT_EXPORT+' ('+this.exportButtons[i].type+')'};if(typeof(this.exportButtons[i].url)=='string'&&this.exportButtons[i].url!==''){buttonCFG.disabled=false;}
this.exportButtons[i].button=new Ext.Toolbar.Button(buttonCFG);buttons.push(this.exportButtons[i].button);buttons.push(new Ext.Toolbar.Separator());}
if(this.DBG&&true===this.DBG.showDBGButton){DBGButtonCFG={scope:this,disabled:false,handler:function(){FATAL(this,this,'DBG','DBG');},text:'DBG'}
buttons.push(new Ext.Toolbar.Button(DBGButtonCFG));buttons.push(new Ext.Toolbar.Separator());}
return buttons;},exportRetailer:function(exportNo){document.location.href=this.exportButtons[exportNo].url+'?country='+this.countrySelector.getCountry();},showRetailerEditorWindow:function(id){try{if(typeof(this.windowElement)=='undefined'||this.windowElement===null){this.windowElement=VIEWPORT.getEl().createChild({tag:'div',id:this.id+'.createFormWindow.el'});}
retailerEditorWindowCFG={html:'...',title:VIEWPORT_PROPERTIES.BUTTON_TEXT_EDIT,modal:true,autoScroll:true,renderTo:this.windowElement,height:400,width:500,resizable:true,id:this.id+'.retailerEditorWindow',masterEditor:this,url:this.editURL};if(typeof(id)!='undefined'&&id!==null){retailerEditorWindowCFG.params={id:id,country:this.countrySelector.getCountry()};}else{retailerEditorWindowCFG.params={country:this.countrySelector.getCountry()};}
this.retailerEditorWindow=new Pulse.SubEditorWindow(retailerEditorWindowCFG);this.retailerEditorWindow.on('show',function(){this.initializePanel();});this.retailerEditorWindow.on('beforeclose',function(){if(true===this.retailerEditorWindow.hasChanges()){Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE,VIEWPORT_PROPERTIES.TEXT_UNSAVEDCHANGES+'<br />'+
VIEWPORT_PROPERTIES.TEXT_REALLYCONTINUE,function(response){if('yes'===response){this.retailerEditorWindow.reset();this.retailerEditorWindow.close();}},this);return false;}},this);this.retailerEditorWindow.on('MSG',function(msgString,editor){if(msgString.toUpperCase()=='SAVESUCCESS'){this.gridStore.reload();}},this);this.retailerEditorWindow.show(this.retailerEditorWindow);this.retailerEditorWindow.setPosition(this.grid.getPosition());}catch(e){FATAL(e,this,'showRetailerEditorWindow');}},onRender:function(){if(this.DBG){THROW({props:['renderTo'],args:arguments},this,'onRender');}
try{this.buildGrid(this.renderTo);this.countrySelectorHandler(this.countrySelector);}catch(e){FATAL(e,this,'onRender');}},getRecord:function(){return new Ext.data.Record.create([{name:'id'},{name:'country'},{name:'customerNumber'},{name:'type'},{name:'name'},{name:'contactPerson'},{name:'street'},{name:'postalCode'},{name:'city'},{name:'phoneNumber'},{name:'faxNumber'},{name:'url'}]);},getStore:function(record){return new Ext.data.JsonStore({pruneModifiedRecords:true,fields:record,root:'data',remoteSort:true,sortInfo:{field:this.defaultSortField,direction:this.defaultSortDirection},totalProperty:'total',url:this.loadURL});},getPagingToolbar:function(){this.pageSizeBox=new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:['size'],sortInfo:{field:'size',direction:"ASC"},data:[[10],[20],[50],[100]]}),displayField:'size',valueField:'size',selectOnFocus:true,mode:'local',triggerAction:'all',width:60,blankText:''+this.defaultPageSize,emptyText:''+this.defaultPageSize,enableKeyEvents:true});this.pageSizeBox.on('keydown',function(box,evt){if(evt.getKey()==Ext.EventObject.ENTER){this.gridStore.reload();}},this);return new Ext.PagingToolbar({displayInfo:true,pageSize:this.defaultPageSize,store:this.gridStore,items:['-',this.pageSizeBox]});},editRetailer:function(retailerId){if(this.DBG){THROW({args:arguments},this,'editRetailer');}
if(typeof(retailerId)!='number'){return;}
try{this.showRetailerEditorWindow(retailerId);}catch(e){FATAL(e,this,'editRetailer');}},deleteRetailer:function(retailerId){if(this.DBG){THROW({args:arguments},this,'deleteRetailer');}
if(typeof(retailerId)!='number'){return;}
try{rec=null;if(typeof(this.gridStore)!='undefined'&&this.gridStore!==null){this.gridStore.each(function(r){if(r.get('id')==retailerId){rec=r;return false;}});}
if(rec===null){return;}
Ext.Msg.confirm(VIEWPORT_PROPERTIES.MSG_CONFIRMTITLE+':&#160;"'+retailerId+'"',VIEWPORT_PROPERTIES.MSG_REALLYDELETE+'<br/>"'+rec.get('name')+'"',function(response){if('yes'===response){requestCFG={url:this.deleteURL,method:'POST',scope:this,success:function(response,options){decodedResponse=Ext.decode(response.responseText);if(true===decodedResponse.status){this.gridStore.remove(options.rec);this.fireEvent('MSG','deletesuccess',this);}else{PulseError.Throw({e:'SERVER.ERROR',o:decodedResponse.error},this,'deleteRetailer');}},failure:function(response,options){if(typeof(response.responseText)=='undefined'){PulseError.Throw({e:'REQUEST.FAILED'},this,'deleteRetailer');}else{PulseError.Throw({e:'REQUEST.ERROR',o:{e:response.responseText}},this,'deleteRetailer');}},rec:rec,params:{id:retailerId}};Ext.Ajax.request(requestCFG);}},this);}catch(e){FATAL(e,this,'deleteRetailer');}},getColumnModel:function(gridSm){columns=[{dataIndex:'country',header:VIEWPORT_PROPERTIES.UTIL_COUNTRY,width:45,sortable:true},{dataIndex:'customerNumber',header:VIEWPORT_PROPERTIES.UTIL_CUSTOMERNUMBER,width:75,sortable:true},{dataIndex:'type',header:VIEWPORT_PROPERTIES.UTIL_TYPE,width:45,sortable:true},{dataIndex:'name',header:VIEWPORT_PROPERTIES.UTIL_NAME,id:'name',width:90,sortable:true},{dataIndex:'contactPerson',header:VIEWPORT_PROPERTIES.UTIL_CONTACTPERSON,width:90,sortable:true},{dataIndex:'street',header:VIEWPORT_PROPERTIES.UTIL_STREET,width:90,sortable:true},{dataIndex:'postalCode',header:VIEWPORT_PROPERTIES.UTIL_POSTALCODE,width:50,sortable:true},{dataIndex:'city',header:VIEWPORT_PROPERTIES.UTIL_CITY,width:90,sortable:true}];if(typeof(this.editURL)!='undefined'&&this.editURL!==''){_id=this.id;columns.push({header:'',dataIndex:'id',width:25,fixed:true,sortable:false,renderer:function(id){try{return FilterEditor.getGridImageField({functionString:'Ext.getCmp(\''+_id+'\').editRetailer('+id+')',iconCls:'editIconCls_14',qtip:VIEWPORT_PROPERTIES.BUTTON_TEXT_EDIT});}catch(renderError){return'<img src="'+Ext.BLANK_IMAGE_URL+'" width="14" height="14" '+'border="0" class="errorIconCls_14" ext:qtip="render-error: '+'try to reload ('+renderError+')"/>';}}});}
if(typeof(this.deleteURL)!='undefined'&&this.deleteURL!==''){columns.push({header:'',dataIndex:'id',width:25,fixed:true,sortable:false,renderer:function(id){try{return FilterEditor.getGridImageField({functionString:'Ext.getCmp(\''+_id+'\').deleteRetailer('+id+')',iconCls:'deleteIconCls_14',qtip:VIEWPORT_PROPERTIES.BUTTON_TEXT_DELET});}catch(renderError){return'<img src="'+Ext.BLANK_IMAGE_URL+'" width="14" height="14" '+'border="0" class="errorIconCls_14" ext:qtip="render-error: '+'try to reload ('+renderError+')"/>';}}});}
return new Ext.grid.ColumnModel(columns);},countrySelectorHandler:function(countrySel){if(countrySel.getCountry()===''){this.editButton.disable();for(var i=0;i<this.exportButtons.length;i++){this.exportButtons[i].button.disable();}}else{this.gridStore.reload();this.editButton.enable();for(var i=0;i<this.exportButtons.length;i++){if(typeof(this.exportButtons[i].url=='string')&&this.exportButtons[i].url!==''){this.exportButtons[i].button.enable();}}}},getGridToolbar:function(store){countrySelectorCFG={store:store,listener:false,scope:this,handler:'countrySelectorHandler'};if(typeof(this.countries!='undefined')){countrySelectorCFG.data=this.countries;}
this.countrySelector=new Pulse.CountrySelector(countrySelectorCFG);tbArray=[VIEWPORT_PROPERTIES.TEXT_SELECTED_COUNTRY+':&#160;'];tbArray=tbArray.concat(this.countrySelector.items);tbArray.push(new Ext.Toolbar.Separator());return tbArray;},buildGrid:function(elId){if(typeof(elId)!='string'||elId===''){FATAL({args:arguments},this,'buildGrid','element.id undefined');}
gridStoreRecord=this.getRecord();this.gridStore=this.getStore(gridStoreRecord);this.pagingToolBar=this.getPagingToolbar();this.gridStore.on('beforeLoad',function(store,options){store.isLoading=true;if(this.pageSizeBox.getRawValue()!==''){try{limit=parseInt(this.pageSizeBox.getRawValue().trim(),10);this.pagingToolBar.pageSize=limit;options.params.limit=limit;}catch(e){}}else{this.pagingToolBar.pageSize=this.defaultPageSize;options.params.limit=this.defaultPageSize;}
options.params.country=this.countrySelector.getCountry();if(typeof(this.filterIds)!='undefined'){for(i=0;i<this.filterIds.length;i++){filterEl=Ext.get(config.filterIds[i]);if(typeof(filterEl)!='undefined'){try{pname=filterEl.dom.name;pvalue=filterEl.getValue().trim();options.params[pname]=pvalue;}catch(e){}}}}},this);this.gridStore.on('load',function(store,recs,options){(function(){this.isLoading=false;}).defer(500,this);},this.gridStore);this.gridStore.on('loadexception',function(){(function(){this.isLoading=false;}).defer(500,this);},this.gridStore);if(typeof(this.filterIds)!='undefined'){for(i=0;i<this.filterIds.length;i++){filterEl=Ext.get(this.filterIds[i]);if(typeof(filterEl)!='undefined'){filterEl.on({'keyup':{scope:this.gridStore,fn:function(evt,el,opts){(function(){if(true===this.isLoading){return;}
this.reload();}).defer(500,this);}}},this.gridStore);}}}
gridCm=this.getColumnModel();gridCFG={store:this.gridStore,cm:gridCm,renderTo:elId,autoExpandColumn:'id',loadMask:true,viewConfig:{forceFit:true},frame:false,tbar:this.getGridToolbar(this.gridStore),bbar:this.pagingToolBar};this.grid=new Ext.grid.GridPanel(gridCFG);if(typeof(this.tab)!='undefined'){this.grid.setWidth(this.tab.getInnerWidth());tabMsgPanel=Ext.getCmp(this.tab.id+'.msgPanel');msgPanelHeight=0;if(tabMsgPanel.isVisible()){msgPanelHeight=tabMsgPanel.getSize().height;}
this.grid.setHeight(this.tab.getInnerHeight()-msgPanelHeight);this.tab.on({'resize':{scope:this,fn:function(tab,adjWidth,adjHeight,rawWidth,rawHeight){tabContentPanel=Ext.getCmp(this.tab.id+'.contentPanel');this.grid.setWidth(this.tab.getInnerWidth());tabMsgPanel=Ext.getCmp(this.tab.id+'.msgPanel');msgPanelHeight=0;if(tabMsgPanel.isVisible()){msgPanelHeight=tabMsgPanel.getSize().height;}
this.grid.setHeight(this.tab.getInnerHeight()-msgPanelHeight);}}},this);}
this.gridStore.load({params:{start:this.defaultPageStart,limit:this.defaultPageSize}});return this.grid;},setDefaults:function(){if(typeof(this.defaultPageStart)!='number'){this.defaultPageStart=0;}
if(typeof(this.defaultPageSize)!='number'){this.defaultPageSize=25;}
if(typeof(this.defaultSortField)!='string'){this.defaultSortField='name';}
if(typeof(this.defaultSortDirection)!='string'){this.defaultSortDirection='ASC';}
return;},initComponent:function(boolInitTab){Pulse.util.RetailersEditor.superclass.initComponent.call(this,boolInitTab);if(this.DBG){props=['id','type','subEditors'];props=props.concat(DBG.getPropertyArray(this.initialConfig));THROW({args:arguments,props:props},this,'initComponent.RetailersEditor');}
try{this.setDefaults();if(typeof(this.tab)!='undefined'&&false!==boolInitTab){this.initTab();}}catch(e){FATAL(e,this,'initComponent.RetailersEditor');}}};Pulse.util.RetailersEditor=Ext.extend(Pulse.Editor,RetailersEditor);